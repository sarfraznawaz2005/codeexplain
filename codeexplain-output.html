<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Explanation: src</title>
    <!-- Critical CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/base16/cupertino.min.css">

    <!-- Critical JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>
    <style>
/* Sidebar styles */
#sidebar a:hover {
    background-color: rgba(0, 123, 255, 0.1);
    color: #0056b3;
}

#sidebar a.active {
    background-color: #007bff;
    color: white;
}

#sidebar .folder-toggle:hover {
    background-color: rgba(0, 123, 255, 0.1);
    color: #0056b3;
}

/* Sidebar list styling */
#sidebar ul {
    list-style: none;
    line-height: 1.3;
}

#sidebar li {
    list-style: none;
}

/* Main content typography and styling */
.explanation-content {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    color: #495057;
}

.explanation-content h1,
.explanation-content h2,
.explanation-content h3,
.explanation-content h4,
.explanation-content h5,
.explanation-content h6 {
    color: #212529;
    font-weight: 600;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
    line-height: 1.3;
}

.explanation-content h1 {
    font-size: 1.75rem;
}

.explanation-content h2 {
    font-size: 1.5rem;
}

.explanation-content h3 {
    font-size: 1.25rem;
}

.explanation-content h4 {
    font-size: 1.1rem;
}

.explanation-content h5 {
    font-size: 1rem;
}

.explanation-content h6 {
    font-size: 0.9rem;
}

.explanation-content p {
    margin-bottom: 1rem;
    line-height: 1.7;
    text-align: justify;
}

.explanation-content ul,
.explanation-content ol {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
}

.explanation-content li {
    margin-bottom: 0.5rem;
    line-height: 1.6;
}

.explanation-content li p {
    margin-bottom: 0.5rem;
}

.explanation-content code {
    background-color: #f8f9fa;
    padding: 0.125rem 0.25rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
    color: #d73a49;
    font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
}

.explanation-content pre {
    background-color: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 0.375rem;
    padding: 1rem;
    margin: 1rem 0;
    overflow-x: auto;
    font-size: 0.875rem;
    line-height: 1.5;
}

.explanation-content pre code {
    background-color: transparent;
    padding: 0;
    color: inherit;
    border: none;
}

/* Ensure highlight.js styles don't conflict */
.explanation-content pre.hljs {
    background-color: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 0.375rem;
    padding: 1rem;
    margin: 1rem 0;
    overflow-x: auto;
    font-size: 0.875rem;
    line-height: 1.5;
}

/* Code block styling */
.code-container pre code {
    font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace !important;
}

/* Ensure highlight.js styles are applied to code container */
.code-container pre code.hljs {
    background: transparent;
    color: inherit;
}

.explanation-content blockquote {
    border-left: 4px solid #007bff;
    padding-left: 1rem;
    margin: 1.5rem 0;
    color: #6c757d;
    font-style: italic;
}

.explanation-content table {
    width: 100%;
    margin-bottom: 1rem;
    border-collapse: collapse;
}

.explanation-content th,
.explanation-content td {
    padding: 0.75rem;
    border: 1px solid #dee2e6;
    text-align: left;
}

.explanation-content th {
    background-color: #f8f9fa;
    font-weight: 600;
}

.explanation-content strong {
    font-weight: 600;
    color: #212529;
}

.explanation-content em {
    font-style: italic;
    color: #495057;
}

/* Card improvements */
.card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

/* File name hover cursor */
.toggle-code:hover {
    cursor: pointer;
}

/* Navigation arrows */
#nav-arrows {
    opacity: 0.8;
    transition: opacity 0.3s ease;
}

#nav-arrows:hover {
    opacity: 1;
}

/* Zoom controls */
.btn-group .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.btn-group .btn {
    transition: all 0.2s ease;
}

.btn-group .btn:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* Mermaid diagram controls */
.mermaid-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin: 10px 0;
    padding: 10px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #dee2e6;
    position: relative;
    z-index: 10;
    /* Ensure controls are above the diagram */
    contain: layout style;
    /* Isolate controls from diagram transforms */
}

.mermaid-controls .btn {
    padding: 6px 12px;
    font-size: 0.875rem;
    border-radius: 6px;
}

.zoom-level {
    font-weight: 600;
    color: #495057;
    min-width: 60px;
    text-align: center;
}

/* Responsive mermaid containers */
.mermaid-diagram-container {
    position: relative;
    overflow: hidden;
    /* Ensure diagram doesn't overflow container */
    border-radius: 8px;
    border: 1px solid #dee2e6;
    background: white;
    min-height: 200px;
    contain: layout;
    /* Isolate layout calculations */
}

.mermaid {
    display: block;
    width: 100%;
    min-height: 200px;
    cursor: grab;
    transition: transform 0.1s ease;
    position: relative;
    z-index: 1;
    /* Ensure diagram is below controls */
    contain: layout style paint;
    /* Isolate diagram from controls */
}

.mermaid svg {
    width: 100%;
    height: auto;
    min-height: 200px;
}

.mermaid.dragging {
    cursor: grabbing;
}

.mermaid-zoomable {
    transform-origin: center center;
}

/* Fullscreen mode */
.mermaid-fullscreen {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    background: white !important;
    z-index: 9999 !important;
    padding: 20px !important;
    box-sizing: border-box !important;
}

.mermaid-fullscreen svg {
    width: 100% !important;
    height: 100% !important;
}

.fullscreen-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.8);
    z-index: 9998;
    display: none;
}

.fullscreen-overlay.active {
    display: block;
}

/* Responsive breakpoints for diagrams */
@media (max-width: 768px) {
    .mermaid-diagram-container {
        min-height: 150px;
    }

    .mermaid svg {
        min-height: 150px;
    }

    .mermaid-controls {
        flex-wrap: wrap;
        gap: 5px;
    }

    .mermaid-controls .btn {
        padding: 4px 8px;
        font-size: 0.75rem;
    }
}
    </style>

    <script>
(function () {
    // Constants for configuration
    const SIDEBAR_DEFAULT_WIDTH = 280;
    const SIDEBAR_MIN_WIDTH = 250;
    const SIDEBAR_MAX_WIDTH = 450;
    const MOBILE_BREAKPOINT = 768;
    const COPY_FEEDBACK_DURATION = 2000;

    // Cache DOM elements and other state (assigned in DOMContentLoaded)
    let cachedFileEntries;
    let cachedSidebarLinks;

    // Initialize syntax highlighting
    document.addEventListener('DOMContentLoaded', function () {
        // Configure marked to use highlight.js for code blocks (after marked is loaded)
        const { Marked } = window.marked;
        const { markedHighlight } = window.markedHighlight;

        // Create Marked instance with the highlight plugin
        const markedInstance = new Marked(
            { gfm: true },
            markedHighlight({
                langPrefix: 'hljs language-',
                emptyLangClass: 'hljs',
                highlight(code, lang) {
                    const language = hljs.getLanguage(lang) ? lang : 'plaintext';
                    return hljs.highlight(code, { language }).value;
                }
            })
        );

        // Apply syntax highlighting to code blocks in AI explanations
        if (typeof hljs !== 'undefined') {
            document.querySelectorAll('.explanation-content pre code').forEach((block) => {
                if (!block.classList.contains('hljs')) {
                    hljs.highlightElement(block);
                }
            });
        }

        // Cache DOM elements - convert NodeList to Array for better performance
        cachedFileEntries = Array.from(document.querySelectorAll('.file-entry'));
        cachedSidebarLinks = document.querySelectorAll('#sidebar a[href^=\"#file-\"]');
        
        // If no sidebar exists, set to empty NodeList to prevent errors
        if (cachedSidebarLinks.length === 0) {
            cachedSidebarLinks = [];
        }

        // Initialize layout
        initializeLayout();

        // Initial active item update
        updateActiveSidebarItem();

        // Update navigation arrows
        updateNavigationArrows();

        // Function to toggle folder icons
        function toggleFolderIcon(folderToggle, force) {
            const folderContents = folderToggle.nextElementSibling;
            const folderIcon = folderToggle.querySelector('.folder-icon');
            const isExpanded = force !== undefined ? force : !folderContents.classList.contains('d-none');

            if (isExpanded) {
                folderIcon.classList.remove('fa-chevron-right');
                folderIcon.classList.add('fa-chevron-down');
            } else {
                folderIcon.classList.remove('fa-chevron-down');
                folderIcon.classList.add('fa-chevron-right');
            }
        }

        // Initialize folder icons for expanded folders
        document.querySelectorAll('.folder-toggle').forEach(toggle => {
            const folderContents = toggle.nextElementSibling;
            if (folderContents && !folderContents.classList.contains('d-none')) {
                toggleFolderIcon(toggle, true);
            }
        });

        // Code folding with dynamic loading
        document.addEventListener('click', function (e) {
            if (e.target.closest('.toggle-code')) {
                const toggleElement = e.target.closest('.toggle-code');
                const fileEntry = toggleElement.closest('.file-entry');
                const codeContainer = fileEntry.querySelector('.code-container');
                const icon = toggleElement.querySelector('i');
                const fileIndex = parseInt(fileEntry.getAttribute('data-file-index'));
                const spinner = codeContainer.querySelector('.spinner-border');
                const loadingText = codeContainer.querySelector('.loading-text');

                // Check if code is already loaded
                const isLoaded = codeContainer.hasAttribute('data-loaded');

                if (!isLoaded) {
                    // Show loading state
                    spinner.style.display = 'inline-block';
                    loadingText.textContent = 'Loading code...';

                    // Load code content from pre-embedded data
                    const codeContentDiv = codeContainer.querySelector('.code-content');
                    if (codeContentDiv) {
                        const highlightedCode = codeContentDiv.innerHTML;

                        // Replace placeholder with actual code
                        codeContainer.innerHTML = `
                            <pre class="hljs p-3 mb-0" style="background: transparent;"><code class="hljs">${highlightedCode}</code></pre>
                        `;

                        // Mark as loaded
                        codeContainer.setAttribute('data-loaded', 'true');
                    } else {
                        // Fallback if content not found
                        codeContainer.innerHTML = `
                            <div class="p-3 text-center text-muted">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                Code content not available
                            </div>
                        `;
                        codeContainer.setAttribute('data-loaded', 'true');
                    }
                }

                // Toggle visibility
                if (codeContainer.classList.contains('d-none')) {
                    codeContainer.classList.remove('d-none');
                    icon.classList.remove('fa-chevron-right');
                    icon.classList.add('fa-chevron-down');
                } else {
                    codeContainer.classList.add('d-none');
                    icon.classList.remove('fa-chevron-down');
                    icon.classList.add('fa-chevron-right');
                }
            }
        });

        // Copy explanation functionality
        document.addEventListener('click', function (e) {
            if (e.target.closest('.copy-explanation')) {
                const button = e.target.closest('.copy-explanation');
                const explanationContainer = button.closest('.file-entry').querySelector('.explanation-content');
                const explanationText = explanationContainer.textContent.trim();

                navigator.clipboard.writeText(explanationText).then(() => {
                    const originalText = button.innerHTML;
                    button.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    setTimeout(() => {
                        button.innerHTML = originalText;
                    }, COPY_FEEDBACK_DURATION);
                });
            }
        });


        // Sidebar navigation and folder toggle
        document.addEventListener('click', function (e) {
            if (e.target.closest('a[href^="#file-"]')) {
                e.preventDefault();
                const targetId = e.target.closest('a').getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                }
            }

            // Folder toggle functionality
            if (e.target.closest('.folder-toggle')) {
                const folderToggle = e.target.closest('.folder-toggle');
                const folderContents = folderToggle.nextElementSibling;
                folderContents.classList.toggle('d-none');
                toggleFolderIcon(folderToggle);
            }
        });

        // Sidebar toggle functionality
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.querySelector('main');

        if (sidebarToggle && sidebar && mainContent) {
            sidebarToggle.addEventListener('click', () => {
                const isCollapsed = sidebar.style.transform === 'translateX(-100%)';
                if (window.innerWidth <= 768) {
                    // Mobile: toggle between collapsed and expanded
                    if (isCollapsed) {
                        sidebar.style.transform = 'translateX(0)';
                        sidebar.style.opacity = '1';
                        sidebar.style.pointerEvents = 'auto';
                        mainContent.style.marginLeft = '280px';
                    } else {
                        sidebar.style.transform = 'translateX(-100%)';
                        sidebar.style.opacity = '0';
                        sidebar.style.pointerEvents = 'none';
                        mainContent.style.marginLeft = '0';
                    }
                }
            });
        }

        // Sidebar drag resizing
        const sidebarResizer = document.getElementById('sidebar-resizer');
        let isResizing = false;
        let startX = 0;
        let startWidth = 0;
        let animationFrameId = null;

        if (sidebarResizer && sidebar && mainContent) {
            sidebarResizer.addEventListener('mousedown', (e) => {
                isResizing = true;
                startX = e.clientX;
                startWidth = sidebar.offsetWidth;
                document.body.style.cursor = 'ew-resize';
                document.body.style.userSelect = 'none';
            });

            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;

                // Cancel any pending animation frame
                if (animationFrameId !== null) {
                    cancelAnimationFrame(animationFrameId);
                }

                // Schedule update on next animation frame
                animationFrameId = requestAnimationFrame(() => {
                    const newWidth = startWidth + (e.clientX - startX);
                    const clampedWidth = Math.max(SIDEBAR_MIN_WIDTH, Math.min(SIDEBAR_MAX_WIDTH, newWidth));

                    sidebar.style.width = `${clampedWidth}px`;
                    mainContent.style.marginLeft = `${clampedWidth}px`;
                    mainContent.style.width = `calc(100% - ${clampedWidth}px)`;
                    animationFrameId = null;
                });
            });

            document.addEventListener('mouseup', () => {
                if (isResizing) {
                    isResizing = false;
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                }
            });
        }

        // Handle window resize using the shared layout function
        window.addEventListener('resize', () => {
            applyLayoutStyles(window.innerWidth <= MOBILE_BREAKPOINT);
        });

        // Navigation arrow event listeners
        const prevFileBtn = document.getElementById('prev-file');
        const nextFileBtn = document.getElementById('next-file');
        
        if (prevFileBtn && nextFileBtn) {
            prevFileBtn.addEventListener('click', () => {
                const currentFile = getCurrentVisibleFile();
                const prevFile = getPreviousFile(currentFile);
                if (prevFile) {
                    prevFile.scrollIntoView({ behavior: 'smooth' });
                }
            });

            nextFileBtn.addEventListener('click', () => {
                const currentFile = getCurrentVisibleFile();
                const nextFile = getNextFile(currentFile);
                if (nextFile) {
                    nextFile.scrollIntoView({ behavior: 'smooth' });
                }
            });
        }

        // Use requestAnimationFrame for smoother scroll performance
        let isScrolling = false;
        window.addEventListener('scroll', function () {
            if (!isScrolling) {
                window.requestAnimationFrame(function () {
                    updateActiveSidebarItem();
                    isScrolling = false;
                });
                isScrolling = true;
            }
        });

    });

    // Shared function to apply layout styles based on screen size
    function applyLayoutStyles(isMobile) {
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const mainContent = document.querySelector('main');

        // If sidebar doesn't exist (e.g., in flowchart, architecture, or onboarding mode), just return
        if (!sidebar) {
            // In special modes, ensure main content takes full width
            if (mainContent) {
                mainContent.style.marginLeft = '0';
                mainContent.style.width = '100%';
            }
            return;
        }

        if (isMobile) {
            if (sidebarToggle) {
                sidebarToggle.classList.remove('d-none');
            }
            if (sidebar.style.transform !== 'translateX(-100%)') {
                sidebar.style.transform = 'translateX(-100%)';
                sidebar.style.opacity = '0';
                sidebar.style.pointerEvents = 'none';
                if (mainContent) {
                    mainContent.style.marginLeft = '0';
                    mainContent.style.width = '100%';
                }
            }
        } else {
            if (sidebarToggle) {
                sidebarToggle.classList.add('d-none');
            }
            sidebar.style.transform = 'translateX(0)';
            sidebar.style.opacity = '1';
            sidebar.style.pointerEvents = 'auto';
            const currentWidth = sidebar.offsetWidth || SIDEBAR_DEFAULT_WIDTH;
            if (mainContent) {
                mainContent.style.marginLeft = `${currentWidth}px`;
                mainContent.style.width = `calc(100% - ${currentWidth}px)`;
            }
        }
    }

    // Initialize layout on page load
    function initializeLayout() {
        applyLayoutStyles(window.innerWidth <= MOBILE_BREAKPOINT);
    }

    // Helper function to find the most visible element from a list of elements
    function getMostVisibleElement(elements) {
        let mostVisibleElement = null;
        let maxVisibility = 0;

        elements.forEach(element => {
            const rect = element.getBoundingClientRect();
            const windowHeight = window.innerHeight;

            // Calculate how much of the element is visible
            const visibleTop = Math.max(0, rect.top);
            const visibleBottom = Math.min(windowHeight, rect.bottom);
            const visibleHeight = Math.max(0, visibleBottom - visibleTop);
            const visibility = visibleHeight / rect.height;

            if (visibility > maxVisibility) {
                maxVisibility = visibility;
                mostVisibleElement = element;
            }
        });

        return mostVisibleElement;
    }

    // Auto-sync sidebar with scroll position
    function updateActiveSidebarItem() {
        // Remove active class from all sidebar links if they exist
        if (cachedSidebarLinks && cachedSidebarLinks.length > 0) {
            cachedSidebarLinks.forEach(link => link.classList.remove('active'));

            // Find which file entry is currently most visible
            const mostVisibleEntry = getMostVisibleElement(cachedFileEntries);

            // Highlight the corresponding sidebar item
            if (mostVisibleEntry) {
                const fileIndex = mostVisibleEntry.getAttribute('data-file-index');
                const correspondingLink = document.querySelector('#sidebar a[href="#file-' + fileIndex + '"]');
                if (correspondingLink) {
                    correspondingLink.classList.add('active');
                }
            }
        }
    }

    // Navigation arrow functionality
    function getCurrentVisibleFile() {
        return getMostVisibleElement(cachedFileEntries);
    }

    function getPreviousFile(currentFile) {
        if (!currentFile) return null;
        const currentIndex = cachedFileEntries.indexOf(currentFile);
        return currentIndex > 0 ? cachedFileEntries[currentIndex - 1] : null;
    }

    function getNextFile(currentFile) {
        if (!currentFile) return null;
        const currentIndex = cachedFileEntries.indexOf(currentFile);
        return currentIndex < cachedFileEntries.length - 1 ? cachedFileEntries[currentIndex + 1] : null;
    }

    // Show/hide navigation arrows based on file count
    function updateNavigationArrows() {
        const fileCount = cachedFileEntries.length;
        const navArrows = document.getElementById('nav-arrows');
        
        // If navArrows element doesn't exist (e.g., in architecture, onboarding, or flowchart modes), return
        if (!navArrows) {
            return;
        }
        
        if (fileCount > 1) {
            navArrows.classList.remove('d-none');
        } else {
            navArrows.classList.add('d-none');
        }
    }

})();


    </script>
</head>
    <body class="bg-light text-dark" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;">
    <div id="app" class="vh-100">
        <!-- Header -->
        <header class="bg-white shadow-sm position-fixed top-0 start-0 w-100 border-bottom" style="z-index: 1030; backdrop-filter: blur(10px); background-color: rgba(255, 255, 255, 0.95);">
            <div class="container-fluid py-3 px-4">
                <div class="row align-items-center">
                    <div class="col-auto d-flex align-items-center">
                        <i class="fas fa-code text-primary me-3 fs-4"></i>
                         <h1 class="h5 fw-bold text-dark mb-0">Code Explanation: <span class="text-primary fw-semibold">src</span></h1>
                    </div>
                    <div class="col text-center d-none d-md-block">
                        <small class="text-muted">AI-Powered Code Explanation</small>
                    </div>
                </div>
            </div>
        </header>

        <!-- Sidebar Toggle Button (Mobile) -->
        <button id="sidebar-toggle" class="btn btn-primary position-fixed d-none" style="top: 16px; left: 16px; z-index: 1030; display: block;" title="Toggle Sidebar">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Sidebar Navigation -->
        <aside class="position-fixed bg-white border-end" id="sidebar" style="width: 280px; height: calc(100vh - 64px); top: 64px; left: 0; transform: translateX(0); opacity: 1; pointer-events: auto; transition: all 0.3s ease; z-index: 1000;">
            <div class="position-absolute" style="top: 0; right: 0; width: 5px; height: 100%; cursor: ew-resize; background: rgba(0,0,0,0.1);" id="sidebar-resizer"></div>
            <div class="p-3 border-bottom">
                <h2 class="h6 fw-bold mb-0 text-muted d-flex align-items-center">
                    <i class="fas fa-folder-tree me-2"></i>
                    Project Files
                </h2>
            </div>
            <div class="sidebar-content" style="height: calc(100% - 60px); overflow-y: auto;">
                <ul class="list-unstyled p-2">
<li>
  <span class="folder-toggle d-flex align-items-center py-1 px-2 rounded" style="cursor: pointer;"><i class="fas fa-chevron-right me-1 fs-6 folder-icon"></i> ai</span>
  <ul class="folder-contents ms-4 ps-2 border-start">
                    <li><a href="#file-0" class="d-block py-1 px-2 text-decoration-none rounded">aiEngine.js</a></li>
                    <li><a href="#file-1" class="d-block py-1 px-2 text-decoration-none rounded">promptManager.js</a></li>
  </ul>
</li>
<li>
  <span class="folder-toggle d-flex align-items-center py-1 px-2 rounded" style="cursor: pointer;"><i class="fas fa-chevron-right me-1 fs-6 folder-icon"></i> commands</span>
  <ul class="folder-contents ms-4 ps-2 border-start">
                    <li><a href="#file-2" class="d-block py-1 px-2 text-decoration-none rounded">explain.js</a></li>
  </ul>
</li>
<li>
  <span class="folder-toggle d-flex align-items-center py-1 px-2 rounded" style="cursor: pointer;"><i class="fas fa-chevron-right me-1 fs-6 folder-icon"></i> core</span>
  <ul class="folder-contents ms-4 ps-2 border-start">
                    <li><a href="#file-3" class="d-block py-1 px-2 text-decoration-none rounded">cacheManager.js</a></li>
                    <li><a href="#file-4" class="d-block py-1 px-2 text-decoration-none rounded">codeAnalyzer.js</a></li>
  </ul>
</li>
<li>
  <span class="folder-toggle d-flex align-items-center py-1 px-2 rounded" style="cursor: pointer;"><i class="fas fa-chevron-right me-1 fs-6 folder-icon"></i> config</span>
  <ul class="folder-contents ms-4 ps-2 border-start">
                    <li><a href="#file-5" class="d-block py-1 px-2 text-decoration-none rounded">configManager.js</a></li>
  </ul>
</li>
<li>
  <span class="folder-toggle d-flex align-items-center py-1 px-2 rounded" style="cursor: pointer;"><i class="fas fa-chevron-right me-1 fs-6 folder-icon"></i> flowchart</span>
  <ul class="folder-contents ms-4 ps-2 border-start">
                    <li><a href="#file-6" class="d-block py-1 px-2 text-decoration-none rounded">flowchartGenerator.js</a></li>
  </ul>
</li>
<li>
  <span class="folder-toggle d-flex align-items-center py-1 px-2 rounded" style="cursor: pointer;"><i class="fas fa-chevron-right me-1 fs-6 folder-icon"></i> utils</span>
  <ul class="folder-contents ms-4 ps-2 border-start">
                    <li><a href="#file-7" class="d-block py-1 px-2 text-decoration-none rounded">constants.js</a></li>
                    <li><a href="#file-8" class="d-block py-1 px-2 text-decoration-none rounded">languageMap.js</a></li>
                    <li><a href="#file-9" class="d-block py-1 px-2 text-decoration-none rounded">utils.js</a></li>
  </ul>
</li>
<li>
  <span class="folder-toggle d-flex align-items-center py-1 px-2 rounded" style="cursor: pointer;"><i class="fas fa-chevron-right me-1 fs-6 folder-icon"></i> output</span>
  <ul class="folder-contents ms-4 ps-2 border-start">
    <li>
      <span class="folder-toggle d-flex align-items-center py-1 px-2 rounded" style="cursor: pointer;"><i class="fas fa-chevron-right me-1 fs-6 folder-icon"></i> html</span>
      <ul class="folder-contents ms-4 ps-2 border-start">
                        <li><a href="#file-10" class="d-block py-1 px-2 text-decoration-none rounded">htmlOutput.js</a></li>
                        <li><a href="#file-11" class="d-block py-1 px-2 text-decoration-none rounded">htmlTemplate.js</a></li>
                        <li><a href="#file-12" class="d-block py-1 px-2 text-decoration-none rounded">_css.css</a></li>
                        <li><a href="#file-13" class="d-block py-1 px-2 text-decoration-none rounded">_flowchart.js</a></li>
                        <li><a href="#file-14" class="d-block py-1 px-2 text-decoration-none rounded">_js.js</a></li>
      </ul>
    </li>
    <li>
      <span class="folder-toggle d-flex align-items-center py-1 px-2 rounded" style="cursor: pointer;"><i class="fas fa-chevron-right me-1 fs-6 folder-icon"></i> pdf</span>
      <ul class="folder-contents ms-4 ps-2 border-start">
                        <li><a href="#file-15" class="d-block py-1 px-2 text-decoration-none rounded">pdfOutput.js</a></li>
      </ul>
    </li>
  </ul>
</li>

                </ul>
            </div>
        </aside>

        <!-- Main Content -->
        <main style="margin-left: 280px; width: calc(100% - 280px); margin-top: 96px; padding: 2rem; transition: margin-left 0.3s ease; min-height: calc(100vh - 96px);">
            <div class="container-fluid">
                <!-- File Entries -->
                <div id="file-entries" class="row g-4">
 <div class="file-entry col-12 mb-4" id="file-0" data-file-path="D:\MyDev\CodeExplain\src\ai\aiEngine.js" data-file-index="0">
     <div class="card shadow-sm border-0 h-100" style="border-radius: 12px; overflow: hidden;">
         <div class="card-header bg-gradient-primary text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1rem 1.5rem;">
             <div class="d-flex justify-content-between align-items-center">
                  <h2 class="toggle-code h5 fw-semibold mb-0 cursor-pointer d-flex align-items-center text-white" data-file-index="0" style="font-size: 1.1rem;">
                      <i class="fas fa-chevron-right me-2 transition-transform duration-200"></i>
                      <i class="fas fa-file-code me-2"></i>
                      ai/aiEngine.js
                  </h2>
                 <span class="badge bg-white bg-opacity-25 text-white px-2 py-1" style="font-size: 0.75rem;">
                     javascript
                 </span>
             </div>
         </div>

               <div class="card-body p-0">
                 <div class="code-container bg-light border-bottom d-none" style="max-height: 400px; overflow: auto;" data-file-path="D:\MyDev\CodeExplain\src\ai\aiEngine.js" data-file-language="javascript">
                     <div class="p-3 text-center text-muted">
                         <div class="spinner-border spinner-border-sm me-2" role="status" style="display: none;"></div>
                         <span class="loading-text">Click to load code</span>
                     </div>
                     <div class="code-content" style="display: none;"> <span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">ChatOpenAI</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@langchain/openai&#x27;</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">ChatGoogleGenerativeAI</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@langchain/google-genai&#x27;</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">ChatOllama</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@langchain/ollama&#x27;</span>);
<span class="hljs-keyword">const</span> chalk = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;chalk&#x27;</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">CacheManager</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../core/cacheManager&#x27;</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">PromptManager</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./promptManager&#x27;</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">Logger</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../utils/logger&#x27;</span>);
<span class="hljs-keyword">const</span> { dd } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../utils/utils&#x27;</span>); <span class="hljs-comment">// Debugging helper</span>
<span class="hljs-keyword">const</span> { encoding_for_model } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;tiktoken&#x27;</span>);

<span class="hljs-comment">// Constants</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PROVIDERS</span> = {
  <span class="hljs-attr">GEMINI</span>: <span class="hljs-string">&#x27;gemini&#x27;</span>,
  <span class="hljs-attr">OPENAI</span>: <span class="hljs-string">&#x27;openai&#x27;</span>,
  <span class="hljs-attr">OLLAMA</span>: <span class="hljs-string">&#x27;ollama&#x27;</span>
};

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MODES</span> = {
  <span class="hljs-attr">EXPLAIN</span>: <span class="hljs-string">&#x27;explain&#x27;</span>,
  <span class="hljs-attr">ARCHITECTURE</span>: <span class="hljs-string">&#x27;architecture&#x27;</span>,
  <span class="hljs-attr">ARCH</span>: <span class="hljs-string">&#x27;arch&#x27;</span>,
  <span class="hljs-attr">LINE_BY_LINE</span>: <span class="hljs-string">&#x27;linebyline&#x27;</span>,
  <span class="hljs-attr">SUMMARY</span>: <span class="hljs-string">&#x27;summary&#x27;</span>
};

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">USER_LEVELS</span> = {
  <span class="hljs-attr">EXPERT</span>: <span class="hljs-string">&#x27;expert&#x27;</span>,
  <span class="hljs-attr">BEGINNER</span>: <span class="hljs-string">&#x27;beginner&#x27;</span>
};

<span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">DEFAULT_CONCURRENCY</span>, <span class="hljs-variable constant_">MAX_CONCURRENCY</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../utils/constants&#x27;</span>);

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AIEngine</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">config</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span> = config;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">provider</span> = config.<span class="hljs-property">provider</span> ?? <span class="hljs-variable constant_">PROVIDERS</span>.<span class="hljs-property">GEMINI</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">model</span> = config.<span class="hljs-property">model</span>; <span class="hljs-comment">// Allow model specification</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">apiKey</span> = config.<span class="hljs-property">apiKey</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseUrl</span> = config.<span class="hljs-property">baseUrl</span>; <span class="hljs-comment">// For Ollama or custom endpoints</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">verbose</span> = config.<span class="hljs-property">verbose</span> || <span class="hljs-literal">false</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">concurrency</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(config.<span class="hljs-property">concurrency</span> || <span class="hljs-variable constant_">DEFAULT_CONCURRENCY</span>, <span class="hljs-variable constant_">MAX_CONCURRENCY</span>);

    <span class="hljs-comment">// Initialize logger</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">logger</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Logger</span>({ <span class="hljs-attr">verbose</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">verbose</span> });

    <span class="hljs-comment">// Initialize managers</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cacheManager</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheManager</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">promptManager</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PromptManager</span>();

    <span class="hljs-comment">// Initialize managers immediately</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();

    <span class="hljs-comment">// Initialize token tracking</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span> = {
      <span class="hljs-attr">totalInputTokens</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">totalOutputTokens</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">totalTokens</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">cachedFiles</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">processedFiles</span>: <span class="hljs-number">0</span>
    };

    <span class="hljs-comment">// Validate API key (not required for Ollama)</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">apiKey</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">provider</span> !== <span class="hljs-string">&#x27;ollama&#x27;</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;API key required for &#x27;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">provider</span> + <span class="hljs-string">&#x27;. Please provide an API key via --apikey option or config file.&#x27;</span>);
    }

    <span class="hljs-comment">// Set up model based on provider</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupModel</span>();
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">cacheManager</span>.<span class="hljs-title function_">initialize</span>();
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">promptManager</span>.<span class="hljs-title function_">initialize</span>();
  }

  <span class="hljs-title function_">setupModel</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">provider</span> === <span class="hljs-variable constant_">PROVIDERS</span>.<span class="hljs-property">GEMINI</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">modelInstance</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatGoogleGenerativeAI</span>({
        <span class="hljs-attr">apiKey</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">apiKey</span>,
        <span class="hljs-attr">modelName</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">model</span> || <span class="hljs-string">&#x27;gemini-2.5-flash&#x27;</span>,
        <span class="hljs-attr">maxOutputTokens</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">maxTokens</span> || <span class="hljs-number">15000</span>
      });
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">provider</span> === <span class="hljs-variable constant_">PROVIDERS</span>.<span class="hljs-property">OPENAI</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">modelInstance</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatOpenAI</span>({
        <span class="hljs-attr">openAIApiKey</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">apiKey</span>,
        <span class="hljs-attr">modelName</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">model</span> || <span class="hljs-string">&#x27;gpt-4o&#x27;</span>,
        <span class="hljs-attr">maxTokens</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">maxTokens</span> || <span class="hljs-number">15000</span>,
        ...(<span class="hljs-variable language_">this</span>.<span class="hljs-property">baseUrl</span> &amp;&amp; { <span class="hljs-attr">configuration</span>: { <span class="hljs-attr">baseURL</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseUrl</span> } })
      });
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">provider</span> === <span class="hljs-variable constant_">PROVIDERS</span>.<span class="hljs-property">OLLAMA</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">modelInstance</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatOllama</span>({
        <span class="hljs-attr">baseUrl</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseUrl</span> || <span class="hljs-string">&#x27;http://localhost:11434&#x27;</span>,
        <span class="hljs-attr">model</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">model</span> || <span class="hljs-string">&#x27;llama2&#x27;</span>,
        <span class="hljs-attr">maxTokens</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">maxTokens</span> || <span class="hljs-number">15000</span>
      });
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">const</span> supportedProviders = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(<span class="hljs-variable constant_">PROVIDERS</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;, &#x27;</span>);
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Unsupported AI provider: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.provider}</span>. Supported providers are: <span class="hljs-subst">${supportedProviders}</span>`</span>);
    }
  }

  <span class="hljs-comment">// Helper function for logging with consistent format</span>
  <span class="hljs-title function_">_log</span>(<span class="hljs-params">level, message</span>) {
    <span class="hljs-keyword">switch</span> (level) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;error&#x27;</span>:
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(chalk.<span class="hljs-title function_">redBright</span>(<span class="hljs-string">`❌ Error: <span class="hljs-subst">${message}</span>`</span>));
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;warn&#x27;</span>:
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(chalk.<span class="hljs-title function_">yellowBright</span>(<span class="hljs-string">`⚠️ Warning: <span class="hljs-subst">${message}</span>`</span>));
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;info&#x27;</span>:
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">verbose</span>) {
          <span class="hljs-keyword">const</span> msg = <span class="hljs-keyword">typeof</span> message === <span class="hljs-string">&#x27;function&#x27;</span> ? <span class="hljs-title function_">message</span>() : message;
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`ℹ️ <span class="hljs-subst">${msg}</span>`</span>));
        }
        <span class="hljs-keyword">break</span>;
    }
  }

  <span class="hljs-comment">// Helper function for exponential backoff retry</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">retryWithBackoff</span>(<span class="hljs-params">fn</span>) {
    <span class="hljs-keyword">const</span> retries = <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">retry</span>?.<span class="hljs-property">attempts</span> || <span class="hljs-number">3</span>;
    <span class="hljs-keyword">let</span> delay = <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">retry</span>?.<span class="hljs-property">delay</span> || <span class="hljs-number">1000</span>;
    <span class="hljs-keyword">let</span> lastError;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= retries; i++) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">fn</span>();
      } <span class="hljs-keyword">catch</span> (error) {
        lastError = error;

        <span class="hljs-comment">// If this was the last attempt, throw the error</span>
        <span class="hljs-keyword">if</span> (i === retries) {
          <span class="hljs-keyword">throw</span> error;
        }

        <span class="hljs-comment">// Log retry attempt</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_log</span>(<span class="hljs-string">&#x27;warn&#x27;</span>, <span class="hljs-string">`Attempt <span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span> failed. Retrying in <span class="hljs-subst">${delay}</span>ms...`</span>);

        <span class="hljs-comment">// Wait for the delay</span>
        <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, delay));

        <span class="hljs-comment">// Exponential backoff: double the delay for next attempt</span>
        delay *= <span class="hljs-number">2</span>;
      }
    }

    <span class="hljs-keyword">throw</span> lastError;
  }

  <span class="hljs-comment">// Estimate tokens using LangChain response metadata if available, otherwise use proper tokenization</span>
  <span class="hljs-title function_">estimateTokens</span>(<span class="hljs-params">text, metadata</span>) {
    <span class="hljs-keyword">if</span> (metadata &amp;&amp; <span class="hljs-keyword">typeof</span> metadata.<span class="hljs-property">completion_tokens</span> === <span class="hljs-string">&#x27;number&#x27;</span> &amp;&amp; <span class="hljs-keyword">typeof</span> metadata.<span class="hljs-property">prompt_tokens</span> === <span class="hljs-string">&#x27;number&#x27;</span>) {
      <span class="hljs-comment">// If both prompt and completion tokens are available, return their sum</span>
      <span class="hljs-keyword">return</span> metadata.<span class="hljs-property">prompt_tokens</span> + metadata.<span class="hljs-property">completion_tokens</span>
    }
    <span class="hljs-keyword">if</span> (metadata &amp;&amp; <span class="hljs-keyword">typeof</span> metadata.<span class="hljs-property">total_tokens</span> === <span class="hljs-string">&#x27;number&#x27;</span>) {
      <span class="hljs-keyword">return</span> metadata.<span class="hljs-property">total_tokens</span>
    }
    <span class="hljs-keyword">if</span> (!text) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>

    <span class="hljs-comment">// Use proper tokenization for OpenAI models</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">provider</span> === <span class="hljs-variable constant_">PROVIDERS</span>.<span class="hljs-property">OPENAI</span>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// Map model names to tiktoken encoding</span>
        <span class="hljs-keyword">let</span> encodingName = <span class="hljs-string">&#x27;cl100k_base&#x27;</span>; <span class="hljs-comment">// Default for GPT-3.5-turbo and GPT-4</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">model</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">model</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;gpt-4o&#x27;</span>)) {
          encodingName = <span class="hljs-string">&#x27;o200k_base&#x27;</span>; <span class="hljs-comment">// GPT-4o uses o200k_base</span>
        }

        <span class="hljs-keyword">const</span> encoding = <span class="hljs-title function_">encoding_for_model</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">model</span> || <span class="hljs-string">&#x27;gpt-3.5-turbo&#x27;</span>, encodingName);
        <span class="hljs-keyword">const</span> tokens = encoding.<span class="hljs-title function_">encode</span>(text);
        encoding.<span class="hljs-title function_">free</span>();
        <span class="hljs-keyword">return</span> tokens.<span class="hljs-property">length</span>;
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-comment">// Fallback to rough estimate if tiktoken fails</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_log</span>(<span class="hljs-string">&#x27;warn&#x27;</span>, <span class="hljs-string">`Failed to tokenize with tiktoken: <span class="hljs-subst">${error.message}</span>`</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(text.<span class="hljs-property">length</span> / <span class="hljs-number">4</span>);
      }
    }

    <span class="hljs-comment">// For other providers, use rough estimate (1 token ≈ 4 chars)</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(text.<span class="hljs-property">length</span> / <span class="hljs-number">4</span>)
  }

  <span class="hljs-comment">// Get usage summary</span>
  <span class="hljs-title function_">getUsageSummary</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">return</span> {
      ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>
    };
  }

  <span class="hljs-comment">// Helper function to suggest garbage collection for large objects</span>
  <span class="hljs-title function_">_suggestGC</span>(<span class="hljs-params"></span>) {
    <span class="hljs-comment">// Only suggest GC if --expose-gc flag is used and gc is available</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">global</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span> &amp;&amp; <span class="hljs-variable language_">global</span>.<span class="hljs-property">gc</span>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-variable language_">global</span>.<span class="hljs-title function_">gc</span>();
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-comment">// Ignore GC errors</span>
      }
    }
  }

  <span class="hljs-comment">// Helper function to process files in parallel batches with memory cleanup</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">processFilesInBatches</span>(<span class="hljs-params">files, processFn, progressCallback = <span class="hljs-literal">null</span></span>) {
    <span class="hljs-keyword">const</span> results = [];
    <span class="hljs-keyword">const</span> total = files.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">let</span> completed = <span class="hljs-number">0</span>;

    <span class="hljs-comment">// Process files in batches of concurrency size</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; files.<span class="hljs-property">length</span>; i += <span class="hljs-variable language_">this</span>.<span class="hljs-property">concurrency</span>) {
      <span class="hljs-keyword">const</span> batch = files.<span class="hljs-title function_">slice</span>(i, i + <span class="hljs-variable language_">this</span>.<span class="hljs-property">concurrency</span>);
      <span class="hljs-keyword">const</span> batchPromises = batch.<span class="hljs-title function_">map</span>(<span class="hljs-title function_">async</span> (file, batchIndex) =&gt; {
        <span class="hljs-keyword">const</span> globalIndex = i + batchIndex;
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">processFn</span>(file, globalIndex);
          <span class="hljs-comment">// Clear reference to file content immediately after processing to free memory</span>
          <span class="hljs-keyword">if</span> (file &amp;&amp; file.<span class="hljs-property">content</span>) {
            file.<span class="hljs-property">content</span> = <span class="hljs-literal">null</span>;
          }
          <span class="hljs-keyword">return</span> { <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, result, <span class="hljs-attr">index</span>: globalIndex };
        } <span class="hljs-keyword">catch</span> (error) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error processing file <span class="hljs-subst">${file.path || <span class="hljs-string">`file-<span class="hljs-subst">${globalIndex}</span>`</span>}</span>:`</span>, error.<span class="hljs-property">message</span>);
          <span class="hljs-comment">// Clear reference even on error</span>
          <span class="hljs-keyword">if</span> (file &amp;&amp; file.<span class="hljs-property">content</span>) {
            file.<span class="hljs-property">content</span> = <span class="hljs-literal">null</span>;
          }
          <span class="hljs-keyword">return</span> { <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>, error, <span class="hljs-attr">index</span>: globalIndex };
        }
      });

      <span class="hljs-comment">// Wait for the current batch to complete</span>
      <span class="hljs-keyword">const</span> batchResults = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">allSettled</span>(batchPromises);

      <span class="hljs-comment">// Process batch results</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> batchResult <span class="hljs-keyword">of</span> batchResults) {
        <span class="hljs-keyword">if</span> (batchResult.<span class="hljs-property">status</span> === <span class="hljs-string">&#x27;fulfilled&#x27;</span>) {
          <span class="hljs-keyword">const</span> { success, result, index } = batchResult.<span class="hljs-property">value</span>;
          <span class="hljs-keyword">if</span> (success) {
            results[index] = result;
            completed++;

            <span class="hljs-comment">// Update progress</span>
            <span class="hljs-keyword">if</span> (progressCallback) {
              <span class="hljs-keyword">const</span> progress = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>((completed / total) * <span class="hljs-number">100</span>);
              <span class="hljs-keyword">const</span> file = files[index];
              <span class="hljs-title function_">progressCallback</span>(file.<span class="hljs-property">path</span> || <span class="hljs-string">`file-<span class="hljs-subst">${index}</span>`</span>, completed, total, progress, result.<span class="hljs-property">cached</span>, <span class="hljs-literal">false</span>);
            }
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// Handle failed file processing</span>
            results[index] = <span class="hljs-literal">null</span>;
            completed++;
            <span class="hljs-keyword">if</span> (progressCallback) {
              <span class="hljs-keyword">const</span> progress = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>((completed / total) * <span class="hljs-number">100</span>);
              <span class="hljs-keyword">const</span> file = files[index];
              <span class="hljs-title function_">progressCallback</span>(file.<span class="hljs-property">path</span> || <span class="hljs-string">`file-<span class="hljs-subst">${index}</span>`</span>, completed, total, progress, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);
            }
          }
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// Promise was rejected</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Batch processing error:&#x27;</span>, batchResult.<span class="hljs-property">reason</span>);
          completed++;
        }
      }

      <span class="hljs-comment">// Clear batch references to help GC</span>
      batch.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>;

      <span class="hljs-comment">// Suggest garbage collection after large batches</span>
      <span class="hljs-keyword">if</span> (i % (<span class="hljs-variable language_">this</span>.<span class="hljs-property">concurrency</span> * <span class="hljs-number">5</span>) === <span class="hljs-number">0</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_suggestGC</span>();
      }
    }

    <span class="hljs-keyword">return</span> results;
  }

  <span class="hljs-comment">// Helper function to process files with request batching for compatible providers</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">processFilesWithRequestBatching</span>(<span class="hljs-params">files, progressCallback = <span class="hljs-literal">null</span>, processFn = <span class="hljs-literal">null</span></span>) {
    <span class="hljs-comment">// Default processing function</span>
    <span class="hljs-keyword">const</span> defaultProcessFn = processFn || (<span class="hljs-title function_">async</span> (file, index) =&gt; <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">explainFile</span>(file));

    <span class="hljs-comment">// Only use request batching for providers that support it efficiently</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">provider</span> !== <span class="hljs-variable constant_">PROVIDERS</span>.<span class="hljs-property">OPENAI</span>) {
      <span class="hljs-comment">// Fall back to regular batch processing</span>
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">processFilesInBatches</span>(files, defaultProcessFn, progressCallback);
    }

    <span class="hljs-keyword">const</span> results = [];
    <span class="hljs-keyword">const</span> total = files.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">let</span> completed = <span class="hljs-number">0</span>;

    <span class="hljs-comment">// Process files in batches, but try to batch API requests within each batch</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; files.<span class="hljs-property">length</span>; i += <span class="hljs-variable language_">this</span>.<span class="hljs-property">concurrency</span>) {
      <span class="hljs-keyword">const</span> batch = files.<span class="hljs-title function_">slice</span>(i, i + <span class="hljs-variable language_">this</span>.<span class="hljs-property">concurrency</span>);

      <span class="hljs-comment">// Prepare batch data: check cache and build prompts</span>
      <span class="hljs-keyword">const</span> batchData = [];
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; batch.<span class="hljs-property">length</span>; j++) {
        <span class="hljs-keyword">const</span> file = batch[j];
        <span class="hljs-keyword">const</span> globalIndex = i + j;

        <span class="hljs-comment">// For custom processing functions, just call them directly</span>
        <span class="hljs-keyword">if</span> (processFn) {
          <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">defaultProcessFn</span>(file, globalIndex);
            results[globalIndex] = result;
            completed++;
            <span class="hljs-keyword">if</span> (progressCallback) {
              <span class="hljs-keyword">const</span> progress = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>((completed / total) * <span class="hljs-number">100</span>);
              <span class="hljs-title function_">progressCallback</span>(file.<span class="hljs-property">path</span> || <span class="hljs-string">`file-<span class="hljs-subst">${globalIndex}</span>`</span>, completed, total, progress, result.<span class="hljs-property">cached</span>, <span class="hljs-literal">false</span>);
            }
          } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error processing file <span class="hljs-subst">${file.path || <span class="hljs-string">`file-<span class="hljs-subst">${globalIndex}</span>`</span>}</span>:`</span>, error.<span class="hljs-property">message</span>);
            results[globalIndex] = <span class="hljs-literal">null</span>;
            completed++;
            <span class="hljs-keyword">if</span> (progressCallback) {
              <span class="hljs-keyword">const</span> progress = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>((completed / total) * <span class="hljs-number">100</span>);
              <span class="hljs-title function_">progressCallback</span>(file.<span class="hljs-property">path</span> || <span class="hljs-string">`file-<span class="hljs-subst">${globalIndex}</span>`</span>, completed, total, progress, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);
            }
          }
          <span class="hljs-keyword">continue</span>;
        }

        <span class="hljs-comment">// Check cache first for default explainFile processing</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">cache</span> !== <span class="hljs-literal">false</span>) {
          <span class="hljs-keyword">const</span> cachedExplanation = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">cacheManager</span>.<span class="hljs-title function_">getCachedExplanation</span>(file.<span class="hljs-property">path</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>);
          <span class="hljs-keyword">if</span> (cachedExplanation) {
            results[globalIndex] = {
              ...file,
              <span class="hljs-attr">explanation</span>: cachedExplanation,
              <span class="hljs-attr">cached</span>: <span class="hljs-literal">true</span>
            };
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>.<span class="hljs-property">cachedFiles</span>++;
            completed++;
            <span class="hljs-keyword">if</span> (progressCallback) {
              <span class="hljs-keyword">const</span> progress = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>((completed / total) * <span class="hljs-number">100</span>);
              <span class="hljs-title function_">progressCallback</span>(file.<span class="hljs-property">path</span> || <span class="hljs-string">`file-<span class="hljs-subst">${globalIndex}</span>`</span>, completed, total, progress, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);
            }
            <span class="hljs-keyword">continue</span>;
          }
        }

        <span class="hljs-comment">// Build prompt for non-cached files</span>
        <span class="hljs-keyword">const</span> prompt = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">buildPrompt</span>(file);
        <span class="hljs-keyword">const</span> inputTokens = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">estimateTokens</span>(prompt);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>.<span class="hljs-property">totalInputTokens</span> += inputTokens;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>.<span class="hljs-property">processedFiles</span>++;

        batchData.<span class="hljs-title function_">push</span>({
          file,
          prompt,
          inputTokens,
          globalIndex
        });
      }

      <span class="hljs-comment">// If we have prompts to process, use batch API calls</span>
      <span class="hljs-keyword">if</span> (batchData.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-comment">// For OpenAI, we can use Promise.all for concurrent requests</span>
          <span class="hljs-comment">// In the future, this could be enhanced to use OpenAI&#x27;s batch API</span>
          <span class="hljs-keyword">const</span> batchPromises = batchData.<span class="hljs-title function_">map</span>(<span class="hljs-title function_">async</span> (data) =&gt; {
            <span class="hljs-keyword">const</span> { file, prompt, inputTokens, globalIndex } = data;

            <span class="hljs-keyword">try</span> {
              <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">retryWithBackoff</span>(<span class="hljs-title function_">async</span> () =&gt; {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">modelInstance</span>.<span class="hljs-title function_">invoke</span>([
                  { <span class="hljs-attr">role</span>: <span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">&#x27;You are a helpful assistant that provides detailed code explanations.&#x27;</span> },
                  { <span class="hljs-attr">role</span>: <span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-attr">content</span>: prompt }
                ]);
              });

              <span class="hljs-keyword">const</span> response = result.<span class="hljs-property">content</span>;
              <span class="hljs-keyword">const</span> metadata = result.<span class="hljs-property">additional_kwargs</span>?.<span class="hljs-property">response_metadata</span> ||
                result.<span class="hljs-property">additional_kwargs</span>?.<span class="hljs-property">usage_metadata</span> ||
                result.<span class="hljs-property">lc_kwargs</span>?.<span class="hljs-property">response_metadata</span>;
              <span class="hljs-keyword">const</span> outputTokens = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">estimateTokens</span>(response, metadata);
              <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>.<span class="hljs-property">totalOutputTokens</span> += outputTokens;
              <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>.<span class="hljs-property">totalTokens</span> += inputTokens + outputTokens;

              <span class="hljs-comment">// Cache the result</span>
              <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">cache</span> !== <span class="hljs-literal">false</span>) {
                <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">cacheManager</span>.<span class="hljs-title function_">setCachedExplanation</span>(file.<span class="hljs-property">path</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>, response);
              }

              <span class="hljs-comment">// Clear file content reference to free memory</span>
              <span class="hljs-keyword">if</span> (file &amp;&amp; file.<span class="hljs-property">content</span>) {
                file.<span class="hljs-property">content</span> = <span class="hljs-literal">null</span>;
              }

              <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">result</span>: {
                  ...file,
                  <span class="hljs-attr">explanation</span>: response,
                  <span class="hljs-attr">cached</span>: <span class="hljs-literal">false</span>
                },
                globalIndex
              };
            } <span class="hljs-keyword">catch</span> (error) {
              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error processing file <span class="hljs-subst">${file.path}</span>:`</span>, error.<span class="hljs-property">message</span>);
              <span class="hljs-comment">// Clear file content reference even on error</span>
              <span class="hljs-keyword">if</span> (file &amp;&amp; file.<span class="hljs-property">content</span>) {
                file.<span class="hljs-property">content</span> = <span class="hljs-literal">null</span>;
              }
              <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
                error,
                globalIndex
              };
            }
          });

          <span class="hljs-comment">// Execute batch requests concurrently</span>
          <span class="hljs-keyword">const</span> batchResults = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">allSettled</span>(batchPromises);

          <span class="hljs-comment">// Process results</span>
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> batchResult <span class="hljs-keyword">of</span> batchResults) {
            <span class="hljs-keyword">if</span> (batchResult.<span class="hljs-property">status</span> === <span class="hljs-string">&#x27;fulfilled&#x27;</span>) {
              <span class="hljs-keyword">const</span> { success, result, globalIndex } = batchResult.<span class="hljs-property">value</span>;
              <span class="hljs-keyword">if</span> (success) {
                results[globalIndex] = result;
                completed++;
                <span class="hljs-keyword">if</span> (progressCallback) {
                  <span class="hljs-keyword">const</span> progress = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>((completed / total) * <span class="hljs-number">100</span>);
                  <span class="hljs-title function_">progressCallback</span>(result.<span class="hljs-property">path</span> || <span class="hljs-string">`file-<span class="hljs-subst">${globalIndex}</span>`</span>, completed, total, progress, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);
                }
              } <span class="hljs-keyword">else</span> {
                results[globalIndex] = <span class="hljs-literal">null</span>;
                completed++;
                <span class="hljs-keyword">if</span> (progressCallback) {
                  <span class="hljs-keyword">const</span> progress = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>((completed / total) * <span class="hljs-number">100</span>);
                  <span class="hljs-title function_">progressCallback</span>(<span class="hljs-string">`file-<span class="hljs-subst">${globalIndex}</span>`</span>, completed, total, progress, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);
                }
              }
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Request batch processing error:&#x27;</span>, batchResult.<span class="hljs-property">reason</span>);
              completed++;
            }
          }
        } <span class="hljs-keyword">catch</span> (error) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Batch processing failed:&#x27;</span>, error);
          <span class="hljs-comment">// Fall back to individual processing for this batch</span>
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> data <span class="hljs-keyword">of</span> batchData) {
            <span class="hljs-keyword">try</span> {
              <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">explainFile</span>(data.<span class="hljs-property">file</span>);
              results[data.<span class="hljs-property">globalIndex</span>] = result;
              completed++;
              <span class="hljs-keyword">if</span> (progressCallback) {
                <span class="hljs-keyword">const</span> progress = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>((completed / total) * <span class="hljs-number">100</span>);
                <span class="hljs-title function_">progressCallback</span>(data.<span class="hljs-property">file</span>.<span class="hljs-property">path</span> || <span class="hljs-string">`file-<span class="hljs-subst">${data.globalIndex}</span>`</span>, completed, total, progress, result.<span class="hljs-property">cached</span>, <span class="hljs-literal">false</span>);
              }
            } <span class="hljs-keyword">catch</span> (error) {
              results[data.<span class="hljs-property">globalIndex</span>] = <span class="hljs-literal">null</span>;
              completed++;
              <span class="hljs-keyword">if</span> (progressCallback) {
                <span class="hljs-keyword">const</span> progress = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>((completed / total) * <span class="hljs-number">100</span>);
                <span class="hljs-title function_">progressCallback</span>(data.<span class="hljs-property">file</span>.<span class="hljs-property">path</span> || <span class="hljs-string">`file-<span class="hljs-subst">${data.globalIndex}</span>`</span>, completed, total, progress, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);
              }
            }
          }
        }
      }
    }

    <span class="hljs-keyword">return</span> results;
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">generateExplanations</span>(<span class="hljs-params">analysis, progressCallback = <span class="hljs-literal">null</span></span>) {
    <span class="hljs-comment">// Reset token tracking</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span> = {
      <span class="hljs-attr">totalInputTokens</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">totalOutputTokens</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">totalTokens</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">cachedFiles</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">processedFiles</span>: <span class="hljs-number">0</span>
    };

    <span class="hljs-comment">// Check if this is architecture or onboarding mode (codebase-level analysis)</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">mode</span> === <span class="hljs-string">&#x27;architecture&#x27;</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">mode</span> === <span class="hljs-string">&#x27;arch&#x27;</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">mode</span> === <span class="hljs-string">&#x27;onboarding&#x27;</span>) {
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">explainCodebaseWithAISummaries</span>(analysis, progressCallback);
      <span class="hljs-keyword">return</span> [result];
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(analysis)) {
      <span class="hljs-comment">// Multiple files - use request batching for better performance</span>
      <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">processFilesWithRequestBatching</span>(analysis, progressCallback);
      <span class="hljs-keyword">return</span> results;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// Single file</span>
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">explainFile</span>(analysis);
      <span class="hljs-keyword">if</span> (progressCallback) {
        <span class="hljs-title function_">progressCallback</span>(analysis.<span class="hljs-property">path</span> || <span class="hljs-string">&#x27;single-file&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">100</span>, result.<span class="hljs-property">cached</span>, <span class="hljs-literal">false</span>); <span class="hljs-comment">// Completed</span>
      }
      <span class="hljs-keyword">return</span> result;
    }
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">explainCodebaseWithAISummaries</span>(<span class="hljs-params">analysisArray, progressCallback</span>) {
    <span class="hljs-comment">// First, generate AI summaries for each file using request batching</span>
    <span class="hljs-keyword">const</span> fileSummaries = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">processFilesWithRequestBatching</span>(
      analysisArray,
      progressCallback,
      <span class="hljs-title function_">async</span> (file, index) =&gt; {
        <span class="hljs-comment">// Temporarily set mode to summary to get file summaries</span>
        <span class="hljs-keyword">const</span> originalMode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">mode</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">mode</span> = <span class="hljs-variable constant_">MODES</span>.<span class="hljs-property">SUMMARY</span>;

        <span class="hljs-keyword">const</span> summaryResult = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">explainFile</span>(file);

        <span class="hljs-comment">// Restore original mode</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">mode</span> = originalMode;

        <span class="hljs-keyword">return</span> {
          <span class="hljs-attr">relativePath</span>: file.<span class="hljs-property">relativePath</span>,
          <span class="hljs-attr">language</span>: file.<span class="hljs-property">language</span>,
          <span class="hljs-attr">summary</span>: summaryResult.<span class="hljs-property">explanation</span>,
          <span class="hljs-attr">cached</span>: summaryResult.<span class="hljs-property">cached</span>
        };
      }
    );

    <span class="hljs-comment">// Filter out any null results and ensure proper structure</span>
    <span class="hljs-keyword">const</span> validSummaries = fileSummaries.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">summary</span> =&gt;</span> summary !== <span class="hljs-literal">null</span>);

    <span class="hljs-comment">// Now generate the final architecture/onboarding analysis using the AI summaries</span>
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">explainCodebaseFromSummaries</span>(validSummaries, analysisArray);
    <span class="hljs-keyword">return</span> result;
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">explainCodebaseFromSummaries</span>(<span class="hljs-params">fileSummaries, analysisArray</span>) {
    <span class="hljs-comment">// Create a single codebase analysis object</span>
    <span class="hljs-keyword">const</span> codebaseSummary = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">buildCodebaseSummary</span>(analysisArray, fileSummaries);

    <span class="hljs-keyword">const</span> codebaseAnalysis = {
      <span class="hljs-attr">relativePath</span>: (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">mode</span> === <span class="hljs-string">&#x27;architecture&#x27;</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">mode</span> === <span class="hljs-string">&#x27;arch&#x27;</span>) ? <span class="hljs-string">&#x27;Project Architecture&#x27;</span> : <span class="hljs-string">&#x27;Developer Onboarding&#x27;</span>,
      <span class="hljs-attr">path</span>: (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">mode</span> === <span class="hljs-string">&#x27;architecture&#x27;</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">mode</span> === <span class="hljs-string">&#x27;arch&#x27;</span>) ? <span class="hljs-string">&#x27;project-architecture&#x27;</span> : <span class="hljs-string">&#x27;developer-onboarding&#x27;</span>,
      <span class="hljs-attr">language</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">mode</span>,
      <span class="hljs-attr">content</span>: codebaseSummary,
      <span class="hljs-attr">codebaseSummary</span>: codebaseSummary
    };

    <span class="hljs-comment">// Try to get cached explanation first (unless cache is disabled)</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">cache</span> !== <span class="hljs-literal">false</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_log</span>(<span class="hljs-string">&#x27;info&#x27;</span>, <span class="hljs-function">() =&gt;</span> chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`🔍 Checking cache for: <span class="hljs-subst">${codebaseAnalysis.relativePath}</span>`</span>));

      <span class="hljs-keyword">const</span> cachedExplanation = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">cacheManager</span>.<span class="hljs-title function_">getCachedExplanation</span>(
        codebaseAnalysis.<span class="hljs-property">path</span>,
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>
      );

      <span class="hljs-keyword">if</span> (cachedExplanation) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_log</span>(<span class="hljs-string">&#x27;info&#x27;</span>, <span class="hljs-function">() =&gt;</span> chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`📋 Cache hit! Using cached explanation (<span class="hljs-subst">${cachedExplanation.length}</span> chars)`</span>));
        <span class="hljs-comment">// Track cached file usage</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>.<span class="hljs-property">cachedFiles</span>++;
        <span class="hljs-keyword">return</span> {
          ...codebaseAnalysis,
          <span class="hljs-attr">explanation</span>: cachedExplanation,
          <span class="hljs-attr">cached</span>: <span class="hljs-literal">true</span>
        };
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_log</span>(<span class="hljs-string">&#x27;info&#x27;</span>, <span class="hljs-function">() =&gt;</span> chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">&#x27;📭 Cache miss - will generate new explanation&#x27;</span>));
      }
    }

    <span class="hljs-keyword">const</span> prompt = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">buildPrompt</span>(codebaseAnalysis);

    <span class="hljs-comment">// Estimate input tokens (prompt)</span>
    <span class="hljs-keyword">const</span> inputTokens = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">estimateTokens</span>(prompt);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>.<span class="hljs-property">totalInputTokens</span> += inputTokens;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>.<span class="hljs-property">processedFiles</span>++;

    <span class="hljs-comment">// Verbose: Show prompt details</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">logger</span>.<span class="hljs-title function_">logVerbose</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`🔍 Processing: <span class="hljs-subst">${codebaseAnalysis.relativePath}</span>`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`📝 Prompt (<span class="hljs-subst">${prompt.length}</span> chars, ~<span class="hljs-subst">${inputTokens}</span> tokens):`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">&#x27;   &#x27;</span> + prompt.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\n/g</span>, <span class="hljs-string">&#x27;\n   &#x27;</span>)));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;&#x27;</span>);
    });

    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// Retry with exponential backoff using LangChain</span>
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">retryWithBackoff</span>(<span class="hljs-title function_">async</span> () =&gt; {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">modelInstance</span>.<span class="hljs-title function_">invoke</span>([
          { <span class="hljs-attr">role</span>: <span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">&#x27;You are a helpful assistant that provides detailed code analysis and documentation.&#x27;</span> },
          { <span class="hljs-attr">role</span>: <span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-attr">content</span>: prompt }
        ]);
      });

      <span class="hljs-keyword">const</span> response = result.<span class="hljs-property">content</span>;

      <span class="hljs-comment">// Get token usage from metadata</span>
      <span class="hljs-keyword">const</span> metadata = result.<span class="hljs-property">additional_kwargs</span>?.<span class="hljs-property">response_metadata</span> ||
        result.<span class="hljs-property">additional_kwargs</span>?.<span class="hljs-property">usage_metadata</span> ||
        result.<span class="hljs-property">lc_kwargs</span>?.<span class="hljs-property">response_metadata</span>;

      <span class="hljs-comment">// Update token tracking with actual usage if available</span>
      <span class="hljs-keyword">const</span> outputTokens = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">estimateTokens</span>(response, metadata);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>.<span class="hljs-property">totalOutputTokens</span> += outputTokens;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>.<span class="hljs-property">totalTokens</span> += inputTokens + outputTokens;

      <span class="hljs-comment">// Verbose: Show response details</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">verbose</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`✅ Response (<span class="hljs-subst">${response.length}</span> chars, ~<span class="hljs-subst">${outputTokens}</span> tokens):`</span>));
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">&#x27;   &#x27;</span> + response.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">200</span>) + (response.<span class="hljs-property">length</span> &gt; <span class="hljs-number">200</span> ? <span class="hljs-string">&#x27;...&#x27;</span> : <span class="hljs-string">&#x27;&#x27;</span>)));
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;&#x27;</span>);
      }

      <span class="hljs-comment">// Cache the explanation (unless cache is disabled)</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">cache</span> !== <span class="hljs-literal">false</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">verbose</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`💾 Saving to cache: <span class="hljs-subst">${codebaseAnalysis.relativePath}</span>`</span>));
        }
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">cacheManager</span>.<span class="hljs-title function_">setCachedExplanation</span>(
          codebaseAnalysis.<span class="hljs-property">path</span>,
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>,
          response
        );
      }

      <span class="hljs-keyword">return</span> {
        ...codebaseAnalysis,
        <span class="hljs-attr">explanation</span>: response,
        <span class="hljs-attr">cached</span>: <span class="hljs-literal">false</span>
      };
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-comment">// Ensure all errors, including those after all retries, are handled here</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error generating <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.config.mode}</span> analysis:`</span>, error &amp;&amp; error.<span class="hljs-property">message</span> ? error.<span class="hljs-property">message</span> : error);
      <span class="hljs-keyword">return</span> {
        ...codebaseAnalysis,
        <span class="hljs-attr">explanation</span>: <span class="hljs-string">`Error generating <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.config.mode}</span> analysis: <span class="hljs-subst">${error &amp;&amp; error.message ? error.message : error}</span>`</span>,
        <span class="hljs-attr">cached</span>: <span class="hljs-literal">false</span>
      };
    }
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">explainCodebase</span>(<span class="hljs-params">analysisArray</span>) {
    <span class="hljs-comment">// Create a single codebase analysis object</span>
    <span class="hljs-keyword">const</span> codebaseSummary = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">buildCodebaseSummary</span>(analysisArray);

    <span class="hljs-keyword">const</span> codebaseAnalysis = {
      <span class="hljs-attr">relativePath</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">mode</span> === <span class="hljs-string">&#x27;architecture&#x27;</span> ? <span class="hljs-string">&#x27;Project Architecture&#x27;</span> : <span class="hljs-string">&#x27;Developer Onboarding&#x27;</span>,
      <span class="hljs-attr">path</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">mode</span> === <span class="hljs-string">&#x27;architecture&#x27;</span> ? <span class="hljs-string">&#x27;project-architecture&#x27;</span> : <span class="hljs-string">&#x27;developer-onboarding&#x27;</span>,
      <span class="hljs-attr">language</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">mode</span>,
      <span class="hljs-attr">content</span>: codebaseSummary,
      <span class="hljs-attr">codebaseSummary</span>: codebaseSummary
    };

    <span class="hljs-comment">// Try to get cached explanation first (unless cache is disabled)</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">cache</span> !== <span class="hljs-literal">false</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">logger</span>.<span class="hljs-title function_">logVerbose</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`🔍 Checking cache for: <span class="hljs-subst">${codebaseAnalysis.relativePath}</span>`</span>)));

      <span class="hljs-keyword">const</span> cachedExplanation = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">cacheManager</span>.<span class="hljs-title function_">getCachedExplanation</span>(
        codebaseAnalysis.<span class="hljs-property">path</span>,
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>
      );

      <span class="hljs-keyword">if</span> (cachedExplanation) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">logger</span>.<span class="hljs-title function_">logVerbose</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`📋 Cache hit! Using cached explanation (<span class="hljs-subst">${cachedExplanation.length}</span> chars)`</span>)));
        <span class="hljs-comment">// Track cached file usage</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>.<span class="hljs-property">cachedFiles</span>++;
        <span class="hljs-keyword">return</span> {
          ...codebaseAnalysis,
          <span class="hljs-attr">explanation</span>: cachedExplanation,
          <span class="hljs-attr">cached</span>: <span class="hljs-literal">true</span>
        };
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">logger</span>.<span class="hljs-title function_">logVerbose</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">&#x27;📭 Cache miss - will generate new explanation&#x27;</span>)));
      }
    }

    <span class="hljs-keyword">const</span> prompt = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">buildPrompt</span>(codebaseAnalysis);

    <span class="hljs-comment">// Estimate input tokens (prompt)</span>
    <span class="hljs-keyword">const</span> inputTokens = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">estimateTokens</span>(prompt);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>.<span class="hljs-property">totalInputTokens</span> += inputTokens;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>.<span class="hljs-property">processedFiles</span>++;

    <span class="hljs-comment">// Verbose: Show prompt details</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">logger</span>.<span class="hljs-title function_">logVerbose</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`🔍 Processing: <span class="hljs-subst">${codebaseAnalysis.relativePath}</span>`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`📝 Prompt (<span class="hljs-subst">${prompt.length}</span> chars, ~<span class="hljs-subst">${inputTokens}</span> tokens):`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">&#x27;   &#x27;</span> + prompt.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\n/g</span>, <span class="hljs-string">&#x27;\n   &#x27;</span>)));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;&#x27;</span>);
    });

    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// Retry with exponential backoff using LangChain</span>
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">retryWithBackoff</span>(<span class="hljs-title function_">async</span> () =&gt; {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">modelInstance</span>.<span class="hljs-title function_">invoke</span>([
          { <span class="hljs-attr">role</span>: <span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">&#x27;You are a helpful assistant that provides detailed code analysis and documentation.&#x27;</span> },
          { <span class="hljs-attr">role</span>: <span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-attr">content</span>: prompt }
        ]);
      });

      <span class="hljs-keyword">const</span> response = result.<span class="hljs-property">content</span>;

      <span class="hljs-comment">// Get token usage from metadata</span>
      <span class="hljs-keyword">const</span> metadata = result.<span class="hljs-property">additional_kwargs</span>?.<span class="hljs-property">response_metadata</span> ||
        result.<span class="hljs-property">additional_kwargs</span>?.<span class="hljs-property">usage_metadata</span> ||
        result.<span class="hljs-property">lc_kwargs</span>?.<span class="hljs-property">response_metadata</span>;

      <span class="hljs-comment">// Update token tracking with actual usage if available</span>
      <span class="hljs-keyword">const</span> outputTokens = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">estimateTokens</span>(response, metadata);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>.<span class="hljs-property">totalOutputTokens</span> += outputTokens;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>.<span class="hljs-property">totalTokens</span> += inputTokens + outputTokens;

      <span class="hljs-comment">// Verbose: Show response details</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">verbose</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`✅ Response (<span class="hljs-subst">${response.length}</span> chars, ~<span class="hljs-subst">${outputTokens}</span> tokens):`</span>));
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">&#x27;   &#x27;</span> + response.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">200</span>) + (response.<span class="hljs-property">length</span> &gt; <span class="hljs-number">200</span> ? <span class="hljs-string">&#x27;...&#x27;</span> : <span class="hljs-string">&#x27;&#x27;</span>)));
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;&#x27;</span>);
      }

      <span class="hljs-comment">// Cache the explanation (unless cache is disabled)</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">cache</span> !== <span class="hljs-literal">false</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">verbose</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`💾 Saving to cache: <span class="hljs-subst">${codebaseAnalysis.relativePath}</span>`</span>));
        }
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">cacheManager</span>.<span class="hljs-title function_">setCachedExplanation</span>(
          codebaseAnalysis.<span class="hljs-property">path</span>,
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>,
          response
        );
      }

      <span class="hljs-keyword">return</span> {
        ...codebaseAnalysis,
        <span class="hljs-attr">explanation</span>: response,
        <span class="hljs-attr">cached</span>: <span class="hljs-literal">false</span>
      };
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-comment">// Ensure all errors, including those after all retries, are handled here</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error generating <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.config.mode}</span> analysis:`</span>, error &amp;&amp; error.<span class="hljs-property">message</span> ? error.<span class="hljs-property">message</span> : error);
      <span class="hljs-keyword">return</span> {
        ...codebaseAnalysis,
        <span class="hljs-attr">explanation</span>: <span class="hljs-string">`Error generating <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.config.mode}</span> analysis: <span class="hljs-subst">${error &amp;&amp; error.message ? error.message : error}</span>`</span>,
        <span class="hljs-attr">cached</span>: <span class="hljs-literal">false</span>
      };
    }
  }

  <span class="hljs-title function_">buildCodebaseSummary</span>(<span class="hljs-params">analysisArray, fileSummaries = <span class="hljs-literal">null</span></span>) {
    <span class="hljs-keyword">let</span> summary = <span class="hljs-string">&#x27;# Codebase Summary\n\n&#x27;</span>;

    <span class="hljs-comment">// Group files by directory</span>
    <span class="hljs-keyword">const</span> dirMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    analysisArray.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> dir = path.<span class="hljs-title function_">dirname</span>(file.<span class="hljs-property">relativePath</span>);
      <span class="hljs-keyword">if</span> (!dirMap.<span class="hljs-title function_">has</span>(dir)) {
        dirMap.<span class="hljs-title function_">set</span>(dir, []);
      }
      dirMap.<span class="hljs-title function_">get</span>(dir).<span class="hljs-title function_">push</span>(file);
    });

    <span class="hljs-comment">// Add project structure</span>
    summary += <span class="hljs-string">&#x27;## Project Structure\n\n&#x27;</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [dir, files] <span class="hljs-keyword">of</span> dirMap) {
      summary += <span class="hljs-string">`### <span class="hljs-subst">${dir === <span class="hljs-string">&#x27;.&#x27;</span> ? <span class="hljs-string">&#x27;Root Directory&#x27;</span> : dir}</span>\n\n`</span>;
      files.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> fileSummary = fileSummaries ? fileSummaries.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-property">relativePath</span> === file.<span class="hljs-property">relativePath</span>)?.<span class="hljs-property">summary</span> : <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">extractPurpose</span>(file.<span class="hljs-property">content</span>, file.<span class="hljs-property">relativePath</span>, file.<span class="hljs-property">language</span>);
        summary += <span class="hljs-string">`- **<span class="hljs-subst">${path.basename(file.relativePath)}</span>** (<span class="hljs-subst">${file.language}</span>): <span class="hljs-subst">${fileSummary || <span class="hljs-variable language_">this</span>.extractPurpose(file.content, file.relativePath, file.language)}</span>\n`</span>;
      });
      summary += <span class="hljs-string">&#x27;\n&#x27;</span>;
    }

    <span class="hljs-comment">// Add technology stack</span>
    <span class="hljs-keyword">const</span> languages = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(analysisArray.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> file.<span class="hljs-property">language</span>))];
    <span class="hljs-keyword">const</span> extensions = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(analysisArray.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> path.<span class="hljs-title function_">extname</span>(file.<span class="hljs-property">relativePath</span>)))];
    summary += <span class="hljs-string">&#x27;## Technology Stack\n\n&#x27;</span>;
    summary += <span class="hljs-string">`- **Languages**: <span class="hljs-subst">${languages.join(<span class="hljs-string">&#x27;, &#x27;</span>)}</span>\n`</span>;
    summary += <span class="hljs-string">`- **File Types**: <span class="hljs-subst">${extensions.join(<span class="hljs-string">&#x27;, &#x27;</span>)}</span>\n\n`</span>;

    <span class="hljs-comment">// Add key files content (limited to avoid token limits)</span>
    summary += <span class="hljs-string">&#x27;## Key Files Content\n\n&#x27;</span>;
    <span class="hljs-keyword">const</span> keyFiles = analysisArray.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span>
      file.<span class="hljs-property">relativePath</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;package.json&#x27;</span>) ||
      file.<span class="hljs-property">relativePath</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;main&#x27;</span>) ||
      file.<span class="hljs-property">relativePath</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;index&#x27;</span>) ||
      file.<span class="hljs-property">relativePath</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;app&#x27;</span>) ||
      file.<span class="hljs-property">relativePath</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;config&#x27;</span>)
    ).<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>); <span class="hljs-comment">// Limit to 5 key files</span>

    keyFiles.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> {
      summary += <span class="hljs-string">`### <span class="hljs-subst">${file.relativePath}</span>\n\n`</span>;
      summary += <span class="hljs-string">`\`\`\`<span class="hljs-subst">${file.language}</span>\n<span class="hljs-subst">${file.content.substring(<span class="hljs-number">0</span>, <span class="hljs-number">1000</span>)}</span><span class="hljs-subst">${file.content.length &gt; <span class="hljs-number">1000</span> ? <span class="hljs-string">&#x27;\n... (truncated)&#x27;</span> : <span class="hljs-string">&#x27;&#x27;</span>}</span>\n\`\`\`\n\n`</span>;
    });

    <span class="hljs-keyword">return</span> summary;
  }

  <span class="hljs-title function_">extractPurpose</span>(<span class="hljs-params">content, relativePath, language</span>) {
    <span class="hljs-keyword">const</span> fileName = path.<span class="hljs-title function_">basename</span>(relativePath, path.<span class="hljs-title function_">extname</span>(relativePath));
    <span class="hljs-keyword">const</span> directory = path.<span class="hljs-title function_">dirname</span>(relativePath);

    <span class="hljs-comment">// Extract purpose based on common patterns</span>
    <span class="hljs-keyword">if</span> (content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;class &#x27;</span>) || content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;function &#x27;</span>) || content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;def &#x27;</span>)) {
      <span class="hljs-keyword">if</span> (relativePath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;controller&#x27;</span>) || relativePath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;route&#x27;</span>) || relativePath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;handler&#x27;</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Handles HTTP requests and routes them to appropriate business logic&#x27;</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (relativePath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;service&#x27;</span>) || relativePath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;manager&#x27;</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Contains business logic and service operations&#x27;</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (relativePath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;model&#x27;</span>) || relativePath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;entity&#x27;</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Defines data structures and database models&#x27;</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (relativePath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;api&#x27;</span>) || relativePath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;client&#x27;</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Handles external API communications&#x27;</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (relativePath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;util&#x27;</span>) || relativePath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;helper&#x27;</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Provides utility functions and reusable code&#x27;</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (relativePath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;config&#x27;</span>) || relativePath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;setting&#x27;</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Configuration settings and environment variables&#x27;</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (relativePath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;test&#x27;</span>) || relativePath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;spec&#x27;</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Contains tests for other modules&#x27;</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (relativePath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;main&#x27;</span>) || relativePath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;index&#x27;</span>) || relativePath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;app&#x27;</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Application entry point and main initialization&#x27;</span>;
      }
    }

    <span class="hljs-comment">// If no specific pattern found, return a generic description</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">`Contains code for <span class="hljs-subst">${fileName}</span> module`</span>;
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">explainFile</span>(<span class="hljs-params">fileAnalysis</span>) {
    <span class="hljs-keyword">if</span> (!fileAnalysis) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-comment">// Try to get cached explanation first (unless cache is disabled)</span>
    <span class="hljs-keyword">if</span> (fileAnalysis.<span class="hljs-property">path</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">cache</span> !== <span class="hljs-literal">false</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_log</span>(<span class="hljs-string">&#x27;info&#x27;</span>, <span class="hljs-function">() =&gt;</span> chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`🔍 Checking cache for: <span class="hljs-subst">${fileAnalysis.relativePath}</span>`</span>));

      <span class="hljs-keyword">const</span> cachedExplanation = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">cacheManager</span>.<span class="hljs-title function_">getCachedExplanation</span>(
        fileAnalysis.<span class="hljs-property">path</span>,
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>
      );

      <span class="hljs-keyword">if</span> (cachedExplanation) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_log</span>(<span class="hljs-string">&#x27;info&#x27;</span>, <span class="hljs-function">() =&gt;</span> chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`📋 Cache hit! Using cached explanation (<span class="hljs-subst">${cachedExplanation.length}</span> chars)`</span>));
        <span class="hljs-comment">// Track cached file usage</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>.<span class="hljs-property">cachedFiles</span>++;
        <span class="hljs-keyword">return</span> {
          ...fileAnalysis,
          <span class="hljs-attr">explanation</span>: cachedExplanation,
          <span class="hljs-attr">cached</span>: <span class="hljs-literal">true</span>
        };
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_log</span>(<span class="hljs-string">&#x27;info&#x27;</span>, <span class="hljs-function">() =&gt;</span> chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">&#x27;📭 Cache miss - will generate new explanation&#x27;</span>));
      }
    }

    <span class="hljs-keyword">const</span> prompt = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">buildPrompt</span>(fileAnalysis);

    <span class="hljs-comment">// Estimate input tokens (prompt)</span>
    <span class="hljs-keyword">const</span> inputTokens = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">estimateTokens</span>(prompt);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>.<span class="hljs-property">totalInputTokens</span> += inputTokens;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>.<span class="hljs-property">processedFiles</span>++;

    <span class="hljs-comment">// Verbose: Show prompt details</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_log</span>(<span class="hljs-string">&#x27;info&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> output = [];
      output.<span class="hljs-title function_">push</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`🔍 Processing: <span class="hljs-subst">${fileAnalysis.relativePath}</span>`</span>));
      output.<span class="hljs-title function_">push</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`📝 Prompt (<span class="hljs-subst">${prompt.length}</span> chars, ~<span class="hljs-subst">${inputTokens}</span> tokens):`</span>));
      output.<span class="hljs-title function_">push</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">&#x27;   &#x27;</span> + prompt.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\n/g</span>, <span class="hljs-string">&#x27;\n   &#x27;</span>)));
      output.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;&#x27;</span>);
      <span class="hljs-keyword">return</span> output.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;\n&#x27;</span>);
    });

    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// Retry with exponential backoff using LangChain</span>
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">retryWithBackoff</span>(<span class="hljs-title function_">async</span> () =&gt; {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">modelInstance</span>.<span class="hljs-title function_">invoke</span>([
          { <span class="hljs-attr">role</span>: <span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">&#x27;You are a helpful assistant that provides detailed code explanations.&#x27;</span> },
          { <span class="hljs-attr">role</span>: <span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-attr">content</span>: prompt }
        ]);
      });

      <span class="hljs-keyword">const</span> response = result.<span class="hljs-property">content</span>;

      <span class="hljs-comment">// Get token usage from metadata</span>
      <span class="hljs-keyword">const</span> metadata = result.<span class="hljs-property">additional_kwargs</span>?.<span class="hljs-property">response_metadata</span> ||
        result.<span class="hljs-property">additional_kwargs</span>?.<span class="hljs-property">usage_metadata</span> ||
        result.<span class="hljs-property">lc_kwargs</span>?.<span class="hljs-property">response_metadata</span>;

      <span class="hljs-comment">// Update token tracking with actual usage if available</span>
      <span class="hljs-keyword">const</span> outputTokens = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">estimateTokens</span>(response, metadata);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>.<span class="hljs-property">totalOutputTokens</span> += outputTokens;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenUsage</span>.<span class="hljs-property">totalTokens</span> += inputTokens + outputTokens;

      <span class="hljs-comment">// Verbose: Show response details</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_log</span>(<span class="hljs-string">&#x27;info&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> output = [];
        output.<span class="hljs-title function_">push</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`✅ Response (<span class="hljs-subst">${response.length}</span> chars, ~<span class="hljs-subst">${outputTokens}</span> tokens):`</span>));
        output.<span class="hljs-title function_">push</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">&#x27;   &#x27;</span> + response.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">200</span>) + (response.<span class="hljs-property">length</span> &gt; <span class="hljs-number">200</span> ? <span class="hljs-string">&#x27;...&#x27;</span> : <span class="hljs-string">&#x27;&#x27;</span>)));
        output.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;&#x27;</span>);
        <span class="hljs-keyword">return</span> output.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;\n&#x27;</span>);
      });

      <span class="hljs-comment">// Cache the explanation (unless cache is disabled)</span>
      <span class="hljs-keyword">if</span> (fileAnalysis.<span class="hljs-property">path</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">cache</span> !== <span class="hljs-literal">false</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_log</span>(<span class="hljs-string">&#x27;info&#x27;</span>, <span class="hljs-function">() =&gt;</span> chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`💾 Saving to cache: <span class="hljs-subst">${fileAnalysis.relativePath}</span>`</span>));
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">cacheManager</span>.<span class="hljs-title function_">setCachedExplanation</span>(
          fileAnalysis.<span class="hljs-property">path</span>,
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>,
          response
        );
      }

      <span class="hljs-comment">// Clear file content reference to free memory</span>
      <span class="hljs-keyword">if</span> (fileAnalysis &amp;&amp; fileAnalysis.<span class="hljs-property">content</span>) {
        fileAnalysis.<span class="hljs-property">content</span> = <span class="hljs-literal">null</span>;
      }

      <span class="hljs-keyword">return</span> {
        ...fileAnalysis,
        <span class="hljs-attr">explanation</span>: response,
        <span class="hljs-attr">cached</span>: <span class="hljs-literal">false</span>
      };
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-comment">// Ensure all errors, including those after all retries, are handled here</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error explaining file <span class="hljs-subst">${fileAnalysis.path}</span>:`</span>, error &amp;&amp; error.<span class="hljs-property">message</span> ? error.<span class="hljs-property">message</span> : error);

      <span class="hljs-comment">// Clear file content reference even on error</span>
      <span class="hljs-keyword">if</span> (fileAnalysis &amp;&amp; fileAnalysis.<span class="hljs-property">content</span>) {
        fileAnalysis.<span class="hljs-property">content</span> = <span class="hljs-literal">null</span>;
      }

      <span class="hljs-keyword">return</span> {
        ...fileAnalysis,
        <span class="hljs-attr">explanation</span>: <span class="hljs-string">`Error generating explanation: <span class="hljs-subst">${error &amp;&amp; error.message ? error.message : error}</span>`</span>,
        <span class="hljs-attr">cached</span>: <span class="hljs-literal">false</span>
      };
    }
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">buildPrompt</span>(<span class="hljs-params">fileAnalysis</span>) {
    <span class="hljs-keyword">const</span> levelDescription = <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">level</span> === <span class="hljs-variable constant_">USER_LEVELS</span>.<span class="hljs-property">EXPERT</span>
      ? <span class="hljs-string">&#x27;an expert developer&#x27;</span>
      : <span class="hljs-string">&#x27;a beginner developer&#x27;</span>;

    <span class="hljs-comment">// Get the appropriate prompt template</span>
    <span class="hljs-keyword">let</span> mode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">mode</span> || <span class="hljs-variable constant_">MODES</span>.<span class="hljs-property">EXPLAIN</span>;
    <span class="hljs-comment">// Handle architecture mode alias</span>
    <span class="hljs-keyword">if</span> (mode === <span class="hljs-variable constant_">MODES</span>.<span class="hljs-property">ARCH</span>) {
      mode = <span class="hljs-variable constant_">MODES</span>.<span class="hljs-property">ARCHITECTURE</span>;
    }
    <span class="hljs-keyword">const</span> promptTemplate = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">promptManager</span>.<span class="hljs-title function_">getPrompt</span>(mode);

    <span class="hljs-comment">// Render the prompt with variables</span>
    <span class="hljs-keyword">let</span> variables = {
      <span class="hljs-attr">levelDescription</span>: levelDescription,
      <span class="hljs-attr">language</span>: fileAnalysis.<span class="hljs-property">language</span>,
      <span class="hljs-attr">filePath</span>: fileAnalysis.<span class="hljs-property">path</span>,
      <span class="hljs-attr">codeContent</span>: fileAnalysis.<span class="hljs-property">content</span>
    };

    <span class="hljs-comment">// For architecture and onboarding modes, use codebaseSummary instead</span>
    <span class="hljs-keyword">if</span> (mode === <span class="hljs-variable constant_">MODES</span>.<span class="hljs-property">ARCHITECTURE</span> || mode === <span class="hljs-string">&#x27;onboarding&#x27;</span>) {
      variables = {
        <span class="hljs-attr">levelDescription</span>: levelDescription,
        <span class="hljs-attr">codebaseSummary</span>: fileAnalysis.<span class="hljs-property">codebaseSummary</span> || fileAnalysis.<span class="hljs-property">content</span>
      };
    }

    <span class="hljs-keyword">const</span> prompt = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">promptManager</span>.<span class="hljs-title function_">renderPrompt</span>(promptTemplate, variables);

    <span class="hljs-comment">// Add instruction to always respond in markdown</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${prompt}</span>\n\nIMPORTANT: Always respond in markdown format.`</span>;
  }
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { <span class="hljs-title class_">AIEngine</span> };</div>
                 </div>

             <div class="p-4">
                 <div class="d-flex justify-content-between align-items-center mb-3">
                     <h3 class="h6 text-muted mb-0 d-flex align-items-center">
                         <i class="fas fa-brain me-2 text-primary"></i>
                         AI Explanation
                     </h3>
                     <button class="btn btn-outline-primary btn-sm copy-explanation" data-file-index="0" title="Copy explanation">
                         <i class="fas fa-copy me-1"></i> Copy
                     </button>
                 </div>
                 <div class="explanation-content">
                     <h1>AIEngine JavaScript Code Explanation</h1>
<p>This JavaScript file, <code>aiEngine.js</code>, defines a class <code>AIEngine</code> that serves as an engine for generating explanations for code files. The class supports multiple AI providers for natural language processing to assist developers by explaining code, analyzing architectures, and other tasks. Below is a structured explanation of the main components and functions from the file:</p>
<h2>Key Components</h2>
<h3>Imports</h3>
<ol>
<li><p><strong>Core Libraries and Utilities</strong></p>
<ul>
<li><code>path</code> (Node.js built-in): Handles and transforms file paths.</li>
<li><code>chalk</code>: Provides terminal string styling for console outputs, like colors.</li>
</ul>
</li>
<li><p><strong>External AI Providers</strong></p>
<ul>
<li><code>ChatOpenAI</code>, <code>ChatGoogleGenerativeAI</code>, <code>ChatOllama</code>: AI chat modules from the <code>@langchain</code> package for interacting with different NLP models.</li>
</ul>
</li>
<li><p><strong>Internal Modules</strong></p>
<ul>
<li><code>CacheManager</code> and <code>PromptManager</code>: Custom managers for caching responses and managing prompt templates.</li>
<li><code>Logger</code>: Handles verbose logging.</li>
<li><code>dd</code>: A utility function for debugging.</li>
<li><code>encoding_for_model</code>: A function for encoding models from the <code>tiktoken</code> package.</li>
</ul>
</li>
<li><p><strong>Constants Import</strong></p>
<ul>
<li>Includes constants for concurrency management from another internal module.</li>
</ul>
</li>
</ol>
<h3>Constants</h3>
<ul>
<li><strong>PROVIDERS</strong>: Lists supported AI providers such as <code>gemini</code>, <code>openai</code>, and <code>ollama</code>.</li>
<li><strong>MODES</strong>: Defines different operational modes like <code>explain</code>, <code>architecture</code>, etc.</li>
<li><strong>USER_LEVELS</strong>: Differentiates expertise levels like <code>expert</code> and <code>beginner</code>.</li>
</ul>
<h2>AIEngine Class</h2>
<h3>Constructor</h3>
<ul>
<li>Initializes the <code>AIEngine</code> with <code>config</code> settings determining the provider, model, API key, concurrency, and verbosity level.</li>
<li>Initializes several manager instances (<code>Logger</code>, <code>CacheManager</code>, <code>PromptManager</code>).</li>
</ul>
<h3>Methods</h3>
<h4><code>init()</code></h4>
<ul>
<li>Initializes the cache and prompt managers asynchronously.</li>
</ul>
<h4><code>setupModel()</code></h4>
<ul>
<li>Configures and instantiates the AI model based on the selected <code>provider</code>.</li>
<li>Throws an error if an unsupported provider is specified.</li>
</ul>
<h4><code>_log(level, message)</code></h4>
<ul>
<li>Logs messages with severity conditions (<code>error</code>, <code>warn</code>, <code>info</code>) using <code>chalk</code> for color-coding output.</li>
</ul>
<h4><code>retryWithBackoff(fn)</code></h4>
<ul>
<li>Implements an exponential backoff strategy for retrying asynchronous functions <code>fn</code> upon failure.</li>
</ul>
<h4><code>estimateTokens(text, metadata)</code></h4>
<ul>
<li>Estimates the number of tokens in a given text using metadata or an appropriate tokenizer.</li>
</ul>
<h4><code>getUsageSummary()</code></h4>
<ul>
<li>Returns a summary of token usage and file processing.</li>
</ul>
<h4><code>_suggestGC()</code></h4>
<ul>
<li>If possible and environmental condition allows, suggests garbage collection to free up memory resources.</li>
</ul>
<h4><code>processFilesInBatches(files, processFn, progressCallback)</code></h4>
<ul>
<li>Processes files in parallel batches.</li>
<li>Disposes resources and suggests memory cleanup after batch processing.</li>
</ul>
<h4><code>processFilesWithRequestBatching(files, progressCallback, processFn)</code></h4>
<ul>
<li>Similar to <code>processFilesInBatches</code> but optimized for making batched API requests where possible.</li>
</ul>
<h4><code>generateExplanations(analysis, progressCallback)</code></h4>
<ul>
<li>Manages whether to perform batch processing or architecture-level processing based on configuration.</li>
</ul>
<h4><code>explainCodebaseWithAISummaries(analysisArray, progressCallback)</code></h4>
<ul>
<li>Generates AI-based summaries for files and compiles an overall codebase analysis.</li>
</ul>
<h4><code>explainCodebaseFromSummaries(fileSummaries, analysisArray)</code></h4>
<ul>
<li>Generates architectural analyses from provided file summaries using AI.</li>
</ul>
<h4><code>buildCodebaseSummary(analysisArray, fileSummaries)</code></h4>
<ul>
<li>Constructs a structured summary of the codebase by organizing file information by directories and technologies used.</li>
</ul>
<h4><code>explainFile(fileAnalysis)</code></h4>
<ul>
<li>Generates a detailed explanation of a single file&#39;s purpose/content using the configured AI model.</li>
</ul>
<h4><code>buildPrompt(fileAnalysis)</code></h4>
<ul>
<li>Constructs the prompt that will be sent to the AI model, injecting the necessary dynamic variables including the user level and mode.</li>
</ul>
<h2>Conclusion</h2>
<p>The <code>AIEngine</code> class facilitates the interaction with AI models to provide code explanations and analyses. It is designed to handle different models and providers dynamically, make efficient use of resources with caching and batching, and adapt to different user expertise levels. It logs operations and manages retries on failures with exponential backoff, ensuring robust and reliable execution.</p>

                 </div>
             </div>
         </div>
     </div>
 </div>

 <div class="file-entry col-12 mb-4" id="file-1" data-file-path="D:\MyDev\CodeExplain\src\ai\promptManager.js" data-file-index="1">
     <div class="card shadow-sm border-0 h-100" style="border-radius: 12px; overflow: hidden;">
         <div class="card-header bg-gradient-primary text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1rem 1.5rem;">
             <div class="d-flex justify-content-between align-items-center">
                  <h2 class="toggle-code h5 fw-semibold mb-0 cursor-pointer d-flex align-items-center text-white" data-file-index="1" style="font-size: 1.1rem;">
                      <i class="fas fa-chevron-right me-2 transition-transform duration-200"></i>
                      <i class="fas fa-file-code me-2"></i>
                      ai/promptManager.js
                  </h2>
                 <span class="badge bg-white bg-opacity-25 text-white px-2 py-1" style="font-size: 0.75rem;">
                     javascript
                 </span>
             </div>
         </div>

               <div class="card-body p-0">
                 <div class="code-container bg-light border-bottom d-none" style="max-height: 400px; overflow: auto;" data-file-path="D:\MyDev\CodeExplain\src\ai\promptManager.js" data-file-language="javascript">
                     <div class="p-3 text-center text-muted">
                         <div class="spinner-border spinner-border-sm me-2" role="status" style="display: none;"></div>
                         <span class="loading-text">Click to load code</span>
                     </div>
                     <div class="code-content" style="display: none;"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs-extra&#x27;</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PromptManager</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">promptsDir</span> = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;..&#x27;</span>, <span class="hljs-string">&#x27;..&#x27;</span>, <span class="hljs-string">&#x27;prompts&#x27;</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">userPromptsDir</span> = path.<span class="hljs-title function_">join</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">&#x27;.codeexplain&#x27;</span>, <span class="hljs-string">&#x27;prompts&#x27;</span>);
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">initialize</span>(<span class="hljs-params"></span>) {
    <span class="hljs-comment">// Ensure user prompts directory exists</span>
    <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">ensureDir</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">userPromptsDir</span>);

    <span class="hljs-comment">// Copy default prompts to user directory if they don&#x27;t exist</span>
    <span class="hljs-keyword">const</span> defaultPrompts = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readdir</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">promptsDir</span>);
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(
      defaultPrompts.<span class="hljs-title function_">map</span>(<span class="hljs-title function_">async</span> (promptEntry) =&gt; {
        <span class="hljs-keyword">const</span> defaultPromptPath = path.<span class="hljs-title function_">join</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">promptsDir</span>, promptEntry);
        <span class="hljs-keyword">const</span> userPromptPath = path.<span class="hljs-title function_">join</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">userPromptsDir</span>, promptEntry);

        <span class="hljs-comment">// Check if it&#x27;s a file before copying</span>
        <span class="hljs-keyword">const</span> stat = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">stat</span>(defaultPromptPath);
        <span class="hljs-keyword">if</span> (stat.<span class="hljs-title function_">isFile</span>()) {
          <span class="hljs-comment">// Only copy if user doesn&#x27;t have a custom version</span>
          <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">pathExists</span>(userPromptPath))) {
            <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">copy</span>(defaultPromptPath, userPromptPath);
          }
        }
      })
    );
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getPrompt</span>(<span class="hljs-params">mode</span>) {
    <span class="hljs-comment">// First check if user has a custom prompt</span>
    <span class="hljs-keyword">const</span> userPromptPath = path.<span class="hljs-title function_">join</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">userPromptsDir</span>, <span class="hljs-string">`<span class="hljs-subst">${mode}</span>.md`</span>);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">pathExists</span>(userPromptPath)) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(userPromptPath, <span class="hljs-string">&#x27;utf8&#x27;</span>);
    }

    <span class="hljs-comment">// Fall back to default prompt</span>
    <span class="hljs-keyword">const</span> defaultPromptPath = path.<span class="hljs-title function_">join</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">promptsDir</span>, <span class="hljs-string">`<span class="hljs-subst">${mode}</span>.md`</span>);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">pathExists</span>(defaultPromptPath)) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(defaultPromptPath, <span class="hljs-string">&#x27;utf8&#x27;</span>);
    }

    <span class="hljs-comment">// Log warning about missing prompt files</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`Prompt for mode &#x27;<span class="hljs-subst">${mode}</span>&#x27; not found in user or default directories. Using generic fallback prompt.`</span>);

    <span class="hljs-comment">// If no prompt found, return a basic template</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">`You are an AI assistant that explains code.
    
Please explain the following {{language}} code file:

File: {{filePath}}

Code:
{{codeContent}}

Please provide a clear explanation in markdown format.`</span>;
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">renderPrompt</span>(<span class="hljs-params">template, variables</span>) {
    <span class="hljs-keyword">let</span> prompt = template;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, value] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(variables)) {
      prompt = prompt.<span class="hljs-title function_">replace</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">`{{<span class="hljs-subst">${key}</span>}}`</span>, <span class="hljs-string">&#x27;g&#x27;</span>), value);
    }
    <span class="hljs-keyword">return</span> prompt;
  }
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { <span class="hljs-title class_">PromptManager</span> };</div>
                 </div>

             <div class="p-4">
                 <div class="d-flex justify-content-between align-items-center mb-3">
                     <h3 class="h6 text-muted mb-0 d-flex align-items-center">
                         <i class="fas fa-brain me-2 text-primary"></i>
                         AI Explanation
                     </h3>
                     <button class="btn btn-outline-primary btn-sm copy-explanation" data-file-index="1" title="Copy explanation">
                         <i class="fas fa-copy me-1"></i> Copy
                     </button>
                 </div>
                 <div class="explanation-content">
                     <h1>Explanation of <code>promptManager.js</code></h1>
<p>This JavaScript file defines a class <code>PromptManager</code> that manages a system of prompts, which are likely used in some AI application to provide templated messages or instructions. It uses the <code>fs-extra</code> and <code>path</code> modules to interact with the file system.</p>
<h2>Key Components</h2>
<h3>Imports</h3>
<ul>
<li><strong><code>fs-extra</code></strong>: An extension of Node.js&#39;s native <code>fs</code> module with additional functionality like <code>ensureDir</code>, <code>copy</code>, etc.</li>
<li><strong><code>path</code></strong>: Used for handling and transforming file paths.</li>
</ul>
<h3>Class: <code>PromptManager</code></h3>
<h4>Constructor</h4>
<p>The constructor doesn&#39;t take any arguments and initializes two properties:</p>
<ul>
<li><strong><code>this.promptsDir</code></strong>: Path to the default prompts directory.</li>
<li><strong><code>this.userPromptsDir</code></strong>: Path to the user-specific prompts directory. It&#39;s located in the current working directory under <code>/.codeexplain/prompts</code>.</li>
</ul>
<h4>Method: <code>initialize</code></h4>
<p>This asynchronous method ensures the user prompts directory exists and tries to copy default prompts to this directory if they don&#39;t already exist.</p>
<ol>
<li><strong>Ensure Directory Exists</strong>: <code>fs.ensureDir(this.userPromptsDir)</code> guarantees that the user prompts directory is present.</li>
<li><strong>Copy Default Prompts</strong>:<ul>
<li>List all entries in the default prompts directory.</li>
<li>For each entry:<ul>
<li>Check if it&#39;s a file.</li>
<li>If a user-specific version of the file doesn’t exist, copy it from the default to the user directory.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4>Method: <code>getPrompt</code></h4>
<p>This asynchronous method retrieves a prompt based on the specified <code>mode</code>.</p>
<ol>
<li><strong>User Custom Prompts</strong>: First, it checks if a customized user prompt exists and reads it.</li>
<li><strong>Default Prompts</strong>: If no user prompt is found, it attempts to read the default prompt.</li>
<li><strong>Fallback</strong>: If neither exists, it logs a warning and returns a generic fallback prompt template.</li>
</ol>
<h4>Method: <code>renderPrompt</code></h4>
<p>An asynchronous method that fills in variables in a given template. It replaces all instances of <code>{{key}}</code> with their corresponding values from the <code>variables</code> object.</p>
<h3>Export</h3>
<ul>
<li><code>module.exports = { PromptManager };</code>: This line exports the <code>PromptManager</code> class, making it available for import in other files.</li>
</ul>
<h2>Summary</h2>
<p>The <code>PromptManager</code> class is a utility for managing AI prompt templates. It checks for user-specific prompts but defaults to standard ones if needed, ensuring a flexible and customizable prompt system. The class is crucial for applications requiring consistent and dynamic message templating.</p>

                 </div>
             </div>
         </div>
     </div>
 </div>

 <div class="file-entry col-12 mb-4" id="file-2" data-file-path="D:\MyDev\CodeExplain\src\commands\explain.js" data-file-index="2">
     <div class="card shadow-sm border-0 h-100" style="border-radius: 12px; overflow: hidden;">
         <div class="card-header bg-gradient-primary text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1rem 1.5rem;">
             <div class="d-flex justify-content-between align-items-center">
                  <h2 class="toggle-code h5 fw-semibold mb-0 cursor-pointer d-flex align-items-center text-white" data-file-index="2" style="font-size: 1.1rem;">
                      <i class="fas fa-chevron-right me-2 transition-transform duration-200"></i>
                      <i class="fas fa-file-code me-2"></i>
                      commands/explain.js
                  </h2>
                 <span class="badge bg-white bg-opacity-25 text-white px-2 py-1" style="font-size: 0.75rem;">
                     javascript
                 </span>
             </div>
         </div>

               <div class="card-body p-0">
                 <div class="code-container bg-light border-bottom d-none" style="max-height: 400px; overflow: auto;" data-file-path="D:\MyDev\CodeExplain\src\commands\explain.js" data-file-language="javascript">
                     <div class="p-3 text-center text-muted">
                         <div class="spinner-border spinner-border-sm me-2" role="status" style="display: none;"></div>
                         <span class="loading-text">Click to load code</span>
                     </div>
                     <div class="code-content" style="display: none;"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);
<span class="hljs-keyword">const</span> chalk = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;chalk&#x27;</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">ConfigManager</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../config/configManager&#x27;</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">CodeAnalyzer</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../core/codeAnalyzer&#x27;</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">AIEngine</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../ai/aiEngine&#x27;</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">HTMLOutput</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../output/html/htmlOutput&#x27;</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">PDFOutput</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../output/pdf/pdfOutput&#x27;</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">PromptManager</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../ai/promptManager&#x27;</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">FlowchartGenerator</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../flowchart/flowchartGenerator&#x27;</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">Logger</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../utils/logger&#x27;</span>);
<span class="hljs-keyword">const</span> {
  <span class="hljs-variable constant_">MODE_LINE_BY_LINE</span>,
  <span class="hljs-variable constant_">MODE_FLOWCHART</span>,
  <span class="hljs-variable constant_">MODE_ARCHITECTURE</span>,
  <span class="hljs-variable constant_">MODE_ONBOARDING</span>,
  <span class="hljs-variable constant_">OUTPUT_PDF</span>,
  <span class="hljs-variable constant_">OUTPUT_HTML</span>
} = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../utils/constants&#x27;</span>);

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateFlowchart</span>(<span class="hljs-params">analysis, config</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">FlowchartGenerator</span>.<span class="hljs-title function_">generate</span>(analysis, config);
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">explain</span>(<span class="hljs-params">paths, options</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-property">cyan</span>.<span class="hljs-title function_">bold</span>(<span class="hljs-string">`
 ██████╗ ██████╗ ██████╗ ███████╗███████╗██╗  ██╗██████╗ ██╗      █████╗ ██╗███╗   ██╗
██╔════╝██╔═══██╗██╔══██╗██╔════╝██╔════╝╚██╗██╔╝██╔══██╗██║     ██╔══██╗██║████╗  ██║
██║     ██║   ██║██║  ██║█████╗  █████╗   ╚███╔╝ ██████╔╝██║     ███████║██║██╔██╗ ██║
██║     ██║   ██║██║  ██║██╔══╝  ██╔══╝   ██╔██╗ ██╔═══╝ ██║     ██╔══██║██║██║╚██╗██║
╚██████╗╚██████╔╝██████╔╝███████╗███████╗██╔╝ ██╗██║     ███████╗██║  ██║██║██║ ╚████║
 ╚═════╝ ╚═════╝ ╚═════╝ ╚══════╝╚══════╝╚═╝  ╚═╝╚═╝     ╚══════╝╚═╝  ╚═╝╚═╝╚═╝  ╚═══╝
`</span>));
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-property">cyan</span>.<span class="hljs-title function_">bold</span>(<span class="hljs-string">&#x27;🚀 Starting CodeExplain...&#x27;</span>));

    <span class="hljs-comment">// Ensure paths is an array</span>
    <span class="hljs-keyword">const</span> pathArray = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(paths) ? paths : [paths];

    <span class="hljs-comment">// Initialize configuration</span>
    <span class="hljs-keyword">const</span> configManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigManager</span>(options.<span class="hljs-property">config</span>);
    <span class="hljs-keyword">const</span> config = <span class="hljs-keyword">await</span> configManager.<span class="hljs-title function_">loadConfig</span>();

    <span class="hljs-comment">// Create final config with proper precedence: CLI &gt; Config &gt; Environment</span>
    <span class="hljs-comment">// To achieve this, we need to selectively apply CLI options that were explicitly provided</span>
    <span class="hljs-comment">// Check for explicitly provided options by looking for their flags in process.argv</span>
    <span class="hljs-keyword">const</span> cliArgs = process.<span class="hljs-property">argv</span>;

    <span class="hljs-comment">// Build final config with proper precedence</span>
    <span class="hljs-keyword">const</span> finalConfig = {
      <span class="hljs-comment">// Start with the loaded config which includes environment variables</span>
      ...config,
      <span class="hljs-comment">// Override with CLI options that were explicitly specified</span>
      <span class="hljs-attr">provider</span>: (cliArgs.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;--provider&#x27;</span>)) ? options.<span class="hljs-property">provider</span> : config.<span class="hljs-property">provider</span>,
      <span class="hljs-attr">output</span>: (cliArgs.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;--output&#x27;</span>)) ? options.<span class="hljs-property">output</span> : config.<span class="hljs-property">output</span>,
      <span class="hljs-attr">mode</span>: (cliArgs.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;--mode&#x27;</span>) || cliArgs.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;-m&#x27;</span>)) ? options.<span class="hljs-property">mode</span> : config.<span class="hljs-property">mode</span>,
      <span class="hljs-attr">level</span>: (cliArgs.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;--level&#x27;</span>) || cliArgs.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;-l&#x27;</span>)) ? options.<span class="hljs-property">level</span> : config.<span class="hljs-property">level</span>,
      <span class="hljs-attr">maxTokens</span>: (cliArgs.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;--max-tokens&#x27;</span>) || cliArgs.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;-t&#x27;</span>)) ? <span class="hljs-built_in">parseInt</span>(options.<span class="hljs-property">maxTokens</span>) : config.<span class="hljs-property">maxTokens</span>,
      <span class="hljs-attr">concurrency</span>: (cliArgs.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;--concurrency&#x27;</span>)) ? <span class="hljs-built_in">parseInt</span>(options.<span class="hljs-property">concurrency</span>) : config.<span class="hljs-property">concurrency</span>,
      <span class="hljs-attr">maxFileSize</span>: (cliArgs.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;--max-file-size&#x27;</span>)) ? <span class="hljs-built_in">parseInt</span>(options.<span class="hljs-property">maxFileSize</span>) : config.<span class="hljs-property">maxFileSize</span>,
      <span class="hljs-attr">model</span>: (cliArgs.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;--model&#x27;</span>) || cliArgs.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;-M&#x27;</span>)) ? options.<span class="hljs-property">model</span> : config.<span class="hljs-property">model</span>,
      <span class="hljs-attr">baseUrl</span>: (cliArgs.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;--base-url&#x27;</span>)) ? options.<span class="hljs-property">baseUrl</span> : config.<span class="hljs-property">baseUrl</span>,
      <span class="hljs-attr">cache</span>: (cliArgs.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;--no-cache&#x27;</span>)) ? <span class="hljs-literal">false</span> : config.<span class="hljs-property">cache</span>, <span class="hljs-comment">// --no-cache sets cache to false</span>
      <span class="hljs-comment">// Always use values that are not subject to default conflicts</span>
      <span class="hljs-attr">verbose</span>: options.<span class="hljs-property">verbose</span>,
      <span class="hljs-attr">paths</span>: pathArray,
      <span class="hljs-comment">// For API key, follow precedence: CLI &gt; Config (this was already handled correctly)</span>
      <span class="hljs-attr">apiKey</span>: options.<span class="hljs-property">apiKey</span> || options.<span class="hljs-property">apikey</span> || config.<span class="hljs-property">apiKey</span>
    };

    <span class="hljs-comment">// Remove lowercase variant if it exists to standardize on camelCase</span>
    <span class="hljs-keyword">delete</span> finalConfig.<span class="hljs-property">apikey</span>;

    <span class="hljs-comment">// Initialize logger</span>
    <span class="hljs-keyword">const</span> logger = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Logger</span>({ <span class="hljs-attr">verbose</span>: finalConfig.<span class="hljs-property">verbose</span> });

    <span class="hljs-comment">// Validate linebyline mode restrictions</span>
    <span class="hljs-keyword">if</span> (finalConfig.<span class="hljs-property">mode</span> === <span class="hljs-variable constant_">MODE_LINE_BY_LINE</span>) {
      <span class="hljs-comment">// Check if multiple files are provided</span>
      <span class="hljs-keyword">if</span> (pathArray.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">red</span>(<span class="hljs-string">&#x27;❌ Error: Line-by-line mode can only be used with a single file.&#x27;</span>));
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">yellow</span>(<span class="hljs-string">&#x27;💡 Tip: Use line-by-line mode with individual files:&#x27;</span>));
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">&#x27;   codeexplain path/to/single/file.js --mode linebyline&#x27;</span>));
        process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
      }

      <span class="hljs-comment">// Check if the single path is a directory</span>
      <span class="hljs-keyword">const</span> singlePath = pathArray[<span class="hljs-number">0</span>];
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> stats = <span class="hljs-keyword">await</span> fs.<span class="hljs-property">promises</span>.<span class="hljs-title function_">stat</span>(singlePath);
        <span class="hljs-keyword">if</span> (stats.<span class="hljs-title function_">isDirectory</span>()) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">red</span>(<span class="hljs-string">&#x27;❌ Error: Line-by-line mode can only be used with individual files, not directories.&#x27;</span>));
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">yellow</span>(<span class="hljs-string">&#x27;💡 Tip: Use line-by-line mode with a single file:&#x27;</span>));
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">&#x27;   codeexplain path/to/single/file.js --mode linebyline&#x27;</span>));
          process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
        }
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-comment">// File doesn&#x27;t exist, let the normal error handling take care of it</span>
      }
    }

    <span class="hljs-comment">// Verbose: Show configuration</span>
    logger.<span class="hljs-title function_">logVerbose</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">&#x27;📋 Configuration:&#x27;</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`   Paths: <span class="hljs-subst">${pathArray.join(<span class="hljs-string">&#x27;, &#x27;</span>)}</span>`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`   Provider: <span class="hljs-subst">${finalConfig.provider}</span>`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`   Model: <span class="hljs-subst">${finalConfig.model}</span>`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`   Output: <span class="hljs-subst">${finalConfig.output}</span>`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`   Mode: <span class="hljs-subst">${finalConfig.mode}</span>`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`   Level: <span class="hljs-subst">${finalConfig.level}</span>`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`   Max Tokens: <span class="hljs-subst">${finalConfig.maxTokens}</span>`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`   Base URL: <span class="hljs-subst">${finalConfig.baseUrl || <span class="hljs-string">&#x27;default&#x27;</span>}</span>`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`   Cache: <span class="hljs-subst">${finalConfig.cache !== <span class="hljs-literal">false</span> ? <span class="hljs-string">&#x27;enabled&#x27;</span> : <span class="hljs-string">&#x27;disabled&#x27;</span>}</span>`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`   Verbose: enabled`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;&#x27;</span>);
    });

    <span class="hljs-comment">// Initialize prompt manager to ensure prompts directory exists</span>
    <span class="hljs-keyword">const</span> promptManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PromptManager</span>();
    <span class="hljs-keyword">await</span> promptManager.<span class="hljs-title function_">initialize</span>();

    <span class="hljs-comment">// Initialize components</span>
    <span class="hljs-keyword">const</span> codeAnalyzer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CodeAnalyzer</span>(finalConfig);

    <span class="hljs-comment">// Analyze all paths</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">yellow</span>(<span class="hljs-string">`🔍 Analyzing: <span class="hljs-subst">${pathArray.join(<span class="hljs-string">&#x27;, &#x27;</span>)}</span>`</span>));

    <span class="hljs-keyword">const</span> allAnalysis = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> filePath <span class="hljs-keyword">of</span> pathArray) {
      logger.<span class="hljs-title function_">logVerbose</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`   Analyzing path: <span class="hljs-subst">${filePath}</span>`</span>)));
      <span class="hljs-keyword">const</span> analysis = <span class="hljs-keyword">await</span> codeAnalyzer.<span class="hljs-title function_">analyze</span>(filePath);
      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(analysis)) {
        allAnalysis.<span class="hljs-title function_">push</span>(...analysis);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (analysis) {
        allAnalysis.<span class="hljs-title function_">push</span>(analysis);
      }
    }

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">green</span>(<span class="hljs-string">`📁 Found <span class="hljs-subst">${allAnalysis.length}</span> file(s) to analyze`</span>));

    <span class="hljs-comment">// Verbose: Show file details</span>
    logger.<span class="hljs-title function_">logVerbose</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">&#x27;📄 Files to analyze:&#x27;</span>));
      allAnalysis.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">file, index</span>) =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`   <span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>. <span class="hljs-subst">${file.relativePath}</span> (<span class="hljs-subst">${file.language}</span>) - <span class="hljs-subst">${file.content.length}</span> chars`</span>));
      });
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;&#x27;</span>);
    });

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">green</span>(<span class="hljs-string">&#x27;✅ Code analysis completed!&#x27;</span>));

    <span class="hljs-comment">// Handle mode aliases</span>
    <span class="hljs-keyword">let</span> effectiveMode = finalConfig.<span class="hljs-property">mode</span>;
    <span class="hljs-keyword">if</span> (effectiveMode === <span class="hljs-string">&#x27;arch&#x27;</span>) {
      effectiveMode = <span class="hljs-string">&#x27;architecture&#x27;</span>;
    }

    <span class="hljs-comment">// Check if we should run in flowchart, architecture, or onboarding mode</span>
    <span class="hljs-keyword">let</span> explanations;
    <span class="hljs-keyword">if</span> (!finalConfig.<span class="hljs-property">apiKey</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">yellow</span>(<span class="hljs-string">&#x27;⚠️ No API key provided. Running in offline mode.&#x27;</span>));
      <span class="hljs-comment">// In offline mode, we just return the code analysis without AI explanations</span>
      <span class="hljs-keyword">if</span> (finalConfig.<span class="hljs-property">mode</span> === <span class="hljs-variable constant_">MODE_FLOWCHART</span> || effectiveMode === <span class="hljs-string">&#x27;architecture&#x27;</span> || finalConfig.<span class="hljs-property">mode</span> === <span class="hljs-variable constant_">MODE_ONBOARDING</span>) {
        <span class="hljs-comment">// For special modes, return appropriate message</span>
        explanations = [{
          <span class="hljs-attr">relativePath</span>: effectiveMode === <span class="hljs-string">&#x27;architecture&#x27;</span> ? <span class="hljs-string">&#x27;Project Architecture&#x27;</span> : 
                      finalConfig.<span class="hljs-property">mode</span> === <span class="hljs-variable constant_">MODE_ONBOARDING</span> ? <span class="hljs-string">&#x27;Developer Onboarding&#x27;</span> : <span class="hljs-string">&#x27;Project Flowchart&#x27;</span>,
          <span class="hljs-attr">path</span>: effectiveMode === <span class="hljs-string">&#x27;architecture&#x27;</span> ? <span class="hljs-string">&#x27;project-architecture&#x27;</span> : 
                finalConfig.<span class="hljs-property">mode</span> === <span class="hljs-variable constant_">MODE_ONBOARDING</span> ? <span class="hljs-string">&#x27;developer-onboarding&#x27;</span> : <span class="hljs-string">&#x27;project-flowchart&#x27;</span>,
          <span class="hljs-attr">language</span>: finalConfig.<span class="hljs-property">mode</span>,
          <span class="hljs-attr">explanation</span>: <span class="hljs-string">&#x27;Offline mode: AI analysis not available. Please provide an API key to get AI-powered architecture overview.&#x27;</span>
        }];
      } <span class="hljs-keyword">else</span> {
        explanations = allAnalysis.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item ? { ...item, <span class="hljs-attr">explanation</span>: <span class="hljs-string">&#x27;Offline mode: AI explanation not available. Please provide an API key to get AI-powered explanations.&#x27;</span> } : <span class="hljs-literal">null</span>);
      }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (finalConfig.<span class="hljs-property">mode</span> === <span class="hljs-variable constant_">MODE_FLOWCHART</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">yellow</span>(<span class="hljs-string">&#x27;📊 Generating flowchart visualization...&#x27;</span>));
      <span class="hljs-keyword">const</span> flowchartResult = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateFlowchart</span>(allAnalysis, finalConfig);
      explanations = [flowchartResult];
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">green</span>(<span class="hljs-string">&#x27;✅ Flowchart generation completed!&#x27;</span>));
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (effectiveMode === <span class="hljs-string">&#x27;architecture&#x27;</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">yellow</span>(<span class="hljs-string">&#x27;🔍 Creating file summaries for analysis:&#x27;</span>));
      <span class="hljs-keyword">const</span> aiEngine = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AIEngine</span>(finalConfig);
      <span class="hljs-keyword">let</span> fileCounter = <span class="hljs-number">0</span>;
      explanations = <span class="hljs-keyword">await</span> aiEngine.<span class="hljs-title function_">generateExplanations</span>(allAnalysis, <span class="hljs-function">(<span class="hljs-params">filePath, completed, total, progress, cached, isStarting</span>) =&gt;</span> {
        <span class="hljs-comment">// Convert to relative path from the scanned folder</span>
        <span class="hljs-keyword">let</span> displayPath = filePath;
        <span class="hljs-keyword">if</span> (pathArray.<span class="hljs-property">length</span> === <span class="hljs-number">1</span>) {
          <span class="hljs-keyword">const</span> relativePath = path.<span class="hljs-title function_">relative</span>(pathArray[<span class="hljs-number">0</span>], filePath);
          displayPath = relativePath || path.<span class="hljs-title function_">basename</span>(filePath); <span class="hljs-comment">// Use basename if relative is empty</span>
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// For multiple paths, show relative to the common base or just filename</span>
          displayPath = path.<span class="hljs-title function_">basename</span>(filePath);
        }

        <span class="hljs-comment">// Only show completion status to avoid duplicate entries</span>
        <span class="hljs-keyword">if</span> (!isStarting) {
          fileCounter++;
          <span class="hljs-keyword">const</span> cacheIndicator = cached ? chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">&#x27;[CACHE] &#x27;</span>) : <span class="hljs-string">&#x27;&#x27;</span>;
          <span class="hljs-keyword">const</span> formattedProgress = progress.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;0&#x27;</span>);
          <span class="hljs-keyword">const</span> progressText = chalk.<span class="hljs-title function_">cyan</span>(<span class="hljs-string">`[<span class="hljs-subst">${formattedProgress}</span>%] <span class="hljs-subst">${cacheIndicator}</span>`</span>);
          <span class="hljs-keyword">const</span> paddedCounter = fileCounter.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;0&#x27;</span>);
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${paddedCounter}</span> - <span class="hljs-subst">${progressText}</span><span class="hljs-subst">${displayPath}</span>`</span>);
        }
      });
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">yellow</span>(<span class="hljs-string">&#x27;🏗️ Generating architecture overview...&#x27;</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">green</span>(<span class="hljs-string">&#x27;✅ Architecture overview generation completed!&#x27;</span>));
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (finalConfig.<span class="hljs-property">mode</span> === <span class="hljs-variable constant_">MODE_ONBOARDING</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">yellow</span>(<span class="hljs-string">&#x27;🔍 Creating file summaries for analysis:&#x27;</span>));
      <span class="hljs-keyword">const</span> aiEngine = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AIEngine</span>(finalConfig);
      <span class="hljs-keyword">let</span> fileCounter = <span class="hljs-number">0</span>;
      explanations = <span class="hljs-keyword">await</span> aiEngine.<span class="hljs-title function_">generateExplanations</span>(allAnalysis, <span class="hljs-function">(<span class="hljs-params">filePath, completed, total, progress, cached, isStarting</span>) =&gt;</span> {
        <span class="hljs-comment">// Convert to relative path from the scanned folder</span>
        <span class="hljs-keyword">let</span> displayPath = filePath;
        <span class="hljs-keyword">if</span> (pathArray.<span class="hljs-property">length</span> === <span class="hljs-number">1</span>) {
          <span class="hljs-keyword">const</span> relativePath = path.<span class="hljs-title function_">relative</span>(pathArray[<span class="hljs-number">0</span>], filePath);
          displayPath = relativePath || path.<span class="hljs-title function_">basename</span>(filePath); <span class="hljs-comment">// Use basename if relative is empty</span>
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// For multiple paths, show relative to the common base or just filename</span>
          displayPath = path.<span class="hljs-title function_">basename</span>(filePath);
        }

        <span class="hljs-comment">// Only show completion status to avoid duplicate entries</span>
        <span class="hljs-keyword">if</span> (!isStarting) {
          fileCounter++;
          <span class="hljs-keyword">const</span> cacheIndicator = cached ? chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">&#x27;[CACHE] &#x27;</span>) : <span class="hljs-string">&#x27;&#x27;</span>;
          <span class="hljs-keyword">const</span> formattedProgress = progress.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;0&#x27;</span>);
          <span class="hljs-keyword">const</span> progressText = chalk.<span class="hljs-title function_">cyan</span>(<span class="hljs-string">`[<span class="hljs-subst">${formattedProgress}</span>%] <span class="hljs-subst">${cacheIndicator}</span>`</span>);
          <span class="hljs-keyword">const</span> paddedCounter = fileCounter.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;0&#x27;</span>);
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${paddedCounter}</span> - <span class="hljs-subst">${progressText}</span><span class="hljs-subst">${displayPath}</span>`</span>);
        }
      });
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">yellow</span>(<span class="hljs-string">&#x27;👨‍💻 Generating onboarding guide...&#x27;</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">green</span>(<span class="hljs-string">&#x27;✅ Onboarding guide generation completed!&#x27;</span>));
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// Generate AI explanations with progress tracking for normal modes</span>
      <span class="hljs-keyword">const</span> aiEngine = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AIEngine</span>(finalConfig);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">yellow</span>(<span class="hljs-string">&#x27;🤖 Generating AI explanations...&#x27;</span>));

       <span class="hljs-comment">// Verbose: Show AI engine details</span>
       logger.<span class="hljs-title function_">logVerbose</span>(<span class="hljs-function">() =&gt;</span> {
         <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`   AI Provider: <span class="hljs-subst">${finalConfig.provider}</span>`</span>));
         <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`   Model: <span class="hljs-subst">${finalConfig.model}</span>`</span>));
         <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`   Max Tokens: <span class="hljs-subst">${finalConfig.maxTokens}</span>`</span>));
         <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`   Retry Attempts: <span class="hljs-subst">${finalConfig.retry?.attempts || <span class="hljs-number">3</span>}</span>`</span>));
         <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;&#x27;</span>);
       });

       <span class="hljs-keyword">let</span> fileCounter = <span class="hljs-number">0</span>;
      explanations = <span class="hljs-keyword">await</span> aiEngine.<span class="hljs-title function_">generateExplanations</span>(allAnalysis, <span class="hljs-function">(<span class="hljs-params">filePath, completed, total, progress, cached, isStarting</span>) =&gt;</span> {
        <span class="hljs-comment">// Convert to relative path from the scanned folder</span>
        <span class="hljs-keyword">let</span> displayPath = filePath;
        <span class="hljs-keyword">if</span> (pathArray.<span class="hljs-property">length</span> === <span class="hljs-number">1</span>) {
          <span class="hljs-keyword">const</span> relativePath = path.<span class="hljs-title function_">relative</span>(pathArray[<span class="hljs-number">0</span>], filePath);
          displayPath = relativePath || path.<span class="hljs-title function_">basename</span>(filePath); <span class="hljs-comment">// Use basename if relative is empty</span>
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// For multiple paths, show relative to the common base or just filename</span>
          displayPath = path.<span class="hljs-title function_">basename</span>(filePath);
        }

        <span class="hljs-comment">// Only show completion status to avoid duplicate entries</span>
        <span class="hljs-keyword">if</span> (!isStarting) {
          fileCounter++;
          <span class="hljs-keyword">const</span> cacheIndicator = cached ? chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">&#x27;[CACHE] &#x27;</span>) : <span class="hljs-string">&#x27;&#x27;</span>;
          <span class="hljs-keyword">const</span> formattedProgress = progress.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;0&#x27;</span>);
          <span class="hljs-keyword">const</span> progressText = chalk.<span class="hljs-title function_">cyan</span>(<span class="hljs-string">`[<span class="hljs-subst">${formattedProgress}</span>%] <span class="hljs-subst">${cacheIndicator}</span>`</span>);
          <span class="hljs-keyword">const</span> paddedCounter = fileCounter.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;0&#x27;</span>);
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${paddedCounter}</span> - <span class="hljs-subst">${progressText}</span><span class="hljs-subst">${displayPath}</span>`</span>);
        }
      });

      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">green</span>(<span class="hljs-string">&#x27;✅ AI explanations completed!&#x27;</span>));

      <span class="hljs-comment">// Show usage summary</span>
      <span class="hljs-keyword">const</span> usageSummary = aiEngine.<span class="hljs-title function_">getUsageSummary</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;&#x27;</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-property">blue</span>.<span class="hljs-title function_">bold</span>(<span class="hljs-string">&#x27;📊 Usage Summary:&#x27;</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">white</span>(<span class="hljs-string">`   Files processed: <span class="hljs-subst">${usageSummary.processedFiles}</span>`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">white</span>(<span class="hljs-string">`   Files from cache: <span class="hljs-subst">${usageSummary.cachedFiles}</span>`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">cyan</span>(<span class="hljs-string">`   Input tokens: <span class="hljs-subst">${usageSummary.totalInputTokens.toLocaleString()}</span>`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">cyan</span>(<span class="hljs-string">`   Output tokens: <span class="hljs-subst">${usageSummary.totalOutputTokens.toLocaleString()}</span>`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">yellow</span>(<span class="hljs-string">`   Total tokens: <span class="hljs-subst">${usageSummary.totalTokens.toLocaleString()}</span>`</span>));
    }

    <span class="hljs-comment">// Generate output</span>
    <span class="hljs-keyword">const</span> title = <span class="hljs-string">`Code Explanation: <span class="hljs-subst">${pathArray.join(<span class="hljs-string">&#x27;, &#x27;</span>)}</span>`</span>;

    <span class="hljs-comment">// Verbose: Show output generation details</span>
    logger.<span class="hljs-title function_">logVerbose</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">&#x27;📤 Generating output:&#x27;</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`   Format: <span class="hljs-subst">${finalConfig.output.toUpperCase()}</span>`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`   Title: <span class="hljs-subst">${title}</span>`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`   Files processed: <span class="hljs-subst">${explanations.length}</span>`</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;&#x27;</span>);
    });

    <span class="hljs-keyword">if</span> (finalConfig.<span class="hljs-property">output</span> === <span class="hljs-variable constant_">OUTPUT_PDF</span>) {
      <span class="hljs-keyword">const</span> pdfOutput = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PDFOutput</span>(finalConfig);
      <span class="hljs-keyword">await</span> pdfOutput.<span class="hljs-title function_">generate</span>(explanations, <span class="hljs-string">&#x27;codeexplain-output.pdf&#x27;</span>, title);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">green</span>(<span class="hljs-string">&#x27;📄 PDF documentation generated successfully!&#x27;</span>));

      logger.<span class="hljs-title function_">logVerbose</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">&#x27;   Output file: codeexplain-output.pdf&#x27;</span>)));
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">const</span> htmlOutput = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HTMLOutput</span>(finalConfig);
      <span class="hljs-keyword">await</span> htmlOutput.<span class="hljs-title function_">generate</span>(explanations, <span class="hljs-string">&#x27;codeexplain-output.html&#x27;</span>, title);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">green</span>(<span class="hljs-string">&#x27;🌐 HTML documentation generated successfully!&#x27;</span>));

      logger.<span class="hljs-title function_">logVerbose</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">&#x27;   Output file: codeexplain-output.html&#x27;</span>)));
    }
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">const</span> errorLine = error.<span class="hljs-property">stack</span> &amp;&amp; error.<span class="hljs-property">stack</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;\n&#x27;</span>)[<span class="hljs-number">1</span>]
      ? error.<span class="hljs-property">stack</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;\n&#x27;</span>)[<span class="hljs-number">1</span>].<span class="hljs-title function_">trim</span>()
      : <span class="hljs-string">&#x27;&#x27;</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(
      chalk.<span class="hljs-title function_">red</span>(<span class="hljs-string">&#x27;❌ Error running CodeExplain:&#x27;</span>),
      error.<span class="hljs-property">message</span>,
      chalk.<span class="hljs-title function_">gray</span>(<span class="hljs-string">`(<span class="hljs-subst">${__filename}</span><span class="hljs-subst">${errorLine ? <span class="hljs-string">&#x27; &#x27;</span> + errorLine : <span class="hljs-string">&#x27;&#x27;</span>}</span>)`</span>)
    )
    process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
  }
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { explain };</div>
                 </div>

             <div class="p-4">
                 <div class="d-flex justify-content-between align-items-center mb-3">
                     <h3 class="h6 text-muted mb-0 d-flex align-items-center">
                         <i class="fas fa-brain me-2 text-primary"></i>
                         AI Explanation
                     </h3>
                     <button class="btn btn-outline-primary btn-sm copy-explanation" data-file-index="2" title="Copy explanation">
                         <i class="fas fa-copy me-1"></i> Copy
                     </button>
                 </div>
                 <div class="explanation-content">
                     <p>Sure! Let&#39;s break down the JavaScript code within <code>explain.js</code> step by step:</p>
<h1>Code Overview</h1>
<p>The purpose of this script is to explain the code files provided as input paths, generating explanations and potential visualizations (like flowcharts) by analyzing the input files. It uses various modes and can generate outputs in HTML or PDF.</p>
<hr>
<h2>Key Components:</h2>
<h3>Module Imports</h3>
<ul>
<li><strong><code>path</code>, <code>fs</code>, <code>chalk</code>:</strong> <ul>
<li><code>path</code> and <code>fs</code> are core Node.js modules for file system operations.</li>
<li><code>chalk</code> is used to style the terminal text output.</li>
</ul>
</li>
<li><strong>Custom Modules:</strong><ul>
<li><strong><code>ConfigManager</code></strong>: Manages application configuration.</li>
<li><strong><code>CodeAnalyzer</code></strong>: Performs the actual analysis on the code files.</li>
<li><strong><code>AIEngine</code></strong>: Uses AI to generate explanations of code.</li>
<li><strong><code>HTMLOutput</code>, <code>PDFOutput</code></strong>: Generate output in HTML or PDF form.</li>
<li><strong><code>PromptManager</code></strong>: Ensures the necessary prompting setup.</li>
<li><strong><code>FlowchartGenerator</code></strong>: Generates flowchart visuals.</li>
<li><strong><code>Logger</code></strong>: Logs messages, with verbosity options.</li>
</ul>
</li>
<li><strong>Constants:</strong> Various mode and output constants imported from <code>constants</code>.</li>
</ul>
<h3><code>generateFlowchart</code></h3>
<p>A simple function that delegates the flowchart generation to <code>FlowchartGenerator</code>.</p>
<pre><code class="language-javascript">async function generateFlowchart(analysis, config) {
  return FlowchartGenerator.generate(analysis, config);
}
</code></pre>
<h3><code>explain</code> Function</h3>
<p>The core function that performs the following:</p>
<ol>
<li><p><strong>Visual Startup Notice:</strong></p>
<ul>
<li>Uses <code>chalk</code> to print a styled banner and a startup message.</li>
</ul>
</li>
<li><p><strong>Input Path Handling:</strong></p>
<ul>
<li>Ensures <code>paths</code> is always an array for ease of processing.</li>
</ul>
</li>
<li><p><strong>Configuration Management:</strong></p>
<ul>
<li>Initializes <code>ConfigManager</code> to load configuration settings.</li>
<li>Overrides config values with any CLI options, ensuring precedence:<ul>
<li>CLI options &gt; Config file settings &gt; Environment variables.</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Logger Initialization:</strong></p>
<ul>
<li>Sets up logging, respecting verbosity settings from the configuration.</li>
</ul>
</li>
<li><p><strong>Mode Validation:</strong></p>
<ul>
<li>Specifically checks for line-by-line mode’s constraint of single-file-only.</li>
</ul>
</li>
<li><p><strong>Verbose Configuration Output:</strong></p>
<ul>
<li>Logs the finalized configuration details if verbosity is enabled.</li>
</ul>
</li>
<li><p><strong>Prompt and Analyzing Setup:</strong></p>
<ul>
<li>Ensures prompt directories are ready.</li>
<li>Creates a <code>CodeAnalyzer</code> instance to analyze code files.</li>
</ul>
</li>
<li><p><strong>File Analysis:</strong></p>
<ul>
<li>Processes each specified path, collecting analysis results.</li>
</ul>
</li>
<li><p><strong>Mode-Based Processing:</strong></p>
<ul>
<li>Handles different operational modes such as flowchart, architecture, onboarding, or offline.</li>
<li>Uses AI or generates visual aids where necessary.</li>
<li>Logs processing details as necessary for each mode.</li>
</ul>
</li>
<li><p><strong>Output Generation:</strong></p>
<ul>
<li>Chooses between PDF and HTML output formats.</li>
<li>Generates the final output using <code>PDFOutput</code> or <code>HTMLOutput</code>.</li>
</ul>
</li>
<li><p><strong>Error Handling:</strong></p>
<ul>
<li>Catches any errors, logs them in a styled way, and exits the process with an error code.</li>
</ul>
</li>
</ol>
<h3><code>module.exports</code></h3>
<p>Exports the <code>explain</code> function for use in other parts of the application.</p>
<pre><code class="language-javascript">module.exports = { explain };
</code></pre>
<hr>
<h2>Conclusion</h2>
<p>The script serves as an automated tool for code analysis using AI, with customizable configurations and multiple output formats. It comprehensively handles input verification, processing in different modes, and final output generation robustly with error handling and logging.</p>

                 </div>
             </div>
         </div>
     </div>
 </div>

 <div class="file-entry col-12 mb-4" id="file-3" data-file-path="D:\MyDev\CodeExplain\src\core\cacheManager.js" data-file-index="3">
     <div class="card shadow-sm border-0 h-100" style="border-radius: 12px; overflow: hidden;">
         <div class="card-header bg-gradient-primary text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1rem 1.5rem;">
             <div class="d-flex justify-content-between align-items-center">
                  <h2 class="toggle-code h5 fw-semibold mb-0 cursor-pointer d-flex align-items-center text-white" data-file-index="3" style="font-size: 1.1rem;">
                      <i class="fas fa-chevron-right me-2 transition-transform duration-200"></i>
                      <i class="fas fa-file-code me-2"></i>
                      core/cacheManager.js
                  </h2>
                 <span class="badge bg-white bg-opacity-25 text-white px-2 py-1" style="font-size: 0.75rem;">
                     javascript
                 </span>
             </div>
         </div>

               <div class="card-body p-0">
                 <div class="code-container bg-light border-bottom d-none" style="max-height: 400px; overflow: auto;" data-file-path="D:\MyDev\CodeExplain\src\core\cacheManager.js" data-file-language="javascript">
                     <div class="p-3 text-center text-muted">
                         <div class="spinner-border spinner-border-sm me-2" role="status" style="display: none;"></div>
                         <span class="loading-text">Click to load code</span>
                     </div>
                     <div class="code-content" style="display: none;"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs-extra&#x27;</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);
<span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;crypto&#x27;</span>);

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheManager</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cacheDir</span> = path.<span class="hljs-title function_">join</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">&#x27;.codeexplain&#x27;</span>, <span class="hljs-string">&#x27;cache&#x27;</span>);
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">initialize</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">ensureDir</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cacheDir</span>);
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getCacheKey</span>(<span class="hljs-params">filePath, config</span>) {
    <span class="hljs-comment">// Create a cache key based on file path, config, mode, and model</span>
    <span class="hljs-keyword">const</span> keyString = <span class="hljs-string">`<span class="hljs-subst">${filePath}</span>-<span class="hljs-subst">${config.mode}</span>-<span class="hljs-subst">${config.level}</span>-<span class="hljs-subst">${config.provider}</span>-<span class="hljs-subst">${config.model}</span>`</span>
    <span class="hljs-keyword">return</span> crypto.<span class="hljs-title function_">createHash</span>(<span class="hljs-string">&#x27;md5&#x27;</span>).<span class="hljs-title function_">update</span>(keyString).<span class="hljs-title function_">digest</span>(<span class="hljs-string">&#x27;hex&#x27;</span>)
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getCachedExplanation</span>(<span class="hljs-params">filePath, config</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> cacheKey = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCacheKey</span>(filePath, config);
      <span class="hljs-keyword">const</span> cacheFile = path.<span class="hljs-title function_">join</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cacheDir</span>, <span class="hljs-string">`<span class="hljs-subst">${cacheKey}</span>.json`</span>);

      <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">pathExists</span>(cacheFile))) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
      }

      <span class="hljs-keyword">const</span> cacheData = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readJson</span>(cacheFile);

      <span class="hljs-keyword">const</span> stats = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">stat</span>(filePath);
      <span class="hljs-keyword">const</span> currentMtime = stats.<span class="hljs-property">mtime</span>.<span class="hljs-title function_">getTime</span>();
      <span class="hljs-keyword">const</span> currentSize = stats.<span class="hljs-property">size</span>;

      <span class="hljs-comment">// Fast path: check mtime and size first (no file content read needed)</span>
      <span class="hljs-keyword">if</span> (cacheData.<span class="hljs-property">mtime</span> === currentMtime &amp;&amp; cacheData.<span class="hljs-property">fileSize</span> === currentSize) {
        <span class="hljs-keyword">return</span> cacheData.<span class="hljs-property">explanation</span>;
      }

      <span class="hljs-comment">// Medium path: if mtime changed but size is same, check hash</span>
      <span class="hljs-keyword">if</span> (cacheData.<span class="hljs-property">fileSize</span> === currentSize) {
        <span class="hljs-keyword">const</span> fileContent = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(filePath, <span class="hljs-string">&#x27;utf8&#x27;</span>);
        <span class="hljs-keyword">const</span> currentHash = crypto.<span class="hljs-title function_">createHash</span>(<span class="hljs-string">&#x27;sha256&#x27;</span>).<span class="hljs-title function_">update</span>(fileContent).<span class="hljs-title function_">digest</span>(<span class="hljs-string">&#x27;hex&#x27;</span>);

        <span class="hljs-keyword">if</span> (cacheData.<span class="hljs-property">fileHash</span> === currentHash) {
          <span class="hljs-comment">// Update mtime in cache</span>
          cacheData.<span class="hljs-property">mtime</span> = currentMtime;
          <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">writeJson</span>(cacheFile, cacheData);
          <span class="hljs-keyword">return</span> cacheData.<span class="hljs-property">explanation</span>;
        }
      }

      <span class="hljs-comment">// Slow path: file has changed, invalidate cache</span>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&#x27;Cache read error:&#x27;</span>, error.<span class="hljs-property">message</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">setCachedExplanation</span>(<span class="hljs-params">filePath, config, explanation</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> cacheKey = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCacheKey</span>(filePath, config);
      <span class="hljs-keyword">const</span> cacheFile = path.<span class="hljs-title function_">join</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cacheDir</span>, <span class="hljs-string">`<span class="hljs-subst">${cacheKey}</span>.json`</span>);

      <span class="hljs-keyword">const</span> stats = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">stat</span>(filePath);
      <span class="hljs-keyword">const</span> fileContent = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(filePath, <span class="hljs-string">&#x27;utf8&#x27;</span>);
      <span class="hljs-keyword">const</span> fileHash = crypto.<span class="hljs-title function_">createHash</span>(<span class="hljs-string">&#x27;sha256&#x27;</span>).<span class="hljs-title function_">update</span>(fileContent).<span class="hljs-title function_">digest</span>(<span class="hljs-string">&#x27;hex&#x27;</span>);

      <span class="hljs-comment">// Only store cache-relevant config, not sensitive data like API keys</span>
      <span class="hljs-keyword">const</span> cacheConfig = {
        <span class="hljs-attr">mode</span>: config.<span class="hljs-property">mode</span>,
        <span class="hljs-attr">level</span>: config.<span class="hljs-property">level</span>,
        <span class="hljs-attr">provider</span>: config.<span class="hljs-property">provider</span>,
        <span class="hljs-attr">model</span>: config.<span class="hljs-property">model</span>
      };

      <span class="hljs-keyword">const</span> cacheData = {
        fileHash,
        <span class="hljs-attr">fileSize</span>: stats.<span class="hljs-property">size</span>,
        <span class="hljs-attr">mtime</span>: stats.<span class="hljs-property">mtime</span>.<span class="hljs-title function_">getTime</span>(),
        explanation,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
        <span class="hljs-attr">config</span>: cacheConfig
      };

      <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">writeJson</span>(cacheFile, cacheData);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&#x27;Cache write error:&#x27;</span>, error.<span class="hljs-property">message</span>);
    }
  }
}


<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { <span class="hljs-title class_">CacheManager</span> };</div>
                 </div>

             <div class="p-4">
                 <div class="d-flex justify-content-between align-items-center mb-3">
                     <h3 class="h6 text-muted mb-0 d-flex align-items-center">
                         <i class="fas fa-brain me-2 text-primary"></i>
                         AI Explanation
                     </h3>
                     <button class="btn btn-outline-primary btn-sm copy-explanation" data-file-index="3" title="Copy explanation">
                         <i class="fas fa-copy me-1"></i> Copy
                     </button>
                 </div>
                 <div class="explanation-content">
                     <p>Certainly! Below is a detailed explanation of the provided JavaScript code for a beginner developer.</p>
<h1>Code Explanation: <code>cacheManager.js</code></h1>
<p>This JavaScript file implements a class called <code>CacheManager</code>. This class handles caching operations for file explanations, storing them as JSON files on disk. The file utilizes Node.js modules like <code>fs-extra</code>, <code>path</code>, and <code>crypto</code> to facilitate filesystem operations and hash generation.</p>
<h2>Key Components:</h2>
<h3>Imports</h3>
<ul>
<li><strong><code>fs-extra</code></strong>: An extension of Node.js&#39; native <code>fs</code> module with additional functionality, including promise-based methods.</li>
<li><strong><code>path</code></strong>: Provides utilities for handling file paths.</li>
<li><strong><code>crypto</code></strong>: Used for creating hash digests of data.</li>
</ul>
<h3><code>CacheManager</code> Class</h3>
<h4>Constructor</h4>
<ul>
<li><strong><code>this.cacheDir</code></strong>: Sets the directory path for cached files (<code>.codeexplain/cache</code> within the current working directory).</li>
</ul>
<h4>Methods</h4>
<ol>
<li><p><strong><code>initialize()</code></strong></p>
<ul>
<li>Ensures that the cache directory exists by creating it if it doesn&#39;t. Uses <code>fs.ensureDir()</code> provided by <code>fs-extra</code>.</li>
</ul>
</li>
<li><p><strong><code>getCacheKey(filePath, config)</code></strong></p>
<ul>
<li>Generates a unique cache key based on the file path and configuration object (<code>config</code>).</li>
<li>Concatenates properties of <code>config</code> with the <code>filePath</code>, hashing this string using MD5 to produce a cache key that will be used to uniquely identify cache files.</li>
</ul>
</li>
<li><p><strong><code>getCachedExplanation(filePath, config)</code></strong></p>
<ul>
<li>Retrieves the cached explanation for a given file and configuration.</li>
<li>Steps:<ul>
<li>Generates a <code>cacheKey</code> and determines the file path of the cached explanation (<code>cacheFile</code>).</li>
<li>Checks if the cache file exists. If not, returns <code>null</code>.</li>
<li>Reads the cache data from the JSON file.</li>
<li>Retrieves and compares the file&#39;s last modified time (<code>mtime</code>) and size:<ul>
<li><strong>Fast Path</strong>: If both match, it returns the cached explanation.</li>
<li><strong>Medium Path</strong>: If <code>mtime</code> differs but size matches, calculates the file&#39;s hash to verify content equality. If it matches, updates the cache&#39;s <code>mtime</code> and returns the explanation.</li>
<li><strong>Slow Path</strong>: If neither <code>mtime</code> nor size matches, the cache is invalid, and it returns <code>null</code>.</li>
</ul>
</li>
</ul>
</li>
<li>Handles any errors during the process by logging a warning and returning <code>null</code>.</li>
</ul>
</li>
<li><p><strong><code>setCachedExplanation(filePath, config, explanation)</code></strong></p>
<ul>
<li>Caches an explanation for a given file and configuration.</li>
<li>Steps:<ul>
<li>Generates a <code>cacheKey</code> and determines the <code>cacheFile</code> path.</li>
<li>Gathers the file&#39;s current <code>mtime</code> and size.</li>
<li>Reads the file content and computes a SHA-256 hash.</li>
<li>Constructs <code>cacheData</code>, including the explanation, file hash, file size, last modified time, timestamp, and non-sensitive configuration data.</li>
<li>Writes this <code>cacheData</code> to the cache file in JSON format.</li>
</ul>
</li>
<li>Handles errors during writing by logging a warning.</li>
</ul>
</li>
</ol>
<h3>Exports</h3>
<ul>
<li>The <code>CacheManager</code> class is exported using <code>module.exports</code>, making it available for import into other files.</li>
</ul>
<h2>Usage</h2>
<p>When using the <code>CacheManager</code>, you:</p>
<ol>
<li><strong>Instantiate</strong> the class.</li>
<li><strong>Initialize</strong> the cache system using <code>initialize()</code> before any other operations.</li>
<li>Use <code>getCachedExplanation()</code> and <code>setCachedExplanation()</code> to read from and write to the cache respectively.</li>
</ol>
<p>This caching mechanism is efficient because it avoids unnecessary computations and disk I/O by quickly verifying whether a cache entry is valid based primarily on file metadata and content hashes.</p>

                 </div>
             </div>
         </div>
     </div>
 </div>

 <div class="file-entry col-12 mb-4" id="file-4" data-file-path="D:\MyDev\CodeExplain\src\core\codeAnalyzer.js" data-file-index="4">
     <div class="card shadow-sm border-0 h-100" style="border-radius: 12px; overflow: hidden;">
         <div class="card-header bg-gradient-primary text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1rem 1.5rem;">
             <div class="d-flex justify-content-between align-items-center">
                  <h2 class="toggle-code h5 fw-semibold mb-0 cursor-pointer d-flex align-items-center text-white" data-file-index="4" style="font-size: 1.1rem;">
                      <i class="fas fa-chevron-right me-2 transition-transform duration-200"></i>
                      <i class="fas fa-file-code me-2"></i>
                      core/codeAnalyzer.js
                  </h2>
                 <span class="badge bg-white bg-opacity-25 text-white px-2 py-1" style="font-size: 0.75rem;">
                     javascript
                 </span>
             </div>
         </div>

               <div class="card-body p-0">
                 <div class="code-container bg-light border-bottom d-none" style="max-height: 400px; overflow: auto;" data-file-path="D:\MyDev\CodeExplain\src\core\codeAnalyzer.js" data-file-language="javascript">
                     <div class="p-3 text-center text-muted">
                         <div class="spinner-border spinner-border-sm me-2" role="status" style="display: none;"></div>
                         <span class="loading-text">Click to load code</span>
                     </div>
                     <div class="code-content" style="display: none;">
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs-extra&#x27;</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);
<span class="hljs-keyword">const</span> { globby } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;globby&#x27;</span>);
<span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;crypto&#x27;</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">MAX_FILE_SIZE_BYTES</span>, <span class="hljs-variable constant_">MAX_FILE_SIZE_MB</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../utils/constants&#x27;</span>);

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CodeAnalyzer</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-variable constant_">OUTPUT_FILE_PREFIX</span> = <span class="hljs-string">&#x27;codeexplain-output&#x27;</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">config</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, config);
    <span class="hljs-comment">// Ensure all codeExtensions are lowercase for consistent matching</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">codeExtensions</span> = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">codeExtensions</span> || []).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">ext</span> =&gt;</span> ext.<span class="hljs-title function_">toLowerCase</span>());
    <span class="hljs-comment">// Set max file size from config (convert MB to bytes)</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxFileSizeBytes</span> = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">maxFileSize</span> || <span class="hljs-variable constant_">MAX_FILE_SIZE_MB</span>) * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>;
    <span class="hljs-comment">// Pre-compile exclude patterns (wildcards to regex)</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">excludeRegexes</span> = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">exclude</span> || []).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">pattern</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (pattern.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;*&#x27;</span>)) {
        <span class="hljs-comment">// Escape all regex special characters EXCEPT &#x27;*&#x27;</span>
        <span class="hljs-keyword">const</span> escapedPattern = pattern.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[.+?^${}()|[\]\\]/g</span>, <span class="hljs-string">&#x27;\\$&amp;&#x27;</span>);
        <span class="hljs-comment">// Replace glob &#x27;*&#x27; with regex &#x27;.*&#x27;</span>
        <span class="hljs-keyword">const</span> safeRegexPattern = escapedPattern.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\*/g</span>, <span class="hljs-string">&#x27;.*&#x27;</span>);
        <span class="hljs-keyword">try</span> {
          <span class="hljs-comment">// Anchor the regex to match the entire string</span>
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">&#x27;^&#x27;</span> + safeRegexPattern + <span class="hljs-string">&#x27;$&#x27;</span>);
        } <span class="hljs-keyword">catch</span> (e) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`Invalid exclude regex pattern &#x27;<span class="hljs-subst">${pattern}</span>&#x27;: <span class="hljs-subst">${e.message}</span>`</span>);
          <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
      }
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }).<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Boolean</span>); <span class="hljs-comment">// Remove null entries</span>
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">countFiles</span>(<span class="hljs-params">targetPath</span>) {
    <span class="hljs-keyword">const</span> fullPath = path.<span class="hljs-title function_">resolve</span>(targetPath);
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">pathExists</span>(fullPath))) {
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
      }
      <span class="hljs-keyword">const</span> stats = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">stat</span>(fullPath);
      <span class="hljs-keyword">if</span> (stats.<span class="hljs-title function_">isFile</span>()) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">shouldIncludeFile</span>(fullPath, <span class="hljs-literal">true</span>) ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (stats.<span class="hljs-title function_">isDirectory</span>()) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">countFilesInDirectory</span>(fullPath);
      }
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Error in countFiles:&#x27;</span>, err.<span class="hljs-property">message</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
  }


  <span class="hljs-comment">// Helper to build include/exclude patterns</span>
  <span class="hljs-title function_">buildGlobPatterns</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">const</span> includePatterns = <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">codeExtensions</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">ext</span> =&gt;</span> <span class="hljs-string">`**/*<span class="hljs-subst">${ext}</span>`</span>);
    <span class="hljs-keyword">const</span> excludePatterns = [<span class="hljs-string">&#x27;.codeexplain&#x27;</span>, ...(<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">exclude</span> || [])].<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">ex</span> =&gt;</span> <span class="hljs-string">`!<span class="hljs-subst">${ex}</span>`</span>);
    <span class="hljs-keyword">return</span> [...includePatterns, ...excludePatterns];
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">countFilesInDirectory</span>(<span class="hljs-params">dirPath</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> patterns = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">buildGlobPatterns</span>();
      <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">globby</span>(patterns, {
        <span class="hljs-attr">cwd</span>: dirPath,
        <span class="hljs-attr">onlyFiles</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">gitignore</span>: <span class="hljs-literal">true</span>
      });
      <span class="hljs-keyword">return</span> files.<span class="hljs-property">length</span>;
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Error in countFilesInDirectory:&#x27;</span>, err.<span class="hljs-property">message</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">analyze</span>(<span class="hljs-params">targetPath</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">analyzeWithProgress</span>(targetPath, <span class="hljs-literal">null</span>);
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">analyzeWithProgress</span>(<span class="hljs-params">targetPath, progressCallback = <span class="hljs-literal">null</span></span>) {
    <span class="hljs-keyword">const</span> fullPath = path.<span class="hljs-title function_">resolve</span>(targetPath);
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">pathExists</span>(fullPath))) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Path does not exist: &#x27;</span> + fullPath);
      }
      <span class="hljs-keyword">const</span> stats = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">stat</span>(fullPath);
      <span class="hljs-keyword">if</span> (stats.<span class="hljs-title function_">isFile</span>()) {
        <span class="hljs-keyword">if</span> (progressCallback) {
          <span class="hljs-title function_">progressCallback</span>(fullPath, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">analyzeFile</span>(fullPath, <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>, stats);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (stats.<span class="hljs-title function_">isDirectory</span>()) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">analyzeDirectoryWithProgress</span>(fullPath, progressCallback);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Unsupported file type: &#x27;</span> + fullPath);
      }
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Error in analyzeWithProgress:&#x27;</span>, err.<span class="hljs-property">message</span>);
      <span class="hljs-keyword">throw</span> err;
    }
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">analyzeFile</span>(<span class="hljs-params">filePath, basePath = <span class="hljs-literal">null</span>, forceInclude = <span class="hljs-literal">false</span>, stats = <span class="hljs-literal">null</span></span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">shouldIncludeFile</span>(filePath, forceInclude)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> fileStats = stats || <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">stat</span>(filePath);

      <span class="hljs-comment">// Check file size limit</span>
      <span class="hljs-keyword">if</span> (fileStats.<span class="hljs-property">size</span> &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxFileSizeBytes</span>) {
        <span class="hljs-keyword">const</span> maxSizeMB = <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxFileSizeBytes</span> / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`⚠️ Skipping large file: <span class="hljs-subst">${filePath}</span> (<span class="hljs-subst">${(fileStats.size / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>).toFixed(<span class="hljs-number">1</span>)}</span>MB &gt; <span class="hljs-subst">${maxSizeMB}</span>MB limit)`</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
      }

      <span class="hljs-comment">// For very large files, read in chunks to avoid memory issues</span>
      <span class="hljs-keyword">let</span> content;
      <span class="hljs-keyword">if</span> (fileStats.<span class="hljs-property">size</span> &gt; <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>) { <span class="hljs-comment">// 1MB threshold for chunked reading</span>
        content = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">readFileInChunks</span>(filePath, fileStats.<span class="hljs-property">size</span>);
      } <span class="hljs-keyword">else</span> {
        content = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(filePath, <span class="hljs-string">&#x27;utf8&#x27;</span>);
      }

      <span class="hljs-keyword">const</span> hash = crypto.<span class="hljs-title function_">createHash</span>(<span class="hljs-string">&#x27;sha256&#x27;</span>).<span class="hljs-title function_">update</span>(content).<span class="hljs-title function_">digest</span>(<span class="hljs-string">&#x27;hex&#x27;</span>);
      <span class="hljs-keyword">const</span> ext = path.<span class="hljs-title function_">extname</span>(filePath).<span class="hljs-title function_">toLowerCase</span>();
      <span class="hljs-keyword">let</span> relativePath = path.<span class="hljs-title function_">basename</span>(filePath);
      <span class="hljs-keyword">if</span> (basePath) {
        relativePath = path.<span class="hljs-title function_">relative</span>(basePath, filePath).<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\\/g</span>, <span class="hljs-string">&#x27;/&#x27;</span>);
      }

      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">path</span>: filePath,
        relativePath,
        content,
        hash,
        <span class="hljs-attr">language</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">detectLanguage</span>(ext),
        <span class="hljs-attr">stats</span>: fileStats
      };
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Error in analyzeFile:&#x27;</span>, err.<span class="hljs-property">message</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
  }

  <span class="hljs-comment">// Read large files in chunks to prevent memory exhaustion</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">readFileInChunks</span>(<span class="hljs-params">filePath, fileSize</span>) {
    <span class="hljs-keyword">const</span> chunkSize = <span class="hljs-number">64</span> * <span class="hljs-number">1024</span>; <span class="hljs-comment">// 64KB chunks</span>
    <span class="hljs-keyword">const</span> chunks = [];
    <span class="hljs-keyword">const</span> stream = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>).<span class="hljs-title function_">createReadStream</span>(filePath, {
      <span class="hljs-attr">encoding</span>: <span class="hljs-string">&#x27;utf8&#x27;</span>,
      <span class="hljs-attr">highWaterMark</span>: chunkSize
    });

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      stream.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">chunk</span>) =&gt;</span> {
        chunks.<span class="hljs-title function_">push</span>(chunk);
      });

      stream.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;end&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">resolve</span>(chunks.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;&#x27;</span>));
      });

      stream.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
        <span class="hljs-title function_">reject</span>(err);
      });
    });
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">analyzeDirectory</span>(<span class="hljs-params">dirPath</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">analyzeDirectoryWithProgress</span>(dirPath, <span class="hljs-literal">null</span>);
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">analyzeDirectoryWithProgress</span>(<span class="hljs-params">dirPath, progressCallback = <span class="hljs-literal">null</span></span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> patterns = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">buildGlobPatterns</span>();
      <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">globby</span>(patterns, {
        <span class="hljs-attr">cwd</span>: dirPath,
        <span class="hljs-attr">onlyFiles</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">gitignore</span>: <span class="hljs-literal">true</span>
      });
      <span class="hljs-keyword">const</span> results = [];
      <span class="hljs-keyword">let</span> processedCount = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> files) {
        <span class="hljs-keyword">const</span> fullPath = path.<span class="hljs-title function_">join</span>(dirPath, file);
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">if</span> (progressCallback) {
            <span class="hljs-title function_">progressCallback</span>(fullPath, ++processedCount, files.<span class="hljs-property">length</span>);
          }
          <span class="hljs-keyword">const</span> analysis = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">analyzeFile</span>(fullPath, dirPath, <span class="hljs-literal">false</span>);
          <span class="hljs-keyword">if</span> (analysis) {
            results.<span class="hljs-title function_">push</span>(analysis);
          }
        } <span class="hljs-keyword">catch</span> (error) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&#x27;Could not analyze file &#x27;</span> + fullPath + <span class="hljs-string">&#x27;: &#x27;</span> + error.<span class="hljs-property">message</span>);
        }
      }
      <span class="hljs-keyword">return</span> results;
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Error in analyzeDirectoryWithProgress:&#x27;</span>, err.<span class="hljs-property">message</span>);
      <span class="hljs-keyword">return</span> [];
    }
  }

  <span class="hljs-title function_">shouldIncludeFile</span>(<span class="hljs-params">filePath, forceInclude = <span class="hljs-literal">false</span></span>) {
    <span class="hljs-keyword">const</span> filename = path.<span class="hljs-title function_">basename</span>(filePath);
    <span class="hljs-comment">// Never include our own output files</span>
    <span class="hljs-keyword">if</span> (filename.<span class="hljs-title function_">startsWith</span>(<span class="hljs-title class_">CodeAnalyzer</span>.<span class="hljs-property">OUTPUT_FILE_PREFIX</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">if</span> (forceInclude) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-comment">// Check if file extension is in our include list (case-insensitive)</span>
    <span class="hljs-keyword">const</span> ext = path.<span class="hljs-title function_">extname</span>(filePath).<span class="hljs-title function_">toLowerCase</span>();
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">codeExtensions</span>.<span class="hljs-title function_">includes</span>(ext)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-comment">// Check against exclude patterns (exact match or wildcard regex)</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">exclude</span> || []).<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">const</span> pattern = <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">exclude</span>[i];
      <span class="hljs-keyword">if</span> (pattern.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;*&#x27;</span>)) {
        <span class="hljs-keyword">const</span> regex = <span class="hljs-variable language_">this</span>.<span class="hljs-property">excludeRegexes</span>[i];
        <span class="hljs-keyword">if</span> (regex &amp;&amp; regex.<span class="hljs-title function_">test</span>(filename)) {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// Check if pattern matches filename or if path contains the pattern (for directories)</span>
        <span class="hljs-keyword">if</span> (pattern === filename || filePath.<span class="hljs-title function_">includes</span>(pattern)) {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
      }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }

  <span class="hljs-title function_">detectLanguage</span>(<span class="hljs-params">extension</span>) {
    <span class="hljs-keyword">const</span> languageMap = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../utils/languageMap&#x27;</span>);
    <span class="hljs-keyword">return</span> languageMap[extension] || <span class="hljs-string">&#x27;plaintext&#x27;</span>;
  }
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { <span class="hljs-title class_">CodeAnalyzer</span> };</div>
                 </div>

             <div class="p-4">
                 <div class="d-flex justify-content-between align-items-center mb-3">
                     <h3 class="h6 text-muted mb-0 d-flex align-items-center">
                         <i class="fas fa-brain me-2 text-primary"></i>
                         AI Explanation
                     </h3>
                     <button class="btn btn-outline-primary btn-sm copy-explanation" data-file-index="4" title="Copy explanation">
                         <i class="fas fa-copy me-1"></i> Copy
                     </button>
                 </div>
                 <div class="explanation-content">
                     <p>Here&#39;s a detailed explanation of the <code>codeAnalyzer.js</code> JavaScript file, structured in markdown format, to help you understand what the code does:</p>
<h1>Code Explanation: <code>codeAnalyzer.js</code></h1>
<p>This file defines a <code>CodeAnalyzer</code> class used to analyze code files and directories. The primary functionalities include counting files and analyzing content based on specified configurations. Below is a step-by-step explanation:</p>
<h2>Imports</h2>
<pre><code class="language-javascript">const fs = require(&#39;fs-extra&#39;);
const path = require(&#39;path&#39;);
const { globby } = require(&#39;globby&#39;);
const crypto = require(&#39;crypto&#39;);
const { MAX_FILE_SIZE_BYTES, MAX_FILE_SIZE_MB } = require(&#39;../utils/constants&#39;);
</code></pre>
<ul>
<li><strong><code>fs-extra</code></strong>: An extension of Node&#39;s <code>fs</code> module with additional methods for file system operations.</li>
<li><strong><code>path</code></strong>: A module for handling and transforming file paths.</li>
<li><strong><code>globby</code></strong>: Used for matching file paths using glob patterns.</li>
<li><strong><code>crypto</code></strong>: Provides cryptographic functionalities, used here for hashing content.</li>
<li><strong><code>MAX_FILE_SIZE_BYTES</code>, <code>MAX_FILE_SIZE_MB</code></strong>: Constants imported from another module, used to handle file size limits.</li>
</ul>
<h2>Class <code>CodeAnalyzer</code></h2>
<h3>Static Property</h3>
<pre><code class="language-javascript">static OUTPUT_FILE_PREFIX = &#39;codeexplain-output&#39;;
</code></pre>
<ul>
<li>Acts as a constant to identify files generated by <code>CodeAnalyzer</code>, preventing reprocessing.</li>
</ul>
<h3>Constructor</h3>
<pre><code class="language-javascript">constructor(config) {
    this.config = Object.assign({}, config);
    // Ensure all codeExtensions are lowercase for consistent matching
    this.config.codeExtensions = (this.config.codeExtensions || []).map(ext =&gt; ext.toLowerCase());
    // Set max file size from config (convert MB to bytes)
    this.maxFileSizeBytes = (this.config.maxFileSize || MAX_FILE_SIZE_MB) * 1024 * 1024;
    // Pre-compile exclude patterns (wildcards to regex)
    this.excludeRegexes = (this.config.exclude || []).map(pattern =&gt; {
      if (pattern.includes(&#39;*&#39;)) {
        // Escape all regex special characters EXCEPT &#39;*&#39;
        const escapedPattern = pattern.replace(/[.+?^${}()|[\]\\]/g, &#39;\\$&amp;&#39;);
        // Replace glob &#39;*&#39; with regex &#39;.*&#39;
        const safeRegexPattern = escapedPattern.replace(/\*/g, &#39;.*&#39;);
        try {
          // Anchor the regex to match the entire string
          return new RegExp(&#39;^&#39; + safeRegexPattern + &#39;$&#39;);
        } catch (e) {
          console.warn(`Invalid exclude regex pattern &#39;${pattern}&#39;: ${e.message}`);
          return null;
        }
      }
      return null;
    }).filter(Boolean); // Remove null entries
}
</code></pre>
<ul>
<li>Initializes configuration.</li>
<li>Converts file extensions to lowercase to ensure case-insensitive matching.</li>
<li>Sets a maximum file size threshold from the configuration or uses a default.</li>
<li>Pre-compiles exclusion patterns into regular expressions to filter out files during processing.</li>
</ul>
<h3>Methods</h3>
<h4><code>countFiles(targetPath)</code></h4>
<p>Counts the files in a given path, considering both files and directories.</p>
<h4><code>buildGlobPatterns()</code></h4>
<pre><code class="language-javascript">buildGlobPatterns() {
    const includePatterns = this.config.codeExtensions.map(ext =&gt; `**/*${ext}`);
    const excludePatterns = [&#39;.codeexplain&#39;, ...(this.config.exclude || [])].map(ex =&gt; `!${ex}`);
    return [...includePatterns, ...excludePatterns];
}
</code></pre>
<ul>
<li>Constructs glob patterns for file inclusion/exclusion, based on extensions and exclusion rules.</li>
</ul>
<h4><code>countFilesInDirectory(dirPath)</code></h4>
<p>Counts files in a directory based on glob patterns.</p>
<h4><code>analyze(targetPath)</code></h4>
<p>Analyzes a target path, ensuring progress can be reported through a callback.</p>
<h4><code>analyzeWithProgress(targetPath, progressCallback)</code></h4>
<p>Performs analysis with progress tracking. It handles both files and directories.</p>
<h4><code>analyzeFile(filePath, basePath, forceInclude, stats)</code></h4>
<p>Analyzes a file, applying filtering based on size and inclusion rules.</p>
<ul>
<li><strong>Reads the file content</strong>: Large files are read in chunks to optimize memory usage.</li>
<li><strong>Hashes content</strong>: Uses SHA-256 to hash file contents.</li>
<li><strong>Determines file language</strong>: Uses file extension to classify the programming language.</li>
</ul>
<h4><code>readFileInChunks(filePath, fileSize)</code></h4>
<p>A helper function to read large files in manageable chunks to avoid memory exhaustion.</p>
<h4><code>analyzeDirectory(dirPath)</code></h4>
<p>Analyzes directories without progress feedback.</p>
<h4><code>analyzeDirectoryWithProgress(dirPath, progressCallback)</code></h4>
<p>Analyzes the directory and provides progress updates through a callback for each processed file.</p>
<h4><code>shouldIncludeFile(filePath, forceInclude)</code></h4>
<p>Determines whether a file should be included based on configurations and wildcard exclude patterns.</p>
<h4><code>detectLanguage(extension)</code></h4>
<p>Maps file extensions to programming languages, defaulting to &#39;plaintext&#39; if unknown.</p>
<h2>Module Exports</h2>
<pre><code class="language-javascript">module.exports = { CodeAnalyzer };
</code></pre>
<ul>
<li>Exports the <code>CodeAnalyzer</code> class for use in other files.</li>
</ul>
<hr>
<p>This file is part of a larger system meant for scanning codebases and collecting metadata, which is useful for applications like code analysis, linting, or automated documentation. The structure and logic of the code support extensibility and configurability, ensuring it can be adapted to various needs based on the configuration provided.</p>

                 </div>
             </div>
         </div>
     </div>
 </div>

 <div class="file-entry col-12 mb-4" id="file-5" data-file-path="D:\MyDev\CodeExplain\src\config\configManager.js" data-file-index="5">
     <div class="card shadow-sm border-0 h-100" style="border-radius: 12px; overflow: hidden;">
         <div class="card-header bg-gradient-primary text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1rem 1.5rem;">
             <div class="d-flex justify-content-between align-items-center">
                  <h2 class="toggle-code h5 fw-semibold mb-0 cursor-pointer d-flex align-items-center text-white" data-file-index="5" style="font-size: 1.1rem;">
                      <i class="fas fa-chevron-right me-2 transition-transform duration-200"></i>
                      <i class="fas fa-file-code me-2"></i>
                      config/configManager.js
                  </h2>
                 <span class="badge bg-white bg-opacity-25 text-white px-2 py-1" style="font-size: 0.75rem;">
                     javascript
                 </span>
             </div>
         </div>

               <div class="card-body p-0">
                 <div class="code-container bg-light border-bottom d-none" style="max-height: 400px; overflow: auto;" data-file-path="D:\MyDev\CodeExplain\src\config\configManager.js" data-file-language="javascript">
                     <div class="p-3 text-center text-muted">
                         <div class="spinner-border spinner-border-sm me-2" role="status" style="display: none;"></div>
                         <span class="loading-text">Click to load code</span>
                     </div>
                     <div class="code-content" style="display: none;"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs-extra&#x27;</span>);

<span class="hljs-comment">// Configuration constants</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CONFIG_DEFAULTS</span> = {
  <span class="hljs-attr">GEMINI_MODEL</span>: <span class="hljs-string">&#x27;gemini-2.5-flash&#x27;</span>,
  <span class="hljs-attr">OPENAI_MODEL</span>: <span class="hljs-string">&#x27;gpt-4o&#x27;</span>,
  <span class="hljs-attr">RETRY_ATTEMPTS</span>: <span class="hljs-number">3</span>,
  <span class="hljs-attr">RETRY_DELAY</span>: <span class="hljs-number">1000</span>,
  <span class="hljs-title class_">JSON</span><span class="hljs-attr">_INDENT_SPACES</span>: <span class="hljs-number">2</span>
};

<span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">MAX_FILE_SIZE_MB</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../utils/constants&#x27;</span>);

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CONFIG_DIR_NAME</span> = <span class="hljs-string">&#x27;.codeexplain&#x27;</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CONFIG_FILE_NAME</span> = <span class="hljs-string">&#x27;config.json&#x27;</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigManager</span> {
  #codeExplainDir;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">configPath</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">configPath</span> = configPath;
    <span class="hljs-variable language_">this</span>.#codeExplainDir = path.<span class="hljs-title function_">join</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-variable constant_">CONFIG_DIR_NAME</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">defaultConfig</span> = {
      <span class="hljs-attr">provider</span>: <span class="hljs-string">&#x27;gemini&#x27;</span>,
      <span class="hljs-attr">model</span>: <span class="hljs-string">&#x27;gemini-2.5-flash&#x27;</span>,
      <span class="hljs-attr">output</span>: <span class="hljs-string">&#x27;html&#x27;</span>,
      <span class="hljs-attr">mode</span>: <span class="hljs-string">&#x27;explain&#x27;</span>,
      <span class="hljs-attr">level</span>: <span class="hljs-string">&#x27;beginner&#x27;</span>,
      <span class="hljs-attr">maxTokens</span>: <span class="hljs-number">15000</span>,
      <span class="hljs-attr">baseUrl</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// For Ollama or custom OpenAI endpoints</span>
      <span class="hljs-attr">retry</span>: {
        <span class="hljs-attr">attempts</span>: <span class="hljs-variable constant_">CONFIG_DEFAULTS</span>.<span class="hljs-property">RETRY_ATTEMPTS</span>,
        <span class="hljs-attr">delay</span>: <span class="hljs-variable constant_">CONFIG_DEFAULTS</span>.<span class="hljs-property">RETRY_DELAY</span>
      },
      <span class="hljs-attr">concurrency</span>: <span class="hljs-number">3</span>,
      <span class="hljs-attr">maxFileSize</span>: <span class="hljs-variable constant_">MAX_FILE_SIZE_MB</span>,
      <span class="hljs-attr">codeExtensions</span>: [
        <span class="hljs-comment">// Web Development</span>
        <span class="hljs-string">&#x27;.js&#x27;</span>, <span class="hljs-string">&#x27;.jsx&#x27;</span>, <span class="hljs-string">&#x27;.ts&#x27;</span>, <span class="hljs-string">&#x27;.tsx&#x27;</span>, <span class="hljs-string">&#x27;.vue&#x27;</span>, <span class="hljs-string">&#x27;.svelte&#x27;</span>, <span class="hljs-string">&#x27;.astro&#x27;</span>,
        <span class="hljs-string">&#x27;.html&#x27;</span>, <span class="hljs-string">&#x27;.htm&#x27;</span>, <span class="hljs-string">&#x27;.xml&#x27;</span>, <span class="hljs-string">&#x27;.svg&#x27;</span>, <span class="hljs-string">&#x27;.css&#x27;</span>, <span class="hljs-string">&#x27;.scss&#x27;</span>, <span class="hljs-string">&#x27;.sass&#x27;</span>, <span class="hljs-string">&#x27;.less&#x27;</span>,
        <span class="hljs-string">&#x27;.php&#x27;</span>, <span class="hljs-string">&#x27;.asp&#x27;</span>, <span class="hljs-string">&#x27;.jsp&#x27;</span>, <span class="hljs-string">&#x27;.ejs&#x27;</span>, <span class="hljs-string">&#x27;.hbs&#x27;</span>, <span class="hljs-string">&#x27;.handlebars&#x27;</span>,

        <span class="hljs-comment">// Backend Languages</span>
        <span class="hljs-string">&#x27;.py&#x27;</span>, <span class="hljs-string">&#x27;.java&#x27;</span>, <span class="hljs-string">&#x27;.c&#x27;</span>, <span class="hljs-string">&#x27;.cpp&#x27;</span>, <span class="hljs-string">&#x27;.cxx&#x27;</span>, <span class="hljs-string">&#x27;.cc&#x27;</span>, <span class="hljs-string">&#x27;.h&#x27;</span>, <span class="hljs-string">&#x27;.hpp&#x27;</span>,
        <span class="hljs-string">&#x27;.cs&#x27;</span>, <span class="hljs-string">&#x27;.vb&#x27;</span>, <span class="hljs-string">&#x27;.fs&#x27;</span>, <span class="hljs-string">&#x27;.fsx&#x27;</span>, <span class="hljs-string">&#x27;.go&#x27;</span>, <span class="hljs-string">&#x27;.rs&#x27;</span>, <span class="hljs-string">&#x27;.swift&#x27;</span>, <span class="hljs-string">&#x27;.kt&#x27;</span>, <span class="hljs-string">&#x27;.scala&#x27;</span>,
        <span class="hljs-string">&#x27;.rb&#x27;</span>, <span class="hljs-string">&#x27;.pl&#x27;</span>, <span class="hljs-string">&#x27;.pm&#x27;</span>, <span class="hljs-string">&#x27;.tcl&#x27;</span>, <span class="hljs-string">&#x27;.lua&#x27;</span>, <span class="hljs-string">&#x27;.dart&#x27;</span>, <span class="hljs-string">&#x27;.r&#x27;</span>, <span class="hljs-string">&#x27;.m&#x27;</span>, <span class="hljs-string">&#x27;.matlab&#x27;</span>,

        <span class="hljs-comment">// Systems Programming</span>
        <span class="hljs-string">&#x27;.asm&#x27;</span>, <span class="hljs-string">&#x27;.s&#x27;</span>, <span class="hljs-string">&#x27;.zig&#x27;</span>, <span class="hljs-string">&#x27;.v&#x27;</span>, <span class="hljs-string">&#x27;.nim&#x27;</span>, <span class="hljs-string">&#x27;.crystal&#x27;</span>, <span class="hljs-string">&#x27;.pony&#x27;</span>,

        <span class="hljs-comment">// Functional Programming</span>
        <span class="hljs-string">&#x27;.hs&#x27;</span>, <span class="hljs-string">&#x27;.ml&#x27;</span>, <span class="hljs-string">&#x27;.fs&#x27;</span>, <span class="hljs-string">&#x27;.elm&#x27;</span>, <span class="hljs-string">&#x27;.purs&#x27;</span>, <span class="hljs-string">&#x27;.clj&#x27;</span>, <span class="hljs-string">&#x27;.cljs&#x27;</span>, <span class="hljs-string">&#x27;.scm&#x27;</span>, <span class="hljs-string">&#x27;.rkt&#x27;</span>,
        <span class="hljs-string">&#x27;.ex&#x27;</span>, <span class="hljs-string">&#x27;.exs&#x27;</span>, <span class="hljs-string">&#x27;.erl&#x27;</span>, <span class="hljs-string">&#x27;.hrl&#x27;</span>,

        <span class="hljs-comment">// Data &amp; Config</span>
        <span class="hljs-string">&#x27;.graphql&#x27;</span>, <span class="hljs-string">&#x27;.gql&#x27;</span>,

        <span class="hljs-comment">// Shell &amp; Scripting</span>
        <span class="hljs-string">&#x27;.awk&#x27;</span>, <span class="hljs-string">&#x27;.sed&#x27;</span>, <span class="hljs-string">&#x27;.perl&#x27;</span>, <span class="hljs-string">&#x27;.ahk&#x27;</span>,

        <span class="hljs-comment">// Build &amp; Config Files</span>
        <span class="hljs-string">&#x27;.makefile&#x27;</span>, <span class="hljs-string">&#x27;.mk&#x27;</span>, <span class="hljs-string">&#x27;.cmake&#x27;</span>, <span class="hljs-string">&#x27;.gradle&#x27;</span>, <span class="hljs-string">&#x27;.maven&#x27;</span>, <span class="hljs-string">&#x27;.pom&#x27;</span>,
        <span class="hljs-string">&#x27;.dockerfile&#x27;</span>, <span class="hljs-string">&#x27;.containerfile&#x27;</span>,

        <span class="hljs-comment">// Other</span>
        <span class="hljs-string">&#x27;.raku&#x27;</span>, <span class="hljs-string">&#x27;.p6&#x27;</span>, <span class="hljs-string">&#x27;.nim&#x27;</span>, <span class="hljs-string">&#x27;.vala&#x27;</span>, <span class="hljs-string">&#x27;.genie&#x27;</span>, <span class="hljs-string">&#x27;.boo&#x27;</span>, <span class="hljs-string">&#x27;.cobra&#x27;</span>, <span class="hljs-string">&#x27;.ahk&#x27;</span>
      ],
      <span class="hljs-attr">exclude</span>: [
        <span class="hljs-comment">// Version control</span>
        <span class="hljs-string">&#x27;.git&#x27;</span>,
        <span class="hljs-string">&#x27;.svn&#x27;</span>,
        <span class="hljs-string">&#x27;.hg&#x27;</span>,
        <span class="hljs-string">&#x27;.bzr&#x27;</span>,

        <span class="hljs-comment">// Dependencies</span>
        <span class="hljs-string">&#x27;node_modules&#x27;</span>,
        <span class="hljs-string">&#x27;vendor&#x27;</span>,
        <span class="hljs-string">&#x27;packages&#x27;</span>,
        <span class="hljs-string">&#x27;bower_components&#x27;</span>,
        <span class="hljs-string">&#x27;jspm_packages&#x27;</span>,
        <span class="hljs-string">&#x27;lib&#x27;</span>,

        <span class="hljs-comment">// Build outputs</span>
        <span class="hljs-string">&#x27;dist&#x27;</span>,
        <span class="hljs-string">&#x27;build&#x27;</span>,
        <span class="hljs-string">&#x27;target&#x27;</span>,
        <span class="hljs-string">&#x27;bin&#x27;</span>,
        <span class="hljs-string">&#x27;obj&#x27;</span>,
        <span class="hljs-string">&#x27;.next&#x27;</span>,
        <span class="hljs-string">&#x27;.nuxt&#x27;</span>,
        <span class="hljs-string">&#x27;.output&#x27;</span>,
        <span class="hljs-string">&#x27;public/build&#x27;</span>,

        <span class="hljs-comment">// IDEs and editors</span>
        <span class="hljs-string">&#x27;.vscode&#x27;</span>,
        <span class="hljs-string">&#x27;.idea&#x27;</span>,
        <span class="hljs-string">&#x27;.vs&#x27;</span>,
        <span class="hljs-string">&#x27;*.swp&#x27;</span>,
        <span class="hljs-string">&#x27;*.swo&#x27;</span>,
        <span class="hljs-string">&#x27;*~&#x27;</span>,

        <span class="hljs-comment">// OS generated</span>
        <span class="hljs-string">&#x27;.DS_Store&#x27;</span>,
        <span class="hljs-string">&#x27;Thumbs.db&#x27;</span>,
        <span class="hljs-string">&#x27;desktop.ini&#x27;</span>,
        <span class="hljs-string">&#x27;.Trashes&#x27;</span>,

        <span class="hljs-comment">// Logs and debug</span>
        <span class="hljs-string">&#x27;*.log&#x27;</span>,
        <span class="hljs-string">&#x27;logs&#x27;</span>,
        <span class="hljs-string">&#x27;log&#x27;</span>,
        <span class="hljs-string">&#x27;.log&#x27;</span>,
        <span class="hljs-string">&#x27;npm-debug.log*&#x27;</span>,
        <span class="hljs-string">&#x27;yarn-debug.log*&#x27;</span>,
        <span class="hljs-string">&#x27;yarn-error.log*&#x27;</span>,

        <span class="hljs-comment">// Cache and temp</span>
        <span class="hljs-string">&#x27;.cache&#x27;</span>,
        <span class="hljs-string">&#x27;__pycache__&#x27;</span>,
        <span class="hljs-string">&#x27;.pytest_cache&#x27;</span>,
        <span class="hljs-string">&#x27;.mypy_cache&#x27;</span>,
        <span class="hljs-string">&#x27;.tox&#x27;</span>,
        <span class="hljs-string">&#x27;.coverage&#x27;</span>,
        <span class="hljs-string">&#x27;.nyc_output&#x27;</span>,
        <span class="hljs-string">&#x27;coverage&#x27;</span>,
        <span class="hljs-string">&#x27;.eslintcache&#x27;</span>,
        <span class="hljs-string">&#x27;.stylelintcache&#x27;</span>,
        <span class="hljs-string">&#x27;.sass-cache&#x27;</span>,

        <span class="hljs-comment">// Temporary files</span>
        <span class="hljs-string">&#x27;tmp&#x27;</span>,
        <span class="hljs-string">&#x27;temp&#x27;</span>,
        <span class="hljs-string">&#x27;.tmp&#x27;</span>,
        <span class="hljs-string">&#x27;.temp&#x27;</span>,

        <span class="hljs-comment">// Archives and backups</span>
        <span class="hljs-string">&#x27;*.zip&#x27;</span>,
        <span class="hljs-string">&#x27;*.tar.gz&#x27;</span>,
        <span class="hljs-string">&#x27;*.tar.bz2&#x27;</span>,
        <span class="hljs-string">&#x27;*.tar&#x27;</span>,
        <span class="hljs-string">&#x27;*.rar&#x27;</span>,
        <span class="hljs-string">&#x27;*.7z&#x27;</span>,
        <span class="hljs-string">&#x27;*.bak&#x27;</span>,
        <span class="hljs-string">&#x27;*.backup&#x27;</span>,

        <span class="hljs-comment">// Lock files (optional, but often not needed for explanation)</span>
        <span class="hljs-comment">// &#x27;package-lock.json&#x27;,</span>
        <span class="hljs-comment">// &#x27;yarn.lock&#x27;,</span>
        <span class="hljs-comment">// &#x27;Gemfile.lock&#x27;,</span>

        <span class="hljs-comment">// Config files that are not code</span>
        <span class="hljs-string">&#x27;.env&#x27;</span>,
        <span class="hljs-string">&#x27;.env.local&#x27;</span>,
        <span class="hljs-string">&#x27;.env.*&#x27;</span>,

        <span class="hljs-comment">// CI/CD</span>
        <span class="hljs-string">&#x27;.github/workflows&#x27;</span>,
        <span class="hljs-string">&#x27;.gitlab-ci.yml&#x27;</span>,
        <span class="hljs-string">&#x27;.travis.yml&#x27;</span>,
        <span class="hljs-string">&#x27;Jenkinsfile&#x27;</span>,

        <span class="hljs-comment">// Docker</span>
        <span class="hljs-string">&#x27;Dockerfile.*&#x27;</span>,

        <span class="hljs-comment">// tests</span>
        <span class="hljs-string">&#x27;tests&#x27;</span>,
        <span class="hljs-string">&#x27;test&#x27;</span>,
        <span class="hljs-string">&#x27;__tests__&#x27;</span>,
        <span class="hljs-string">&#x27;*.test.*&#x27;</span>,
        <span class="hljs-string">&#x27;*cest*&#x27;</span>,
        <span class="hljs-string">&#x27;*.spec.*&#x27;</span>,
        <span class="hljs-string">&#x27;e2e&#x27;</span>,
        <span class="hljs-string">&#x27;*.e2e.*&#x27;</span>,

        <span class="hljs-comment">// Other</span>
        <span class="hljs-string">&#x27;.codeexplain&#x27;</span>
      ]
    };
  }



  <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadConfig</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_cachedConfig</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_cachedConfig</span>
    }

    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// Create config directory if it doesn&#x27;t exist</span>
      <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">ensureDir</span>(<span class="hljs-variable language_">this</span>.#codeExplainDir)

      <span class="hljs-comment">// Determine config file path</span>
      <span class="hljs-keyword">const</span> configFile = <span class="hljs-variable language_">this</span>.<span class="hljs-property">configPath</span>
        ? path.<span class="hljs-title function_">resolve</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">configPath</span>)
        : path.<span class="hljs-title function_">join</span>(<span class="hljs-variable language_">this</span>.#codeExplainDir, <span class="hljs-variable constant_">CONFIG_FILE_NAME</span>)

      <span class="hljs-comment">// Load existing config or create default</span>
      <span class="hljs-keyword">let</span> config = {}
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">pathExists</span>(configFile)) {
        <span class="hljs-keyword">const</span> configContent = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readJson</span>(configFile)
        config = { ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">defaultConfig</span>, ...configContent }
      } <span class="hljs-keyword">else</span> {
        config = { ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">defaultConfig</span> }
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveConfig</span>(config, configFile)
      }

      <span class="hljs-comment">// Only set environment variable as fallback if apiKey is not already set in config file</span>
      <span class="hljs-keyword">if</span> (!config.<span class="hljs-property">apiKey</span> &amp;&amp; process.<span class="hljs-property">env</span>.<span class="hljs-property">CODEEXPLAIN_API_KEY</span>) {
        config.<span class="hljs-property">apiKey</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">CODEEXPLAIN_API_KEY</span>
      }

      <span class="hljs-comment">// Ensure model parameter is set (for backward compatibility)</span>
      <span class="hljs-keyword">if</span> (!config.<span class="hljs-property">model</span> &amp;&amp; config.<span class="hljs-property">provider</span> === <span class="hljs-string">&#x27;gemini&#x27;</span>) {
        config.<span class="hljs-property">model</span> = <span class="hljs-variable constant_">CONFIG_DEFAULTS</span>.<span class="hljs-property">GEMINI_MODEL</span>
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!config.<span class="hljs-property">model</span> &amp;&amp; config.<span class="hljs-property">provider</span> === <span class="hljs-string">&#x27;openai&#x27;</span>) {
        config.<span class="hljs-property">model</span> = <span class="hljs-variable constant_">CONFIG_DEFAULTS</span>.<span class="hljs-property">OPENAI_MODEL</span>
      }

      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_cachedConfig</span> = config
      <span class="hljs-keyword">return</span> config
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Failed to load config:&#x27;</span>, err)
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Could not load configuration&#x27;</span>)
    }
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">saveConfig</span>(<span class="hljs-params">config, configFile</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> configPath = configFile || path.<span class="hljs-title function_">join</span>(<span class="hljs-variable language_">this</span>.#codeExplainDir, <span class="hljs-variable constant_">CONFIG_FILE_NAME</span>)
      <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">writeJson</span>(configPath, config, { <span class="hljs-attr">spaces</span>: <span class="hljs-variable constant_">CONFIG_DEFAULTS</span>.<span class="hljs-property">JSON_INDENT_SPACES</span> })
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_cachedConfig</span> = config
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Failed to save config:&#x27;</span>, err)
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Could not save configuration&#x27;</span>)
    }
  }
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { <span class="hljs-title class_">ConfigManager</span> };</div>
                 </div>

             <div class="p-4">
                 <div class="d-flex justify-content-between align-items-center mb-3">
                     <h3 class="h6 text-muted mb-0 d-flex align-items-center">
                         <i class="fas fa-brain me-2 text-primary"></i>
                         AI Explanation
                     </h3>
                     <button class="btn btn-outline-primary btn-sm copy-explanation" data-file-index="5" title="Copy explanation">
                         <i class="fas fa-copy me-1"></i> Copy
                     </button>
                 </div>
                 <div class="explanation-content">
                     <p>Certainly! Let&#39;s go through the JavaScript code file <code>configManager.js</code> step by step and explain what it does.</p>
<pre><code class="language-javascript">const path = require(&#39;path&#39;);
const fs = require(&#39;fs-extra&#39;);
</code></pre>
<p>These libraries are being imported at the beginning:</p>
<ul>
<li><code>path</code>: A Node.js module providing utilities for working with file and directory paths.</li>
<li><code>fs-extra</code>: An extension of the <code>fs</code> module that provides additional functionality for file system operations, such as creating directories recursively.</li>
</ul>
<h3>Configuration Constants</h3>
<pre><code class="language-javascript">const CONFIG_DEFAULTS = {
  GEMINI_MODEL: &#39;gemini-2.5-flash&#39;,
  OPENAI_MODEL: &#39;gpt-4o&#39;,
  RETRY_ATTEMPTS: 3,
  RETRY_DELAY: 1000,
  JSON_INDENT_SPACES: 2
};

const { MAX_FILE_SIZE_MB } = require(&#39;../utils/constants&#39;);
</code></pre>
<ul>
<li><code>CONFIG_DEFAULTS</code> stores default configurations used by the application, including default model versions and retry configurations.</li>
<li><code>MAX_FILE_SIZE_MB</code> is imported from <code>../utils/constants</code>, indicating a maximum file size setting.</li>
</ul>
<h3>Configuration File and Directory Names</h3>
<pre><code class="language-javascript">const CONFIG_DIR_NAME = &#39;.codeexplain&#39;;
const CONFIG_FILE_NAME = &#39;config.json&#39;;
</code></pre>
<ul>
<li>These constants define where the configuration files will be stored. The directory <code>.codeexplain</code> will contain a <code>config.json</code> file.</li>
</ul>
<h3>ConfigManager Class</h3>
<pre><code class="language-javascript">class ConfigManager {
  #codeExplainDir;

  constructor(configPath) {
    this.configPath = configPath;
    this.#codeExplainDir = path.join(process.cwd(), CONFIG_DIR_NAME);
    this.defaultConfig = { ... }
  }
</code></pre>
<ul>
<li>The <code>ConfigManager</code> class is responsible for managing configuration settings.</li>
<li><code>#codeExplainDir</code> is a private property indicating the directory for the configuration files.</li>
<li>The <code>constructor</code> initializes <code>configPath</code> (a custom path provided for the config file) and sets up default configuration settings in <code>this.defaultConfig</code>.</li>
</ul>
<h3>Load Configuration</h3>
<pre><code class="language-javascript">async loadConfig() {
  if (this._cachedConfig) {
    return this._cachedConfig;
  }

  try {
    await fs.ensureDir(this.#codeExplainDir);
    const configFile = this.configPath
      ? path.resolve(this.configPath)
      : path.join(this.#codeExplainDir, CONFIG_FILE_NAME);

    let config = {};
    if (await fs.pathExists(configFile)) {
      const configContent = await fs.readJson(configFile);
      config = { ...this.defaultConfig, ...configContent };
    } else {
      config = { ...this.defaultConfig };
      await this.saveConfig(config, configFile);
    }

    if (!config.apiKey &amp;&amp; process.env.CODEEXPLAIN_API_KEY) {
      config.apiKey = process.env.CODEEXPLAIN_API_KEY;
    }

    if (!config.model &amp;&amp; config.provider === &#39;gemini&#39;) {
      config.model = CONFIG_DEFAULTS.GEMINI_MODEL;
    } else if (!config.model &amp;&amp; config.provider === &#39;openai&#39;) {
      config.model = CONFIG_DEFAULTS.OPENAI_MODEL;
    }

    this._cachedConfig = config;
    return config;
  } catch (err) {
    console.error(&#39;Failed to load config:&#39;, err);
    throw new Error(&#39;Could not load configuration&#39;);
  }
}
</code></pre>
<ul>
<li><code>loadConfig()</code> is an asynchronous method that loads configuration settings.</li>
<li>It first checks if the configuration is already cached (<code>_cachedConfig</code>), returning it if available.</li>
<li>If not cached, it ensures the directory exists (<code>ensureDir</code>) and determines the config file path (either a custom path or the default path).</li>
<li>It checks if the configuration file exists. If it does, it reads and merges it with default settings. If not, it uses default settings and saves a new config file.</li>
<li>It sets the <code>apiKey</code> from an environment variable if not present in the configuration.</li>
<li>Ensures backward compatibility with model settings based on provider type (<code>gemini</code> or <code>openai</code>).</li>
<li>Finally, it caches the loaded config and returns it.</li>
</ul>
<h3>Save Configuration</h3>
<pre><code class="language-javascript">async saveConfig(config, configFile) {
  try {
    const configPath = configFile || path.join(this.#codeExplainDir, CONFIG_FILE_NAME);
    await fs.writeJson(configPath, config, { spaces: CONFIG_DEFAULTS.JSON_INDENT_SPACES });
    this._cachedConfig = config;
  } catch (err) {
    console.error(&#39;Failed to save config:&#39;, err);
    throw new Error(&#39;Could not save configuration&#39;);
  }
}
</code></pre>
<ul>
<li><code>saveConfig()</code> is an asynchronous method that saves the given configuration object to a file.</li>
<li>It writes the configuration to a specified path, formatting it with indentation for readability (defined by <code>CONFIG_DEFAULTS.JSON_INDENT_SPACES</code>).</li>
<li>It updates the <code>_cachedConfig</code> to avoid redundant loads.</li>
</ul>
<h3>Export</h3>
<pre><code class="language-javascript">module.exports = { ConfigManager };
</code></pre>
<ul>
<li>The <code>ConfigManager</code> class is exported, allowing it to be imported and used in other parts of the application.</li>
</ul>
<p>This code is designed to be part of a larger application that involves managing configurations for different providers and models, likely in an AI or machine learning context. The ability to cache and easily update configurations makes it robust for real-world usage.</p>

                 </div>
             </div>
         </div>
     </div>
 </div>

 <div class="file-entry col-12 mb-4" id="file-6" data-file-path="D:\MyDev\CodeExplain\src\flowchart\flowchartGenerator.js" data-file-index="6">
     <div class="card shadow-sm border-0 h-100" style="border-radius: 12px; overflow: hidden;">
         <div class="card-header bg-gradient-primary text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1rem 1.5rem;">
             <div class="d-flex justify-content-between align-items-center">
                  <h2 class="toggle-code h5 fw-semibold mb-0 cursor-pointer d-flex align-items-center text-white" data-file-index="6" style="font-size: 1.1rem;">
                      <i class="fas fa-chevron-right me-2 transition-transform duration-200"></i>
                      <i class="fas fa-file-code me-2"></i>
                      flowchart/flowchartGenerator.js
                  </h2>
                 <span class="badge bg-white bg-opacity-25 text-white px-2 py-1" style="font-size: 0.75rem;">
                     javascript
                 </span>
             </div>
         </div>

               <div class="card-body p-0">
                 <div class="code-container bg-light border-bottom d-none" style="max-height: 400px; overflow: auto;" data-file-path="D:\MyDev\CodeExplain\src\flowchart\flowchartGenerator.js" data-file-language="javascript">
                     <div class="p-3 text-center text-muted">
                         <div class="spinner-border spinner-border-sm me-2" role="status" style="display: none;"></div>
                         <span class="loading-text">Click to load code</span>
                     </div>
                     <div class="code-content" style="display: none;"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FlowchartGenerator</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-variable constant_">MAX_FUNCTIONS_PER_COMPONENT</span> = <span class="hljs-number">2</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-variable constant_">MAX_FUNCTIONS_TOTAL</span> = <span class="hljs-number">15</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-variable constant_">MAX_DB_CONNECTIONS</span> = <span class="hljs-number">3</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-variable constant_">MAX_API_CONNECTIONS</span> = <span class="hljs-number">3</span>;

  <span class="hljs-keyword">static</span> <span class="hljs-variable constant_">NODE_SHAPES</span> = {
    <span class="hljs-attr">DEFAULT</span>: [<span class="hljs-string">&#x27;[&quot;&#x27;</span>, <span class="hljs-string">&#x27;&quot;]&#x27;</span>],
    <span class="hljs-attr">ENTRY</span>: [<span class="hljs-string">&#x27;(&quot;&#x27;</span>, <span class="hljs-string">&#x27;&quot;)&#x27;</span>],
    <span class="hljs-attr">CONFIG</span>: [<span class="hljs-string">&#x27;[/&#x27;</span>, <span class="hljs-string">&#x27;/]&#x27;</span>],
    <span class="hljs-attr">SERVICE</span>: [<span class="hljs-string">&#x27;{{&#x27;</span>, <span class="hljs-string">&#x27;}}&#x27;</span>],
    <span class="hljs-attr">MODEL</span>: [<span class="hljs-string">&#x27;[[&#x27;</span>, <span class="hljs-string">&#x27;]]&#x27;</span>],
    <span class="hljs-attr">UTILITY</span>: [<span class="hljs-string">&#x27;[(&#x27;</span>, <span class="hljs-string">&#x27;)]&#x27;</span>],
    <span class="hljs-attr">TEST</span>: [<span class="hljs-string">&#x27;{{&#x27;</span>, <span class="hljs-string">&#x27;}}&#x27;</span>]
  };

  <span class="hljs-comment">/**
   * Generate a comprehensive flowchart and explanation from code analysis
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array</span>} <span class="hljs-variable">analysis</span> - Array of analyzed files with their content and metadata
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">config</span> - Configuration options for flowchart generation
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object</span>} Generated flowchart and explanation
   */</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params">analysis, config</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// Analyze code structure to understand project relationships</span>
      <span class="hljs-keyword">const</span> codeStructure = <span class="hljs-title class_">FlowchartGenerator</span>.<span class="hljs-title function_">analyzeCodeStructure</span>(analysis);

      <span class="hljs-comment">// Create a map of component names to their indices for faster lookups</span>
      <span class="hljs-keyword">const</span> componentIndexMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(
        codeStructure.<span class="hljs-property">components</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">comp, index</span>) =&gt;</span> [comp.<span class="hljs-property">name</span>, index])
      );

      <span class="hljs-comment">// Create a comprehensive flowchart based on actual code relationships</span>
      <span class="hljs-keyword">const</span> flowchartLines = [<span class="hljs-string">&#x27;flowchart TD&#x27;</span>];

      <span class="hljs-comment">// Add main entry points - connecting each directly to START</span>
      flowchartLines.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;    START[(&quot;Start&quot;)]&#x27;</span>);
      <span class="hljs-keyword">if</span> (codeStructure.<span class="hljs-property">entryPoints</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        codeStructure.<span class="hljs-property">entryPoints</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">entry, index</span>) =&gt;</span> {
          <span class="hljs-keyword">const</span> safeEntryName = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sanitizeComponentName</span>(entry.<span class="hljs-property">name</span>);
          flowchartLines.<span class="hljs-title function_">push</span>(<span class="hljs-string">`    ENTRY<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>[(&quot;<span class="hljs-subst">${safeEntryName}</span> (entry point)&quot;)]`</span>);
          flowchartLines.<span class="hljs-title function_">push</span>(<span class="hljs-string">`    START --&gt; ENTRY<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>`</span>);
        });
      }

      <span class="hljs-comment">// Add core components and their relationships</span>
      codeStructure.<span class="hljs-property">components</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">component, index</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> compId = <span class="hljs-string">`COMP<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>`</span>;

        <span class="hljs-comment">// Get node shape based on component type</span>
        <span class="hljs-keyword">const</span> [nodeShape, nodeEnd] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getNodeShape</span>(component.<span class="hljs-property">type</span>);

        <span class="hljs-comment">// Format the node content properly - avoid parentheses and newlines that can cause parsing issues</span>
        <span class="hljs-keyword">const</span> safeComponentName = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sanitizeComponentName</span>(component.<span class="hljs-property">name</span>);
        <span class="hljs-keyword">const</span> safeComponentType = component.<span class="hljs-property">type</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&quot;/g</span>, <span class="hljs-string">&#x27;\\&quot;&#x27;</span>).<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\n/g</span>, <span class="hljs-string">&#x27; &#x27;</span>);
        <span class="hljs-keyword">const</span> nodeContent = <span class="hljs-string">`<span class="hljs-subst">${safeComponentName}</span> - <span class="hljs-subst">${safeComponentType}</span>`</span>;
        flowchartLines.<span class="hljs-title function_">push</span>(<span class="hljs-string">`    <span class="hljs-subst">${compId}</span><span class="hljs-subst">${nodeShape}</span><span class="hljs-subst">${nodeContent}</span><span class="hljs-subst">${nodeEnd}</span>`</span>);

        <span class="hljs-comment">// Only connect Main/Entry components to START if they&#x27;re not already in entryPoints</span>
        <span class="hljs-keyword">if</span> ((component.<span class="hljs-property">type</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;Main&#x27;</span>) || component.<span class="hljs-property">type</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;Entry&#x27;</span>)) &amp;&amp;
          !codeStructure.<span class="hljs-property">entryPoints</span>.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> entry.<span class="hljs-property">name</span> === component.<span class="hljs-property">name</span>)) {
          flowchartLines.<span class="hljs-title function_">push</span>(<span class="hljs-string">`    START --&gt; <span class="hljs-subst">${compId}</span>`</span>);
        }

        <span class="hljs-comment">// Add internal dependencies (other project modules)</span>
        <span class="hljs-keyword">if</span> (component.<span class="hljs-property">internalDependencies</span> &amp;&amp; component.<span class="hljs-property">internalDependencies</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
          <span class="hljs-keyword">const</span> lines = component.<span class="hljs-property">internalDependencies</span>
            .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">dep</span> =&gt;</span> {
              <span class="hljs-keyword">const</span> depIndex = componentIndexMap.<span class="hljs-title function_">get</span>(dep);
              <span class="hljs-comment">// Only create connection if dependency component exists and isn&#x27;t self</span>
              <span class="hljs-keyword">if</span> (depIndex !== <span class="hljs-literal">undefined</span> &amp;&amp; depIndex !== index) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">`    <span class="hljs-subst">${compId}</span> --&gt; COMP<span class="hljs-subst">${depIndex + <span class="hljs-number">1</span>}</span>\n`</span>;
              }
              <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
            })
            .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">line</span> =&gt;</span> line !== <span class="hljs-literal">null</span>);

          <span class="hljs-keyword">if</span> (lines.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
            flowchartLines.<span class="hljs-title function_">push</span>(...lines.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">line</span> =&gt;</span> line.<span class="hljs-title function_">trim</span>()));
          }
        }

        <span class="hljs-comment">// External dependencies are shown in text analysis only, not in visual flowchart</span>
        <span class="hljs-comment">// to keep the diagram clean and focused on internal architecture</span>

        <span class="hljs-comment">// Add functions/methods within component</span>
        <span class="hljs-keyword">if</span> (component.<span class="hljs-property">functions</span> &amp;&amp; component.<span class="hljs-property">functions</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
          <span class="hljs-keyword">const</span> funcCount = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(component.<span class="hljs-property">functions</span>.<span class="hljs-property">length</span>, <span class="hljs-title class_">FlowchartGenerator</span>.<span class="hljs-property">MAX_FUNCTIONS_PER_COMPONENT</span>);
          component.<span class="hljs-property">functions</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, funcCount).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">func, funcIndex</span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> funcId = <span class="hljs-string">`FUNC<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>_<span class="hljs-subst">${funcIndex + <span class="hljs-number">1</span>}</span>`</span>;
            <span class="hljs-comment">// Escape special characters in function names</span>
            <span class="hljs-keyword">const</span> safeFuncName = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sanitizeFunctionName</span>(func.<span class="hljs-property">name</span>);
            flowchartLines.<span class="hljs-title function_">push</span>(<span class="hljs-string">`    <span class="hljs-subst">${compId}</span> --&gt; <span class="hljs-subst">${funcId}</span>[&quot;<span class="hljs-subst">${safeFuncName}</span>()&quot;]`</span>);
          });
          <span class="hljs-keyword">if</span> (component.<span class="hljs-property">functions</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">2</span>) {
            flowchartLines.<span class="hljs-title function_">push</span>(<span class="hljs-string">`    <span class="hljs-subst">${compId}</span> --&gt; FUNC<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>_MORE[&quot;<span class="hljs-subst">${component.functions.length - <span class="hljs-number">2</span>}</span> more funcs&quot;]`</span>);
          }
        }
      });

      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Add database/external connections if detected</span>
      <span class="hljs-comment">// Currently disabled due to extraction pattern issues</span>
      <span class="hljs-comment">/*
       if (codeStructure.databaseConnections.length &gt; 0) {
         codeStructure.databaseConnections.slice(0, 3).forEach((db, index) =&gt; {
           const dbId = `DB${index + 1}`;
           const cleanName = db.name.replace(/https?:\/\//, &#x27;&#x27;).split(&#x27;/&#x27;)[0].split(&#x27;.&#x27;)[0].substring(0, 15);
           const displayName = cleanName || &#x27;Database&#x27;;
           flowchartLines.push(`    ${dbId}((&quot;${displayName}&quot;)`);
           codeStructure.components.forEach((comp, compIndex) =&gt; {
             if (comp.databases &amp;&amp; comp.databases.includes(db.name)) {
               flowchartLines.push(`    COMP${compIndex + 1} --&gt; ${dbId}`);
             }
           });
         });
       }

       if (codeStructure.apiConnections.length &gt; 0) {
         codeStructure.apiConnections.slice(0, 3).forEach((api, index) =&gt; {
           const apiId = `API${index + 1}`;
           const cleanName = api.name.replace(/https?:\/\//, &#x27;&#x27;).split(&#x27;/&#x27;)[0].split(&#x27;.&#x27;)[0].substring(0, 15);
           const displayName = cleanName || &#x27;API&#x27;;
           flowchartLines.push(`    ${apiId}((&quot;${displayName}&quot;)`);
           codeStructure.components.forEach((comp, compIndex) =&gt; {
             if (comp.apis &amp;&amp; comp.apis.includes(api.name)) {
               flowchartLines.push(`    COMP${compIndex + 1} --&gt; ${apiId}`);
             }
           });
         });
       }
       */</span>

      <span class="hljs-comment">// Add completion node</span>
      flowchartLines.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;    END[(&quot;End&quot;)]&#x27;</span>);
      codeStructure.<span class="hljs-property">components</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">_, index</span>) =&gt;</span> {
        flowchartLines.<span class="hljs-title function_">push</span>(<span class="hljs-string">`    COMP<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span> --&gt; END`</span>);
      });

      <span class="hljs-comment">// Create a summary of the project structure</span>
      <span class="hljs-keyword">const</span> summary = codeStructure.<span class="hljs-property">components</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">comp, index</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> funcCount = comp.<span class="hljs-property">functions</span> ? comp.<span class="hljs-property">functions</span>.<span class="hljs-property">length</span> : <span class="hljs-number">0</span>;
        <span class="hljs-keyword">const</span> internalDepsCount = comp.<span class="hljs-property">internalDependencies</span> ? comp.<span class="hljs-property">internalDependencies</span>.<span class="hljs-property">length</span> : <span class="hljs-number">0</span>;
        <span class="hljs-keyword">const</span> externalDepsCount = comp.<span class="hljs-property">externalDependencies</span> ? comp.<span class="hljs-property">externalDependencies</span>.<span class="hljs-property">length</span> : <span class="hljs-number">0</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>. **<span class="hljs-subst">${comp.name}</span>** (<span class="hljs-subst">${comp.type}</span>) - <span class="hljs-subst">${funcCount}</span> functions, <span class="hljs-subst">${internalDepsCount}</span> internal deps, <span class="hljs-subst">${externalDepsCount}</span> external deps`</span>;
      }).<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;\n&#x27;</span>);

      <span class="hljs-comment">// Create dependency summary with all dependencies in code tags</span>
      <span class="hljs-keyword">const</span> externalDepsSummary = codeStructure.<span class="hljs-property">externalDependencies</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>
        ? <span class="hljs-string">`**External Dependencies (<span class="hljs-subst">${codeStructure.externalDependencies.length}</span> unique):** <span class="hljs-subst">${codeStructure.externalDependencies
          .filter(dep =&gt; dep &amp;&amp; dep.trim()) // Filter out empty/<span class="hljs-literal">null</span> dependencies
          .map(dep =&gt; <span class="hljs-string">`&lt;code&gt;<span class="hljs-subst">${dep.replace(/[&lt;&gt;&amp;]/g, <span class="hljs-string">&#x27;&#x27;</span>)}</span>&lt;/code&gt;`</span>) // Escape HTML and wrap <span class="hljs-keyword">in</span> code tags
          .join(<span class="hljs-string">&#x27;, &#x27;</span>)}</span>`</span>
        : <span class="hljs-string">&#x27;**External Dependencies:** None detected&#x27;</span>;

      <span class="hljs-keyword">const</span> internalDepsSummary = codeStructure.<span class="hljs-property">internalDependencies</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>
        ? <span class="hljs-string">`**Internal Dependencies (<span class="hljs-subst">${codeStructure.internalDependencies.length}</span> unique):** <span class="hljs-subst">${codeStructure.internalDependencies
          .filter(dep =&gt; dep &amp;&amp; dep.trim()) // Filter out empty/<span class="hljs-literal">null</span> dependencies
          .map(dep =&gt; <span class="hljs-string">`&lt;code&gt;<span class="hljs-subst">${dep.replace(/[&lt;&gt;&amp;]/g, <span class="hljs-string">&#x27;&#x27;</span>)}</span>&lt;/code&gt;`</span>) // Escape HTML and wrap <span class="hljs-keyword">in</span> code tags
          .join(<span class="hljs-string">&#x27;, &#x27;</span>)}</span>`</span>
        : <span class="hljs-string">&#x27;**Internal Dependencies:** None detected&#x27;</span>;

      <span class="hljs-comment">// Construct the beautified explanation string with enhanced HTML formatting</span>
      <span class="hljs-keyword">const</span> explanation = <span class="hljs-string">`# Project Architecture Flowchart

## 📋 Project Overview
&lt;div class=&quot;alert alert-info border-0 shadow-sm mb-4&quot;&gt;
  &lt;div class=&quot;d-flex align-items-center&quot;&gt;
    &lt;i class=&quot;fas fa-info-circle text-info me-3 fs-5&quot;&gt;&lt;/i&gt;
    &lt;div&gt;
      &lt;h5 class=&quot;alert-heading mb-1&quot;&gt;Project Analysis Summary&lt;/h5&gt;
      &lt;p class=&quot;mb-0&quot;&gt;This interactive flowchart visualizes how your &lt;strong class=&quot;text-primary&quot;&gt;<span class="hljs-subst">${codeStructure.language.toUpperCase()}</span>&lt;/strong&gt; project works, including components, dependencies, and data flow patterns.&lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

## 🏗️ Architecture Analysis
&lt;div class=&quot;row g-3 mb-4&quot;&gt;
  &lt;div class=&quot;col-md-6&quot;&gt;
    &lt;div class=&quot;card h-100 border-0&quot;&gt;
       &lt;div class=&quot;card-header bg-primary text-white border-0 d-flex align-items-center justify-content-center&quot; style=&quot;height: 60px;&quot;&gt;
         &lt;h6 class=&quot;card-title text-white&quot; style=&quot;margin: 0;&quot;&gt;
           &lt;i class=&quot;fas fa-sitemap me-2&quot;&gt;&lt;/i&gt;
           System Structure
         &lt;/h6&gt;
       &lt;/div&gt;
      &lt;div class=&quot;card-body&quot;&gt;
        &lt;p class=&quot;text-muted small mb-2&quot;&gt;This analysis reveals the structure and relationships within your codebase:&lt;/p&gt;
        &lt;ul class=&quot;list-unstyled mb-0&quot;&gt;
          &lt;li class=&quot;mb-2 d-flex align-items-start&quot;&gt;
            &lt;i class=&quot;fas fa-play-circle text-success me-2 mt-1&quot;&gt;&lt;/i&gt;
            &lt;div&gt;&lt;strong&gt;Entry Points&lt;/strong&gt;&lt;br&gt;&lt;small class=&quot;text-muted&quot;&gt;Main execution paths and application starting points&lt;/small&gt;&lt;/div&gt;
          &lt;/li&gt;
          &lt;li class=&quot;mb-2 d-flex align-items-start&quot;&gt;
            &lt;i class=&quot;fas fa-cubes text-primary me-2 mt-1&quot;&gt;&lt;/i&gt;
            &lt;div&gt;&lt;strong&gt;Core Components&lt;/strong&gt;&lt;br&gt;&lt;small class=&quot;text-muted&quot;&gt;Primary modules and classes that form the application backbone&lt;/small&gt;&lt;/div&gt;
          &lt;/li&gt;
          &lt;li class=&quot;mb-2 d-flex align-items-start&quot;&gt;
            &lt;i class=&quot;fas fa-project-diagram text-info me-2 mt-1&quot;&gt;&lt;/i&gt;
            &lt;div&gt;&lt;strong&gt;Data Flow&lt;/strong&gt;&lt;br&gt;&lt;small class=&quot;text-muted&quot;&gt;How data moves between components and external systems&lt;/small&gt;&lt;/div&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;div class=&quot;col-md-6&quot;&gt;
    &lt;div class=&quot;card h-100 border-0&quot;&gt;
       &lt;div class=&quot;card-header bg-success text-white border-0 d-flex align-items-center justify-content-center&quot; style=&quot;height: 60px;&quot;&gt;
         &lt;h6 class=&quot;card-title text-white&quot; style=&quot;margin: 0;&quot;&gt;
           &lt;i class=&quot;fas fa-plug me-2&quot;&gt;&lt;/i&gt;
           Integration Points
         &lt;/h6&gt;
       &lt;/div&gt;
      &lt;div class=&quot;card-body&quot;&gt;
        &lt;p class=&quot;text-muted small mb-2&quot;&gt;External connections and service integrations:&lt;/p&gt;
        &lt;ul class=&quot;list-unstyled mb-0&quot;&gt;
          &lt;li class=&quot;mb-2 d-flex align-items-start&quot;&gt;
            &lt;i class=&quot;fas fa-database text-warning me-2 mt-1&quot;&gt;&lt;/i&gt;
            &lt;div&gt;&lt;strong&gt;Database Connections&lt;/strong&gt;&lt;br&gt;&lt;small class=&quot;text-muted&quot;&gt;Database and storage system integrations&lt;/small&gt;&lt;/div&gt;
          &lt;/li&gt;
          &lt;li class=&quot;mb-2 d-flex align-items-start&quot;&gt;
            &lt;i class=&quot;fas fa-globe text-danger me-2 mt-1&quot;&gt;&lt;/i&gt;
            &lt;div&gt;&lt;strong&gt;API Connections&lt;/strong&gt;&lt;br&gt;&lt;small class=&quot;text-muted&quot;&gt;External API and web service integrations&lt;/small&gt;&lt;/div&gt;
          &lt;/li&gt;
          &lt;li class=&quot;mb-2 d-flex align-items-start&quot;&gt;
            &lt;i class=&quot;fas fa-code-branch text-secondary me-2 mt-1&quot;&gt;&lt;/i&gt;
            &lt;div&gt;&lt;strong&gt;Function Organization&lt;/strong&gt;&lt;br&gt;&lt;small class=&quot;text-muted&quot;&gt;How functionality is distributed across the codebase&lt;/small&gt;&lt;/div&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

## 📦 Key Components
&lt;div class=&quot;card border-0 mb-4&quot;&gt;
  &lt;div class=&quot;card-header bg-gradient-primary bg-dark text-white border-0 d-flex align-items-center justify-content-between&quot; style=&quot;height: 60px;&quot;&gt;
    &lt;h6 class=&quot;card-title text-white&quot; style=&quot;margin: 0;&quot;&gt;
      &lt;i class=&quot;fas fa-cube me-2&quot;&gt;&lt;/i&gt;
      Core Components (<span class="hljs-subst">${codeStructure.components.length}</span>)
    &lt;/h6&gt;
    &lt;span class=&quot;badge bg-white text-dark&quot;&gt;<span class="hljs-subst">${codeStructure.components.length}</span> modules&lt;/span&gt;
  &lt;/div&gt;
  &lt;div class=&quot;card-body p-0&quot;&gt;
    &lt;div class=&quot;table-responsive&quot;&gt;
      &lt;table class=&quot;table table-hover mb-0&quot;&gt;
        &lt;thead class=&quot;table-light&quot;&gt;
          &lt;tr&gt;
            &lt;th class=&quot;border-0 fw-semibold&quot;&gt;Component&lt;/th&gt;
            &lt;th class=&quot;border-0 fw-semibold text-center&quot;&gt;Type&lt;/th&gt;
            &lt;th class=&quot;border-0 fw-semibold text-center&quot;&gt;Functions&lt;/th&gt;
            &lt;th class=&quot;border-0 fw-semibold text-center&quot;&gt;Dependencies&lt;/th&gt;
          &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
          <span class="hljs-subst">${codeStructure.components.map((comp, index) =&gt; {
        <span class="hljs-keyword">const</span> funcCount = comp.functions ? comp.functions.length : <span class="hljs-number">0</span>;
        <span class="hljs-keyword">const</span> internalDepsCount = comp.internalDependencies ? comp.internalDependencies.length : <span class="hljs-number">0</span>;
        <span class="hljs-keyword">const</span> externalDepsCount = comp.externalDependencies ? comp.externalDependencies.length : <span class="hljs-number">0</span>;

        <span class="hljs-keyword">let</span> typeIcon = <span class="hljs-string">&#x27;fas fa-cube&#x27;</span>;
        <span class="hljs-keyword">let</span> typeColor = <span class="hljs-string">&#x27;text-primary&#x27;</span>;
        <span class="hljs-keyword">if</span> (comp.type.includes(<span class="hljs-string">&#x27;Service&#x27;</span>)) {
          typeIcon = <span class="hljs-string">&#x27;fas fa-server&#x27;</span>;
          typeColor = <span class="hljs-string">&#x27;text-success&#x27;</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (comp.type.includes(<span class="hljs-string">&#x27;Utility&#x27;</span>)) {
          typeIcon = <span class="hljs-string">&#x27;fas fa-tools&#x27;</span>;
          typeColor = <span class="hljs-string">&#x27;text-info&#x27;</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (comp.type.includes(<span class="hljs-string">&#x27;Main&#x27;</span>) || comp.type.includes(<span class="hljs-string">&#x27;Entry&#x27;</span>)) {
          typeIcon = <span class="hljs-string">&#x27;fas fa-play-circle&#x27;</span>;
          typeColor = <span class="hljs-string">&#x27;text-warning&#x27;</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-string">`
          &lt;tr&gt;
            &lt;td class=&quot;fw-semibold&quot;&gt;
              &lt;i class=&quot;<span class="hljs-subst">${typeIcon}</span> <span class="hljs-subst">${typeColor}</span> me-2&quot;&gt;&lt;/i&gt;
              <span class="hljs-subst">${comp.name}</span>
            &lt;/td&gt;
            &lt;td class=&quot;text-center&quot;&gt;
              &lt;span class=&quot;badge bg-light text-dark&quot;&gt;<span class="hljs-subst">${comp.type}</span>&lt;/span&gt;
            &lt;/td&gt;
            &lt;td class=&quot;text-center&quot;&gt;
              &lt;span class=&quot;badge bg-primary&quot;&gt;<span class="hljs-subst">${funcCount}</span>&lt;/span&gt;
            &lt;/td&gt;
            &lt;td class=&quot;text-center&quot;&gt;
              &lt;span class=&quot;badge bg-secondary&quot;&gt;<span class="hljs-subst">${internalDepsCount}</span> int&lt;/span&gt;
              &lt;span class=&quot;badge bg-info ms-1&quot;&gt;<span class="hljs-subst">${externalDepsCount}</span> ext&lt;/span&gt;
            &lt;/td&gt;
          &lt;/tr&gt;`</span>;
      }).join(<span class="hljs-string">&#x27;&#x27;</span>)}</span>
        &lt;/tbody&gt;
      &lt;/table&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

## 🔗 Dependency Analysis
&lt;div class=&quot;row g-3 mb-4&quot;&gt;
  &lt;div class=&quot;col-md-6&quot;&gt;
    &lt;div class=&quot;card h-100 border-0&quot;&gt;
       &lt;div class=&quot;card-header bg-warning text-white border-0 d-flex align-items-center justify-content-center&quot; style=&quot;height: 60px;&quot;&gt;
         &lt;h6 class=&quot;card-title text-white&quot; style=&quot;margin: 0;&quot;&gt;
           &lt;i class=&quot;fas fa-boxes me-2&quot;&gt;&lt;/i&gt;
           External Dependencies
         &lt;/h6&gt;
       &lt;/div&gt;
      &lt;div class=&quot;card-body&quot;&gt;
        &lt;div class=&quot;d-flex justify-content-between align-items-center mb-3&quot;&gt;
          &lt;span class=&quot;badge bg-white text-dark fs-6&quot;&gt;<span class="hljs-subst">${codeStructure.externalDependencies.length}</span> unique packages&lt;/span&gt;
        &lt;/div&gt;
        &lt;div class=&quot;dependency-tags&quot;&gt;
          <span class="hljs-subst">${codeStructure.externalDependencies
          .filter(dep =&gt; dep &amp;&amp; dep.trim())
          .map(dep =&gt; <span class="hljs-string">`&lt;span class=&quot;badge bg-light text-dark me-1 mb-1&quot;&gt;&lt;code class=&quot;text-muted&quot;&gt;<span class="hljs-subst">${dep.replace(/[&lt;&gt;&amp;]/g, <span class="hljs-string">&#x27;&#x27;</span>)}</span>&lt;/code&gt;&lt;/span&gt;`</span>)
          .join(<span class="hljs-string">&#x27;&#x27;</span>)}</span>
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;div class=&quot;col-md-6&quot;&gt;
    &lt;div class=&quot;card h-100 border-0&quot;&gt;
       &lt;div class=&quot;card-header bg-info text-white border-0 d-flex align-items-center justify-content-center&quot; style=&quot;height: 60px;&quot;&gt;
         &lt;h6 class=&quot;card-title text-white&quot; style=&quot;margin: 0;&quot;&gt;
           &lt;i class=&quot;fas fa-link me-2&quot;&gt;&lt;/i&gt;
           Internal Dependencies
         &lt;/h6&gt;
       &lt;/div&gt;
      &lt;div class=&quot;card-body&quot;&gt;
        <span class="hljs-subst">${codeStructure.internalDependencies.length &gt; <span class="hljs-number">0</span>
          ? <span class="hljs-string">`&lt;div class=&quot;d-flex justify-content-between align-items-center mb-3&quot;&gt;
               &lt;span class=&quot;badge bg-white text-dark fs-6&quot;&gt;<span class="hljs-subst">${codeStructure.internalDependencies.length}</span> internal links&lt;/span&gt;
             &lt;/div&gt;
             &lt;div class=&quot;dependency-tags&quot;&gt;
               <span class="hljs-subst">${codeStructure.internalDependencies
            .filter(dep =&gt; dep &amp;&amp; dep.trim())
            .map(dep =&gt; <span class="hljs-string">`&lt;span class=&quot;badge bg-light text-dark me-1 mb-1&quot;&gt;&lt;code class=&quot;text-muted&quot;&gt;<span class="hljs-subst">${dep.replace(/[&lt;&gt;&amp;]/g, <span class="hljs-string">&#x27;&#x27;</span>)}</span>&lt;/code&gt;&lt;/span&gt;`</span>)
            .join(<span class="hljs-string">&#x27;&#x27;</span>)}</span>
             &lt;/div&gt;`</span>
          : <span class="hljs-string">`&lt;div class=&quot;text-center py-4&quot;&gt;
               &lt;i class=&quot;fas fa-unlink text-muted fs-1 mb-3&quot;&gt;&lt;/i&gt;
               &lt;p class=&quot;text-muted mb-0&quot;&gt;No internal dependencies detected&lt;/p&gt;
               &lt;small class=&quot;text-muted&quot;&gt;All components are self-contained&lt;/small&gt;
             &lt;/div&gt;`</span>
        }</span>
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

## 📊 Architecture Metrics
&lt;div class=&quot;card border-0 mb-4&quot;&gt;
   &lt;div class=&quot;card-header bg-primary text-white border-0 d-flex align-items-center justify-content-center&quot; style=&quot;height: 60px;&quot;&gt;
     &lt;h6 class=&quot;card-title text-white&quot; style=&quot;margin: 0;&quot;&gt;
       &lt;i class=&quot;fas fa-chart-bar me-2&quot;&gt;&lt;/i&gt;
       System Metrics
     &lt;/h6&gt;
   &lt;/div&gt;
  &lt;div class=&quot;card-body&quot;&gt;
    &lt;div class=&quot;row g-3&quot;&gt;
      &lt;div class=&quot;col-md-3 col-sm-6&quot;&gt;
        &lt;div class=&quot;text-center&quot;&gt;
          &lt;div class=&quot;fs-2 fw-bold text-primary&quot;&gt;<span class="hljs-subst">${codeStructure.entryPoints.length}</span>&lt;/div&gt;
          &lt;div class=&quot;text-muted small&quot;&gt;Entry Points&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class=&quot;col-md-3 col-sm-6&quot;&gt;
        &lt;div class=&quot;text-center&quot;&gt;
          &lt;div class=&quot;fs-2 fw-bold text-success&quot;&gt;<span class="hljs-subst">${codeStructure.databaseConnections.length}</span>&lt;/div&gt;
          &lt;div class=&quot;text-muted small&quot;&gt;Database Connections&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class=&quot;col-md-3 col-sm-6&quot;&gt;
        &lt;div class=&quot;text-center&quot;&gt;
          &lt;div class=&quot;fs-2 fw-bold text-danger&quot;&gt;<span class="hljs-subst">${codeStructure.apiConnections.length}</span>&lt;/div&gt;
          &lt;div class=&quot;text-muted small&quot;&gt;API Connections&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class=&quot;col-md-3 col-sm-6&quot;&gt;
        &lt;div class=&quot;text-center&quot;&gt;
          &lt;div class=&quot;fs-2 fw-bold text-info&quot;&gt;<span class="hljs-subst">${codeStructure.components.reduce((sum, comp) =&gt; sum + (comp.functions ? comp.functions.length : <span class="hljs-number">0</span>), <span class="hljs-number">0</span>)}</span>&lt;/div&gt;
          &lt;div class=&quot;text-muted small&quot;&gt;Total Functions&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

## 🎨 Visual Architecture
&lt;div class=&quot;card border-0&quot;&gt;
  &lt;div class=&quot;card-header bg-dark text-white border-0 d-flex align-items-center justify-content-center&quot; style=&quot;height: 60px;&quot;&gt;
    &lt;h6 class=&quot;card-title text-white&quot; style=&quot;margin: 0;&quot;&gt;
      &lt;i class=&quot;fas fa-project-diagram me-2&quot;&gt;&lt;/i&gt;
      Interactive Flowchart
    &lt;/h6&gt;
  &lt;/div&gt;
  &lt;div class=&quot;card-body&quot;&gt;
    &lt;div class=&quot;alert alert-light border-0 mb-3&quot;&gt;
      &lt;i class=&quot;fas fa-mouse-pointer text-primary me-2&quot;&gt;&lt;/i&gt;
      &lt;strong&gt;Interactive Features:&lt;/strong&gt; Click and drag to pan, scroll to zoom, use controls for fullscreen and reset view.
    &lt;/div&gt;

\`\`\`mermaid
<span class="hljs-subst">${flowchartLines.join(<span class="hljs-string">&#x27;\n&#x27;</span>)}</span>\`\`\`

  &lt;/div&gt;
&lt;/div&gt;

&lt;div class=&quot;text-center text-muted mt-3&quot;&gt;
  &lt;small&gt;&lt;i class=&quot;fas fa-info-circle me-1&quot;&gt;&lt;/i&gt;This flowchart shows the actual architecture and data flow of your project.&lt;/small&gt;
&lt;/div&gt;`</span>;

      <span class="hljs-comment">// Return the result</span>
      <span class="hljs-keyword">const</span> finalFlowchart = flowchartLines.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;\n&#x27;</span>);
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">relativePath</span>: <span class="hljs-string">&#x27;Project Flowchart&#x27;</span>,
        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;project-flowchart&#x27;</span>,
        <span class="hljs-attr">language</span>: <span class="hljs-string">&#x27;flowchart&#x27;</span>,
        <span class="hljs-attr">content</span>: finalFlowchart, <span class="hljs-comment">// Include the raw content for analysis</span>
        <span class="hljs-attr">explanation</span>: explanation,
        <span class="hljs-attr">flowchart</span>: finalFlowchart
      };
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Error generating flowchart:&#x27;</span>, error.<span class="hljs-property">message</span>);
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">relativePath</span>: <span class="hljs-string">&#x27;Project Flowchart&#x27;</span>,
        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;project-flowchart&#x27;</span>,
        <span class="hljs-attr">language</span>: <span class="hljs-string">&#x27;flowchart&#x27;</span>,
        <span class="hljs-attr">explanation</span>: <span class="hljs-string">&#x27;Error generating flowchart. Please check the code structure.&#x27;</span>,
        <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span>
      };
    }
  }

  <span class="hljs-comment">/**
   * Analyze code structure to understand project relationships
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array</span>} <span class="hljs-variable">analysis</span> - Array of analyzed files with their content and metadata
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object</span>} Structure containing components, dependencies, and relationships
   */</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">analyzeCodeStructure</span>(<span class="hljs-params">analysis</span>) {
    <span class="hljs-keyword">const</span> structure = {
      <span class="hljs-attr">language</span>: <span class="hljs-string">&#x27;Unknown&#x27;</span>,
      <span class="hljs-attr">components</span>: [],
      <span class="hljs-attr">entryPoints</span>: [],
      <span class="hljs-attr">databaseConnections</span>: [],
      <span class="hljs-attr">apiConnections</span>: [],
      <span class="hljs-attr">externalDependencies</span>: [],
      <span class="hljs-attr">internalDependencies</span>: []
    };

    <span class="hljs-comment">// Determine primary language</span>
    <span class="hljs-keyword">const</span> langCount = {};
    analysis.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> lang = file.<span class="hljs-property">language</span> || <span class="hljs-string">&#x27;unknown&#x27;</span>;
      langCount[lang] = (langCount[lang] || <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>;
    });
    structure.<span class="hljs-property">language</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(langCount).<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> langCount[a] &gt; langCount[b] ? a : b);

    <span class="hljs-comment">// Collect all component names for internal dependency detection</span>
    <span class="hljs-keyword">const</span> componentNames = analysis.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span>
      path.<span class="hljs-title function_">basename</span>(file.<span class="hljs-property">relativePath</span>, path.<span class="hljs-title function_">extname</span>(file.<span class="hljs-property">relativePath</span>))
    );

    <span class="hljs-comment">// Analyze each file for components and relationships</span>
    analysis.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">file, index</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> content = file.<span class="hljs-property">content</span>;
      <span class="hljs-keyword">const</span> fileName = path.<span class="hljs-title function_">basename</span>(file.<span class="hljs-property">relativePath</span>, path.<span class="hljs-title function_">extname</span>(file.<span class="hljs-property">relativePath</span>));

      <span class="hljs-comment">// Extract all dependencies</span>
      <span class="hljs-keyword">const</span> allDependencies = <span class="hljs-title class_">FlowchartGenerator</span>.<span class="hljs-title function_">extractDependencies</span>(content);

      <span class="hljs-comment">// Categorize dependencies as internal or external</span>
      <span class="hljs-keyword">const</span> internalDeps = [];
      <span class="hljs-keyword">const</span> externalDeps = [];

      allDependencies.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">dep</span> =&gt;</span> {
        <span class="hljs-comment">// Check if dependency matches any component name (internal)</span>
        <span class="hljs-keyword">if</span> (componentNames.<span class="hljs-title function_">includes</span>(dep)) {
          internalDeps.<span class="hljs-title function_">push</span>(dep);
        } <span class="hljs-keyword">else</span> {
          externalDeps.<span class="hljs-title function_">push</span>(dep);
        }
      });

      <span class="hljs-comment">// Detect components based on file patterns and content</span>
      <span class="hljs-keyword">const</span> component = {
        <span class="hljs-attr">name</span>: fileName,
        <span class="hljs-attr">type</span>: <span class="hljs-title class_">FlowchartGenerator</span>.<span class="hljs-title function_">detectComponentType</span>(file, content),
        <span class="hljs-attr">functions</span>: <span class="hljs-title class_">FlowchartGenerator</span>.<span class="hljs-title function_">extractFunctions</span>(content),
        <span class="hljs-attr">dependencies</span>: allDependencies,
        <span class="hljs-attr">internalDependencies</span>: internalDeps,
        <span class="hljs-attr">externalDependencies</span>: externalDeps,
        <span class="hljs-attr">databases</span>: <span class="hljs-title class_">FlowchartGenerator</span>.<span class="hljs-title function_">extractDatabases</span>(content),
        <span class="hljs-attr">apis</span>: <span class="hljs-title class_">FlowchartGenerator</span>.<span class="hljs-title function_">extractAPIs</span>(content)
      };

      structure.<span class="hljs-property">components</span>.<span class="hljs-title function_">push</span>(component);

      <span class="hljs-comment">// Detect entry points</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">FlowchartGenerator</span>.<span class="hljs-title function_">isEntryPoint</span>(file, content)) {
        structure.<span class="hljs-property">entryPoints</span>.<span class="hljs-title function_">push</span>({
          <span class="hljs-attr">name</span>: fileName,
          <span class="hljs-attr">file</span>: file.<span class="hljs-property">relativePath</span>
        });
      }

      <span class="hljs-comment">// Detect database connections</span>
      <span class="hljs-keyword">const</span> dbConnections = <span class="hljs-title class_">FlowchartGenerator</span>.<span class="hljs-title function_">extractDatabaseConnections</span>(content);
      dbConnections.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">db</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (!structure.<span class="hljs-property">databaseConnections</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">existing</span> =&gt;</span> existing.<span class="hljs-property">name</span> === db.<span class="hljs-property">name</span>)) {
          structure.<span class="hljs-property">databaseConnections</span>.<span class="hljs-title function_">push</span>(db);
        }
      });

      <span class="hljs-comment">// Detect API connections</span>
      <span class="hljs-keyword">const</span> apiConnections = <span class="hljs-title class_">FlowchartGenerator</span>.<span class="hljs-title function_">extractAPIConnections</span>(content);
      apiConnections.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">api</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (!structure.<span class="hljs-property">apiConnections</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">existing</span> =&gt;</span> existing.<span class="hljs-property">name</span> === api.<span class="hljs-property">name</span>)) {
          structure.<span class="hljs-property">apiConnections</span>.<span class="hljs-title function_">push</span>(api);
        }
      });

      <span class="hljs-comment">// Collect all external dependencies for overview</span>
      externalDeps.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">dep</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (!structure.<span class="hljs-property">externalDependencies</span>.<span class="hljs-title function_">includes</span>(dep)) {
          structure.<span class="hljs-property">externalDependencies</span>.<span class="hljs-title function_">push</span>(dep);
        }
      });

      <span class="hljs-comment">// Collect all internal dependencies for overview</span>
      internalDeps.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">dep</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (!structure.<span class="hljs-property">internalDependencies</span>.<span class="hljs-title function_">includes</span>(dep)) {
          structure.<span class="hljs-property">internalDependencies</span>.<span class="hljs-title function_">push</span>(dep);
        }
      });
    });

    <span class="hljs-keyword">return</span> structure;
  }

  <span class="hljs-comment">/**
   * Get the appropriate node shape for a component type
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">componentType</span> - The type of component
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">[string, string]</span>} Tuple containing start and end shape markers
   */</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getNodeShape</span>(<span class="hljs-params">componentType</span>) {
    <span class="hljs-keyword">if</span> (componentType.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;Main&#x27;</span>) || componentType.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;Entry&#x27;</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">FlowchartGenerator</span>.<span class="hljs-property">NODE_SHAPES</span>.<span class="hljs-property">ENTRY</span>;
    }
    <span class="hljs-keyword">if</span> (componentType.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;Config&#x27;</span>) || componentType.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;Setting&#x27;</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">FlowchartGenerator</span>.<span class="hljs-property">NODE_SHAPES</span>.<span class="hljs-property">CONFIG</span>;
    }
    <span class="hljs-keyword">if</span> (componentType.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;Service&#x27;</span>) || componentType.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;Processor&#x27;</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">FlowchartGenerator</span>.<span class="hljs-property">NODE_SHAPES</span>.<span class="hljs-property">SERVICE</span>;
    }
    <span class="hljs-keyword">if</span> (componentType.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;Model&#x27;</span>) || componentType.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;Data&#x27;</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">FlowchartGenerator</span>.<span class="hljs-property">NODE_SHAPES</span>.<span class="hljs-property">MODEL</span>;
    }
    <span class="hljs-keyword">if</span> (componentType.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;Util&#x27;</span>) || componentType.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;Helper&#x27;</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">FlowchartGenerator</span>.<span class="hljs-property">NODE_SHAPES</span>.<span class="hljs-property">UTILITY</span>;
    }
    <span class="hljs-keyword">if</span> (componentType.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;Test&#x27;</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">FlowchartGenerator</span>.<span class="hljs-property">NODE_SHAPES</span>.<span class="hljs-property">TEST</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">FlowchartGenerator</span>.<span class="hljs-property">NODE_SHAPES</span>.<span class="hljs-property">DEFAULT</span>;
  }

  <span class="hljs-comment">// Language-agnostic component type detection based on filename patterns</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">detectComponentType</span>(<span class="hljs-params">file, content</span>) {
    <span class="hljs-keyword">const</span> fileName = path.<span class="hljs-title function_">basename</span>(file.<span class="hljs-property">relativePath</span>).<span class="hljs-title function_">toLowerCase</span>();

    <span class="hljs-comment">// Generic filename-based detection (works for any language)</span>
    <span class="hljs-keyword">if</span> (fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;controller&#x27;</span>) || fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;handler&#x27;</span>) || fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;route&#x27;</span>)) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Controller&#x27;</span>;
    <span class="hljs-keyword">if</span> (fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;service&#x27;</span>) || fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;manager&#x27;</span>) || fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;provider&#x27;</span>)) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Service&#x27;</span>;
    <span class="hljs-keyword">if</span> (fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;model&#x27;</span>) || fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;entity&#x27;</span>) || fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;schema&#x27;</span>)) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Model&#x27;</span>;
    <span class="hljs-keyword">if</span> (fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;config&#x27;</span>) || fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;settings&#x27;</span>) || fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;conf&#x27;</span>)) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Configuration&#x27;</span>;
    <span class="hljs-keyword">if</span> (fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;util&#x27;</span>) || fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;helper&#x27;</span>) || fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;utils&#x27;</span>)) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Utility&#x27;</span>;
    <span class="hljs-keyword">if</span> (fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;main&#x27;</span>) || fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;app&#x27;</span>) || fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;index&#x27;</span>) || fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;program&#x27;</span>)) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Main&#x27;</span>;
    <span class="hljs-keyword">if</span> (fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;test&#x27;</span>) || fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;spec&#x27;</span>)) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Test&#x27;</span>;

    <span class="hljs-comment">// Generic content-based detection (language-agnostic patterns)</span>
    <span class="hljs-keyword">if</span> (content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;class &#x27;</span>) || content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;Class &#x27;</span>) || content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;struct &#x27;</span>)) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Class&#x27;</span>;
    <span class="hljs-keyword">if</span> (content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;function &#x27;</span>) || content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;def &#x27;</span>) || content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;func &#x27;</span>)) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Function&#x27;</span>;
    <span class="hljs-keyword">if</span> (content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;interface &#x27;</span>) || content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;protocol &#x27;</span>)) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Interface&#x27;</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Component&#x27;</span>;
  }

  <span class="hljs-comment">/**
   * Extract function declarations from code content
   * Supports multiple languages and function declaration styles
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">content</span> - Source code content to analyze
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Array&lt;Object&gt;</span>} Array of functions with name and type
   */</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">extractFunctions</span>(<span class="hljs-params">content</span>) {
    <span class="hljs-keyword">const</span> functions = [];

    <span class="hljs-comment">// Generic function patterns that work across languages</span>
    <span class="hljs-keyword">const</span> patterns = [
      <span class="hljs-comment">// Standard function definitions</span>
      <span class="hljs-regexp">/\b(?:function|def|func|fn|method|sub)\s+([a-zA-Z_][a-zA-Z0-9_]*)\s*\(/gi</span>,
      <span class="hljs-comment">// Arrow functions and lambdas</span>
      <span class="hljs-regexp">/\b(?:const|let|var|val|var)\s+([a-zA-Z_][a-zA-Z0-9_]*)\s*[:=]\s*(?:\([^)]*\)\s*=&gt;|\([^)]*\)\s*-&gt;|function\s*\()/gi</span>,
      <span class="hljs-comment">// Class methods</span>
      <span class="hljs-regexp">/(?:public|private|protected|static)?\s*(?:function|def|func|fn|method|sub)\s+([a-zA-Z_][a-zA-Z0-9_]*)\s*\(/gi</span>,
      <span class="hljs-comment">// Property methods</span>
      <span class="hljs-regexp">/([a-zA-Z_][a-zA-Z0-9_]*)\s*\([^)]*\)\s*\{/gi</span>
    ];

    patterns.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">pattern</span> =&gt;</span> {
      <span class="hljs-keyword">let</span> match;
      <span class="hljs-keyword">while</span> ((match = pattern.<span class="hljs-title function_">exec</span>(content)) !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">const</span> funcName = match[<span class="hljs-number">1</span>];
        <span class="hljs-keyword">if</span> (funcName &amp;&amp;
          !functions.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-property">name</span> === funcName) &amp;&amp;
          funcName.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span> &amp;&amp;
          ![<span class="hljs-string">&#x27;if&#x27;</span>, <span class="hljs-string">&#x27;for&#x27;</span>, <span class="hljs-string">&#x27;while&#x27;</span>, <span class="hljs-string">&#x27;switch&#x27;</span>, <span class="hljs-string">&#x27;try&#x27;</span>, <span class="hljs-string">&#x27;catch&#x27;</span>, <span class="hljs-string">&#x27;finally&#x27;</span>, <span class="hljs-string">&#x27;function&#x27;</span>, <span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;constructor&#x27;</span>, <span class="hljs-string">&#x27;main&#x27;</span>].<span class="hljs-title function_">includes</span>(funcName.<span class="hljs-title function_">toLowerCase</span>()) &amp;&amp;
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isSafeFunctionName</span>(funcName)) {
          functions.<span class="hljs-title function_">push</span>({
            <span class="hljs-attr">name</span>: funcName,
            <span class="hljs-attr">type</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">inferFunctionType</span>(funcName, content)
          });
        }
      }
    });

    <span class="hljs-keyword">return</span> functions.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-title class_">FlowchartGenerator</span>.<span class="hljs-property">MAX_FUNCTIONS_TOTAL</span>); <span class="hljs-comment">// Limit to maximum functions per file</span>
  }

  <span class="hljs-comment">// Infer function type based on context and naming</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">inferFunctionType</span>(<span class="hljs-params">funcName, content</span>) {
    <span class="hljs-keyword">const</span> lowerName = funcName.<span class="hljs-title function_">toLowerCase</span>();

    <span class="hljs-comment">// Common patterns for different function types</span>
    <span class="hljs-keyword">if</span> (lowerName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;get&#x27;</span>) || lowerName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;fetch&#x27;</span>) || lowerName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;find&#x27;</span>) || lowerName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;select&#x27;</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;getter&#x27;</span>;
    }
    <span class="hljs-keyword">if</span> (lowerName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;set&#x27;</span>) || lowerName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;update&#x27;</span>) || lowerName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;save&#x27;</span>) || lowerName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;insert&#x27;</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;setter&#x27;</span>;
    }
    <span class="hljs-keyword">if</span> (lowerName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;handle&#x27;</span>) || lowerName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;process&#x27;</span>) || lowerName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;execute&#x27;</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;handler&#x27;</span>;
    }
    <span class="hljs-keyword">if</span> (lowerName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;validate&#x27;</span>) || lowerName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;check&#x27;</span>) || lowerName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;verify&#x27;</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;validator&#x27;</span>;
    }
    <span class="hljs-keyword">if</span> (lowerName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;convert&#x27;</span>) || lowerName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;transform&#x27;</span>) || lowerName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;format&#x27;</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;converter&#x27;</span>;
    }

    <span class="hljs-comment">// Check for async patterns</span>
    <span class="hljs-keyword">const</span> funcPattern = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">`\\b<span class="hljs-subst">${funcName}</span>\\b.*(?:async|await|Promise|Future|Task)`</span>, <span class="hljs-string">&#x27;i&#x27;</span>);
    <span class="hljs-keyword">if</span> (funcPattern.<span class="hljs-title function_">test</span>(content)) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;async-function&#x27;</span>;
    }

    <span class="hljs-comment">// Check for arrow function patterns</span>
    <span class="hljs-keyword">const</span> arrowPattern = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">`<span class="hljs-subst">${funcName}</span>\\s*[:=]\\s*[^=]*=&gt;`</span>, <span class="hljs-string">&#x27;i&#x27;</span>);
    <span class="hljs-keyword">if</span> (arrowPattern.<span class="hljs-title function_">test</span>(content)) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;arrow-function&#x27;</span>;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;function&#x27;</span>;
  }

  <span class="hljs-comment">/**
   * Extract dependencies from code content
   * Supports multiple languages and import/require patterns
   * Handles scoped packages and submodules appropriately
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">content</span> - Source code content to analyze
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Array&lt;string&gt;</span>} Array of dependency names
   */</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">extractDependencies</span>(<span class="hljs-params">content</span>) {
    <span class="hljs-keyword">const</span> dependencies = [];

    <span class="hljs-comment">// Generic import/include patterns that work across languages</span>
    <span class="hljs-keyword">const</span> patterns = [
      <span class="hljs-comment">// ES6/TypeScript imports</span>
      <span class="hljs-regexp">/import\s+.*?\s+from\s+[&#x27;&quot;]([^&#x27;&quot;]+)[&#x27;&quot;]/gi</span>,
      <span class="hljs-comment">// CommonJS/Node.js requires</span>
      <span class="hljs-regexp">/require\s*\(\s*[&#x27;&quot;]([^&#x27;&quot;]+)[&#x27;&quot;]\s*\)/gi</span>,
      <span class="hljs-comment">// Python imports</span>
      <span class="hljs-regexp">/(?:from\s+([^\s]+)\s+import|import\s+([^\s]+))/gi</span>,
      <span class="hljs-comment">// PHP includes/requires</span>
      <span class="hljs-regexp">/(?:include|require|include_once|require_once)\s*\(\s*[&#x27;&quot;]([^&#x27;&quot;]+)[&#x27;&quot;]\s*\)/gi</span>,
      <span class="hljs-comment">// C/C++/C# includes</span>
      <span class="hljs-regexp">/#include\s+[&lt;&quot;]([^&gt;&quot;]+)[&gt;&quot;]/gi</span>,
      <span class="hljs-comment">// Java imports</span>
      <span class="hljs-regexp">/import\s+([^\s;]+)/gi</span>,
      <span class="hljs-comment">// Ruby requires</span>
      <span class="hljs-regexp">/require\s*\(\s*[&#x27;&quot;]([^&#x27;&quot;]+)[&#x27;&quot;]\s*\)|require\s+[&#x27;&quot;]([^&#x27;&quot;]+)[&#x27;&quot;]/gi</span>,
      <span class="hljs-comment">// Go imports</span>
      <span class="hljs-regexp">/import\s*\(\s*[\s\S]*?&quot;([^&quot;]+)&quot;[\s\S]*?\s*\)|import\s+&quot;([^&quot;]+)&quot;/gi</span>,
      <span class="hljs-comment">// Rust use statements</span>
      <span class="hljs-regexp">/use\s+([^;]+)/gi</span>
    ];

    patterns.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">pattern</span> =&gt;</span> {
      <span class="hljs-keyword">let</span> match;
      <span class="hljs-keyword">while</span> ((match = pattern.<span class="hljs-title function_">exec</span>(content)) !== <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// Extract the dependency name (first non-empty capture group)</span>
        <span class="hljs-keyword">const</span> dep = match.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">group</span> =&gt;</span> group &amp;&amp; group.<span class="hljs-title function_">trim</span>());
        <span class="hljs-keyword">if</span> (dep &amp;&amp; !dep.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&#x27;.&#x27;</span>) &amp;&amp; !dependencies.<span class="hljs-title function_">includes</span>(dep)) {
          <span class="hljs-comment">// Keep scoped packages and submodules intact, only clean if needed</span>
          <span class="hljs-keyword">let</span> cleanDep = dep;
          <span class="hljs-comment">// Only split on &#x27;/&#x27; if it&#x27;s not a scoped package</span>
          <span class="hljs-keyword">if</span> (!dep.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&#x27;@&#x27;</span>)) {
            cleanDep = dep.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;/&#x27;</span>)[<span class="hljs-number">0</span>];
          }

          <span class="hljs-comment">// Additional filtering to avoid false positives</span>
          <span class="hljs-keyword">if</span> (cleanDep &amp;&amp;
            !dependencies.<span class="hljs-title function_">includes</span>(cleanDep) &amp;&amp;
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isSafeDependencyName</span>(cleanDep) &amp;&amp;
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isValidPackageName</span>(cleanDep)) {
            dependencies.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sanitizeDependencyName</span>(cleanDep));
          }
        }
      }
    });

    <span class="hljs-keyword">return</span> dependencies;
  }

  <span class="hljs-comment">// Language-agnostic database pattern detection</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">extractDatabases</span>(<span class="hljs-params">content</span>) {
    <span class="hljs-keyword">const</span> databases = [];

    <span class="hljs-comment">// Common database patterns that work across languages</span>
    <span class="hljs-keyword">const</span> dbPatterns = [
      <span class="hljs-regexp">/\b(?:mysql|postgresql|postgres|mongodb|mongo|sqlite|redis|oracle|sqlserver|mssql|cassandra|couchdb|dynamodb)\b/gi</span>,
      <span class="hljs-regexp">/\b(?:database|db|pdo|mysqli|sqlite3|mongoose|prisma|typeorm|sequelize)\b/gi</span>,
      <span class="hljs-regexp">/\b(?:connection|connect|pool|client|session)\b.*?\b(?:db|database)\b/gi</span>
    ];

    dbPatterns.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">pattern</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> matches = content.<span class="hljs-title function_">match</span>(pattern);
      <span class="hljs-keyword">if</span> (matches) {
        matches.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">match</span> =&gt;</span> {
          <span class="hljs-keyword">const</span> cleanMatch = match.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\b(?:connection|connect|pool|client|session)\b.*?\b(?:db|database)\b/gi</span>, <span class="hljs-function"><span class="hljs-params">match</span> =&gt;</span> match.<span class="hljs-title function_">split</span>(<span class="hljs-regexp">/\s+/</span>)[<span class="hljs-number">0</span>]);
          <span class="hljs-keyword">if</span> (!databases.<span class="hljs-title function_">includes</span>(cleanMatch)) {
            databases.<span class="hljs-title function_">push</span>(cleanMatch);
          }
        });
      }
    });

    <span class="hljs-keyword">return</span> databases;
  }

  <span class="hljs-comment">// Language-agnostic API pattern detection</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">extractAPIs</span>(<span class="hljs-params">content</span>) {
    <span class="hljs-keyword">const</span> apis = [];

    <span class="hljs-comment">// Common API patterns that work across languages</span>
    <span class="hljs-keyword">const</span> apiPatterns = [
      <span class="hljs-regexp">/\b(?:api|rest|graphql|http|fetch|axios|request|curl|urllib|httpx)\b/gi</span>,
      <span class="hljs-regexp">/\b(?:endpoint|route|router|controller)\b/gi</span>,
      <span class="hljs-regexp">/(?:https?:\/\/[^\/\s]+|[a-zA-Z_][a-zA-Z0-9_]*\.(?:com|org|net|io|dev|api))/gi</span>
    ];

    apiPatterns.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">pattern</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> matches = content.<span class="hljs-title function_">match</span>(pattern);
      <span class="hljs-keyword">if</span> (matches) {
        matches.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">match</span> =&gt;</span> {
          <span class="hljs-keyword">if</span> (!apis.<span class="hljs-title function_">includes</span>(match.<span class="hljs-title function_">toLowerCase</span>())) {
            apis.<span class="hljs-title function_">push</span>(match.<span class="hljs-title function_">toLowerCase</span>());
          }
        });
      }
    });

    <span class="hljs-keyword">return</span> apis;
  }

  <span class="hljs-comment">// Language-agnostic entry point detection</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">isEntryPoint</span>(<span class="hljs-params">file, content</span>) {
    <span class="hljs-keyword">const</span> fileName = path.<span class="hljs-title function_">basename</span>(file.<span class="hljs-property">relativePath</span>).<span class="hljs-title function_">toLowerCase</span>();

    <span class="hljs-comment">// Generic entry point filename patterns</span>
    <span class="hljs-keyword">if</span> ([<span class="hljs-string">&#x27;index&#x27;</span>, <span class="hljs-string">&#x27;main&#x27;</span>, <span class="hljs-string">&#x27;app&#x27;</span>, <span class="hljs-string">&#x27;program&#x27;</span>, <span class="hljs-string">&#x27;start&#x27;</span>, <span class="hljs-string">&#x27;run&#x27;</span>, <span class="hljs-string">&#x27;init&#x27;</span>, <span class="hljs-string">&#x27;bootstrap&#x27;</span>].<span class="hljs-title function_">includes</span>(fileName) ||
      fileName.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&#x27;main.&#x27;</span>) || fileName.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&#x27;app.&#x27;</span>) || fileName.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&#x27;index.&#x27;</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-comment">// Generic content patterns for entry points</span>
    <span class="hljs-keyword">const</span> entryPatterns = [
      <span class="hljs-regexp">/\b(?:main|run|start|init|bootstrap)\s*\(/gi</span>,  <span class="hljs-comment">// main() function calls</span>
      <span class="hljs-regexp">/if\s+__name__\s*==\s*[&#x27;&quot;]__main__[&#x27;&quot;]/gi</span>,     <span class="hljs-comment">// Python main guard</span>
      <span class="hljs-regexp">/public\s+static\s+void\s+main/gi</span>,             <span class="hljs-comment">// Java main method</span>
      <span class="hljs-regexp">/fn\s+main\s*\(/gi</span>,                            <span class="hljs-comment">// Rust main function</span>
      <span class="hljs-regexp">/int\s+main\s*\(/gi</span>,                           <span class="hljs-comment">// C/C++ main function</span>
      <span class="hljs-regexp">/func\s+main\s*\(/gi</span>,                          <span class="hljs-comment">// Go main function</span>
      <span class="hljs-regexp">/app\.listen|express\(\)/gi</span>,                   <span class="hljs-comment">// Node.js server startup</span>
      <span class="hljs-regexp">/console\.log.*start|server.*start/gi</span>          <span class="hljs-comment">// Generic startup logging</span>
    ];

    <span class="hljs-keyword">return</span> entryPatterns.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">pattern</span> =&gt;</span> pattern.<span class="hljs-title function_">test</span>(content));
  }

  <span class="hljs-comment">// Language-agnostic database connection extraction (with security filtering)</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">extractDatabaseConnections</span>(<span class="hljs-params">content</span>) {
    <span class="hljs-keyword">const</span> connections = [];

    <span class="hljs-comment">// Generic database connection patterns - very specific to avoid false matches</span>
    <span class="hljs-keyword">const</span> dbConnectionPatterns = [
      <span class="hljs-regexp">/(?:host|server|hostname)=([^&amp;\s;,]{5,})/gi</span>,  <span class="hljs-comment">// At least 5 characters</span>
      <span class="hljs-regexp">/(?:database|db|dbname)=([^&amp;\s;,]{5,})/gi</span>,    <span class="hljs-comment">// At least 5 characters</span>
      <span class="hljs-regexp">/(?:mysql|postgresql|mongodb|sqlite|redis):\/\/([^\/\s]{5,})/gi</span>,  <span class="hljs-comment">// At least 5 characters</span>
      <span class="hljs-regexp">/(?:connection|connect).*?(?:to|@)\s*([^;\s]{5,})/gi</span>  <span class="hljs-comment">// At least 5 characters</span>
    ];

    dbConnectionPatterns.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">pattern</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> matches = content.<span class="hljs-title function_">match</span>(pattern);
      <span class="hljs-keyword">if</span> (matches) {
        matches.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">match</span> =&gt;</span> {
          <span class="hljs-keyword">const</span> connection = match[<span class="hljs-number">1</span>] || match[<span class="hljs-number">0</span>];
          <span class="hljs-keyword">if</span> (connection &amp;&amp; !connections.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.<span class="hljs-property">name</span> === connection) &amp;&amp;
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isSafeConnectionString</span>(connection)) {
            connections.<span class="hljs-title function_">push</span>({
              <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;Database&#x27;</span>,
              <span class="hljs-attr">name</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sanitizeConnectionString</span>(connection)
            });
          }
        });
      }
    });

    <span class="hljs-keyword">return</span> connections;
  }

  <span class="hljs-comment">// Language-agnostic API connection extraction (with security filtering)</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">extractAPIConnections</span>(<span class="hljs-params">content</span>) {
    <span class="hljs-keyword">const</span> connections = [];

    <span class="hljs-comment">// Generic API connection patterns - very specific to avoid false matches</span>
    <span class="hljs-keyword">const</span> apiPatterns = [
      <span class="hljs-regexp">/(?:https?:\/\/[^\/\s]{8,})/gi</span>,  <span class="hljs-comment">// At least 8 characters for full URLs</span>
      <span class="hljs-regexp">/(?:api|service|endpoint)[-_]?url[\s]*[=:][\s]*[&#x27;&quot;]([^&#x27;&quot;]{8,})[&#x27;&quot;]/gi</span>,     <span class="hljs-comment">// At least 8 characters</span>
      <span class="hljs-regexp">/(?:base|api)[-_]?url[\s]*[=:][\s]*[&#x27;&quot;]([^&#x27;&quot;]{8,})[&#x27;&quot;]/gi</span>                  <span class="hljs-comment">// At least 8 characters</span>
    ];

    apiPatterns.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">pattern</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> matches = content.<span class="hljs-title function_">match</span>(pattern);
      <span class="hljs-keyword">if</span> (matches) {
        matches.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">match</span> =&gt;</span> {
          <span class="hljs-keyword">const</span> api = match[<span class="hljs-number">1</span>] || match[<span class="hljs-number">0</span>];
          <span class="hljs-keyword">if</span> (!connections.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.<span class="hljs-property">name</span> === api) &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isSafeAPIEndpoint</span>(api)) {
            connections.<span class="hljs-title function_">push</span>({
              <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;API&#x27;</span>,
              <span class="hljs-attr">name</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sanitizeAPIEndpoint</span>(api)
            });
          }
        });
      }
    });

    <span class="hljs-keyword">return</span> connections;
  }

  <span class="hljs-comment">/**
   * Security filtering methods to prevent exposure of sensitive information
   * These methods ensure no sensitive data is exposed in the flowchart or explanation
   */</span>

  <span class="hljs-comment">/**
   * Check if a connection string is safe to display
   * Filters out sensitive information like passwords, tokens, and internal URLs
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">connection</span> - Connection string to validate
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">boolean</span>} True if the connection string is safe to display
   */</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">isSafeConnectionString</span>(<span class="hljs-params">connection</span>) {
    <span class="hljs-keyword">const</span> sensitivePatterns = [
      <span class="hljs-regexp">/\b(?:password|pwd|pass|secret|key|token|auth|credential)\b/i</span>,
      <span class="hljs-regexp">/\b(?:admin|root|superuser)\b/i</span>,
      <span class="hljs-regexp">/\b\d{3,}\b/</span>, <span class="hljs-comment">// Avoid IP addresses or long numbers that might be sensitive</span>
      <span class="hljs-regexp">/[a-zA-Z0-9]{32,}/</span>, <span class="hljs-comment">// Long alphanumeric strings (potential keys)</span>
      <span class="hljs-regexp">/localhost|127\.0\.0\.1|0\.0\.0\.0/</span>, <span class="hljs-comment">// Local development connections</span>
      <span class="hljs-regexp">/\.local\b|\.internal\b/</span>, <span class="hljs-comment">// Internal domains</span>
    ];

    <span class="hljs-keyword">return</span> !sensitivePatterns.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">pattern</span> =&gt;</span> pattern.<span class="hljs-title function_">test</span>(connection));
  }

  <span class="hljs-comment">// Sanitize connection strings for safe display</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">sanitizeConnectionString</span>(<span class="hljs-params">connection</span>) {
    <span class="hljs-comment">// Replace sensitive parts with placeholders</span>
    <span class="hljs-keyword">let</span> sanitized = connection
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\bpassword\s*=\s*[^&amp;\s,]*/gi</span>, <span class="hljs-string">&#x27;password=***&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\bsecret\s*=\s*[^&amp;\s,]*/gi</span>, <span class="hljs-string">&#x27;secret=***&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\bkey\s*=\s*[^&amp;\s,]*/gi</span>, <span class="hljs-string">&#x27;key=***&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\btoken\s*=\s*[^&amp;\s,]*/gi</span>, <span class="hljs-string">&#x27;token=***&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\bauth\s*=\s*[^&amp;\s,]*/gi</span>, <span class="hljs-string">&#x27;auth=***&#x27;</span>);

    <span class="hljs-comment">// If the connection still looks sensitive, replace with a generic name</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isSafeConnectionString</span>(sanitized)) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Database Connection&#x27;</span>;
    }

    <span class="hljs-keyword">return</span> sanitized;
  }

  <span class="hljs-comment">// Check if an API endpoint is safe to display</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">isSafeAPIEndpoint</span>(<span class="hljs-params">api</span>) {
    <span class="hljs-keyword">const</span> sensitivePatterns = [
      <span class="hljs-regexp">/\b(?:secret|key|token|auth|credential|password)\b/i</span>,
      <span class="hljs-regexp">/[a-zA-Z0-9]{32,}/</span>, <span class="hljs-comment">// Long alphanumeric strings (potential keys)</span>
      <span class="hljs-regexp">/localhost|127\.0\.0\.1|0\.0\.0\.0/</span>, <span class="hljs-comment">// Local development endpoints</span>
      <span class="hljs-regexp">/\.local\b|\.internal\b/</span>, <span class="hljs-comment">// Internal domains</span>
      <span class="hljs-regexp">/\/(?:admin|superuser|root|private|secret)\b/i</span>, <span class="hljs-comment">// Sensitive paths</span>
    ];

    <span class="hljs-keyword">return</span> !sensitivePatterns.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">pattern</span> =&gt;</span> pattern.<span class="hljs-title function_">test</span>(api));
  }

  <span class="hljs-comment">// Sanitize API endpoints for safe display</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">sanitizeAPIEndpoint</span>(<span class="hljs-params">api</span>) {
    <span class="hljs-comment">// Replace sensitive parts with placeholders</span>
    <span class="hljs-keyword">let</span> sanitized = api
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\/(?:secret|key|token|auth|credential|password)[^/]*/gi</span>, <span class="hljs-string">&#x27;/***&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[?&amp;](?:secret|key|token|auth|credential|password)=[^&amp;]*/gi</span>, <span class="hljs-string">&#x27;?***=***&#x27;</span>);

    <span class="hljs-comment">// If the API still looks sensitive, replace with a generic name</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isSafeAPIEndpoint</span>(sanitized)) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;API Endpoint&#x27;</span>;
    }

    <span class="hljs-keyword">return</span> sanitized;
  }

  <span class="hljs-comment">// Filter out sensitive function names</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">isSafeFunctionName</span>(<span class="hljs-params">funcName</span>) {
    <span class="hljs-keyword">const</span> sensitivePatterns = [
      <span class="hljs-regexp">/\b(?:password|pwd|pass|secret|key|token|auth|credential|private)\b/i</span>,
      <span class="hljs-regexp">/\b(?:admin|root|superuser|sudo)\b/i</span>,
      <span class="hljs-regexp">/\b(?:encrypt|decrypt|cipher|hash)\b.*\b(?:key|secret|password)\b/i</span>,
    ];

    <span class="hljs-keyword">return</span> !sensitivePatterns.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">pattern</span> =&gt;</span> pattern.<span class="hljs-title function_">test</span>(funcName));
  }

  <span class="hljs-comment">// Filter out sensitive dependency names</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">isSafeDependencyName</span>(<span class="hljs-params">depName</span>) {
    <span class="hljs-keyword">const</span> sensitivePatterns = [
      <span class="hljs-regexp">/\b(?:secret|key|token|auth|credential|password)\b/i</span>,
      <span class="hljs-regexp">/\b(?:private|internal|confidential)\b/i</span>,
      <span class="hljs-regexp">/[a-zA-Z0-9]{32,}/</span>, <span class="hljs-comment">// Long alphanumeric strings (potential keys)</span>
    ];

    <span class="hljs-keyword">return</span> !sensitivePatterns.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">pattern</span> =&gt;</span> pattern.<span class="hljs-title function_">test</span>(depName));
  }

  <span class="hljs-comment">// Sanitize dependency names</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">sanitizeDependencyName</span>(<span class="hljs-params">depName</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isSafeDependencyName</span>(depName)) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;External Module&#x27;</span>;
    }
    <span class="hljs-keyword">return</span> depName;
  }

  <span class="hljs-comment">// Check if a string looks like a valid package/dependency name</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">isValidPackageName</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-comment">// Filter out obviously invalid package names</span>
    <span class="hljs-keyword">const</span> invalidPatterns = [
      <span class="hljs-regexp">/[&#x27;&quot;)}\];]/</span>,  <span class="hljs-comment">// Contains quotes, brackets, or semicolons (likely code snippets)</span>
      <span class="hljs-regexp">/mode with/</span>,  <span class="hljs-comment">// Contains &quot;mode with&quot; (likely from comments)</span>
      <span class="hljs-regexp">/^(?:if|else|for|while|return|const|let|var|function|class|def)$/</span>,  <span class="hljs-comment">// Exact matches for keywords only</span>
      <span class="hljs-regexp">/basename if/</span>,  <span class="hljs-comment">// Specific corrupted text patterns</span>
      <span class="hljs-regexp">/different shapes/</span>,  <span class="hljs-comment">// Specific corrupted text patterns</span>
      <span class="hljs-regexp">/parsing issues/</span>,  <span class="hljs-comment">// Specific corrupted text patterns</span>
      <span class="hljs-regexp">/\s+/</span>,  <span class="hljs-comment">// Contains spaces (invalid for package names)</span>
      <span class="hljs-regexp">/^$/</span>,  <span class="hljs-comment">// Empty string</span>
      <span class="hljs-regexp">/[&lt;&gt;|?*]/</span>,  <span class="hljs-comment">// Invalid filesystem characters</span>
      <span class="hljs-regexp">/^\.+$/</span>,  <span class="hljs-comment">// Just dots</span>
      <span class="hljs-regexp">/^.{100,}$/</span>  <span class="hljs-comment">// Extremely long (likely a code snippet)</span>
    ];

    <span class="hljs-keyword">return</span> !invalidPatterns.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">pattern</span> =&gt;</span> pattern.<span class="hljs-title function_">test</span>(name));
  }

  <span class="hljs-comment">// Sanitize component names for safe display</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">sanitizeComponentName</span>(<span class="hljs-params">componentName</span>) {
    <span class="hljs-keyword">let</span> sanitized = componentName
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&quot;/g</span>, <span class="hljs-string">&#x27;\\&quot;&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\n/g</span>, <span class="hljs-string">&#x27; &#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\b(?:secret|key|token|auth|password|credential)\b/gi</span>, <span class="hljs-string">&#x27;***&#x27;</span>);

    <span class="hljs-comment">// If the name still contains sensitive patterns, use a generic name</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/\b(?:secret|key|token|auth|password|credential)\b/gi</span>.<span class="hljs-title function_">test</span>(sanitized)) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Component&#x27;</span>;
    }

    <span class="hljs-keyword">return</span> sanitized;
  }

  <span class="hljs-comment">// Sanitize function names for safe display</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">sanitizeFunctionName</span>(<span class="hljs-params">funcName</span>) {
    <span class="hljs-keyword">let</span> sanitized = funcName
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&quot;/g</span>, <span class="hljs-string">&#x27;\\&quot;&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\n/g</span>, <span class="hljs-string">&#x27; &#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\b(?:secret|key|token|auth|password|credential)\b/gi</span>, <span class="hljs-string">&#x27;***&#x27;</span>);

    <span class="hljs-comment">// If the name still contains sensitive patterns, use a generic name</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/\b(?:secret|key|token|auth|password|credential)\b/gi</span>.<span class="hljs-title function_">test</span>(sanitized)) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;function&#x27;</span>;
    }

    <span class="hljs-keyword">return</span> sanitized;
  }
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { <span class="hljs-title class_">FlowchartGenerator</span> };</div>
                 </div>

             <div class="p-4">
                 <div class="d-flex justify-content-between align-items-center mb-3">
                     <h3 class="h6 text-muted mb-0 d-flex align-items-center">
                         <i class="fas fa-brain me-2 text-primary"></i>
                         AI Explanation
                     </h3>
                     <button class="btn btn-outline-primary btn-sm copy-explanation" data-file-index="6" title="Copy explanation">
                         <i class="fas fa-copy me-1"></i> Copy
                     </button>
                 </div>
                 <div class="explanation-content">
                     <p>Certainly! Below is a detailed explanation of the JavaScript code file <code>flowchartGenerator.js</code> written in markdown format:</p>
<hr>
<h2>Overview</h2>
<p>This JavaScript file defines a class <code>FlowchartGenerator</code>, which is used to generate flowcharts and explanations of project architecture based on code analysis. The class can analyze code, detect components, relationships, dependencies, and produce a visual summary of these elements in a flowchart form.</p>
<h3>Main Features of FlowchartGenerator</h3>
<ol>
<li><p><strong>Constants</strong>:</p>
<ul>
<li><strong>MAX_FUNCTIONS_PER_COMPONENT</strong>: Limits the number of functions displayed per component in the flowchart to 2.</li>
<li><strong>MAX_FUNCTIONS_TOTAL</strong>: Limits the total number of functions that can be extracted and analyzed to 15.</li>
<li><strong>NODE_SHAPES</strong>: Defines different shapes for nodes based on component types.</li>
</ul>
</li>
<li><p><strong>Main Method - <code>generate</code></strong>:</p>
<ul>
<li><strong>Input Parameters</strong>:<ul>
<li><code>analysis</code>: An array containing analyzed files with content and metadata.</li>
<li><code>config</code>: Additional configuration options for flowchart generation.</li>
</ul>
</li>
<li><strong>Returns</strong>: An object containing the generated flowchart, explanation, and additional metadata.</li>
<li><strong>Process</strong>:<ul>
<li>Analyzes the code structure using <code>analyzeCodeStructure</code>.</li>
<li>Creates a flowchart representation of the project, mapping out components, entry points, and their relationships.</li>
<li>Formats a description of the project’s architecture in HTML language to enhance readability.</li>
<li>Handles any errors gracefully during the flowchart generation.</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Helper Methods</strong>:</p>
<ul>
<li><strong><code>analyzeCodeStructure</code></strong>: Analyzes the provided code to identify components, entry points, database connections, API connections, and dependencies both internal and external.</li>
<li><strong><code>getNodeShape</code></strong>: Returns the flowchart node shape markers based on the component type.</li>
<li><strong><code>detectComponentType</code></strong>: Identifies the type of component based on filename patterns or content.</li>
<li><strong><code>extractFunctions</code></strong>: Extracts function declarations from the code content, supporting various languages and function declaration styles.</li>
<li><strong><code>inferFunctionType</code></strong>: Utilizes common patterns to guess a function&#39;s role (e.g., getter, setter).</li>
<li><strong><code>extractDependencies</code></strong>: Identifies dependencies within the code content based on common import/include patterns.</li>
<li>Additional methods for extracting databases, APIs, and safely filtering/displaying sensitive information.</li>
</ul>
</li>
<li><p><strong>Security Measures</strong>:</p>
<ul>
<li>Includes methods for sanitizing and selectively displaying sensitive information to avoid exposing credentials or secrets in the output flowchart or explanation.</li>
</ul>
</li>
</ol>
<h3>Security and Safety Measures</h3>
<ul>
<li><strong>Sanitization</strong>: Before including any extracted data in the flowchart, the code uses sanitization methods like <code>sanitizeComponentName</code> and <code>sanitizeFunctionName</code> to escape special characters and mask sensitive information.</li>
<li><strong>Validations</strong>: Methods like <code>isSafeConnectionString</code> and <code>isSafeAPIEndpoint</code> check and confirm that no sensitive information is included in API or database connections.</li>
</ul>
<h3>Error Handling</h3>
<p>The <code>generate</code> method includes a try-catch block to handle and log errors during the analysis and flowchart generation process, ensuring the system can gracefully handle unexpected mistakes or inconsistencies in the input data.</p>
<h3>Usage Example</h3>
<p>This class can be used in a broader tool or command-line interface that performs static analysis of a codebase, visualizing how different parts of the system interact, thus offering developers valuable insight into their project&#39;s architecture.</p>
<pre><code class="language-javascript">const { FlowchartGenerator } = require(&#39;./flowchartGenerator&#39;);

const analysis = [
  // Array of objects containing file metadata and content
];

const config = {
  // Configuration options for flowchart generation
};

const flowchartData = FlowchartGenerator.generate(analysis, config);
console.log(flowchartData);
</code></pre>
<h3>Conclusion</h3>
<p>The <code>FlowchartGenerator</code> class is a powerful utility for analyzing and visualizing complex codebases, providing both a structured text-based explanation and an interactive flowchart representation. The class is designed to be language-agnostic where possible, and emphasizes safety and ease of use by appropriately handling errors and protecting sensitive details.</p>
<hr>
<p>This explanation aims to help a beginner developer understand the primary functionalities of the code, how it is structured, and what precautions are taken to ensure a safe and effective analysis. The class effectively combines code analysis with visual representation, which can be beneficial for system documentation and understanding.</p>

                 </div>
             </div>
         </div>
     </div>
 </div>

 <div class="file-entry col-12 mb-4" id="file-7" data-file-path="D:\MyDev\CodeExplain\src\utils\constants.js" data-file-index="7">
     <div class="card shadow-sm border-0 h-100" style="border-radius: 12px; overflow: hidden;">
         <div class="card-header bg-gradient-primary text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1rem 1.5rem;">
             <div class="d-flex justify-content-between align-items-center">
                  <h2 class="toggle-code h5 fw-semibold mb-0 cursor-pointer d-flex align-items-center text-white" data-file-index="7" style="font-size: 1.1rem;">
                      <i class="fas fa-chevron-right me-2 transition-transform duration-200"></i>
                      <i class="fas fa-file-code me-2"></i>
                      utils/constants.js
                  </h2>
                 <span class="badge bg-white bg-opacity-25 text-white px-2 py-1" style="font-size: 0.75rem;">
                     javascript
                 </span>
             </div>
         </div>

               <div class="card-body p-0">
                 <div class="code-container bg-light border-bottom d-none" style="max-height: 400px; overflow: auto;" data-file-path="D:\MyDev\CodeExplain\src\utils\constants.js" data-file-language="javascript">
                     <div class="p-3 text-center text-muted">
                         <div class="spinner-border spinner-border-sm me-2" role="status" style="display: none;"></div>
                         <span class="loading-text">Click to load code</span>
                     </div>
                     <div class="code-content" style="display: none;"><span class="hljs-comment">// Explanation modes</span>
<span class="hljs-built_in">exports</span>.<span class="hljs-property">MODE_LINE_BY_LINE</span> = <span class="hljs-string">&#x27;linebyline&#x27;</span>;
<span class="hljs-built_in">exports</span>.<span class="hljs-property">MODE_FLOWCHART</span> = <span class="hljs-string">&#x27;flowchart&#x27;</span>;
<span class="hljs-built_in">exports</span>.<span class="hljs-property">MODE_EXPLAIN</span> = <span class="hljs-string">&#x27;explain&#x27;</span>;
<span class="hljs-built_in">exports</span>.<span class="hljs-property">MODE_ARCHITECTURE</span> = <span class="hljs-string">&#x27;architecture&#x27;</span>;
<span class="hljs-built_in">exports</span>.<span class="hljs-property">MODE_ARCH</span> = <span class="hljs-string">&#x27;arch&#x27;</span>;  <span class="hljs-comment">// Alias for architecture</span>
<span class="hljs-built_in">exports</span>.<span class="hljs-property">MODE_ISSUES</span> = <span class="hljs-string">&#x27;issues&#x27;</span>;
<span class="hljs-built_in">exports</span>.<span class="hljs-property">MODE_ONBOARDING</span> = <span class="hljs-string">&#x27;onboarding&#x27;</span>;

<span class="hljs-comment">// Output formats</span>
<span class="hljs-built_in">exports</span>.<span class="hljs-property">OUTPUT_PDF</span> = <span class="hljs-string">&#x27;pdf&#x27;</span>;
<span class="hljs-built_in">exports</span>.<span class="hljs-property">OUTPUT_HTML</span> = <span class="hljs-string">&#x27;html&#x27;</span>;

<span class="hljs-comment">// Default configuration values</span>
<span class="hljs-built_in">exports</span>.<span class="hljs-property">DEFAULT_RETRY_ATTEMPTS</span> = <span class="hljs-number">3</span>;
<span class="hljs-built_in">exports</span>.<span class="hljs-property">DEFAULT_CONCURRENCY</span> = <span class="hljs-number">3</span>;
<span class="hljs-built_in">exports</span>.<span class="hljs-property">MAX_CONCURRENCY</span> = <span class="hljs-number">10</span>;
<span class="hljs-built_in">exports</span>.<span class="hljs-property">MAX_FILE_SIZE_BYTES</span> = <span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>; <span class="hljs-comment">// 10MB default</span>
<span class="hljs-built_in">exports</span>.<span class="hljs-property">MAX_FILE_SIZE_MB</span> = <span class="hljs-number">10</span>;</div>
                 </div>

             <div class="p-4">
                 <div class="d-flex justify-content-between align-items-center mb-3">
                     <h3 class="h6 text-muted mb-0 d-flex align-items-center">
                         <i class="fas fa-brain me-2 text-primary"></i>
                         AI Explanation
                     </h3>
                     <button class="btn btn-outline-primary btn-sm copy-explanation" data-file-index="7" title="Copy explanation">
                         <i class="fas fa-copy me-1"></i> Copy
                     </button>
                 </div>
                 <div class="explanation-content">
                     <p>Certainly! Here&#39;s a structured explanation in markdown format for the JavaScript file you provided:</p>
<h1>Explanation of <code>constants.js</code> File</h1>
<p>This JavaScript file defines a series of constants that are used throughout an application. These constants are typically used to ensure consistency and avoid &quot;magic numbers&quot; or hardcoded values within the codebase.</p>
<h2>Constants Overview</h2>
<p>The file is organized into three main sections:</p>
<ol>
<li><strong>Explanation Modes</strong></li>
<li><strong>Output Formats</strong></li>
<li><strong>Default Configuration Values</strong></li>
</ol>
<p>Each section contains related constants.</p>
<h3>1. Explanation Modes</h3>
<p>These constants represent different modes that an application might support for explaining or visualizing code. Each constant is exported using <code>exports</code> so it can be used in other parts of the application.</p>
<ul>
<li><code>MODE_LINE_BY_LINE</code>: Represents a <code>linebyline</code> mode, likely used for explaining code one line at a time.</li>
<li><code>MODE_FLOWCHART</code>: Represents a <code>flowchart</code> mode, likely used for visualizing code flow as a flowchart.</li>
<li><code>MODE_EXPLAIN</code>: Represents an <code>explain</code> mode, possibly for a general explanation of code.</li>
<li><code>MODE_ARCHITECTURE</code>: Represents an <code>architecture</code> mode, potentially used for describing the architecture of a system.</li>
<li><code>MODE_ARCH</code>: An alias for <code>architecture</code>, allowing a shorter version of the same concept.</li>
<li><code>MODE_ISSUES</code>: Represents an <code>issues</code> mode, possibly dealing with code issues or problem analysis.</li>
<li><code>MODE_ONBOARDING</code>: Represents an <code>onboarding</code> mode, which could be used for introducing new users to the system or codebase.</li>
</ul>
<h3>2. Output Formats</h3>
<p>These constants specify various formats in which the output can be produced:</p>
<ul>
<li><code>OUTPUT_PDF</code>: Represents the <code>pdf</code> format, indicating output could be generated as a PDF document.</li>
<li><code>OUTPUT_HTML</code>: Represents the <code>html</code> format, indicating output can be generated as an HTML document or webpage.</li>
</ul>
<h3>3. Default Configuration Values</h3>
<p>These constants define default settings for the application&#39;s operation, particularly concerning retries, concurrency, and file handling:</p>
<ul>
<li><code>DEFAULT_RETRY_ATTEMPTS</code>: Set to <code>3</code>, this constant indicates the default number of times an operation should be retried upon failure.</li>
<li><code>DEFAULT_CONCURRENCY</code>: Also set to <code>3</code>, this indicates the default number of concurrent operations allowed.</li>
<li><code>MAX_CONCURRENCY</code>: Set to <code>10</code>, this is the maximum number of concurrent operations permitted.</li>
<li><code>MAX_FILE_SIZE_BYTES</code>: Set to <code>10 * 1024 * 1024</code> bytes (equivalent to 10 Megabytes), this constant limits the maximum size of files that can be processed by the application.</li>
<li><code>MAX_FILE_SIZE_MB</code>: Set to <code>10</code>, this provides the maximum file size in Megabytes for convenience.</li>
</ul>
<h2>Usage</h2>
<p>By defining these constants in a separate <code>constants.js</code> file, the codebase increases maintainability and readability. Changes to these values can be made centrally without needing to hunt through the code for scattered literals.</p>
<p>These constants can be imported into other modules and used to replace magic values, ensuring consistency and improving the code&#39;s clarity.</p>


<p>This markdown explanation gives a comprehensive overview of the constants and their purpose in the codebase, making it more accessible for beginner developers.</p>

                 </div>
             </div>
         </div>
     </div>
 </div>

 <div class="file-entry col-12 mb-4" id="file-8" data-file-path="D:\MyDev\CodeExplain\src\utils\languageMap.js" data-file-index="8">
     <div class="card shadow-sm border-0 h-100" style="border-radius: 12px; overflow: hidden;">
         <div class="card-header bg-gradient-primary text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1rem 1.5rem;">
             <div class="d-flex justify-content-between align-items-center">
                  <h2 class="toggle-code h5 fw-semibold mb-0 cursor-pointer d-flex align-items-center text-white" data-file-index="8" style="font-size: 1.1rem;">
                      <i class="fas fa-chevron-right me-2 transition-transform duration-200"></i>
                      <i class="fas fa-file-code me-2"></i>
                      utils/languageMap.js
                  </h2>
                 <span class="badge bg-white bg-opacity-25 text-white px-2 py-1" style="font-size: 0.75rem;">
                     javascript
                 </span>
             </div>
         </div>

               <div class="card-body p-0">
                 <div class="code-container bg-light border-bottom d-none" style="max-height: 400px; overflow: auto;" data-file-path="D:\MyDev\CodeExplain\src\utils\languageMap.js" data-file-language="javascript">
                     <div class="p-3 text-center text-muted">
                         <div class="spinner-border spinner-border-sm me-2" role="status" style="display: none;"></div>
                         <span class="loading-text">Click to load code</span>
                     </div>
                     <div class="code-content" style="display: none;"><span class="hljs-comment">// Map of file extensions to programming languages</span>
<span class="hljs-keyword">const</span> languageMap = {
  <span class="hljs-string">&#x27;.js&#x27;</span>: <span class="hljs-string">&#x27;javascript&#x27;</span>,
  <span class="hljs-string">&#x27;.jsx&#x27;</span>: <span class="hljs-string">&#x27;javascript&#x27;</span>,
  <span class="hljs-string">&#x27;.ts&#x27;</span>: <span class="hljs-string">&#x27;typescript&#x27;</span>,
  <span class="hljs-string">&#x27;.tsx&#x27;</span>: <span class="hljs-string">&#x27;typescript&#x27;</span>,
  <span class="hljs-string">&#x27;.vue&#x27;</span>: <span class="hljs-string">&#x27;vue&#x27;</span>,
  <span class="hljs-string">&#x27;.svelte&#x27;</span>: <span class="hljs-string">&#x27;svelte&#x27;</span>,
  <span class="hljs-string">&#x27;.astro&#x27;</span>: <span class="hljs-string">&#x27;astro&#x27;</span>,
  <span class="hljs-string">&#x27;.html&#x27;</span>: <span class="hljs-string">&#x27;html&#x27;</span>,
  <span class="hljs-string">&#x27;.htm&#x27;</span>: <span class="hljs-string">&#x27;html&#x27;</span>,
  <span class="hljs-string">&#x27;.xml&#x27;</span>: <span class="hljs-string">&#x27;xml&#x27;</span>,
  <span class="hljs-string">&#x27;.svg&#x27;</span>: <span class="hljs-string">&#x27;xml&#x27;</span>,
  <span class="hljs-string">&#x27;.css&#x27;</span>: <span class="hljs-string">&#x27;css&#x27;</span>,
  <span class="hljs-string">&#x27;.scss&#x27;</span>: <span class="hljs-string">&#x27;scss&#x27;</span>,
  <span class="hljs-string">&#x27;.sass&#x27;</span>: <span class="hljs-string">&#x27;scss&#x27;</span>,
  <span class="hljs-string">&#x27;.less&#x27;</span>: <span class="hljs-string">&#x27;less&#x27;</span>,
  <span class="hljs-string">&#x27;.php&#x27;</span>: <span class="hljs-string">&#x27;php&#x27;</span>,
  <span class="hljs-string">&#x27;.asp&#x27;</span>: <span class="hljs-string">&#x27;asp&#x27;</span>,
  <span class="hljs-string">&#x27;.jsp&#x27;</span>: <span class="hljs-string">&#x27;java&#x27;</span>,
  <span class="hljs-string">&#x27;.ejs&#x27;</span>: <span class="hljs-string">&#x27;ejs&#x27;</span>,
  <span class="hljs-string">&#x27;.hbs&#x27;</span>: <span class="hljs-string">&#x27;handlebars&#x27;</span>,
  <span class="hljs-string">&#x27;.handlebars&#x27;</span>: <span class="hljs-string">&#x27;handlebars&#x27;</span>,
  <span class="hljs-string">&#x27;.py&#x27;</span>: <span class="hljs-string">&#x27;python&#x27;</span>,
  <span class="hljs-string">&#x27;.java&#x27;</span>: <span class="hljs-string">&#x27;java&#x27;</span>,
  <span class="hljs-string">&#x27;.c&#x27;</span>: <span class="hljs-string">&#x27;c&#x27;</span>,
  <span class="hljs-string">&#x27;.cpp&#x27;</span>: <span class="hljs-string">&#x27;cpp&#x27;</span>,
  <span class="hljs-string">&#x27;.cxx&#x27;</span>: <span class="hljs-string">&#x27;cpp&#x27;</span>,
  <span class="hljs-string">&#x27;.cc&#x27;</span>: <span class="hljs-string">&#x27;cpp&#x27;</span>,
  <span class="hljs-string">&#x27;.h&#x27;</span>: <span class="hljs-string">&#x27;c&#x27;</span>,
  <span class="hljs-string">&#x27;.hpp&#x27;</span>: <span class="hljs-string">&#x27;cpp&#x27;</span>,
  <span class="hljs-string">&#x27;.cs&#x27;</span>: <span class="hljs-string">&#x27;csharp&#x27;</span>,
  <span class="hljs-string">&#x27;.vb&#x27;</span>: <span class="hljs-string">&#x27;vbnet&#x27;</span>,
  <span class="hljs-string">&#x27;.fs&#x27;</span>: <span class="hljs-string">&#x27;fsharp&#x27;</span>,
  <span class="hljs-string">&#x27;.fsx&#x27;</span>: <span class="hljs-string">&#x27;fsharp&#x27;</span>,
  <span class="hljs-string">&#x27;.go&#x27;</span>: <span class="hljs-string">&#x27;go&#x27;</span>,
  <span class="hljs-string">&#x27;.rs&#x27;</span>: <span class="hljs-string">&#x27;rust&#x27;</span>,
  <span class="hljs-string">&#x27;.swift&#x27;</span>: <span class="hljs-string">&#x27;swift&#x27;</span>,
  <span class="hljs-string">&#x27;.kt&#x27;</span>: <span class="hljs-string">&#x27;kotlin&#x27;</span>,
  <span class="hljs-string">&#x27;.scala&#x27;</span>: <span class="hljs-string">&#x27;scala&#x27;</span>,
  <span class="hljs-string">&#x27;.rb&#x27;</span>: <span class="hljs-string">&#x27;ruby&#x27;</span>,
  <span class="hljs-string">&#x27;.pl&#x27;</span>: <span class="hljs-string">&#x27;perl&#x27;</span>,
  <span class="hljs-string">&#x27;.pm&#x27;</span>: <span class="hljs-string">&#x27;perl&#x27;</span>,
  <span class="hljs-string">&#x27;.tcl&#x27;</span>: <span class="hljs-string">&#x27;tcl&#x27;</span>,
  <span class="hljs-string">&#x27;.lua&#x27;</span>: <span class="hljs-string">&#x27;lua&#x27;</span>,
  <span class="hljs-string">&#x27;.dart&#x27;</span>: <span class="hljs-string">&#x27;dart&#x27;</span>,
  <span class="hljs-string">&#x27;.r&#x27;</span>: <span class="hljs-string">&#x27;r&#x27;</span>,
  <span class="hljs-string">&#x27;.m&#x27;</span>: <span class="hljs-string">&#x27;matlab&#x27;</span>,
  <span class="hljs-string">&#x27;.matlab&#x27;</span>: <span class="hljs-string">&#x27;matlab&#x27;</span>,
  <span class="hljs-string">&#x27;.asm&#x27;</span>: <span class="hljs-string">&#x27;asm&#x27;</span>,
  <span class="hljs-string">&#x27;.s&#x27;</span>: <span class="hljs-string">&#x27;asm&#x27;</span>,
  <span class="hljs-string">&#x27;.zig&#x27;</span>: <span class="hljs-string">&#x27;zig&#x27;</span>,
  <span class="hljs-string">&#x27;.v&#x27;</span>: <span class="hljs-string">&#x27;v&#x27;</span>,
  <span class="hljs-string">&#x27;.nim&#x27;</span>: <span class="hljs-string">&#x27;nim&#x27;</span>,
  <span class="hljs-string">&#x27;.crystal&#x27;</span>: <span class="hljs-string">&#x27;crystal&#x27;</span>,
  <span class="hljs-string">&#x27;.pony&#x27;</span>: <span class="hljs-string">&#x27;pony&#x27;</span>,
  <span class="hljs-string">&#x27;.hs&#x27;</span>: <span class="hljs-string">&#x27;haskell&#x27;</span>,
  <span class="hljs-string">&#x27;.ml&#x27;</span>: <span class="hljs-string">&#x27;ocaml&#x27;</span>,
  <span class="hljs-string">&#x27;.elm&#x27;</span>: <span class="hljs-string">&#x27;elm&#x27;</span>,
  <span class="hljs-string">&#x27;.purs&#x27;</span>: <span class="hljs-string">&#x27;purescript&#x27;</span>,
  <span class="hljs-string">&#x27;.clj&#x27;</span>: <span class="hljs-string">&#x27;clojure&#x27;</span>,
  <span class="hljs-string">&#x27;.cljs&#x27;</span>: <span class="hljs-string">&#x27;clojure&#x27;</span>,
  <span class="hljs-string">&#x27;.scm&#x27;</span>: <span class="hljs-string">&#x27;scheme&#x27;</span>,
  <span class="hljs-string">&#x27;.rkt&#x27;</span>: <span class="hljs-string">&#x27;racket&#x27;</span>,
  <span class="hljs-string">&#x27;.ex&#x27;</span>: <span class="hljs-string">&#x27;elixir&#x27;</span>,
  <span class="hljs-string">&#x27;.exs&#x27;</span>: <span class="hljs-string">&#x27;elixir&#x27;</span>,
  <span class="hljs-string">&#x27;.erl&#x27;</span>: <span class="hljs-string">&#x27;erlang&#x27;</span>,
  <span class="hljs-string">&#x27;.hrl&#x27;</span>: <span class="hljs-string">&#x27;erlang&#x27;</span>,
  <span class="hljs-string">&#x27;.graphql&#x27;</span>: <span class="hljs-string">&#x27;graphql&#x27;</span>,
  <span class="hljs-string">&#x27;.gql&#x27;</span>: <span class="hljs-string">&#x27;graphql&#x27;</span>,
  <span class="hljs-string">&#x27;.sql&#x27;</span>: <span class="hljs-string">&#x27;sql&#x27;</span>,
  <span class="hljs-string">&#x27;.json&#x27;</span>: <span class="hljs-string">&#x27;json&#x27;</span>,
  <span class="hljs-string">&#x27;.yaml&#x27;</span>: <span class="hljs-string">&#x27;yaml&#x27;</span>,
  <span class="hljs-string">&#x27;.yml&#x27;</span>: <span class="hljs-string">&#x27;yaml&#x27;</span>,
  <span class="hljs-string">&#x27;.awk&#x27;</span>: <span class="hljs-string">&#x27;awk&#x27;</span>,
  <span class="hljs-string">&#x27;.sed&#x27;</span>: <span class="hljs-string">&#x27;sed&#x27;</span>,
  <span class="hljs-string">&#x27;.perl&#x27;</span>: <span class="hljs-string">&#x27;perl&#x27;</span>,
  <span class="hljs-string">&#x27;.sh&#x27;</span>: <span class="hljs-string">&#x27;bash&#x27;</span>,
  <span class="hljs-string">&#x27;.bash&#x27;</span>: <span class="hljs-string">&#x27;bash&#x27;</span>,
  <span class="hljs-string">&#x27;.zsh&#x27;</span>: <span class="hljs-string">&#x27;bash&#x27;</span>,
  <span class="hljs-string">&#x27;.makefile&#x27;</span>: <span class="hljs-string">&#x27;makefile&#x27;</span>,
  <span class="hljs-string">&#x27;.mk&#x27;</span>: <span class="hljs-string">&#x27;makefile&#x27;</span>,
  <span class="hljs-string">&#x27;.cmake&#x27;</span>: <span class="hljs-string">&#x27;cmake&#x27;</span>,
  <span class="hljs-string">&#x27;.gradle&#x27;</span>: <span class="hljs-string">&#x27;gradle&#x27;</span>,
  <span class="hljs-string">&#x27;.maven&#x27;</span>: <span class="hljs-string">&#x27;xml&#x27;</span>,
  <span class="hljs-string">&#x27;.pom&#x27;</span>: <span class="hljs-string">&#x27;xml&#x27;</span>,
  <span class="hljs-string">&#x27;.dockerfile&#x27;</span>: <span class="hljs-string">&#x27;dockerfile&#x27;</span>,
  <span class="hljs-string">&#x27;.containerfile&#x27;</span>: <span class="hljs-string">&#x27;dockerfile&#x27;</span>,
  <span class="hljs-string">&#x27;.md&#x27;</span>: <span class="hljs-string">&#x27;markdown&#x27;</span>,
  <span class="hljs-string">&#x27;.markdown&#x27;</span>: <span class="hljs-string">&#x27;markdown&#x27;</span>,
  <span class="hljs-string">&#x27;.rst&#x27;</span>: <span class="hljs-string">&#x27;rst&#x27;</span>,
  <span class="hljs-string">&#x27;.tex&#x27;</span>: <span class="hljs-string">&#x27;latex&#x27;</span>,
  <span class="hljs-string">&#x27;.raku&#x27;</span>: <span class="hljs-string">&#x27;raku&#x27;</span>,
  <span class="hljs-string">&#x27;.p6&#x27;</span>: <span class="hljs-string">&#x27;raku&#x27;</span>,
  <span class="hljs-string">&#x27;.vala&#x27;</span>: <span class="hljs-string">&#x27;vala&#x27;</span>,
  <span class="hljs-string">&#x27;.genie&#x27;</span>: <span class="hljs-string">&#x27;vala&#x27;</span>,
  <span class="hljs-string">&#x27;.boo&#x27;</span>: <span class="hljs-string">&#x27;boo&#x27;</span>,
  <span class="hljs-string">&#x27;.cobra&#x27;</span>: <span class="hljs-string">&#x27;python&#x27;</span>,
  <span class="hljs-string">&#x27;.ahk&#x27;</span>: <span class="hljs-string">&#x27;autohotkey&#x27;</span>
};

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = languageMap;</div>
                 </div>

             <div class="p-4">
                 <div class="d-flex justify-content-between align-items-center mb-3">
                     <h3 class="h6 text-muted mb-0 d-flex align-items-center">
                         <i class="fas fa-brain me-2 text-primary"></i>
                         AI Explanation
                     </h3>
                     <button class="btn btn-outline-primary btn-sm copy-explanation" data-file-index="8" title="Copy explanation">
                         <i class="fas fa-copy me-1"></i> Copy
                     </button>
                 </div>
                 <div class="explanation-content">
                     <p>Certainly! Below is a structured explanation of the <code>languageMap.js</code> JavaScript file content in Markdown format:</p>
<h1>Explanation of <code>languageMap.js</code></h1>
<h2>Overview</h2>
<p>The <code>languageMap.js</code> file is a utility module that exports an object called <code>languageMap</code>. This object serves as a mapping between file extensions and their corresponding programming languages. This can be particularly useful in software development tools that need to detect the language of a code file based on its extension.</p>
<h2>Key Components</h2>
<h3>1. Object Declaration</h3>
<p>The <code>languageMap</code> is defined as a constant object (<code>const</code>) which implies that you cannot reassign the <code>languageMap</code> variable to a different object, though you can still modify the contents of the object itself (i.e., add or remove key-value pairs).</p>
<h3>2. Map of Extensions to Languages</h3>
<p>The <code>languageMap</code> consists of key-value pairs where:</p>
<ul>
<li><strong>Key</strong>: A string representing a file extension (e.g., <code>.js</code>, <code>.py</code>, <code>.java</code>).</li>
<li><strong>Value</strong>: A string representing the corresponding programming language or technology (e.g., <code>javascript</code>, <code>python</code>, <code>java</code>).</li>
</ul>
<h4>Examples:</h4>
<ul>
<li><code>.js</code> is mapped to <code>javascript</code>, meaning files with <code>.js</code> extensions are identified as JavaScript files.</li>
<li><code>.py</code> is mapped to <code>python</code>, meaning files with <code>.py</code> extensions are identified as Python files.</li>
<li><code>.html</code> and <code>.htm</code> are both mapped to <code>html</code>, indicating that either extension corresponds to HTML language.</li>
</ul>
<h3>3. Supported Languages</h3>
<p>The mapping is quite extensive, providing support for a wide range of programming, scripting, and markup languages. Some notable languages and formats include:</p>
<ul>
<li><strong>Programming Languages</strong>: JavaScript, Python, Java, C, C++, C#, Go, Rust, Swift</li>
<li><strong>Markup Languages</strong>: HTML, XML, SVG</li>
<li><strong>Scripting Languages</strong>: Bash, Perl, Ruby, Sed</li>
<li><strong>Others</strong>: SQL, JSON, YAML, Markdown, Dockerfile</li>
</ul>
<h3>4. Export Statement</h3>
<p>The module uses <code>module.exports = languageMap;</code> to export <code>languageMap</code>, making it available for import in other JavaScript files. This is the CommonJS module system used in Node.js for organizing your code into reusable components.</p>
<h2>Usage</h2>
<p>In a Node.js project, you can import this utility to easily detect the programming language of a file by its extension.</p>
<p>Example Usage:</p>
javascript
const languageMap = require('./path/to/utils/languageMap');

<p>// Determine the language for a given file extension
const language = languageMap[&#39;.js&#39;];
console.log(language); // Output: &quot;javascript&quot;</p>
<pre><code>
## Conclusion

This `languageMap` serves as a convenient utility to associate file extensions with their respective programming languages, which is useful for code analysis, editor support, and tooling enhancements in software development workflows.
</code></pre>
<p>This explanation covers the purpose, structure, and potential usage of the code, along with examples and details about the module&#39;s components.</p>

                 </div>
             </div>
         </div>
     </div>
 </div>

 <div class="file-entry col-12 mb-4" id="file-9" data-file-path="D:\MyDev\CodeExplain\src\utils\utils.js" data-file-index="9">
     <div class="card shadow-sm border-0 h-100" style="border-radius: 12px; overflow: hidden;">
         <div class="card-header bg-gradient-primary text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1rem 1.5rem;">
             <div class="d-flex justify-content-between align-items-center">
                  <h2 class="toggle-code h5 fw-semibold mb-0 cursor-pointer d-flex align-items-center text-white" data-file-index="9" style="font-size: 1.1rem;">
                      <i class="fas fa-chevron-right me-2 transition-transform duration-200"></i>
                      <i class="fas fa-file-code me-2"></i>
                      utils/utils.js
                  </h2>
                 <span class="badge bg-white bg-opacity-25 text-white px-2 py-1" style="font-size: 0.75rem;">
                     javascript
                 </span>
             </div>
         </div>

               <div class="card-body p-0">
                 <div class="code-container bg-light border-bottom d-none" style="max-height: 400px; overflow: auto;" data-file-path="D:\MyDev\CodeExplain\src\utils\utils.js" data-file-language="javascript">
                     <div class="p-3 text-center text-muted">
                         <div class="spinner-border spinner-border-sm me-2" role="status" style="display: none;"></div>
                         <span class="loading-text">Click to load code</span>
                     </div>
                     <div class="code-content" style="display: none;"><span class="hljs-comment">/**
 * Common utility functions for CodeExplain
 */</span>

<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);
<span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;crypto&#x27;</span>)

<span class="hljs-comment">/**
 * Escape HTML special characters
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">unsafe</span> - String to escape
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} Escaped string
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">escapeHtml</span>(<span class="hljs-params">unsafe</span>) {
  <span class="hljs-keyword">return</span> unsafe.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[&amp;&lt;&gt;&quot;&#x27;]/g</span>, <span class="hljs-function">(<span class="hljs-params">m</span>) =&gt;</span> {
    <span class="hljs-keyword">switch</span> (m) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;&amp;&#x27;</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&amp;amp;&#x27;</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;&lt;&#x27;</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&amp;lt;&#x27;</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;&gt;&#x27;</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&amp;gt;&#x27;</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;&quot;&#x27;</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&amp;quot;&#x27;</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;&#x27;&quot;</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&amp;#039;&#x27;</span>;
      <span class="hljs-attr">default</span>: <span class="hljs-keyword">return</span> m;
    }
  });
}

<span class="hljs-comment">/**
 * Escape regex special characters
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">string</span> - String to escape
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} Escaped string
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">escapeRegExp</span>(<span class="hljs-params">string</span>) {
  <span class="hljs-keyword">return</span> string.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[.*+?^${}()|[\]\\]/g</span>, <span class="hljs-string">&#x27;\\$&amp;&#x27;</span>);
}

<span class="hljs-comment">/**
 * Get file extension from path
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">filePath</span> - Path to file
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} File extension
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getFileExtension</span>(<span class="hljs-params">filePath</span>) {
  <span class="hljs-keyword">return</span> path.<span class="hljs-title function_">extname</span>(filePath).<span class="hljs-title function_">toLowerCase</span>();
}

<span class="hljs-comment">/**
 * Get file name without extension
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">filePath</span> - Path to file
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} File name without extension
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getFileNameWithoutExtension</span>(<span class="hljs-params">filePath</span>) {
  <span class="hljs-keyword">return</span> path.<span class="hljs-title function_">basename</span>(filePath, path.<span class="hljs-title function_">extname</span>(filePath));
}

<span class="hljs-comment">/**
 * Check if a file should be included based on extension
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">filePath</span> - Path to file
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string[]</span>} <span class="hljs-variable">allowedExtensions</span> - Allowed extensions
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">boolean</span>} True if file should be included
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">shouldIncludeFile</span>(<span class="hljs-params">filePath, allowedExtensions</span>) {
  <span class="hljs-keyword">const</span> ext = <span class="hljs-title function_">getFileExtension</span>(filePath);
  <span class="hljs-keyword">return</span> allowedExtensions.<span class="hljs-title function_">includes</span>(ext);
}

<span class="hljs-comment">/**
 * Format bytes to human readable format
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">bytes</span> - Number of bytes
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">decimals</span> - Number of decimal places
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} Formatted string
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatBytes</span>(<span class="hljs-params">bytes, decimals = <span class="hljs-number">2</span></span>) {
  <span class="hljs-keyword">if</span> (bytes === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;0 Bytes&#x27;</span>;

  <span class="hljs-keyword">const</span> k = <span class="hljs-number">1024</span>;
  <span class="hljs-keyword">const</span> dm = decimals &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : decimals;
  <span class="hljs-keyword">const</span> sizes = [<span class="hljs-string">&#x27;Bytes&#x27;</span>, <span class="hljs-string">&#x27;KB&#x27;</span>, <span class="hljs-string">&#x27;MB&#x27;</span>, <span class="hljs-string">&#x27;GB&#x27;</span>, <span class="hljs-string">&#x27;TB&#x27;</span>];

  <span class="hljs-keyword">const</span> i = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">log</span>(bytes) / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">log</span>(k));

  <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>((bytes / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(k, i)).<span class="hljs-title function_">toFixed</span>(dm)) + <span class="hljs-string">&#x27; &#x27;</span> + sizes[i];
}

<span class="hljs-comment">/**
 * Capitalize first letter of string
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">string</span> - String to capitalize
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} Capitalized string
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">capitalizeFirstLetter</span>(<span class="hljs-params">string</span>) {
  <span class="hljs-keyword">return</span> string.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">toUpperCase</span>() + string.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>);
}

<span class="hljs-comment">/**
 * Convert camelCase to kebab-case
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">string</span> - String to convert
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} Converted string
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">camelToKebab</span>(<span class="hljs-params">string</span>) {
  <span class="hljs-keyword">return</span> string.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/([a-z0-9])([A-Z])/g</span>, <span class="hljs-string">&#x27;$1-$2&#x27;</span>).<span class="hljs-title function_">toLowerCase</span>();
}

<span class="hljs-comment">/**
 * Truncate string with ellipsis
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">str</span> - String to truncate
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">maxLength</span> - Maximum length
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} Truncated string
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">truncateString</span>(<span class="hljs-params">str, maxLength</span>) {
  <span class="hljs-keyword">if</span> (str.<span class="hljs-property">length</span> &lt;= maxLength) <span class="hljs-keyword">return</span> str;
  <span class="hljs-keyword">if</span> (maxLength &lt;= <span class="hljs-number">3</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;...&#x27;</span>;
  <span class="hljs-keyword">return</span> str.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, maxLength - <span class="hljs-number">3</span>) + <span class="hljs-string">&#x27;...&#x27;</span>;
}

<span class="hljs-comment">/**
 * Generate unique ID
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} Unique ID
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">generateUniqueId</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">return</span> crypto.<span class="hljs-title function_">randomBytes</span>(<span class="hljs-number">8</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;hex&#x27;</span>)
}

<span class="hljs-comment">/**
 * Sleep for specified milliseconds
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">ms</span> - Milliseconds to sleep
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise</span>} Promise that resolves after specified time
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-params">ms</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, ms));
}

<span class="hljs-comment">/**
 * Deep merge two objects
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">target</span> - Target object
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">source</span> - Source object
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object</span>} Merged object
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">deepMerge</span>(<span class="hljs-params">target, source</span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> target !== <span class="hljs-string">&#x27;object&#x27;</span> || target === <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">return</span> source;
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> source !== <span class="hljs-string">&#x27;object&#x27;</span> || source === <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">return</span> target;
  }

  <span class="hljs-keyword">const</span> output = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(target) ? [...target] : { ...target };

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> source) {
    <span class="hljs-keyword">if</span> (source.<span class="hljs-title function_">hasOwnProperty</span>(key)) {
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isObject</span>(source[key])) {
        output[key] = <span class="hljs-title function_">deepMerge</span>(output[key] || {}, source[key]);
      } <span class="hljs-keyword">else</span> {
        output[key] = source[key];
      }
    }
  }

  <span class="hljs-keyword">return</span> output;
}

<span class="hljs-comment">/**
 * Check if value is object
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">item</span> - Value to check
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">boolean</span>} True if value is object
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isObject</span>(<span class="hljs-params">item</span>) {
  <span class="hljs-keyword">return</span> (item &amp;&amp; <span class="hljs-keyword">typeof</span> item === <span class="hljs-string">&#x27;object&#x27;</span> &amp;&amp; !<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(item));
}

<span class="hljs-comment">/**
 * Format date to readable string
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Date</span>} <span class="hljs-variable">date</span> - Date to format
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} Formatted date string
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatDate</span>(<span class="hljs-params">date</span>) {
  <span class="hljs-keyword">return</span> date.<span class="hljs-title function_">toLocaleDateString</span>(<span class="hljs-string">&#x27;en-US&#x27;</span>, {
    <span class="hljs-attr">year</span>: <span class="hljs-string">&#x27;numeric&#x27;</span>,
    <span class="hljs-attr">month</span>: <span class="hljs-string">&#x27;long&#x27;</span>,
    <span class="hljs-attr">day</span>: <span class="hljs-string">&#x27;numeric&#x27;</span>,
    <span class="hljs-attr">hour</span>: <span class="hljs-string">&#x27;2-digit&#x27;</span>,
    <span class="hljs-attr">minute</span>: <span class="hljs-string">&#x27;2-digit&#x27;</span>
  });
}

<span class="hljs-comment">/**
 * Pluralize word based on count
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">count</span> - Count
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">singular</span> - Singular form
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">plural</span> - Plural form
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} Pluralized word
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">pluralize</span>(<span class="hljs-params">count, singular, plural</span>) {
  <span class="hljs-keyword">return</span> count === <span class="hljs-number">1</span> ? singular : plural;
}

<span class="hljs-comment">/**
 * Convert array to human-readable list
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array</span>} <span class="hljs-variable">array</span> - Array to convert
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">Human</span>-readable list
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">arrayToHumanReadableList</span>(<span class="hljs-params">array</span>) {
  <span class="hljs-keyword">if</span> (array.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>;
  <span class="hljs-keyword">if</span> (array.<span class="hljs-property">length</span> === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> array[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">if</span> (array.<span class="hljs-property">length</span> === <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> array.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27; and &#x27;</span>);

  <span class="hljs-comment">// Create a shallow copy to avoid modifying the original array</span>
  <span class="hljs-keyword">const</span> arrCopy = [...array];
  <span class="hljs-keyword">const</span> last = arrCopy.<span class="hljs-title function_">pop</span>();
  <span class="hljs-keyword">return</span> arrCopy.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;, &#x27;</span>) + <span class="hljs-string">&#x27;, and &#x27;</span> + last;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">dd</span>(<span class="hljs-params">data</span>) {
  process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>) + <span class="hljs-string">&#x27;\n&#x27;</span>);
  process.<span class="hljs-title function_">exit</span>();
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  dd,
  escapeHtml,
  escapeRegExp,
  getFileExtension,
  getFileNameWithoutExtension,
  shouldIncludeFile,
  formatBytes,
  capitalizeFirstLetter,
  camelToKebab,
  truncateString,
  generateUniqueId,
  sleep,
  deepMerge,
  isObject,
  formatDate,
  pluralize,
  arrayToHumanReadableList
};</div>
                 </div>

             <div class="p-4">
                 <div class="d-flex justify-content-between align-items-center mb-3">
                     <h3 class="h6 text-muted mb-0 d-flex align-items-center">
                         <i class="fas fa-brain me-2 text-primary"></i>
                         AI Explanation
                     </h3>
                     <button class="btn btn-outline-primary btn-sm copy-explanation" data-file-index="9" title="Copy explanation">
                         <i class="fas fa-copy me-1"></i> Copy
                     </button>
                 </div>
                 <div class="explanation-content">
                     <p>Sure! Here&#39;s a detailed explanation of the <code>utils.js</code> file in markdown format:</p>
<h1>JavaScript Utility Functions Explained</h1>
<p>The <code>utils.js</code> file contains a collection of common utility functions used in the <code>CodeExplain</code> project. Below is a detailed explanation of each function and its purpose.</p>
<h2>1. Imports</h2>
<ul>
<li><strong>path</strong>: A core Node.js module for working with file and directory paths.</li>
<li><strong>crypto</strong>: A core Node.js module used for cryptographic operations.</li>
</ul>
javascript
const path = require('path');
const crypto = require('crypto');
```

<h2>2. Functions</h2>
<h3>Escape HTML Special Characters</h3>
<ul>
<li><strong>Function</strong>: <code>escapeHtml(unsafe)</code></li>
<li><strong>Purpose</strong>: Converts special HTML characters in a string to their respective HTML entity codes to prevent HTML injection.</li>
<li><strong>Inputs</strong>: A <code>string</code> (<code>unsafe</code>).</li>
<li><strong>Outputs</strong>: An escaped <code>string</code>.</li>
</ul>
<h3>Escape Regular Expression Special Characters</h3>
<ul>
<li><strong>Function</strong>: <code>escapeRegExp(string)</code></li>
<li><strong>Purpose</strong>: Escapes special characters in a string to safely use it in a regular expression.</li>
<li><strong>Inputs</strong>: A <code>string</code>.</li>
<li><strong>Outputs</strong>: An escaped <code>string</code>.</li>
</ul>
<h3>Get File Extension</h3>
<ul>
<li><strong>Function</strong>: <code>getFileExtension(filePath)</code></li>
<li><strong>Purpose</strong>: Extracts the file extension from a given file path.</li>
<li><strong>Inputs</strong>: A <code>string</code> (<code>filePath</code>).</li>
<li><strong>Outputs</strong>: A <code>string</code> representing the file extension in lowercase.</li>
</ul>
<h3>Get File Name Without Extension</h3>
<ul>
<li><strong>Function</strong>: <code>getFileNameWithoutExtension(filePath)</code></li>
<li><strong>Purpose</strong>: Extracts the file name without its extension from a given file path.</li>
<li><strong>Inputs</strong>: A <code>string</code> (<code>filePath</code>).</li>
<li><strong>Outputs</strong>: A <code>string</code> representing the file name without the extension.</li>
</ul>
<h3>Should Include File</h3>
<ul>
<li><strong>Function</strong>: <code>shouldIncludeFile(filePath, allowedExtensions)</code></li>
<li><strong>Purpose</strong>: Determines if a file should be included based on its extension.</li>
<li><strong>Inputs</strong>: A <code>string</code> (<code>filePath</code>) and an array of strings (<code>allowedExtensions</code>).</li>
<li><strong>Outputs</strong>: <code>boolean</code> indicating if the file has an allowed extension.</li>
</ul>
<h3>Format Bytes</h3>
<ul>
<li><strong>Function</strong>: <code>formatBytes(bytes, decimals = 2)</code></li>
<li><strong>Purpose</strong>: Converts a number of bytes into a human-readable format (e.g., KB, MB).</li>
<li><strong>Inputs</strong>: A <code>number</code> (<code>bytes</code>) and an optional <code>number</code> of <code>decimals</code>.</li>
<li><strong>Outputs</strong>: A formatted <code>string</code>.</li>
</ul>
<h3>Capitalize First Letter</h3>
<ul>
<li><strong>Function</strong>: <code>capitalizeFirstLetter(string)</code></li>
<li><strong>Purpose</strong>: Capitalizes the first letter of a string.</li>
<li><strong>Inputs</strong>: A <code>string</code>.</li>
<li><strong>Outputs</strong>: A <code>string</code> with its first letter capitalized.</li>
</ul>
<h3>Convert CamelCase to Kebab-Case</h3>
<ul>
<li><strong>Function</strong>: <code>camelToKebab(string)</code></li>
<li><strong>Purpose</strong>: Converts a camelCase string to kebab-case.</li>
<li><strong>Inputs</strong>: A <code>string</code>.</li>
<li><strong>Outputs</strong>: A <code>string</code> in kebab-case.</li>
</ul>
<h3>Truncate String With Ellipsis</h3>
<ul>
<li><strong>Function</strong>: <code>truncateString(str, maxLength)</code></li>
<li><strong>Purpose</strong>: Truncates a string to a specified maximum length, appending an ellipsis if it exceeds that length.</li>
<li><strong>Inputs</strong>: A <code>string</code> (<code>str</code>) and a <code>number</code> (<code>maxLength</code>).</li>
<li><strong>Outputs</strong>: A truncated <code>string</code>.</li>
</ul>
<h3>Generate Unique ID</h3>
<ul>
<li><strong>Function</strong>: <code>generateUniqueId()</code></li>
<li><strong>Purpose</strong>: Generates a random, unique identifier using cryptographic functions.</li>
<li><strong>Outputs</strong>: A <code>string</code> representing a unique ID.</li>
</ul>
<h3>Sleep for Specified Milliseconds</h3>
<ul>
<li><strong>Function</strong>: <code>sleep(ms)</code></li>
<li><strong>Purpose</strong>: Pauses execution for a specified number of milliseconds.</li>
<li><strong>Inputs</strong>: A <code>number</code> (<code>ms</code>).</li>
<li><strong>Outputs</strong>: A <code>Promise</code> that resolves after the specified time.</li>
</ul>
<h3>Deep Merge Two Objects</h3>
<ul>
<li><strong>Function</strong>: <code>deepMerge(target, source)</code></li>
<li><strong>Purpose</strong>: Recursively merges properties from a source object into a target object.</li>
<li><strong>Inputs</strong>: Two <code>Objects</code> (<code>target</code> and <code>source</code>).</li>
<li><strong>Outputs</strong>: A new <code>Object</code> containing merged properties.</li>
</ul>
<h3>Check if Value is an Object</h3>
<ul>
<li><strong>Function</strong>: <code>isObject(item)</code></li>
<li><strong>Purpose</strong>: Determines if a value is a non-array object.</li>
<li><strong>Inputs</strong>: Any value (<code>item</code>).</li>
<li><strong>Outputs</strong>: <code>boolean</code> indicating if the value is an object.</li>
</ul>
<h3>Format Date to Readable String</h3>
<ul>
<li><strong>Function</strong>: <code>formatDate(date)</code></li>
<li><strong>Purpose</strong>: Formats a JavaScript <code>Date</code> object into a human-readable string.</li>
<li><strong>Inputs</strong>: A <code>Date</code> object.</li>
<li><strong>Outputs</strong>: A formatted <code>string</code>.</li>
</ul>
<h3>Pluralize Word Based on Count</h3>
<ul>
<li><strong>Function</strong>: <code>pluralize(count, singular, plural)</code></li>
<li><strong>Purpose</strong>: Returns the singular or plural form of a word based on a count.</li>
<li><strong>Inputs</strong>: A <code>number</code> (<code>count</code>), a <code>string</code> (<code>singular</code>), and a <code>string</code> (<code>plural</code>).</li>
<li><strong>Outputs</strong>: The appropriate <code>string</code> (either singular or plural).</li>
</ul>
<h3>Convert Array to Human-Readable List</h3>
<ul>
<li><strong>Function</strong>: <code>arrayToHumanReadableList(array)</code></li>
<li><strong>Purpose</strong>: Converts an array into a grammatically correct human-readable list.</li>
<li><strong>Inputs</strong>: An <code>Array</code>.</li>
<li><strong>Outputs</strong>: A <code>string</code>.</li>
</ul>
<h3>Debugging Function</h3>
<ul>
<li><strong>Function</strong>: <code>dd(data)</code></li>
<li><strong>Purpose</strong>: Serializes the given data to JSON, writes it to the standard output, and immediately exits the process (useful for debugging).</li>
<li><strong>Inputs</strong>: Any value (<code>data</code>).</li>
</ul>
<h2>3. Module Exports</h2>
<p>The <code>module.exports</code> section exposes all the functions so that they can be used in other parts of the application.</p>
<pre><code class="language-javascript">module.exports = {
  dd,
  escapeHtml,
  escapeRegExp,
  getFileExtension,
  getFileNameWithoutExtension,
  shouldIncludeFile,
  formatBytes,
  capitalizeFirstLetter,
  camelToKebab,
  truncateString,
  generateUniqueId,
  sleep,
  deepMerge,
  isObject,
  formatDate,
  pluralize,
  arrayToHumanReadableList
};
</code></pre>
<p>In summary, this utilities file provides a set of helper functions for common tasks such as string manipulation, file path operations, and data formatting to ease development processes.</p>
<pre><code>
</code></pre>

                 </div>
             </div>
         </div>
     </div>
 </div>

 <div class="file-entry col-12 mb-4" id="file-10" data-file-path="D:\MyDev\CodeExplain\src\output\html\htmlOutput.js" data-file-index="10">
     <div class="card shadow-sm border-0 h-100" style="border-radius: 12px; overflow: hidden;">
         <div class="card-header bg-gradient-primary text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1rem 1.5rem;">
             <div class="d-flex justify-content-between align-items-center">
                  <h2 class="toggle-code h5 fw-semibold mb-0 cursor-pointer d-flex align-items-center text-white" data-file-index="10" style="font-size: 1.1rem;">
                      <i class="fas fa-chevron-right me-2 transition-transform duration-200"></i>
                      <i class="fas fa-file-code me-2"></i>
                      output/html/htmlOutput.js
                  </h2>
                 <span class="badge bg-white bg-opacity-25 text-white px-2 py-1" style="font-size: 0.75rem;">
                     javascript
                 </span>
             </div>
         </div>

               <div class="card-body p-0">
                 <div class="code-container bg-light border-bottom d-none" style="max-height: 400px; overflow: auto;" data-file-path="D:\MyDev\CodeExplain\src\output\html\htmlOutput.js" data-file-language="javascript">
                     <div class="p-3 text-center text-muted">
                         <div class="spinner-border spinner-border-sm me-2" role="status" style="display: none;"></div>
                         <span class="loading-text">Click to load code</span>
                     </div>
                     <div class="code-content" style="display: none;"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>).<span class="hljs-property">promises</span>;
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);
<span class="hljs-keyword">const</span> marked = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;marked&#x27;</span>);
<span class="hljs-keyword">const</span> hljs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;highlight.js&#x27;</span>);
<span class="hljs-keyword">const</span> { escapeHtml, generateUniqueId } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../../utils/utils&#x27;</span>);
<span class="hljs-keyword">const</span> { createHTMLTemplate, loadHTMLAssets } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./htmlTemplate&#x27;</span>);

<span class="hljs-comment">// Configure marked to use highlight.js for syntax highlighting</span>
marked.<span class="hljs-title function_">setOptions</span>({
  <span class="hljs-attr">highlight</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">code, lang</span>) {
    <span class="hljs-keyword">if</span> (lang &amp;&amp; hljs.<span class="hljs-title function_">getLanguage</span>(lang)) {
      <span class="hljs-keyword">return</span> hljs.<span class="hljs-title function_">highlight</span>(code, { <span class="hljs-attr">language</span>: lang }).<span class="hljs-property">value</span>;
    }
    <span class="hljs-keyword">return</span> hljs.<span class="hljs-title function_">highlightAuto</span>(code).<span class="hljs-property">value</span>;
  }
});

<span class="hljs-comment">/**
 * Highlight code using highlight.js
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">code</span> - Code to highlight
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">language</span> - Programming language
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} Highlighted HTML
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">highlightCode</span>(<span class="hljs-params">code, language</span>) {
  <span class="hljs-keyword">if</span> (!code || <span class="hljs-keyword">typeof</span> code !== <span class="hljs-string">&#x27;string&#x27;</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>;
  }

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">if</span> (language &amp;&amp; hljs.<span class="hljs-title function_">getLanguage</span>(language)) {
      <span class="hljs-keyword">return</span> hljs.<span class="hljs-title function_">highlight</span>(code, { language }).<span class="hljs-property">value</span>;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> hljs.<span class="hljs-title function_">highlightAuto</span>(code).<span class="hljs-property">value</span>;
    }
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-comment">// Fallback to escaping if highlighting fails</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">escapeHtml</span>(code);
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">HTMLOutput</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">config</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span> = config || {};
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params">analysis, outputPath, title = <span class="hljs-string">&#x27;Code Explanation&#x27;</span></span>) {
    <span class="hljs-comment">// Ensure analysis is always an array</span>
    <span class="hljs-keyword">const</span> files = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(analysis) ? analysis : [analysis];

    <span class="hljs-comment">// Determine if this mode should show sidebar and navigation</span>
    <span class="hljs-keyword">const</span> showSidebarAndNavigation = <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">mode</span> === <span class="hljs-string">&#x27;explain&#x27;</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">mode</span> === <span class="hljs-string">&#x27;issues&#x27;</span>;

    <span class="hljs-comment">// Create a tree structure for the sidebar (only for modes that need it)</span>
    <span class="hljs-keyword">let</span> sidebarItems = <span class="hljs-string">&#x27;&#x27;</span>;
    <span class="hljs-keyword">if</span> (showSidebarAndNavigation) {
      <span class="hljs-keyword">const</span> tree = <span class="hljs-title function_">createFileTree</span>(files);
      sidebarItems = <span class="hljs-title function_">generateSidebarTree</span>(tree);
    }

    <span class="hljs-comment">// Modify title to include success labels for paths</span>
    <span class="hljs-keyword">const</span> titleResult = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">modifyTitleWithLabels</span>(title);

    <span class="hljs-comment">// Load HTML assets (CSS, JS)</span>
    <span class="hljs-keyword">const</span> assets = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadHTMLAssets</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>);

    <span class="hljs-comment">// Use streaming HTML generation to reduce memory usage</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateStreamingHTML</span>(files, outputPath, titleResult, sidebarItems, assets, showSidebarAndNavigation);
  }

  <span class="hljs-comment">// Streaming HTML generation to reduce memory fragmentation</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">generateStreamingHTML</span>(<span class="hljs-params">files, outputPath, titleResult, sidebarItems, assets, showSidebarAndNavigation = <span class="hljs-literal">true</span></span>) {
    <span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>).<span class="hljs-property">promises</span>;
    <span class="hljs-keyword">const</span> stream = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>).<span class="hljs-title function_">createWriteStream</span>(outputPath);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// Write HTML header</span>
      <span class="hljs-keyword">const</span> headerHTML = <span class="hljs-title function_">createHTMLTemplate</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>, titleResult, sidebarItems, <span class="hljs-string">&#x27;&#x27;</span>, assets, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>, showSidebarAndNavigation);
      stream.<span class="hljs-title function_">write</span>(headerHTML);

      <span class="hljs-comment">// Write file entries one by one to reduce memory usage</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; files.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-keyword">const</span> fileEntry = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateFileEntry</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>, files[i], i);
        stream.<span class="hljs-title function_">write</span>(fileEntry + <span class="hljs-string">&#x27;\n&#x27;</span>);

        <span class="hljs-comment">// Clear reference to file content to free memory</span>
        <span class="hljs-keyword">if</span> (files[i] &amp;&amp; files[i].<span class="hljs-property">content</span>) {
          files[i].<span class="hljs-property">content</span> = <span class="hljs-literal">null</span>;
        }

        <span class="hljs-comment">// Suggest GC every 10 files for large codebases</span>
        <span class="hljs-keyword">if</span> (i % <span class="hljs-number">10</span> === <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">global</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span> &amp;&amp; <span class="hljs-variable language_">global</span>.<span class="hljs-property">gc</span>) {
          <span class="hljs-keyword">try</span> {
            <span class="hljs-variable language_">global</span>.<span class="hljs-title function_">gc</span>();
          } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-comment">// Ignore GC errors</span>
          }
        }
      }

      <span class="hljs-comment">// Write HTML footer</span>
      <span class="hljs-keyword">const</span> footerHTML = <span class="hljs-title function_">createHTMLTemplate</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>, titleResult, sidebarItems, <span class="hljs-string">&#x27;&#x27;</span>, assets, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>, showSidebarAndNavigation);
      stream.<span class="hljs-title function_">write</span>(footerHTML);

      <span class="hljs-comment">// Wait for stream to finish</span>
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        stream.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;finish&#x27;</span>, resolve);
        stream.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;error&#x27;</span>, reject);
        stream.<span class="hljs-title function_">end</span>();
      });

      <span class="hljs-keyword">return</span> outputPath;
    } <span class="hljs-keyword">catch</span> (error) {
      stream.<span class="hljs-title function_">destroy</span>();
      <span class="hljs-keyword">throw</span> error;
    }
  }

  <span class="hljs-title function_">modifyTitleWithLabels</span>(<span class="hljs-params">title</span>) {
    <span class="hljs-comment">// Extract paths from title like &quot;Code Explanation: path1, path2, path3&quot;</span>
    <span class="hljs-keyword">const</span> titleMatch = title.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/^Code Explanation:\s*(.+)$/</span>);
    <span class="hljs-keyword">if</span> (!titleMatch) <span class="hljs-keyword">return</span> title;

    <span class="hljs-keyword">const</span> paths = titleMatch[<span class="hljs-number">1</span>].<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;,&#x27;</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">path</span> =&gt;</span> path.<span class="hljs-title function_">trim</span>());
    <span class="hljs-keyword">const</span> coloredPaths = paths.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">path</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> fileName = path.<span class="hljs-title function_">split</span>(<span class="hljs-regexp">/[/\\]/</span>).<span class="hljs-title function_">pop</span>() || path;
      <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;span class=&quot;text-primary fw-semibold&quot;&gt;<span class="hljs-subst">${fileName}</span>&lt;/span&gt;`</span>;
    });

    <span class="hljs-comment">// Return both HTML version for header and plain text version for title tag</span>
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">html</span>: <span class="hljs-string">`Code Explanation: <span class="hljs-subst">${coloredPaths.join(<span class="hljs-string">&#x27;, &#x27;</span>)}</span>`</span>,
      <span class="hljs-attr">plain</span>: <span class="hljs-string">`Code Explanation: <span class="hljs-subst">${paths.map(path =&gt; path.split(/[/\\]/).pop() || path).join(<span class="hljs-string">&#x27;, &#x27;</span>)}</span>`</span>
    };
  }
}

<span class="hljs-comment">/**
 * Extract and process Mermaid code blocks from text
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">text</span> - Text containing Mermaid code blocks
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} Text with Mermaid blocks replaced by HTML containers
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">extractMermaidBlocks</span>(<span class="hljs-params">text</span>) {
  <span class="hljs-comment">// Replace mermaid code blocks with placeholders before marked.parse()</span>
  <span class="hljs-keyword">return</span> text.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/```mermaid\s*([\s\S]*?)```/g</span>, <span class="hljs-function">(<span class="hljs-params">match, mermaidCode</span>) =&gt;</span> {
    <span class="hljs-comment">// Generate a unique ID for this diagram</span>
    <span class="hljs-keyword">const</span> diagramId = <span class="hljs-string">`mermaid-diagram-<span class="hljs-subst">${generateUniqueId()}</span>`</span>;

    <span class="hljs-comment">// Clean up the mermaid code</span>
    <span class="hljs-keyword">const</span> cleanCode = mermaidCode.<span class="hljs-title function_">trim</span>();

    <span class="hljs-comment">// Validate that this is actually a mermaid diagram with content</span>
    <span class="hljs-keyword">if</span> (!cleanCode || cleanCode.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> match; <span class="hljs-comment">// Return original if empty</span>
    }

    <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;div class=&quot;mermaid-diagram-container mb-4&quot;&gt;
      &lt;div class=&quot;mermaid&quot; id=&quot;<span class="hljs-subst">${diagramId}</span>&quot;&gt;<span class="hljs-subst">${cleanCode}</span>&lt;/div&gt;
    &lt;/div&gt;`</span>;
  });
}

<span class="hljs-comment">/**
 * Extract and process Markdown code blocks from text
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">text</span> - Text containing Markdown code blocks
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} Text with Markdown blocks replaced by rendered HTML
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">extractMarkdownBlocks</span>(<span class="hljs-params">text</span>) {
  <span class="hljs-comment">// Replace markdown code blocks with rendered HTML before marked.parse()</span>
  <span class="hljs-keyword">return</span> text.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/```markdown\s*([\s\S]*?)```/g</span>, <span class="hljs-function">(<span class="hljs-params">match, markdownContent</span>) =&gt;</span> {
    <span class="hljs-comment">// Trim and parse the markdown content</span>
    <span class="hljs-keyword">const</span> cleanContent = markdownContent.<span class="hljs-title function_">trim</span>();
    <span class="hljs-keyword">if</span> (!cleanContent || cleanContent.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> match; <span class="hljs-comment">// Return original if empty</span>
    }

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">return</span> marked.<span class="hljs-title function_">parse</span>(cleanContent);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Error parsing markdown block:&#x27;</span>, error);
      <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;pre&gt;<span class="hljs-subst">${escapeHtml(cleanContent)}</span>&lt;/pre&gt;`</span>;
    }
  });
}

<span class="hljs-comment">/**
 * Create a tree structure for the sidebar from file analysis
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array</span>} <span class="hljs-variable">files</span> - Array of file analysis objects
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object</span>} Tree structure for sidebar navigation
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createFileTree</span>(<span class="hljs-params">files</span>) {
  <span class="hljs-keyword">const</span> tree = {};
  <span class="hljs-keyword">const</span> seenPaths = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();

  files.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">file, index</span>) =&gt;</span> {
    <span class="hljs-comment">// Ensure we have a unique path for each file</span>
    <span class="hljs-keyword">let</span> relativePath = file.<span class="hljs-property">relativePath</span>;
    <span class="hljs-keyword">if</span> (!relativePath) {
      <span class="hljs-comment">// If no relativePath, use full path and make it unique</span>
      relativePath = file.<span class="hljs-property">path</span>;
      <span class="hljs-keyword">if</span> (path.<span class="hljs-title function_">isAbsolute</span>(relativePath)) {
        <span class="hljs-comment">// Convert absolute path to a relative-like path that preserves uniqueness</span>
        relativePath = relativePath.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^[a-zA-Z]:\\/</span>, <span class="hljs-string">&#x27;&#x27;</span>).<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^\//</span>, <span class="hljs-string">&#x27;&#x27;</span>);
      }
    }

    <span class="hljs-comment">// Normalize path separators</span>
    <span class="hljs-keyword">const</span> normalizedPath = relativePath.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\\/g</span>, <span class="hljs-string">&#x27;/&#x27;</span>);

    <span class="hljs-comment">// Handle path collisions</span>
    <span class="hljs-keyword">if</span> (seenPaths.<span class="hljs-title function_">has</span>(normalizedPath)) {
      <span class="hljs-comment">// Add a unique suffix to the filename</span>
      <span class="hljs-keyword">const</span> pathParts = normalizedPath.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;/&#x27;</span>);
      <span class="hljs-keyword">const</span> fileName = pathParts.<span class="hljs-title function_">pop</span>();
      <span class="hljs-keyword">const</span> fileExt = path.<span class="hljs-title function_">extname</span>(fileName);
      <span class="hljs-keyword">const</span> fileBase = path.<span class="hljs-title function_">basename</span>(fileName, fileExt);
      pathParts.<span class="hljs-title function_">push</span>(<span class="hljs-string">`<span class="hljs-subst">${fileBase}</span>_<span class="hljs-subst">${index}</span><span class="hljs-subst">${fileExt}</span>`</span>);
      relativePath = pathParts.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;/&#x27;</span>);
    }
    seenPaths.<span class="hljs-title function_">add</span>(normalizedPath);

    <span class="hljs-comment">// Split path into parts</span>
    <span class="hljs-keyword">const</span> pathParts = relativePath.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;/&#x27;</span>);

    <span class="hljs-keyword">let</span> current = tree;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; pathParts.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">const</span> part = pathParts[i];
      <span class="hljs-keyword">if</span> (part) { <span class="hljs-comment">// Skip empty parts</span>
        <span class="hljs-keyword">if</span> (!current[part]) {
          current[part] = i === pathParts.<span class="hljs-property">length</span> - <span class="hljs-number">1</span> ? { <span class="hljs-attr">isFile</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">index</span>: index, <span class="hljs-attr">file</span>: file } : {};
        }
        current = current[part];
      }
    }
  });

  <span class="hljs-keyword">return</span> tree;
}

<span class="hljs-comment">/**
 * Generate HTML for the sidebar tree navigation
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">tree</span> - Tree structure from createFileTree
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} HTML string for sidebar navigation
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">generateSidebarTree</span>(<span class="hljs-params">tree</span>) {
  <span class="hljs-comment">// Generate HTML for the tree</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">generateTreeHTML</span> = (<span class="hljs-params">tree, depth = <span class="hljs-number">0</span></span>) =&gt; {
    <span class="hljs-keyword">const</span> htmlParts = [];
    <span class="hljs-keyword">const</span> indent = <span class="hljs-string">&#x27;  &#x27;</span>.<span class="hljs-title function_">repeat</span>(depth);

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, value] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(tree)) {
      <span class="hljs-keyword">if</span> (value.<span class="hljs-property">isFile</span>) {
        <span class="hljs-keyword">const</span> file = value.<span class="hljs-property">file</span>;
        <span class="hljs-keyword">const</span> fileName = path.<span class="hljs-title function_">basename</span>(file.<span class="hljs-property">path</span>);
        htmlParts.<span class="hljs-title function_">push</span>(<span class="hljs-string">`<span class="hljs-subst">${indent}</span>                &lt;li&gt;&lt;a href=&quot;#file-<span class="hljs-subst">${value.index}</span>&quot; class=&quot;d-block py-1 px-2 text-decoration-none rounded&quot;&gt;<span class="hljs-subst">${escapeHtml(fileName)}</span>&lt;/a&gt;&lt;/li&gt;\n`</span>);
      } <span class="hljs-keyword">else</span> {
        htmlParts.<span class="hljs-title function_">push</span>(<span class="hljs-string">`<span class="hljs-subst">${indent}</span>&lt;li&gt;\n`</span>);
        htmlParts.<span class="hljs-title function_">push</span>(<span class="hljs-string">`<span class="hljs-subst">${indent}</span>  &lt;span class=&quot;folder-toggle d-flex align-items-center py-1 px-2 rounded&quot; style=&quot;cursor: pointer;&quot;&gt;&lt;i class=&quot;fas fa-chevron-right me-1 fs-6 folder-icon&quot;&gt;&lt;/i&gt; <span class="hljs-subst">${key}</span>&lt;/span&gt;\n`</span>);
        htmlParts.<span class="hljs-title function_">push</span>(<span class="hljs-string">`<span class="hljs-subst">${indent}</span>  &lt;ul class=&quot;folder-contents ms-4 ps-2 border-start&quot;&gt;\n`</span>);
        htmlParts.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">generateTreeHTML</span>(value, depth + <span class="hljs-number">2</span>));
        htmlParts.<span class="hljs-title function_">push</span>(<span class="hljs-string">`<span class="hljs-subst">${indent}</span>  &lt;/ul&gt;\n`</span>);
        htmlParts.<span class="hljs-title function_">push</span>(<span class="hljs-string">`<span class="hljs-subst">${indent}</span>&lt;/li&gt;\n`</span>);
      }
    }

    <span class="hljs-keyword">return</span> htmlParts.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;&#x27;</span>);
  };

  <span class="hljs-keyword">return</span> <span class="hljs-title function_">generateTreeHTML</span>(tree);
}

<span class="hljs-comment">/**
 * Process HTML tables in content while preserving their structure
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">content</span> - Content containing HTML tables
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object</span>} Processed content and table mappings
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processHtmlTables</span>(<span class="hljs-params">content</span>) {
  <span class="hljs-keyword">const</span> tables = [];
  <span class="hljs-keyword">const</span> tableRegex = <span class="hljs-regexp">/&lt;table[^&gt;]*&gt;[\s\S]*?&lt;\/table&gt;/gi</span>;
  <span class="hljs-keyword">let</span> processedContent = content;
  <span class="hljs-keyword">let</span> match;

  <span class="hljs-comment">// Extract all tables with unique placeholders</span>
  <span class="hljs-keyword">while</span> ((match = tableRegex.<span class="hljs-title function_">exec</span>(content)) !== <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">const</span> placeholder = <span class="hljs-string">`___TABLE_<span class="hljs-subst">${tables.length}</span>_PLACEHOLDER___`</span>;
    tables.<span class="hljs-title function_">push</span>({ placeholder, <span class="hljs-attr">table</span>: match[<span class="hljs-number">0</span>] });
    processedContent = processedContent.<span class="hljs-title function_">replace</span>(match[<span class="hljs-number">0</span>], placeholder);
  }

  <span class="hljs-keyword">return</span> { processedContent, tables };
}

<span class="hljs-comment">/**
 * Restore HTML tables in content
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">content</span> - Content with table placeholders
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array</span>} <span class="hljs-variable">tables</span> - Array of table mappings
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} Content with tables restored
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">restoreHtmlTables</span>(<span class="hljs-params">content, tables</span>) {
  <span class="hljs-keyword">let</span> restoredContent = content;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> { placeholder, table } <span class="hljs-keyword">of</span> tables) {
    restoredContent = restoredContent.<span class="hljs-title function_">replace</span>(placeholder, table);
  }
  <span class="hljs-keyword">return</span> restoredContent;
}

<span class="hljs-comment">/**
 * Process Mermaid diagrams in a flowchart file
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">content</span> - Flowchart content
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">explanation</span> - File explanation
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object</span>} Processed content and explanation
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processFlowchartContent</span>(<span class="hljs-params">content, explanation</span>) {
  <span class="hljs-keyword">const</span> diagrams = [];

  <span class="hljs-comment">// For flowchart mode, replace mermaid code blocks directly with diagram HTML</span>
  <span class="hljs-keyword">let</span> processedExplanation = explanation;
  processedExplanation = processedExplanation.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/```mermaid\s*([\s\S]*?)```/g</span>, <span class="hljs-function">(<span class="hljs-params">match, mermaidCode</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> diagramId = <span class="hljs-string">`mermaid-diagram-<span class="hljs-subst">${generateUniqueId()}</span>`</span>;
    diagrams.<span class="hljs-title function_">push</span>({
      <span class="hljs-attr">id</span>: diagramId,
      <span class="hljs-attr">code</span>: mermaidCode.<span class="hljs-title function_">trim</span>(),
      <span class="hljs-attr">isMain</span>: <span class="hljs-literal">false</span>
    });
    <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;div class=&quot;mermaid-diagram-container mb-4&quot;&gt;
      &lt;div class=&quot;mermaid&quot; id=&quot;<span class="hljs-subst">${diagramId}</span>&quot;&gt;<span class="hljs-subst">${mermaidCode.trim()}</span>&lt;/div&gt;
    &lt;/div&gt;`</span>;
  });

  <span class="hljs-keyword">return</span> { diagrams, processedExplanation };
}

<span class="hljs-comment">/**
 * Generate HTML for a single file entry
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">config</span> - Configuration object
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">file</span> - File analysis object
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">fileIndex</span> - Index of the file for unique IDs
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;string&gt;</span>} HTML string for the file entry
 */</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateFileEntry</span>(<span class="hljs-params">config, file, fileIndex</span>) {
   <span class="hljs-keyword">let</span> processedExplanation = file.<span class="hljs-property">explanation</span> || <span class="hljs-string">&#x27;No explanation available.&#x27;</span>;
   <span class="hljs-keyword">const</span> isFlowchart = config.<span class="hljs-property">mode</span> === <span class="hljs-string">&#x27;flowchart&#x27;</span>;
   <span class="hljs-keyword">const</span> isMultiFileMode = config.<span class="hljs-property">mode</span> === <span class="hljs-string">&#x27;explain&#x27;</span> || config.<span class="hljs-property">mode</span> === <span class="hljs-string">&#x27;issues&#x27;</span>;
   <span class="hljs-keyword">let</span> mermaidDiagrams = [];

  <span class="hljs-keyword">if</span> (isFlowchart) {
    <span class="hljs-comment">// Process flowchart content and explanation</span>
    <span class="hljs-keyword">const</span> { diagrams, <span class="hljs-attr">processedExplanation</span>: newExplanation } = <span class="hljs-title function_">processFlowchartContent</span>(
      file.<span class="hljs-property">content</span>,
      processedExplanation
    );
    mermaidDiagrams = diagrams;
    processedExplanation = newExplanation;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// For non-flowchart files, process mermaid blocks normally</span>
    processedExplanation = <span class="hljs-title function_">extractMermaidBlocks</span>(processedExplanation);
  }

  <span class="hljs-comment">// Process markdown blocks</span>
  processedExplanation = <span class="hljs-title function_">extractMarkdownBlocks</span>(processedExplanation);

  <span class="hljs-comment">// Extract and preserve HTML tables</span>
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">processedContent</span>: contentWithoutTables, tables } = <span class="hljs-title function_">processHtmlTables</span>(processedExplanation);
  processedExplanation = contentWithoutTables;

  <span class="hljs-comment">// Render the explanation as HTML</span>
  <span class="hljs-keyword">let</span> renderedExplanation;
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> processedExplanation !== <span class="hljs-string">&#x27;string&#x27;</span>) {
      processedExplanation = <span class="hljs-title class_">String</span>(processedExplanation || <span class="hljs-string">&#x27;&#x27;</span>);
    }
    renderedExplanation = marked.<span class="hljs-title function_">parse</span>(processedExplanation);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Error parsing markdown for file:&#x27;</span>, file.<span class="hljs-property">path</span>, error);
    renderedExplanation = <span class="hljs-string">`&lt;pre&gt;<span class="hljs-subst">${escapeHtml(processedExplanation)}</span>&lt;/pre&gt;`</span>;
  }

  <span class="hljs-comment">// Restore the tables after markdown processing</span>
  renderedExplanation = <span class="hljs-title function_">restoreHtmlTables</span>(renderedExplanation, tables);

  <span class="hljs-comment">// For flowchart mode, diagrams are already embedded in the explanation</span>

  <span class="hljs-comment">// Prepare highlighted code content for dynamic loading</span>
  <span class="hljs-keyword">let</span> codeContentDiv = <span class="hljs-string">&#x27;&#x27;</span>;
  <span class="hljs-keyword">if</span> (isMultiFileMode) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// Read content from file since it may have been cleared for memory optimization</span>
      <span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>).<span class="hljs-property">promises</span>;
      <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(file.<span class="hljs-property">path</span>, <span class="hljs-string">&#x27;utf8&#x27;</span>);
      <span class="hljs-keyword">const</span> highlightedContent = <span class="hljs-title function_">highlightCode</span>(content, file.<span class="hljs-property">language</span>);
      codeContentDiv = <span class="hljs-string">`&lt;div class=&quot;code-content&quot; style=&quot;display: none;&quot;&gt;<span class="hljs-subst">${highlightedContent}</span>&lt;/div&gt;`</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-comment">// Fallback if file can&#x27;t be read</span>
      codeContentDiv = <span class="hljs-string">`&lt;div class=&quot;code-content&quot; style=&quot;display: none;&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// Error loading file content&lt;/span&gt;&lt;/div&gt;`</span>;
    }
  }

  <span class="hljs-keyword">return</span> <span class="hljs-string">`
 &lt;div class=&quot;file-entry col-12 mb-4&quot; id=&quot;file-<span class="hljs-subst">${fileIndex}</span>&quot; data-file-path=&quot;<span class="hljs-subst">${escapeHtml(file.path)}</span>&quot; data-file-index=&quot;<span class="hljs-subst">${fileIndex}</span>&quot;&gt;
     &lt;div class=&quot;card shadow-sm border-0 h-100&quot; style=&quot;border-radius: 12px; overflow: hidden;&quot;&gt;
         &lt;div class=&quot;card-header bg-gradient-primary text-white&quot; style=&quot;background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1rem 1.5rem;&quot;&gt;
             &lt;div class=&quot;d-flex justify-content-between align-items-center&quot;&gt;
                  &lt;h2 class=&quot;<span class="hljs-subst">${isMultiFileMode ? <span class="hljs-string">&#x27;toggle-code&#x27;</span> : <span class="hljs-string">&#x27;&#x27;</span>}</span> h5 fw-semibold mb-0 <span class="hljs-subst">${isMultiFileMode ? <span class="hljs-string">&#x27;cursor-pointer&#x27;</span> : <span class="hljs-string">&#x27;&#x27;</span>}</span> d-flex align-items-center text-white&quot; data-file-index=&quot;<span class="hljs-subst">${fileIndex}</span>&quot; style=&quot;font-size: 1.1rem;&quot;&gt;
                      <span class="hljs-subst">${isMultiFileMode ? <span class="hljs-string">&#x27;&lt;i class=&quot;fas fa-chevron-right me-2 transition-transform duration-200&quot;&gt;&lt;/i&gt;&#x27;</span> : <span class="hljs-string">&#x27;&#x27;</span>}</span>
                      &lt;i class=&quot;fas fa-<span class="hljs-subst">${isFlowchart ? <span class="hljs-string">&#x27;project-diagram&#x27;</span> : <span class="hljs-string">&#x27;file-code&#x27;</span>}</span> me-2&quot;&gt;&lt;/i&gt;
                      <span class="hljs-subst">${escapeHtml(file.relativePath || path.basename(file.path))}</span>
                  &lt;/h2&gt;
                 &lt;span class=&quot;badge bg-white bg-opacity-25 text-white px-2 py-1&quot; style=&quot;font-size: 0.75rem;&quot;&gt;
                     <span class="hljs-subst">${file.language || <span class="hljs-string">&#x27;text&#x27;</span>}</span>
                 &lt;/span&gt;
             &lt;/div&gt;
         &lt;/div&gt;

               &lt;div class=&quot;card-body p-0&quot;&gt;
                 <span class="hljs-subst">${isMultiFileMode ? <span class="hljs-string">`&lt;div class=&quot;code-container bg-light border-bottom d-none&quot; style=&quot;max-height: 400px; overflow: auto;&quot; data-file-path=&quot;<span class="hljs-subst">${escapeHtml(file.path)}</span>&quot; data-file-language=&quot;<span class="hljs-subst">${file.language}</span>&quot;&gt;
                     &lt;div class=&quot;p-3 text-center text-muted&quot;&gt;
                         &lt;div class=&quot;spinner-border spinner-border-sm me-2&quot; role=&quot;status&quot; style=&quot;display: none;&quot;&gt;&lt;/div&gt;
                         &lt;span class=&quot;loading-text&quot;&gt;Click to load code&lt;/span&gt;
                     &lt;/div&gt;
                     <span class="hljs-subst">${codeContentDiv}</span>
                 &lt;/div&gt;`</span> : <span class="hljs-string">&#x27;&#x27;</span>}</span>

             &lt;div class=&quot;p-4&quot;&gt;
                 &lt;div class=&quot;d-flex justify-content-between align-items-center mb-3&quot;&gt;
                     &lt;h3 class=&quot;h6 text-muted mb-0 d-flex align-items-center&quot;&gt;
                         &lt;i class=&quot;fas fa-brain me-2 text-primary&quot;&gt;&lt;/i&gt;
                         AI Explanation
                     &lt;/h3&gt;
                     &lt;button class=&quot;btn btn-outline-primary btn-sm copy-explanation&quot; data-file-index=&quot;<span class="hljs-subst">${fileIndex}</span>&quot; title=&quot;Copy explanation&quot;&gt;
                         &lt;i class=&quot;fas fa-copy me-1&quot;&gt;&lt;/i&gt; Copy
                     &lt;/button&gt;
                 &lt;/div&gt;
                 &lt;div class=&quot;explanation-content&quot;&gt;
                     <span class="hljs-subst">${renderedExplanation}</span>
                 &lt;/div&gt;
             &lt;/div&gt;
         &lt;/div&gt;
     &lt;/div&gt;
 &lt;/div&gt;`</span>;
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { <span class="hljs-title class_">HTMLOutput</span> };</div>
                 </div>

             <div class="p-4">
                 <div class="d-flex justify-content-between align-items-center mb-3">
                     <h3 class="h6 text-muted mb-0 d-flex align-items-center">
                         <i class="fas fa-brain me-2 text-primary"></i>
                         AI Explanation
                     </h3>
                     <button class="btn btn-outline-primary btn-sm copy-explanation" data-file-index="10" title="Copy explanation">
                         <i class="fas fa-copy me-1"></i> Copy
                     </button>
                 </div>
                 <div class="explanation-content">
                     <p>Certainly! Here&#39;s a detailed breakdown of the JavaScript file <code>htmlOutput.js</code>.</p>
<h3>Overview</h3>
<p>The <code>htmlOutput.js</code> module is responsible for generating HTML output, specifically rendering code explanations and visualizations derived from provided file analyses. It uses libraries such as <code>marked</code> for Markdown parsing, <code>highlight.js</code> for syntax highlighting, and has several utilities for processing HTML and content.</p>
<h3>Key Components:</h3>
<ol>
<li><p><strong>Imports</strong>:</p>
<ul>
<li><code>fs</code> and <code>path</code>: Core Node.js modules for file system operations and path handling.</li>
<li><code>marked</code>: A library for parsing Markdown into HTML.</li>
<li><code>highlight.js</code>: Used for syntax highlighting of code snippets.</li>
<li>Utility functions from relative paths are also included to help with HTML escape and ID generation.</li>
</ul>
</li>
<li><p><strong>Configuration of <code>marked</code></strong>:</p>
<ul>
<li><code>marked</code> is configured to integrate with <code>highlight.js</code> to automatically apply syntax highlighting to Markdown code blocks. This is facilitated through the <code>highlight</code> option in <code>marked.setOptions</code>.</li>
</ul>
</li>
<li><p><strong><code>highlightCode</code> Function</strong>:</p>
<ul>
<li>A utility function to highlight code snippets using <code>highlight.js</code>. It first checks if the provided language is supported; if not, it attempts to auto-detect.</li>
</ul>
</li>
<li><p><strong><code>HTMLOutput</code> Class</strong>:</p>
<ul>
<li><strong>Constructor</strong>: Initializes the class with a given configuration.</li>
<li><strong><code>generate</code> Method</strong>: Orchestrates the HTML generation process for a set of files, managing assets, sidebars, and streaming.</li>
<li><strong><code>generateStreamingHTML</code> Method</strong>: Writes HTML content to a file in a streaming manner to manage memory efficiently:<ul>
<li>Generates and writes HTML headers and footers.</li>
<li>Processes each file to create HTML entries, minimizing memory usage with large datasets.</li>
<li>Implements memory optimization techniques like nullifying file content references and suggesting garbage collection.</li>
</ul>
</li>
<li><strong><code>modifyTitleWithLabels</code> Method</strong>: Enhances the HTML title with labels based on file paths for better visualization.</li>
</ul>
</li>
<li><p><strong>Utility Functions</strong>:</p>
<ul>
<li><strong><code>extractMermaidBlocks</code> and <code>extractMarkdownBlocks</code></strong>: Process specific code block types (Mermaid and Markdown) within text to render them correctly in HTML.</li>
<li><strong><code>createFileTree</code> and <code>generateSidebarTree</code></strong>:<ul>
<li>Builds a hierarchical tree structure from file paths.</li>
<li>Generates HTML for sidebar navigation from the tree.</li>
</ul>
</li>
<li><strong>HTML Table Processing</strong>:<ul>
<li><strong><code>processHtmlTables</code> and <code>restoreHtmlTables</code></strong> handle extracting, replacing, and restoring HTML table contents to ensure they&#39;re maintained correctly during processing.</li>
</ul>
</li>
<li><strong><code>processFlowchartContent</code></strong>: Specifically for flowchart diagrams, it processes Mermaid diagrams directly embedded within content.</li>
</ul>
</li>
<li><p><strong>File Entry Generation</strong>:</p>
<ul>
<li>The <strong><code>generateFileEntry</code></strong> method creates HTML for each file in the analysis, including syntax-highlighted code sections and AI-generated explanations. It handles memory management efficiently by loading file content on demand.</li>
</ul>
</li>
</ol>
<h3>Overall Workflow:</h3>
<ul>
<li><strong>Initialization</strong>: Set up syntax highlighting and prepare the <code>HTMLOutput</code> instance with any configuration passed during instantiation.</li>
<li><strong>Generate HTML</strong>:<ul>
<li>If multiple files need processing, they are stored as an array.</li>
<li>Determine if sidebar and navigation are required based on configuration settings.</li>
<li>Create HTML content file by file, handling special syntax and content needs (Mermaid diagrams, Markdown blocks, etc.).</li>
<li>Use streaming to write results efficiently, reducing memory footprint and addressing large codebases.</li>
</ul>
</li>
</ul>
<h3>Additional Notes:</h3>
<ul>
<li>The code is structured to address both functional and non-functional requirements, such as performance optimizations.</li>
<li>It demonstrates a mix of synchronous and asynchronous operations, especially in file reading and HTML generation tasks.</li>
</ul>
<p>This module would be pivotal in applications that generate detailed explanations or documentation for codebases, offering insights and dynamic visualization as part of an interactive HTML export.</p>

                 </div>
             </div>
         </div>
     </div>
 </div>

 <div class="file-entry col-12 mb-4" id="file-11" data-file-path="D:\MyDev\CodeExplain\src\output\html\htmlTemplate.js" data-file-index="11">
     <div class="card shadow-sm border-0 h-100" style="border-radius: 12px; overflow: hidden;">
         <div class="card-header bg-gradient-primary text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1rem 1.5rem;">
             <div class="d-flex justify-content-between align-items-center">
                  <h2 class="toggle-code h5 fw-semibold mb-0 cursor-pointer d-flex align-items-center text-white" data-file-index="11" style="font-size: 1.1rem;">
                      <i class="fas fa-chevron-right me-2 transition-transform duration-200"></i>
                      <i class="fas fa-file-code me-2"></i>
                      output/html/htmlTemplate.js
                  </h2>
                 <span class="badge bg-white bg-opacity-25 text-white px-2 py-1" style="font-size: 0.75rem;">
                     javascript
                 </span>
             </div>
         </div>

               <div class="card-body p-0">
                 <div class="code-container bg-light border-bottom d-none" style="max-height: 400px; overflow: auto;" data-file-path="D:\MyDev\CodeExplain\src\output\html\htmlTemplate.js" data-file-language="javascript">
                     <div class="p-3 text-center text-muted">
                         <div class="spinner-border spinner-border-sm me-2" role="status" style="display: none;"></div>
                         <span class="loading-text">Click to load code</span>
                     </div>
                     <div class="code-content" style="display: none;"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>).<span class="hljs-property">promises</span>;
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);

<span class="hljs-comment">/**
 * HTML Template for CodeExplain output
 */</span>

<span class="hljs-comment">/**
 * Creates the HTML layout for multi-file modes (explain, issues) with sidebar and navigation
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">object</span>} <span class="hljs-variable">config</span> - Configuration object
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">title</span> - The page title
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">sidebarItems</span> - HTML for sidebar navigation
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">fileEntries</span> - HTML for file entries
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">object</span>} <span class="hljs-variable">assets</span> - { styles, jsCode, jsCodeFlowChart }
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} HTML layout string
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createMultiFileLayout</span>(<span class="hljs-params">config, title, sidebarItems, fileEntries, assets, headerOnly = <span class="hljs-literal">false</span>, footerOnly = <span class="hljs-literal">false</span>, showSidebarAndNavigation = <span class="hljs-literal">true</span></span>) {
    <span class="hljs-comment">// Handle title - can be string or object with html/plain properties</span>
    <span class="hljs-keyword">let</span> finalTitle = <span class="hljs-string">&#x27;AI-Powered Code Explanation&#x27;</span>;
    <span class="hljs-keyword">let</span> headerTitle = title;

    <span class="hljs-keyword">if</span> (title) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> title === <span class="hljs-string">&#x27;object&#x27;</span> &amp;&amp; title.<span class="hljs-property">plain</span>) {
            finalTitle = title.<span class="hljs-property">plain</span>;
            headerTitle = title.<span class="hljs-property">html</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> title === <span class="hljs-string">&#x27;string&#x27;</span>) {
            finalTitle = title.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&lt;[^&gt;]*&gt;/g</span>, <span class="hljs-string">&#x27;&#x27;</span>).<span class="hljs-title function_">trim</span>() || title;
            headerTitle = title;
        }
    }

    <span class="hljs-keyword">const</span> { styles, jsCode, jsCodeFlowChart } = assets;

    <span class="hljs-comment">// For streaming: return only header part</span>
    <span class="hljs-keyword">if</span> (headerOnly) {
        <span class="hljs-keyword">const</span> headerParts = [
            <span class="hljs-string">&#x27;&lt;!DOCTYPE html&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;&lt;html lang=&quot;en&quot;&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;&lt;head&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;title&gt;&#x27;</span> + finalTitle + <span class="hljs-string">&#x27;&lt;/title&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;!-- Critical CSS --&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css&quot;&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/base16/cupertino.min.css&quot;&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;!-- Critical JavaScript --&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;style&gt;&#x27;</span>,
            styles,
            <span class="hljs-string">&#x27;    &lt;/style&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;script&gt;&#x27;</span>,
            jsCode,
            (jsCodeFlowChart || <span class="hljs-string">&#x27;&#x27;</span>),
            <span class="hljs-string">&#x27;    &lt;/script&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;&lt;/head&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;body class=&quot;bg-light text-dark&quot; style=&quot;font-family: -apple-system, BlinkMacSystemFont, \&#x27;Segoe UI\&#x27;, Roboto, \&#x27;Helvetica Neue\&#x27;, Arial, sans-serif;&quot;&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;div id=&quot;app&quot; class=&quot;vh-100&quot;&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;        &lt;!-- Header --&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;        &lt;header class=&quot;bg-white shadow-sm position-fixed top-0 start-0 w-100 border-bottom&quot; style=&quot;z-index: 1030; backdrop-filter: blur(10px); background-color: rgba(255, 255, 255, 0.95);&quot;&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;            &lt;div class=&quot;container-fluid py-3 px-4&quot;&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;                &lt;div class=&quot;row align-items-center&quot;&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;                    &lt;div class=&quot;col-auto d-flex align-items-center&quot;&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;                        &lt;i class=&quot;fas fa-code text-primary me-3 fs-4&quot;&gt;&lt;/i&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;                         &lt;h1 class=&quot;h5 fw-bold text-dark mb-0&quot;&gt;&#x27;</span> + headerTitle + <span class="hljs-string">&#x27;&lt;/h1&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;                    &lt;/div&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;                    &lt;div class=&quot;col text-center d-none d-md-block&quot;&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;                        &lt;small class=&quot;text-muted&quot;&gt;AI-Powered Code Explanation&lt;/small&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;                    &lt;/div&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;                &lt;/div&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;            &lt;/div&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;        &lt;/header&gt;&#x27;</span>
        ];

        <span class="hljs-comment">// Conditionally add sidebar elements</span>
        <span class="hljs-keyword">if</span> (showSidebarAndNavigation) {
            headerParts.<span class="hljs-title function_">push</span>(
                <span class="hljs-string">&#x27;&#x27;</span>,
                <span class="hljs-string">&#x27;        &lt;!-- Sidebar Toggle Button (Mobile) --&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;        &lt;button id=&quot;sidebar-toggle&quot; class=&quot;btn btn-primary position-fixed d-none&quot; style=&quot;top: 16px; left: 16px; z-index: 1030; display: block;&quot; title=&quot;Toggle Sidebar&quot;&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;            &lt;i class=&quot;fas fa-bars&quot;&gt;&lt;/i&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;        &lt;/button&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;&#x27;</span>,
                <span class="hljs-string">&#x27;        &lt;!-- Sidebar Navigation --&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;        &lt;aside class=&quot;position-fixed bg-white border-end&quot; id=&quot;sidebar&quot; style=&quot;width: 280px; height: calc(100vh - 64px); top: 64px; left: 0; transform: translateX(0); opacity: 1; pointer-events: auto; transition: all 0.3s ease; z-index: 1000;&quot;&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;            &lt;div class=&quot;position-absolute&quot; style=&quot;top: 0; right: 0; width: 5px; height: 100%; cursor: ew-resize; background: rgba(0,0,0,0.1);&quot; id=&quot;sidebar-resizer&quot;&gt;&lt;/div&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;            &lt;div class=&quot;p-3 border-bottom&quot;&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;                &lt;h2 class=&quot;h6 fw-bold mb-0 text-muted d-flex align-items-center&quot;&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;                    &lt;i class=&quot;fas fa-folder-tree me-2&quot;&gt;&lt;/i&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;                    Project Files&#x27;</span>,
                <span class="hljs-string">&#x27;                &lt;/h2&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;            &lt;/div&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;            &lt;div class=&quot;sidebar-content&quot; style=&quot;height: calc(100% - 60px); overflow-y: auto;&quot;&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;                &lt;ul class=&quot;list-unstyled p-2&quot;&gt;&#x27;</span>,
                sidebarItems,
                <span class="hljs-string">&#x27;                &lt;/ul&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;            &lt;/div&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;        &lt;/aside&gt;&#x27;</span>
            );
        }

        headerParts.<span class="hljs-title function_">push</span>(
            <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-string">&#x27;        &lt;!-- Main Content --&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;        &lt;main style=&quot;&#x27;</span> + (showSidebarAndNavigation ? <span class="hljs-string">&#x27;margin-left: 280px; width: calc(100% - 280px);&#x27;</span> : <span class="hljs-string">&#x27;margin-left: 0; width: 100%;&#x27;</span>) + <span class="hljs-string">&#x27; margin-top: 96px; padding: 2rem; transition: margin-left 0.3s ease; min-height: calc(100vh - 96px);&quot;&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;            &lt;div class=&quot;container-fluid&quot;&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;                &lt;!-- File Entries --&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;                &lt;div id=&quot;file-entries&quot; class=&quot;row g-4&quot;&gt;&#x27;</span>
        );

        <span class="hljs-keyword">return</span> headerParts.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;\n&#x27;</span>);
    }

    <span class="hljs-comment">// For streaming: return only footer part</span>
    <span class="hljs-keyword">if</span> (footerOnly) {
        <span class="hljs-keyword">const</span> footerParts = [
            <span class="hljs-string">&#x27;                &lt;/div&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;            &lt;/div&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;        &lt;/main&gt;&#x27;</span>
        ];

        <span class="hljs-comment">// Conditionally add navigation arrows</span>
        <span class="hljs-keyword">if</span> (showSidebarAndNavigation) {
            footerParts.<span class="hljs-title function_">push</span>(
                <span class="hljs-string">&#x27;&#x27;</span>,
                <span class="hljs-string">&#x27;        &lt;!-- Navigation Arrows --&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;        &lt;div id=&quot;nav-arrows&quot; class=&quot;position-fixed d-none d-flex flex-column&quot; style=&quot;bottom: 20px; right: 20px; z-index: 1040; gap: 8px;&quot;&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;            &lt;button id=&quot;prev-file&quot; class=&quot;btn btn-primary btn-sm&quot; title=&quot;Previous file&quot;&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;                &lt;i class=&quot;fas fa-chevron-up&quot;&gt;&lt;/i&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;            &lt;/button&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;            &lt;button id=&quot;next-file&quot; class=&quot;btn btn-primary btn-sm&quot; title=&quot;Next file&quot;&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;                &lt;i class=&quot;fas fa-chevron-down&quot;&gt;&lt;/i&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;            &lt;/button&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;        &lt;/div&gt;&#x27;</span>
            );
        }

        footerParts.<span class="hljs-title function_">push</span>(
            <span class="hljs-string">&#x27;    &lt;/div&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;!-- Non-critical scripts --&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;!-- Load common programming languages for syntax highlighting --&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/python.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/javascript.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/typescript.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/java.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/cpp.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/csharp.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/ruby.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/go.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/rust.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/php.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;     &lt;script src=&quot;https://cdn.jsdelivr.net/npm/marked@9.1.0/marked.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;     &lt;script src=&quot;https://cdn.jsdelivr.net/npm/marked-highlight@2.1.0/lib/index.umd.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;     &lt;script src=&quot;https://cdn.jsdelivr.net/npm/mermaid@11.0.0/dist/mermaid.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
            <span class="hljs-string">&#x27;&lt;/html&gt;&#x27;</span>
        );

        <span class="hljs-keyword">return</span> footerParts.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;\n&#x27;</span>);
    }

    <span class="hljs-comment">// Regular complete HTML return</span>
    <span class="hljs-keyword">return</span> [
        <span class="hljs-string">&#x27;&lt;!DOCTYPE html&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;&lt;html lang=&quot;en&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;&lt;head&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;title&gt;&#x27;</span> + finalTitle + <span class="hljs-string">&#x27;&lt;/title&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;!-- Critical CSS --&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/base16/cupertino.min.css&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;!-- Critical JavaScript --&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;style&gt;&#x27;</span>,
        styles,
        <span class="hljs-string">&#x27;    &lt;/style&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script&gt;&#x27;</span>,
        jsCode,
        (jsCodeFlowChart || <span class="hljs-string">&#x27;&#x27;</span>),
        <span class="hljs-string">&#x27;    &lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;&lt;/head&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;body class=&quot;bg-light text-dark&quot; style=&quot;font-family: -apple-system, BlinkMacSystemFont, \&#x27;Segoe UI\&#x27;, Roboto, \&#x27;Helvetica Neue\&#x27;, Arial, sans-serif;&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;div id=&quot;app&quot; class=&quot;vh-100&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;!-- Header --&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;header class=&quot;bg-white shadow-sm position-fixed top-0 start-0 w-100 border-bottom&quot; style=&quot;z-index: 1030; backdrop-filter: blur(10px); background-color: rgba(255, 255, 255, 0.95);&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;            &lt;div class=&quot;container-fluid py-3 px-4&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                &lt;div class=&quot;row align-items-center&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                    &lt;div class=&quot;col-auto d-flex align-items-center&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                        &lt;i class=&quot;fas fa-code text-primary me-3 fs-4&quot;&gt;&lt;/i&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                         &lt;h1 class=&quot;h5 fw-bold text-dark mb-0&quot;&gt;&#x27;</span> + headerTitle + <span class="hljs-string">&#x27;&lt;/h1&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                    &lt;/div&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                    &lt;div class=&quot;col text-center d-none d-md-block&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                        &lt;small class=&quot;text-muted&quot;&gt;AI-Powered Code Explanation&lt;/small&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                    &lt;/div&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                &lt;/div&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;            &lt;/div&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;/header&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;!-- Sidebar Toggle Button (Mobile) --&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;button id=&quot;sidebar-toggle&quot; class=&quot;btn btn-primary position-fixed d-none&quot; style=&quot;top: 16px; left: 16px; z-index: 1030; display: block;&quot; title=&quot;Toggle Sidebar&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;            &lt;i class=&quot;fas fa-bars&quot;&gt;&lt;/i&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;/button&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;!-- Sidebar Navigation --&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;aside class=&quot;position-fixed bg-white border-end&quot; id=&quot;sidebar&quot; style=&quot;width: 280px; height: calc(100vh - 64px); top: 64px; left: 0; transform: translateX(0); opacity: 1; pointer-events: auto; transition: all 0.3s ease; z-index: 1000;&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;            &lt;div class=&quot;position-absolute&quot; style=&quot;top: 0; right: 0; width: 5px; height: 100%; cursor: ew-resize; background: rgba(0,0,0,0.1);&quot; id=&quot;sidebar-resizer&quot;&gt;&lt;/div&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;            &lt;div class=&quot;p-3 border-bottom&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                &lt;h2 class=&quot;h6 fw-bold mb-0 text-muted d-flex align-items-center&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                    &lt;i class=&quot;fas fa-folder-tree me-2&quot;&gt;&lt;/i&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                    Project Files&#x27;</span>,
        <span class="hljs-string">&#x27;                &lt;/h2&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;            &lt;/div&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;            &lt;div class=&quot;sidebar-content&quot; style=&quot;height: calc(100% - 60px); overflow-y: auto;&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                &lt;ul class=&quot;list-unstyled p-2&quot;&gt;&#x27;</span>,
        sidebarItems,
        <span class="hljs-string">&#x27;                &lt;/ul&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;            &lt;/div&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;/aside&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;!-- Main Content --&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;main style=&quot;margin-left: 280px; width: calc(100% - 280px); margin-top: 96px; padding: 2rem; transition: margin-left 0.3s ease; min-height: calc(100vh - 96px);&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;            &lt;div class=&quot;container-fluid&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                &lt;!-- File Entries --&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                &lt;div id=&quot;file-entries&quot; class=&quot;row g-4&quot;&gt;&#x27;</span>,
        fileEntries,
        <span class="hljs-string">&#x27;                &lt;/div&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;            &lt;/div&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;/main&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;!-- Navigation Arrows --&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;div id=&quot;nav-arrows&quot; class=&quot;position-fixed d-none d-flex flex-column&quot; style=&quot;bottom: 20px; right: 20px; z-index: 1040; gap: 8px;&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;            &lt;button id=&quot;prev-file&quot; class=&quot;btn btn-primary btn-sm&quot; title=&quot;Previous file&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                &lt;i class=&quot;fas fa-chevron-up&quot;&gt;&lt;/i&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;            &lt;/button&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;            &lt;button id=&quot;next-file&quot; class=&quot;btn btn-primary btn-sm&quot; title=&quot;Next file&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                &lt;i class=&quot;fas fa-chevron-down&quot;&gt;&lt;/i&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;            &lt;/button&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;/div&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;/div&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;!-- Non-critical scripts --&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;!-- Load common programming languages for syntax highlighting --&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/python.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/javascript.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/typescript.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/java.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/cpp.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/csharp.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/ruby.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/go.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/rust.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/php.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;     &lt;script src=&quot;https://cdn.jsdelivr.net/npm/marked@9.1.0/marked.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;     &lt;script src=&quot;https://cdn.jsdelivr.net/npm/marked-highlight@2.1.0/lib/index.umd.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;     &lt;script src=&quot;https://cdn.jsdelivr.net/npm/mermaid@11.0.0/dist/mermaid.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;&lt;/html&gt;&#x27;</span>
    ].<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;\n&#x27;</span>);
}

<span class="hljs-comment">/**
 * Creates the HTML layout for single/overview modes (linebyline, architecture, onboarding) without sidebar and navigation
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">object</span>} <span class="hljs-variable">config</span> - Configuration object
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">title</span> - The page title
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">sidebarItems</span> - HTML for sidebar navigation (ignored)
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">fileEntries</span> - HTML for file entries
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">object</span>} <span class="hljs-variable">assets</span> - { styles, jsCode, jsCodeFlowChart }
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} HTML layout string
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createSingleFileLayout</span>(<span class="hljs-params">config, title, sidebarItems, fileEntries, assets</span>) {
    <span class="hljs-comment">// Handle title - can be string or object with html/plain properties</span>
    <span class="hljs-keyword">let</span> finalTitle = <span class="hljs-string">&#x27;AI-Powered Code Explanation&#x27;</span>;
    <span class="hljs-keyword">let</span> headerTitle = title;

    <span class="hljs-keyword">if</span> (title) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> title === <span class="hljs-string">&#x27;object&#x27;</span> &amp;&amp; title.<span class="hljs-property">plain</span>) {
            finalTitle = title.<span class="hljs-property">plain</span>;
            headerTitle = title.<span class="hljs-property">html</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> title === <span class="hljs-string">&#x27;string&#x27;</span>) {
            finalTitle = title.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&lt;[^&gt;]*&gt;/g</span>, <span class="hljs-string">&#x27;&#x27;</span>).<span class="hljs-title function_">trim</span>() || title;
            headerTitle = title;
        }
    }

    <span class="hljs-keyword">const</span> { styles, jsCode, jsCodeFlowChart } = assets;
    <span class="hljs-keyword">return</span> [
        <span class="hljs-string">&#x27;&lt;!DOCTYPE html&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;&lt;html lang=&quot;en&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;&lt;head&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;title&gt;&#x27;</span> + finalTitle + <span class="hljs-string">&#x27;&lt;/title&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;!-- Critical CSS --&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/base16/cupertino.min.css&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;!-- Critical JavaScript --&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;style&gt;&#x27;</span>,
        styles,
        <span class="hljs-string">&#x27;    &lt;/style&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script&gt;&#x27;</span>,
        jsCode,
        (jsCodeFlowChart || <span class="hljs-string">&#x27;&#x27;</span>),
        <span class="hljs-string">&#x27;    &lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;&lt;/head&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;body class=&quot;bg-light text-dark&quot; style=&quot;font-family: -apple-system, BlinkMacSystemFont, \&#x27;Segoe UI\&#x27;, Roboto, \&#x27;Helvetica Neue\&#x27;, Arial, sans-serif;&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;div id=&quot;app&quot; class=&quot;vh-100&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;!-- Header --&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;header class=&quot;bg-white shadow-sm position-fixed top-0 start-0 w-100 border-bottom&quot; style=&quot;z-index: 1030; backdrop-filter: blur(10px); background-color: rgba(255, 255, 255, 0.95);&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;            &lt;div class=&quot;container-fluid py-3 px-4&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                &lt;div class=&quot;row align-items-center&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                    &lt;div class=&quot;col-auto d-flex align-items-center&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                        &lt;i class=&quot;fas fa-code text-primary me-3 fs-4&quot;&gt;&lt;/i&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                         &lt;h1 class=&quot;h5 fw-bold text-dark mb-0&quot;&gt;&#x27;</span> + headerTitle + <span class="hljs-string">&#x27;&lt;/h1&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                    &lt;/div&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                    &lt;div class=&quot;col text-center d-none d-md-block&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                        &lt;small class=&quot;text-muted&quot;&gt;AI-Powered Code Explanation&lt;/small&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                    &lt;/div&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                &lt;/div&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;            &lt;/div&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;/header&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;!-- Main Content --&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;main style=&quot;margin-left: 0px; width: 100%; margin-top: 96px; padding: 2rem; transition: margin-left 0.3s ease; min-height: calc(100vh - 96px);&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;            &lt;div class=&quot;container-fluid&quot;&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                &lt;!-- File Entries --&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;                &lt;div id=&quot;file-entries&quot; class=&quot;row g-4&quot;&gt;&#x27;</span>,
        fileEntries,
        <span class="hljs-string">&#x27;                &lt;/div&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;            &lt;/div&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;        &lt;/main&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;/div&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;!-- Non-critical scripts --&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;!-- Load common programming languages for syntax highlighting --&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/python.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/javascript.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/typescript.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/java.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/cpp.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/csharp.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/ruby.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/go.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/rust.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/php.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;     &lt;script src=&quot;https://cdn.jsdelivr.net/npm/marked@9.1.0/marked.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;     &lt;script src=&quot;https://cdn.jsdelivr.net/npm/marked-highlight@2.1.0/lib/index.umd.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;     &lt;script src=&quot;https://cdn.jsdelivr.net/npm/mermaid@11.0.0/dist/mermaid.min.js&quot; defer&gt;&lt;/script&gt;&#x27;</span>,
        <span class="hljs-string">&#x27;&lt;/html&gt;&#x27;</span>
    ].<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;\n&#x27;</span>);
}

<span class="hljs-comment">/**

 * Creates the complete HTML template for the output
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">object</span>} <span class="hljs-variable">config</span> - Configuration object
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">title</span> - The page title
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">sidebarItems</span> - HTML for sidebar navigation
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">fileEntries</span> - HTML for file entries
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">object</span>} <span class="hljs-variable">assets</span> - { styles, jsCode, jsCodeFlowChart }
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} Complete HTML document
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createHTMLTemplate</span>(<span class="hljs-params">config, title, sidebarItems, fileEntries, assets, headerOnly = <span class="hljs-literal">false</span>, footerOnly = <span class="hljs-literal">false</span>, showSidebarAndNavigation = <span class="hljs-literal">true</span></span>) {
    <span class="hljs-comment">// Determine which layout to use based on mode</span>
    <span class="hljs-keyword">const</span> isMultiFileMode = config.<span class="hljs-property">mode</span> === <span class="hljs-string">&#x27;explain&#x27;</span> || config.<span class="hljs-property">mode</span> === <span class="hljs-string">&#x27;issues&#x27;</span>;

    <span class="hljs-keyword">if</span> (headerOnly) {
        <span class="hljs-comment">// Return only the header part for streaming</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">createMultiFileLayout</span>(config, title, sidebarItems, fileEntries, assets, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>, showSidebarAndNavigation);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (footerOnly) {
        <span class="hljs-comment">// Return only the footer part for streaming</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">createMultiFileLayout</span>(config, title, sidebarItems, fileEntries, assets, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>, showSidebarAndNavigation);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isMultiFileMode) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">createMultiFileLayout</span>(config, title, sidebarItems, fileEntries, assets, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">createSingleFileLayout</span>(config, title, sidebarItems, fileEntries, assets);
    }
}

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;{styles: string, jsCode: string, jsCodeFlowChart: string</span>}&gt;}
 */</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadHTMLAssets</span>(<span class="hljs-params">config</span>) {
    <span class="hljs-keyword">const</span> stylesPath = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;_css.css&#x27;</span>);
    <span class="hljs-keyword">const</span> jsPath = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;_js.js&#x27;</span>);
    <span class="hljs-keyword">const</span> isFlowchart = config.<span class="hljs-property">mode</span> === <span class="hljs-string">&#x27;flowchart&#x27;</span>;
    <span class="hljs-keyword">const</span> [styles, jsCode] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
        fs.<span class="hljs-title function_">readFile</span>(stylesPath, <span class="hljs-string">&#x27;utf8&#x27;</span>),
        fs.<span class="hljs-title function_">readFile</span>(jsPath, <span class="hljs-string">&#x27;utf8&#x27;</span>)
    ]);
    <span class="hljs-keyword">let</span> jsCodeFlowChart = <span class="hljs-string">&#x27;&#x27;</span>;
    <span class="hljs-keyword">if</span> (isFlowchart) {
        <span class="hljs-keyword">const</span> jsflowChartPath = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;_flowchart.js&#x27;</span>);
        jsCodeFlowChart = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(jsflowChartPath, <span class="hljs-string">&#x27;utf8&#x27;</span>);
    }
    <span class="hljs-keyword">return</span> { styles, jsCode, jsCodeFlowChart };
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { createHTMLTemplate, loadHTMLAssets };</div>
                 </div>

             <div class="p-4">
                 <div class="d-flex justify-content-between align-items-center mb-3">
                     <h3 class="h6 text-muted mb-0 d-flex align-items-center">
                         <i class="fas fa-brain me-2 text-primary"></i>
                         AI Explanation
                     </h3>
                     <button class="btn btn-outline-primary btn-sm copy-explanation" data-file-index="11" title="Copy explanation">
                         <i class="fas fa-copy me-1"></i> Copy
                     </button>
                 </div>
                 <div class="explanation-content">
                     <p>Certainly! Let&#39;s break down the JavaScript file <code>htmlTemplate.js</code> located at <code>D:\MyDev\CodeExplain\src\output\html\</code> into manageable parts and explain each section clearly.</p>
<h3>Overview</h3>
<p>This JavaScript module primarily focuses on generating HTML templates for different modes of an application. It allows for creating HTML layouts with optional components like sidebars and navigation, depending on the application mode. It also includes utility functions to load necessary CSS and JavaScript assets for the HTML pages.</p>
<h3>Code Explained</h3>
<h4>Import Statements</h4>
<pre><code class="language-javascript">const fs = require(&#39;fs&#39;).promises;
const path = require(&#39;path&#39;);
</code></pre>
<ul>
<li><strong><code>fs</code>:</strong> This module is used to handle file system operations. Using <code>fs.promises</code>, allows us to use the <code>async/await</code> syntax for file operations.</li>
<li><strong><code>path</code>:</strong> This module provides utilities for working with file and directory paths. It ensures platform-independent path construction.</li>
</ul>
<h4>Functions</h4>
<ol>
<li><p><strong><code>createMultiFileLayout(config, title, sidebarItems, fileEntries, assets, headerOnly, footerOnly, showSidebarAndNavigation)</code></strong></p>
<ul>
<li><strong>Purpose:</strong> Generates an HTML layout suitable for environments with multiple files (like a detailed explanation or issues report).</li>
<li><strong>Parameters:</strong><ul>
<li><code>config</code>: Configuration object for modifying behavior.</li>
<li><code>title</code>: Title of the HTML page which can be a string or an object with <code>html</code> and <code>plain</code> properties.</li>
<li><code>sidebarItems</code>: HTML content for the sidebar.</li>
<li><code>fileEntries</code>: HTML content for the main file entries.</li>
<li><code>assets</code>: An object containing <code>styles</code>, <code>jsCode</code>, and <code>jsCodeFlowChart</code>.</li>
<li><code>headerOnly</code>, <code>footerOnly</code>, <code>showSidebarAndNavigation</code>: Boolean flags to control what parts of the layout are rendered.</li>
</ul>
</li>
<li><strong>Functionality:</strong> <ul>
<li>Adjusts the page title based on the <code>title</code> parameter.</li>
<li>Constructs different parts of the HTML string either entirely or as header/footer parts based on the flags provided.</li>
<li>Integrates CSS and JavaScript assets within the HTML.</li>
</ul>
</li>
</ul>
</li>
<li><p><strong><code>createSingleFileLayout(config, title, sidebarItems, fileEntries, assets)</code></strong></p>
<ul>
<li><strong>Purpose:</strong> Creates an HTML layout for single-file scenarios where sidebars and navigation are not required.</li>
<li><strong>Parameters:</strong> Similar to <code>createMultiFileLayout</code>, but ignores <code>sidebarItems</code>.</li>
<li><strong>Functionality:</strong> <ul>
<li>Generates a simple HTML output with the given title and content, using the assets for styles and scripts.</li>
</ul>
</li>
</ul>
</li>
<li><p><strong><code>createHTMLTemplate(config, title, sidebarItems, fileEntries, assets, headerOnly, footerOnly, showSidebarAndNavigation)</code></strong></p>
<ul>
<li><strong>Purpose:</strong> Determines which layout function to use (<code>multi-file</code> or <code>single-file</code>) based on the mode in the config.</li>
<li><strong>Parameters:</strong> Inherits parameters from the previous functions.</li>
<li><strong>Functionality:</strong> <ul>
<li>Decides whether to render just a header, footer, or a complete HTML based on provided flags and the application&#39;s mode.</li>
</ul>
</li>
</ul>
</li>
<li><p><strong><code>async loadHTMLAssets(config)</code></strong></p>
<ul>
<li><strong>Purpose:</strong> Loads the necessary CSS and JavaScript files from the file system asynchronously.</li>
<li><strong>Parameters:</strong> <ul>
<li><code>config</code>: Configuration object used to determine additional script loading (e.g., for flowchart modes).</li>
</ul>
</li>
<li><strong>Functionality:</strong><ul>
<li>Reads the content of specific CSS and JavaScript files.</li>
<li>Optionally, loads an additional JavaScript file if the current mode supports flowcharts.</li>
</ul>
</li>
<li><strong>Returns:</strong> An object containing the loaded CSS and JavaScript as strings.</li>
</ul>
</li>
</ol>
<h4>Exports</h4>
<pre><code class="language-javascript">module.exports = { createHTMLTemplate, loadHTMLAssets };
</code></pre>
<ul>
<li><strong>Exports the functions</strong> <code>createHTMLTemplate</code> and <code>loadHTMLAssets</code> so they can be used in other modules/files.</li>
</ul>
<h3>Summary</h3>
<p>This module is designed to dynamically construct HTML structures for different modes of visualization (multi-file vs. single-file) within a software tool that explains code. It includes well-defined functions to switch between layouts, and load external assets asynchronously, enabling a smooth and adaptable user interface experience. The use of modern JavaScript patterns ensures code that is both efficient and maintainable.</p>

                 </div>
             </div>
         </div>
     </div>
 </div>

 <div class="file-entry col-12 mb-4" id="file-12" data-file-path="D:\MyDev\CodeExplain\src\output\html\_css.css" data-file-index="12">
     <div class="card shadow-sm border-0 h-100" style="border-radius: 12px; overflow: hidden;">
         <div class="card-header bg-gradient-primary text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1rem 1.5rem;">
             <div class="d-flex justify-content-between align-items-center">
                  <h2 class="toggle-code h5 fw-semibold mb-0 cursor-pointer d-flex align-items-center text-white" data-file-index="12" style="font-size: 1.1rem;">
                      <i class="fas fa-chevron-right me-2 transition-transform duration-200"></i>
                      <i class="fas fa-file-code me-2"></i>
                      output/html/_css.css
                  </h2>
                 <span class="badge bg-white bg-opacity-25 text-white px-2 py-1" style="font-size: 0.75rem;">
                     css
                 </span>
             </div>
         </div>

               <div class="card-body p-0">
                 <div class="code-container bg-light border-bottom d-none" style="max-height: 400px; overflow: auto;" data-file-path="D:\MyDev\CodeExplain\src\output\html\_css.css" data-file-language="css">
                     <div class="p-3 text-center text-muted">
                         <div class="spinner-border spinner-border-sm me-2" role="status" style="display: none;"></div>
                         <span class="loading-text">Click to load code</span>
                     </div>
                     <div class="code-content" style="display: none;"><span class="hljs-comment">/* Sidebar styles */</span>
<span class="hljs-selector-id">#sidebar</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">123</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#0056b3</span>;
}

<span class="hljs-selector-id">#sidebar</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.active</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#007bff</span>;
    <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-id">#sidebar</span> <span class="hljs-selector-class">.folder-toggle</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">123</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#0056b3</span>;
}

<span class="hljs-comment">/* Sidebar list styling */</span>
<span class="hljs-selector-id">#sidebar</span> <span class="hljs-selector-tag">ul</span> {
    <span class="hljs-attribute">list-style</span>: none;
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.3</span>;
}

<span class="hljs-selector-id">#sidebar</span> <span class="hljs-selector-tag">li</span> {
    <span class="hljs-attribute">list-style</span>: none;
}

<span class="hljs-comment">/* Main content typography and styling */</span>
<span class="hljs-selector-class">.explanation-content</span> {
    <span class="hljs-attribute">font-family</span>: -apple-system, BlinkMacSystemFont, <span class="hljs-string">&#x27;Segoe UI&#x27;</span>, Roboto, <span class="hljs-string">&#x27;Helvetica Neue&#x27;</span>, Arial, sans-serif;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#495057</span>;
}

<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">h1</span>,
<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">h2</span>,
<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">h3</span>,
<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">h4</span>,
<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">h5</span>,
<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">h6</span> {
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#212529</span>;
    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
    <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">1.5rem</span>;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">0.75rem</span>;
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.3</span>;
}

<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">h1</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.75rem</span>;
}

<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">h2</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
}

<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">h3</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.25rem</span>;
}

<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">h4</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.1rem</span>;
}

<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">h5</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1rem</span>;
}

<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">h6</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.9rem</span>;
}

<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">p</span> {
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">1rem</span>;
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.7</span>;
    <span class="hljs-attribute">text-align</span>: justify;
}

<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">ul</span>,
<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">ol</span> {
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">1rem</span>;
    <span class="hljs-attribute">padding-left</span>: <span class="hljs-number">1.5rem</span>;
}

<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">li</span> {
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">0.5rem</span>;
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>;
}

<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">p</span> {
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">0.5rem</span>;
}

<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">code</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f8f9fa</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0.125rem</span> <span class="hljs-number">0.25rem</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">0.25rem</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.875em</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#d73a49</span>;
    <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&#x27;SF Mono&#x27;</span>, Monaco, <span class="hljs-string">&#x27;Cascadia Code&#x27;</span>, <span class="hljs-string">&#x27;Roboto Mono&#x27;</span>, Consolas, <span class="hljs-string">&#x27;Courier New&#x27;</span>, monospace;
}

<span class="hljs-selector-class">.explanation-content</span> pre {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f8f9fa</span>;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e9ecef</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">0.375rem</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">1rem</span>;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">1rem</span> <span class="hljs-number">0</span>;
    <span class="hljs-attribute">overflow-x</span>: auto;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.875rem</span>;
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.5</span>;
}

<span class="hljs-selector-class">.explanation-content</span> pre <span class="hljs-selector-tag">code</span> {
    <span class="hljs-attribute">background-color</span>: transparent;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">color</span>: inherit;
    <span class="hljs-attribute">border</span>: none;
}

<span class="hljs-comment">/* Ensure highlight.js styles don&#x27;t conflict */</span>
<span class="hljs-selector-class">.explanation-content</span> pre<span class="hljs-selector-class">.hljs</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f8f9fa</span>;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e9ecef</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">0.375rem</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">1rem</span>;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">1rem</span> <span class="hljs-number">0</span>;
    <span class="hljs-attribute">overflow-x</span>: auto;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.875rem</span>;
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.5</span>;
}

<span class="hljs-comment">/* Code block styling */</span>
<span class="hljs-selector-class">.code-container</span> pre <span class="hljs-selector-tag">code</span> {
    <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&#x27;SF Mono&#x27;</span>, Monaco, <span class="hljs-string">&#x27;Cascadia Code&#x27;</span>, <span class="hljs-string">&#x27;Roboto Mono&#x27;</span>, Consolas, <span class="hljs-string">&#x27;Courier New&#x27;</span>, monospace <span class="hljs-meta">!important</span>;
}

<span class="hljs-comment">/* Ensure highlight.js styles are applied to code container */</span>
<span class="hljs-selector-class">.code-container</span> pre <span class="hljs-selector-tag">code</span><span class="hljs-selector-class">.hljs</span> {
    <span class="hljs-attribute">background</span>: transparent;
    <span class="hljs-attribute">color</span>: inherit;
}

<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">blockquote</span> {
    <span class="hljs-attribute">border-left</span>: <span class="hljs-number">4px</span> solid <span class="hljs-number">#007bff</span>;
    <span class="hljs-attribute">padding-left</span>: <span class="hljs-number">1rem</span>;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">1.5rem</span> <span class="hljs-number">0</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#6c757d</span>;
    <span class="hljs-attribute">font-style</span>: italic;
}

<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">table</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">1rem</span>;
    <span class="hljs-attribute">border-collapse</span>: collapse;
}

<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">th</span>,
<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">td</span> {
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0.75rem</span>;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#dee2e6</span>;
    <span class="hljs-attribute">text-align</span>: left;
}

<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">th</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f8f9fa</span>;
    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
}

<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">strong</span> {
    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#212529</span>;
}

<span class="hljs-selector-class">.explanation-content</span> <span class="hljs-selector-tag">em</span> {
    <span class="hljs-attribute">font-style</span>: italic;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#495057</span>;
}

<span class="hljs-comment">/* Card improvements */</span>
<span class="hljs-selector-class">.card</span> {
    <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.2s</span> ease, box-shadow <span class="hljs-number">0.2s</span> ease;
}

<span class="hljs-comment">/* File name hover cursor */</span>
<span class="hljs-selector-class">.toggle-code</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">cursor</span>: pointer;
}

<span class="hljs-comment">/* Navigation arrows */</span>
<span class="hljs-selector-id">#nav-arrows</span> {
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.8</span>;
    <span class="hljs-attribute">transition</span>: opacity <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-selector-id">#nav-arrows</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
}

<span class="hljs-comment">/* Zoom controls */</span>
<span class="hljs-selector-class">.btn-group</span> <span class="hljs-selector-class">.btn</span><span class="hljs-selector-pseudo">:disabled</span> {
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.5</span>;
    <span class="hljs-attribute">cursor</span>: not-allowed;
}

<span class="hljs-selector-class">.btn-group</span> <span class="hljs-selector-class">.btn</span> {
    <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span> ease;
}

<span class="hljs-selector-class">.btn-group</span> <span class="hljs-selector-class">.btn</span><span class="hljs-selector-pseudo">:hover</span><span class="hljs-selector-pseudo">:not</span>(<span class="hljs-selector-pseudo">:disabled</span>) {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">1px</span>);
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
}

<span class="hljs-comment">/* Mermaid diagram controls */</span>
<span class="hljs-selector-class">.mermaid-controls</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">justify-content</span>: center;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">10px</span> <span class="hljs-number">0</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
    <span class="hljs-attribute">background</span>: <span class="hljs-number">#f8f9fa</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#dee2e6</span>;
    <span class="hljs-attribute">position</span>: relative;
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">10</span>;
    <span class="hljs-comment">/* Ensure controls are above the diagram */</span>
    <span class="hljs-attribute">contain</span>: layout style;
    <span class="hljs-comment">/* Isolate controls from diagram transforms */</span>
}

<span class="hljs-selector-class">.mermaid-controls</span> <span class="hljs-selector-class">.btn</span> {
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">6px</span> <span class="hljs-number">12px</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.875rem</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
}

<span class="hljs-selector-class">.zoom-level</span> {
    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#495057</span>;
    <span class="hljs-attribute">min-width</span>: <span class="hljs-number">60px</span>;
    <span class="hljs-attribute">text-align</span>: center;
}

<span class="hljs-comment">/* Responsive mermaid containers */</span>
<span class="hljs-selector-class">.mermaid-diagram-container</span> {
    <span class="hljs-attribute">position</span>: relative;
    <span class="hljs-attribute">overflow</span>: hidden;
    <span class="hljs-comment">/* Ensure diagram doesn&#x27;t overflow container */</span>
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#dee2e6</span>;
    <span class="hljs-attribute">background</span>: white;
    <span class="hljs-attribute">min-height</span>: <span class="hljs-number">200px</span>;
    <span class="hljs-attribute">contain</span>: layout;
    <span class="hljs-comment">/* Isolate layout calculations */</span>
}

<span class="hljs-selector-class">.mermaid</span> {
    <span class="hljs-attribute">display</span>: block;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">min-height</span>: <span class="hljs-number">200px</span>;
    <span class="hljs-attribute">cursor</span>: grab;
    <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.1s</span> ease;
    <span class="hljs-attribute">position</span>: relative;
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;
    <span class="hljs-comment">/* Ensure diagram is below controls */</span>
    <span class="hljs-attribute">contain</span>: layout style paint;
    <span class="hljs-comment">/* Isolate diagram from controls */</span>
}

<span class="hljs-selector-class">.mermaid</span> <span class="hljs-selector-tag">svg</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">height</span>: auto;
    <span class="hljs-attribute">min-height</span>: <span class="hljs-number">200px</span>;
}

<span class="hljs-selector-class">.mermaid</span><span class="hljs-selector-class">.dragging</span> {
    <span class="hljs-attribute">cursor</span>: grabbing;
}

<span class="hljs-selector-class">.mermaid-zoomable</span> {
    <span class="hljs-attribute">transform-origin</span>: center center;
}

<span class="hljs-comment">/* Fullscreen mode */</span>
<span class="hljs-selector-class">.mermaid-fullscreen</span> {
    <span class="hljs-attribute">position</span>: fixed <span class="hljs-meta">!important</span>;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span> <span class="hljs-meta">!important</span>;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span> <span class="hljs-meta">!important</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span> <span class="hljs-meta">!important</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span> <span class="hljs-meta">!important</span>;
    <span class="hljs-attribute">background</span>: white <span class="hljs-meta">!important</span>;
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">9999</span> <span class="hljs-meta">!important</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span> <span class="hljs-meta">!important</span>;
    <span class="hljs-attribute">box-sizing</span>: border-box <span class="hljs-meta">!important</span>;
}

<span class="hljs-selector-class">.mermaid-fullscreen</span> <span class="hljs-selector-tag">svg</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span> <span class="hljs-meta">!important</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span> <span class="hljs-meta">!important</span>;
}

<span class="hljs-selector-class">.fullscreen-overlay</span> {
    <span class="hljs-attribute">position</span>: fixed;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.8</span>);
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">9998</span>;
    <span class="hljs-attribute">display</span>: none;
}

<span class="hljs-selector-class">.fullscreen-overlay</span><span class="hljs-selector-class">.active</span> {
    <span class="hljs-attribute">display</span>: block;
}

<span class="hljs-comment">/* Responsive breakpoints for diagrams */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
    <span class="hljs-selector-class">.mermaid-diagram-container</span> {
        <span class="hljs-attribute">min-height</span>: <span class="hljs-number">150px</span>;
    }

    <span class="hljs-selector-class">.mermaid</span> <span class="hljs-selector-tag">svg</span> {
        <span class="hljs-attribute">min-height</span>: <span class="hljs-number">150px</span>;
    }

    <span class="hljs-selector-class">.mermaid-controls</span> {
        <span class="hljs-attribute">flex-wrap</span>: wrap;
        <span class="hljs-attribute">gap</span>: <span class="hljs-number">5px</span>;
    }

    <span class="hljs-selector-class">.mermaid-controls</span> <span class="hljs-selector-class">.btn</span> {
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">4px</span> <span class="hljs-number">8px</span>;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.75rem</span>;
    }
}</div>
                 </div>

             <div class="p-4">
                 <div class="d-flex justify-content-between align-items-center mb-3">
                     <h3 class="h6 text-muted mb-0 d-flex align-items-center">
                         <i class="fas fa-brain me-2 text-primary"></i>
                         AI Explanation
                     </h3>
                     <button class="btn btn-outline-primary btn-sm copy-explanation" data-file-index="12" title="Copy explanation">
                         <i class="fas fa-copy me-1"></i> Copy
                     </button>
                 </div>
                 <div class="explanation-content">
                     <p>Below is a detailed explanation of the CSS code provided for the file <code>D:\MyDev\CodeExplain\src\output\html\_css.css</code>. The explanation is organized by section, describing how each part of the CSS affects the webpage styling:</p>
<pre><code class="language-css">/* Sidebar styles */
#sidebar a:hover {
    background-color: rgba(0, 123, 255, 0.1);
    color: #0056b3;
}

#sidebar a.active {
    background-color: #007bff;
    color: white;
}

#sidebar .folder-toggle:hover {
    background-color: rgba(0, 123, 255, 0.1);
    color: #0056b3;
}
</code></pre>
<h3>Sidebar Styles</h3>
<ul>
<li><strong>Hover Effect for Links:</strong> Links inside the sidebar (<code>#sidebar a</code>) change their background color to a light blue tint and text color to a darker blue when hovered over.</li>
<li><strong>Active Links:</strong> Links with the <code>active</code> class have a solid blue background and white text, highlighting that they are currently selected.</li>
<li><strong>Folder Toggle Hover:</strong> Similar to the links, when the <code>.folder-toggle</code> is hovered over, the background changes with the same light blue effect.</li>
</ul>
<pre><code class="language-css">/* Sidebar list styling */
#sidebar ul {
    list-style: none;
    line-height: 1.3;
}

#sidebar li {
    list-style: none;
}
</code></pre>
<h3>Sidebar List Styling</h3>
<ul>
<li><strong>List Style:</strong> Both unordered lists (<code>ul</code>) and list items (<code>li</code>) in the sidebar remove bullet points by setting <code>list-style: none</code> and increase readability with a <code>line-height</code> of 1.3.</li>
</ul>
<pre><code class="language-css">/* Main content typography and styling */
.explanation-content {
    font-family: -apple-system, BlinkMacSystemFont, &#39;Segoe UI&#39;, Roboto, &#39;Helvetica Neue&#39;, Arial, sans-serif;
    color: #495057;
}
</code></pre>
<h3>Main Content Typography</h3>
<ul>
<li><strong>Font and Color:</strong> The main content uses a system font stack for compatibility across different operating systems and has a grayish color for the text.</li>
</ul>
<pre><code class="language-css">.explanation-content h1, h2, h3, h4, h5, h6 {
    color: #212529;
    font-weight: 600;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
    line-height: 1.3;
}
</code></pre>
<h3>Headings Styling</h3>
<ul>
<li><strong>Headings (h1-h6):</strong> These elements share a dark gray color, bold font weight, and have consistent margins for spacing.</li>
</ul>
<h4>Specific Heading Sizes</h4>
<ul>
<li><strong>h1:</strong> 1.75rem (larger size), and each subsequent heading decreases in font size down to <strong>h6:</strong> 0.9rem.</li>
</ul>
<pre><code class="language-css">.explanation-content p {
    margin-bottom: 1rem;
    line-height: 1.7;
    text-align: justify;
}

.explanation-content ul, ol {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
}

.explanation-content li {
    margin-bottom: 0.5rem;
    line-height: 1.6;
}
</code></pre>
<h3>Paragraph and List Styling</h3>
<ul>
<li><strong>Paragraphs:</strong> Have justified text alignment for more even line edges, and a bottom margin for separation.</li>
<li><strong>Lists:</strong> Receive a bottom margin for separation and a left padding to indent list items.</li>
</ul>
<pre><code class="language-css">.explanation-content code {
    background-color: #f8f9fa;
    padding: 0.125rem 0.25rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
    color: #d73a49;
    font-family: &#39;SF Mono&#39;, Monaco, &#39;Cascadia Code&#39;, &#39;Roboto Mono&#39;, Consolas, &#39;Courier New&#39;, monospace;
}

.explanation-content pre {
    background-color: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 0.375rem;
    padding: 1rem;
    margin: 1rem 0;
    overflow-x: auto;
    font-size: 0.875rem;
    line-height: 1.5;
}
</code></pre>
<h3>Code and Preformatted Text</h3>
<ul>
<li><strong>Code Blocks:</strong> Inline-code has a light gray background, slight padding, rounded corners, and is styled with a monospace font.</li>
<li><strong>Preformatted Text (<code>pre</code>):</strong> Receives a border, consistent padding, and horizontal scroll for overflowing text.</li>
</ul>
<pre><code class="language-css">.explanation-content pre.hljs {
    background-color: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 0.375rem;
    padding: 1rem;
    margin: 1rem 0;
    overflow-x: auto;
    font-size: 0.875rem;
    line-height: 1.5;
}
</code></pre>
<h3>Highlight.js Pre Element</h3>
<ul>
<li><strong>Highlight.js Specific Preformatting:</strong> This ensures <code>hljs</code> specific styles are not counteracted and maintain the same consistent styles as other preformatted text.</li>
</ul>
<pre><code class="language-css">/* Code block styling */
.code-container pre code {
    font-family: &#39;SF Mono&#39;, Monaco, &#39;Cascadia Code&#39;, &#39;Roboto Mono&#39;, Consolas, &#39;Courier New&#39;, monospace !important;
}
</code></pre>
<h3>Code Container Styling</h3>
<ul>
<li><strong>Code Containers:</strong> Customize the font for code within <code>.code-container</code> ensuring it always uses the specified monospace fonts.</li>
</ul>
<pre><code class="language-css">.explanation-content blockquote {
    border-left: 4px solid #007bff;
    padding-left: 1rem;
    margin: 1.5rem 0;
    color: #6c757d;
    font-style: italic;
}
</code></pre>
<h3>Blockquote Styling</h3>
<ul>
<li><strong>Blockquotes:</strong> Feature a blue left border, extra padding, distinctive margin, and are italicized for emphasis.</li>
</ul>
<pre><code class="language-css">.explanation-content table {
    width: 100%;
    margin-bottom: 1rem;
    border-collapse: collapse;
}

.explanation-content th,
.explanation-content td {
    padding: 0.75rem;
    border: 1px solid #dee2e6;
    text-align: left;
}

.explanation-content th {
    background-color: #f8f9fa;
    font-weight: 600;
}
</code></pre>
<h3>Table Styling</h3>
<ul>
<li><strong>Tables:</strong> Are full-width with collapsed borders and padding for cells.</li>
<li><strong>Table Headers (<code>th</code>):</strong> Have a light background for differentiation and are bolded.</li>
</ul>
<pre><code class="language-css">.explanation-content strong {
    font-weight: 600;
    color: #212529;
}

.explanation-content em {
    font-style: italic;
    color: #495057;
}
</code></pre>
<h3>Text Emphasis</h3>
<ul>
<li><strong>Strong Text:</strong> Appears bold with a darker color.</li>
<li><strong>Emphasized Text:</strong> Maintains an italic style with a consistent color.</li>
</ul>
<pre><code class="language-css">/* Card improvements */
.card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}
</code></pre>
<h3>Card Component</h3>
<ul>
<li><strong>Card Animation:</strong> Subtle transition effects for transformation and shadow when interacted with.</li>
</ul>
<pre><code class="language-css">/* File name hover cursor */
.toggle-code:hover {
    cursor: pointer;
}
</code></pre>
<h3>Cursor Style</h3>
<ul>
<li><strong>Code Toggler:</strong> The cursor changes to a pointer indicating a clickable element.</li>
</ul>
<pre><code class="language-css">/* Navigation arrows */
#nav-arrows {
    opacity: 0.8;
    transition: opacity 0.3s ease;
}

#nav-arrows:hover {
    opacity: 1;
}
</code></pre>
<h3>Navigation Arrows</h3>
<ul>
<li><strong>Opacity Change:</strong> Arrows become fully visible when hovered over.</li>
</ul>
<pre><code class="language-css">/* Zoom controls */
.btn-group .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.btn-group .btn {
    transition: all 0.2s ease;
}

.btn-group .btn:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}
</code></pre>
<h3>Button Group</h3>
<ul>
<li><strong>Disabled Buttons:</strong> Appear dimmed, with a forbidden cursor.</li>
<li><strong>Hover Effects:</strong> Buttons shift slightly upward and have a shadow when hovered over, if not disabled.</li>
</ul>
<pre><code class="language-css">/* Mermaid diagram controls */
.mermaid-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin: 10px 0;
    padding: 10px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #dee2e6;
    position: relative;
    z-index: 10;
    contain: layout style;
}

.mermaid-controls .btn {
    padding: 6px 12px;
    font-size: 0.875rem;
    border-radius: 6px;
}
</code></pre>
<h3>Mermaid Diagram Controls</h3>
<ul>
<li><strong>Control Layout:</strong> Positioned at the center with a background and border, providing a clear control area above a mermaid diagram.</li>
<li><strong>Buttons:</strong> Have custom padding and rounded corners.</li>
</ul>
<pre><code class="language-css">.zoom-level {
    font-weight: 600;
    color: #495057;
    min-width: 60px;
    text-align: center;
}
</code></pre>
<h3>Zoom Level Display</h3>
<ul>
<li><strong>Zoom Level Text:</strong> Shows prominently with bold styling and centered within a minimum width.</li>
</ul>
<pre><code class="language-css">/* Responsive mermaid containers */
.mermaid-diagram-container {
    position: relative;
    overflow: hidden;
    border-radius: 8px;
    border: 1px solid #dee2e6;
    background: white;
    min-height: 200px;
    contain: layout;
}

.mermaid {
    display: block;
    width: 100%;
    min-height: 200px;
    cursor: grab;
    transition: transform 0.1s ease;
    position: relative;
    z-index: 1;
    contain: layout style paint;
}

.mermaid svg {
    width: 100%;
    height: auto;
    min-height: 200px;
}

.mermaid.dragging {
    cursor: grabbing;
}

.mermaid-zoomable {
    transform-origin: center center;
}
</code></pre>
<h3>Mermaid Diagram Container</h3>
<ul>
<li><strong>Container Styles:</strong> Ensures diagrams do not overflow and have a consistent appearance with rounded corners and a border.</li>
<li><strong>Diagram Styles:</strong> Interactive styling with grab cursor for panning and a smooth transition.</li>
</ul>
<pre><code class="language-css">/* Fullscreen mode */
.mermaid-fullscreen {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    background: white !important;
    z-index: 9999 !important;
    padding: 20px !important;
    box-sizing: border-box !important;
}

.mermaid-fullscreen svg {
    width: 100% !important;
    height: 100% !important;
}

.fullscreen-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.8);
    z-index: 9998;
    display: none;
}

.fullscreen-overlay.active {
    display: block;
}
</code></pre>
<h3>Fullscreen Mode</h3>
<ul>
<li><strong>Fullscreen Styling:</strong> Mermaid diagrams take up the entire viewport with a white background and z-index for layering above other content.</li>
<li><strong>Overlay:</strong> Provides a dark background for enhanced focus, becoming visible when <code>active</code>.</li>
</ul>
<pre><code class="language-css">/* Responsive breakpoints for diagrams */
@media (max-width: 768px) {
    .mermaid-diagram-container {
        min-height: 150px;
    }

    .mermaid svg {
        min-height: 150px;
    }

    .mermaid-controls {
        flex-wrap: wrap;
        gap: 5px;
    }

    .mermaid-controls .btn {
        padding: 4px 8px;
        font-size: 0.75rem;
    }
}
</code></pre>
<h3>Responsive Breakpoints</h3>
<ul>
<li><strong>Responsive Adjustments:</strong> For smaller screens, reduces minimum height of diagrams and adjusts control button sizes for fitting within limited space.</li>
</ul>
<p>This CSS file is structured to create a cohesive visual style emphasizing readability, ease of navigation, and responsiveness, catering to various elements typical in a web application like sidebars, main content areas, interactive elements, and responsive design adaptations.</p>

                 </div>
             </div>
         </div>
     </div>
 </div>

 <div class="file-entry col-12 mb-4" id="file-13" data-file-path="D:\MyDev\CodeExplain\src\output\html\_flowchart.js" data-file-index="13">
     <div class="card shadow-sm border-0 h-100" style="border-radius: 12px; overflow: hidden;">
         <div class="card-header bg-gradient-primary text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1rem 1.5rem;">
             <div class="d-flex justify-content-between align-items-center">
                  <h2 class="toggle-code h5 fw-semibold mb-0 cursor-pointer d-flex align-items-center text-white" data-file-index="13" style="font-size: 1.1rem;">
                      <i class="fas fa-chevron-right me-2 transition-transform duration-200"></i>
                      <i class="fas fa-file-code me-2"></i>
                      output/html/_flowchart.js
                  </h2>
                 <span class="badge bg-white bg-opacity-25 text-white px-2 py-1" style="font-size: 0.75rem;">
                     javascript
                 </span>
             </div>
         </div>

               <div class="card-body p-0">
                 <div class="code-container bg-light border-bottom d-none" style="max-height: 400px; overflow: auto;" data-file-path="D:\MyDev\CodeExplain\src\output\html\_flowchart.js" data-file-language="javascript">
                     <div class="p-3 text-center text-muted">
                         <div class="spinner-border spinner-border-sm me-2" role="status" style="display: none;"></div>
                         <span class="loading-text">Click to load code</span>
                     </div>
                     <div class="code-content" style="display: none;">

<span class="hljs-comment">// Global zoom state for each diagram</span>
<span class="hljs-keyword">const</span> diagramStates = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;DOMContentLoaded&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
    <span class="hljs-comment">// Initialize Mermaid for flowchart rendering with zoom support (after mermaid is loaded)</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> mermaid !== <span class="hljs-string">&#x27;undefined&#x27;</span>) {
        mermaid.<span class="hljs-title function_">initialize</span>({
            <span class="hljs-attr">startOnLoad</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// Disable auto-rendering to control manually</span>
            <span class="hljs-attr">theme</span>: <span class="hljs-string">&#x27;default&#x27;</span>,
            <span class="hljs-attr">flowchart</span>: {
                <span class="hljs-attr">useMaxWidth</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// Disable to allow custom sizing</span>
                <span class="hljs-attr">htmlLabels</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">curve</span>: <span class="hljs-string">&#x27;basis&#x27;</span>,
                <span class="hljs-attr">nodeSpacing</span>: <span class="hljs-variable constant_">NODE_SPACING</span>,
                <span class="hljs-attr">rankSpacing</span>: <span class="hljs-variable constant_">RANK_SPACING</span>
            },
            <span class="hljs-attr">securityLevel</span>: <span class="hljs-string">&#x27;antiscript&#x27;</span>, <span class="hljs-comment">// Updated security level for Mermaid v11</span>
            <span class="hljs-attr">themeVariables</span>: {
                <span class="hljs-attr">fontSize</span>: <span class="hljs-variable constant_">FONT_SIZE</span>,
                <span class="hljs-attr">fontFamily</span>: <span class="hljs-string">&#x27;arial&#x27;</span>
            }
        });
    }

    <span class="hljs-comment">// Re-render any mermaid diagrams that might have been missed</span>
    <span class="hljs-keyword">const</span> mermaidElements = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">&#x27;.mermaid:not([data-processed])&#x27;</span>);
    mermaidElements.<span class="hljs-title function_">forEach</span>(<span class="hljs-title function_">async</span> (element) =&gt; {
        <span class="hljs-comment">// Check if element has content to render</span>
        <span class="hljs-keyword">const</span> content = element.<span class="hljs-property">textContent</span>.<span class="hljs-title function_">trim</span>();
        <span class="hljs-keyword">if</span> (!content || content.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&#x27;Skipping empty Mermaid diagram&#x27;</span>);
            element.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">&#x27;&lt;div class=&quot;alert alert-info&quot;&gt;No diagram content available&lt;/div&gt;&#x27;</span>;
            element.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;data-processed&#x27;</span>, <span class="hljs-string">&#x27;true&#x27;</span>);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// Check if content looks like valid Mermaid syntax</span>
        <span class="hljs-keyword">if</span> (!content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;flowchart&#x27;</span>) &amp;&amp; !content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;graph&#x27;</span>) &amp;&amp; !content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;sequenceDiagram&#x27;</span>) &amp;&amp;
            !content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;gantt&#x27;</span>) &amp;&amp; !content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;classDiagram&#x27;</span>) &amp;&amp; !content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;stateDiagram&#x27;</span>) &amp;&amp;
            !content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;pie&#x27;</span>) &amp;&amp; !content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;erDiagram&#x27;</span>) &amp;&amp; !content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;journey&#x27;</span>)) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&#x27;Skipping invalid Mermaid diagram content:&#x27;</span>, content.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">50</span>) + <span class="hljs-string">&#x27;...&#x27;</span>);
            element.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">&#x27;&lt;div class=&quot;alert alert-info&quot;&gt;Invalid diagram syntax&lt;/div&gt;&#x27;</span>;
            element.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;data-processed&#x27;</span>, <span class="hljs-string">&#x27;true&#x27;</span>);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">const</span> diagramId = <span class="hljs-string">&#x27;mermaid-&#x27;</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>().<span class="hljs-title function_">toString</span>(<span class="hljs-number">36</span>).<span class="hljs-title function_">substr</span>(<span class="hljs-number">2</span>, <span class="hljs-number">9</span>);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// Clean the content to ensure valid Mermaid syntax</span>
            <span class="hljs-keyword">const</span> cleanContent = content.<span class="hljs-title function_">replace</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">&#x27;\\r\\n&#x27;</span>, <span class="hljs-string">&#x27;g&#x27;</span>), <span class="hljs-string">&#x27;\\n&#x27;</span>).<span class="hljs-title function_">replace</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">&#x27;\\r&#x27;</span>, <span class="hljs-string">&#x27;g&#x27;</span>), <span class="hljs-string">&#x27;\\n&#x27;</span>).<span class="hljs-title function_">trim</span>();
            <span class="hljs-keyword">const</span> { svg } = <span class="hljs-keyword">await</span> mermaid.<span class="hljs-title function_">render</span>(diagramId, cleanContent);
            element.<span class="hljs-property">innerHTML</span> = svg;
            element.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;data-processed&#x27;</span>, <span class="hljs-string">&#x27;true&#x27;</span>);
            <span class="hljs-comment">// Set the diagramId as the id attribute on the element for correct state linkage</span>
            element.<span class="hljs-property">id</span> = diagramId;

            <span class="hljs-comment">// Add zoom controls after rendering</span>
            <span class="hljs-title function_">addZoomControls</span>(element);
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Mermaid rendering error:&#x27;</span>, error);
            element.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">&#x27;&lt;div class=&quot;alert alert-warning&quot;&gt;Failed to render diagram: &#x27;</span> + error.<span class="hljs-property">message</span> + <span class="hljs-string">&#x27;&lt;/div&gt;&#x27;</span>;
            element.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;data-processed&#x27;</span>, <span class="hljs-string">&#x27;true&#x27;</span>);
        }
    });

});

<span class="hljs-comment">// Function to add zoom controls to a diagram</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">addZoomControls</span>(<span class="hljs-params">diagramElement</span>) {
    <span class="hljs-keyword">const</span> container = diagramElement.<span class="hljs-title function_">closest</span>(<span class="hljs-string">&#x27;.mermaid-diagram-container&#x27;</span>);
    <span class="hljs-keyword">if</span> (!container) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// Check if controls already exist</span>
    <span class="hljs-keyword">if</span> (container.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.mermaid-controls&#x27;</span>)) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// Create zoom controls</span>
    <span class="hljs-keyword">const</span> controls = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;div&#x27;</span>);
    controls.<span class="hljs-property">className</span> = <span class="hljs-string">&#x27;mermaid-controls&#x27;</span>;
    controls.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">&#x27;&lt;button class=&quot;btn btn-outline-secondary btn-sm&quot; id=&quot;zoom-out&quot; title=&quot;Zoom Out&quot;&gt;&lt;i class=&quot;fas fa-search-minus&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;button class=&quot;btn btn-outline-secondary btn-sm&quot; id=&quot;zoom-reset&quot; title=&quot;Reset Zoom&quot;&gt;&lt;i class=&quot;fas fa-sync-alt&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;span class=&quot;zoom-level&quot;&gt;100%&lt;/span&gt;&lt;button class=&quot;btn btn-outline-secondary btn-sm&quot; id=&quot;zoom-in&quot; title=&quot;Zoom In&quot;&gt;&lt;i class=&quot;fas fa-search-plus&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;button class=&quot;btn btn-outline-secondary btn-sm&quot; id=&quot;fullscreen&quot; title=&quot;Fullscreen&quot;&gt;&lt;i class=&quot;fas fa-expand&quot;&gt;&lt;/i&gt;&lt;/button&gt;&#x27;</span>;

    <span class="hljs-comment">// Insert controls before the diagram</span>
    container.<span class="hljs-title function_">insertBefore</span>(controls, diagramElement);

    <span class="hljs-comment">// Initialize zoom state</span>
    <span class="hljs-keyword">const</span> diagramId = diagramElement.<span class="hljs-property">id</span>;
    diagramStates.<span class="hljs-title function_">set</span>(diagramId, {
        <span class="hljs-attr">scale</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">translateX</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">translateY</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">isDragging</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">lastX</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">lastY</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">isFullscreen</span>: <span class="hljs-literal">false</span>
    });

    <span class="hljs-keyword">const</span> state = diagramStates.<span class="hljs-title function_">get</span>(diagramId);
    <span class="hljs-keyword">const</span> zoomLevel = controls.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.zoom-level&#x27;</span>);

    <span class="hljs-comment">// Add zoom functionality</span>
    diagramElement.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;mermaid-zoomable&#x27;</span>);
    diagramElement.<span class="hljs-property">style</span>.<span class="hljs-property">cursor</span> = <span class="hljs-string">&#x27;grab&#x27;</span>;
    <span class="hljs-title function_">updateTransform</span>(diagramElement, state);

    <span class="hljs-comment">// Add debouncing for zoom level updates</span>
    <span class="hljs-keyword">let</span> zoomUpdateTimeout;
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">debouncedUpdateZoomLevel</span> = (<span class="hljs-params">element, scale</span>) =&gt; {
        <span class="hljs-built_in">clearTimeout</span>(zoomUpdateTimeout);
        zoomUpdateTimeout = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-title function_">updateZoomLevel</span>(element, scale);
        }, <span class="hljs-number">100</span>); <span class="hljs-comment">// Wait 100ms after last zoom event</span>
    };

    <span class="hljs-comment">// Zoom in button</span>
    controls.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;#zoom-in&#x27;</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
        state.<span class="hljs-property">scale</span> = state.<span class="hljs-property">scale</span> * <span class="hljs-variable constant_">ZOOM_FACTOR_IN</span>;
        <span class="hljs-title function_">updateTransform</span>(diagramElement, state);
        <span class="hljs-title function_">debouncedUpdateZoomLevel</span>(zoomLevel, state.<span class="hljs-property">scale</span>);
    });

    <span class="hljs-comment">// Zoom out button</span>
    controls.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;#zoom-out&#x27;</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
        state.<span class="hljs-property">scale</span> = state.<span class="hljs-property">scale</span> / <span class="hljs-variable constant_">ZOOM_FACTOR_IN</span>;
        <span class="hljs-title function_">updateTransform</span>(diagramElement, state);
        <span class="hljs-title function_">debouncedUpdateZoomLevel</span>(zoomLevel, state.<span class="hljs-property">scale</span>);
    });

    <span class="hljs-comment">// Reset zoom button</span>
    controls.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;#zoom-reset&#x27;</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
        state.<span class="hljs-property">scale</span> = <span class="hljs-number">1</span>;
        state.<span class="hljs-property">translateX</span> = <span class="hljs-number">0</span>;
        state.<span class="hljs-property">translateY</span> = <span class="hljs-number">0</span>;
        <span class="hljs-title function_">updateTransform</span>(diagramElement, state);
        <span class="hljs-title function_">debouncedUpdateZoomLevel</span>(zoomLevel, state.<span class="hljs-property">scale</span>);
    });

    <span class="hljs-comment">// Fullscreen button</span>
    controls.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;#fullscreen&#x27;</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
        <span class="hljs-title function_">toggleFullscreen</span>(container, diagramElement, state);
    });

    <span class="hljs-comment">// Mouse wheel zoom</span>
    diagramElement.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;wheel&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
        e.<span class="hljs-title function_">preventDefault</span>();
        <span class="hljs-keyword">const</span> delta = e.<span class="hljs-property">deltaY</span> &gt; <span class="hljs-number">0</span> ? <span class="hljs-variable constant_">ZOOM_FACTOR_OUT</span> : <span class="hljs-number">1</span> / <span class="hljs-variable constant_">ZOOM_FACTOR_OUT</span>;
        state.<span class="hljs-property">scale</span> = state.<span class="hljs-property">scale</span> * delta;
        <span class="hljs-title function_">updateTransform</span>(diagramElement, state);
        <span class="hljs-title function_">debouncedUpdateZoomLevel</span>(zoomLevel, state.<span class="hljs-property">scale</span>);
    });

    <span class="hljs-comment">// Pan functionality</span>
    diagramElement.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;mousedown&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
        state.<span class="hljs-property">isDragging</span> = <span class="hljs-literal">true</span>;
        state.<span class="hljs-property">lastX</span> = e.<span class="hljs-property">clientX</span>;
        state.<span class="hljs-property">lastY</span> = e.<span class="hljs-property">clientY</span>;
        diagramElement.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;dragging&#x27;</span>);
        diagramElement.<span class="hljs-property">style</span>.<span class="hljs-property">cursor</span> = <span class="hljs-string">&#x27;grabbing&#x27;</span>;
    });

    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;mousemove&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
        <span class="hljs-keyword">if</span> (!state.<span class="hljs-property">isDragging</span>) <span class="hljs-keyword">return</span>;

        <span class="hljs-keyword">const</span> deltaX = e.<span class="hljs-property">clientX</span> - state.<span class="hljs-property">lastX</span>;
        <span class="hljs-keyword">const</span> deltaY = e.<span class="hljs-property">clientY</span> - state.<span class="hljs-property">lastY</span>;

        state.<span class="hljs-property">translateX</span> += deltaX;
        state.<span class="hljs-property">translateY</span> += deltaY;

        state.<span class="hljs-property">lastX</span> = e.<span class="hljs-property">clientX</span>;
        state.<span class="hljs-property">lastY</span> = e.<span class="hljs-property">clientY</span>;

        <span class="hljs-title function_">updateTransform</span>(diagramElement, state);
    });

    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;mouseup&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
        state.<span class="hljs-property">isDragging</span> = <span class="hljs-literal">false</span>;
        diagramElement.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;dragging&#x27;</span>);
        diagramElement.<span class="hljs-property">style</span>.<span class="hljs-property">cursor</span> = <span class="hljs-string">&#x27;grab&#x27;</span>;
    });

    <span class="hljs-comment">// Touch support for mobile</span>
    <span class="hljs-keyword">let</span> initialDistance = <span class="hljs-number">0</span>;
    diagramElement.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;touchstart&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
        <span class="hljs-keyword">if</span> (e.<span class="hljs-property">touches</span>.<span class="hljs-property">length</span> === <span class="hljs-number">2</span>) {
            <span class="hljs-comment">// Pinch to zoom</span>
            <span class="hljs-keyword">const</span> touch1 = e.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">const</span> touch2 = e.<span class="hljs-property">touches</span>[<span class="hljs-number">1</span>];
            initialDistance = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(
                <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(touch2.<span class="hljs-property">clientX</span> - touch1.<span class="hljs-property">clientX</span>, <span class="hljs-number">2</span>) +
                <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(touch2.<span class="hljs-property">clientY</span> - touch1.<span class="hljs-property">clientY</span>, <span class="hljs-number">2</span>)
            );
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e.<span class="hljs-property">touches</span>.<span class="hljs-property">length</span> === <span class="hljs-number">1</span>) {
            <span class="hljs-comment">// Pan</span>
            state.<span class="hljs-property">isDragging</span> = <span class="hljs-literal">true</span>;
            state.<span class="hljs-property">lastX</span> = e.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span>;
            state.<span class="hljs-property">lastY</span> = e.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientY</span>;
            diagramElement.<span class="hljs-property">style</span>.<span class="hljs-property">cursor</span> = <span class="hljs-string">&#x27;grabbing&#x27;</span>;
        }
    });

    diagramElement.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;touchmove&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
        <span class="hljs-keyword">if</span> (e.<span class="hljs-property">touches</span>.<span class="hljs-property">length</span> === <span class="hljs-number">2</span>) {
            <span class="hljs-comment">// Handle pinch zoom</span>
            <span class="hljs-keyword">const</span> touch1 = e.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">const</span> touch2 = e.<span class="hljs-property">touches</span>[<span class="hljs-number">1</span>];
            <span class="hljs-keyword">const</span> currentDistance = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(
                <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(touch2.<span class="hljs-property">clientX</span> - touch1.<span class="hljs-property">clientX</span>, <span class="hljs-number">2</span>) +
                <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(touch2.<span class="hljs-property">clientY</span> - touch1.<span class="hljs-property">clientY</span>, <span class="hljs-number">2</span>)
            );

            <span class="hljs-keyword">if</span> (initialDistance &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">const</span> scaleChange = currentDistance / initialDistance;
                state.<span class="hljs-property">scale</span> = state.<span class="hljs-property">scale</span> * scaleChange; <span class="hljs-comment">// Removed min/max zoom limitations</span>
                <span class="hljs-title function_">updateTransform</span>(diagramElement, state);
                <span class="hljs-title function_">updateZoomLevel</span>(zoomLevel, state.<span class="hljs-property">scale</span>);
                initialDistance = currentDistance;
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e.<span class="hljs-property">touches</span>.<span class="hljs-property">length</span> === <span class="hljs-number">1</span> &amp;&amp; state.<span class="hljs-property">isDragging</span>) {
            <span class="hljs-comment">// Handle pan</span>
            <span class="hljs-keyword">const</span> deltaX = e.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span> - state.<span class="hljs-property">lastX</span>;
            <span class="hljs-keyword">const</span> deltaY = e.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientY</span> - state.<span class="hljs-property">lastY</span>;

            state.<span class="hljs-property">translateX</span> += deltaX;
            state.<span class="hljs-property">translateY</span> += deltaY;

            state.<span class="hljs-property">lastX</span> = e.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span>;
            state.<span class="hljs-property">lastY</span> = e.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientY</span>;

            <span class="hljs-title function_">updateTransform</span>(diagramElement, state);
        }
    });

    diagramElement.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;touchend&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
        state.<span class="hljs-property">isDragging</span> = <span class="hljs-literal">false</span>;
        initialDistance = <span class="hljs-number">0</span>;
        diagramElement.<span class="hljs-property">style</span>.<span class="hljs-property">cursor</span> = <span class="hljs-string">&#x27;grab&#x27;</span>;
    });
}

<span class="hljs-comment">// Helper function to update transform</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateTransform</span>(<span class="hljs-params">element, state</span>) {
    element.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">&#x27;scale(&#x27;</span> + state.<span class="hljs-property">scale</span> + <span class="hljs-string">&#x27;) translate(&#x27;</span> + (state.<span class="hljs-property">translateX</span> / state.<span class="hljs-property">scale</span>) + <span class="hljs-string">&#x27;px, &#x27;</span> + (state.<span class="hljs-property">translateY</span> / state.<span class="hljs-property">scale</span>) + <span class="hljs-string">&#x27;px)&#x27;</span>;
}

<span class="hljs-comment">// Helper function to update zoom level display</span>
<span class="hljs-comment">// Note: For performance, consider debouncing if zoom events are very frequent.</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateZoomLevel</span>(<span class="hljs-params">displayElement, scale</span>) {
    displayElement.<span class="hljs-property">textContent</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(scale * <span class="hljs-number">100</span>) + <span class="hljs-string">&#x27;%&#x27;</span>;
}

<span class="hljs-comment">// Helper to get or initialize diagram state</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getDiagramState</span>(<span class="hljs-params">diagramId</span>) {
    <span class="hljs-keyword">let</span> state = diagramStates.<span class="hljs-title function_">get</span>(diagramId);
    <span class="hljs-keyword">if</span> (!state) {
        state = {
            <span class="hljs-attr">scale</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">translateX</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">translateY</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">isDragging</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">lastX</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">lastY</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">isFullscreen</span>: <span class="hljs-literal">false</span>
        };
        diagramStates.<span class="hljs-title function_">set</span>(diagramId, state);
    }
    <span class="hljs-keyword">return</span> state;
}

<span class="hljs-comment">// Constants for configuration values</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ZOOM_FACTOR_IN</span> = <span class="hljs-number">1.2</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ZOOM_FACTOR_OUT</span> = <span class="hljs-number">0.9</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">NODE_SPACING</span> = <span class="hljs-number">100</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">RANK_SPACING</span> = <span class="hljs-number">80</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FONT_SIZE</span> = <span class="hljs-string">&#x27;14px&#x27;</span>;

<span class="hljs-comment">// Global functions for onclick handlers</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">zoomDiagram</span>(<span class="hljs-params">diagramId, factor</span>) {
    <span class="hljs-keyword">const</span> diagram = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(diagramId);
    <span class="hljs-keyword">if</span> (!diagram) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">getDiagramState</span>(diagramId);
    state.<span class="hljs-property">scale</span> = state.<span class="hljs-property">scale</span> * factor;
    <span class="hljs-title function_">updateTransform</span>(diagram, state);

    <span class="hljs-keyword">const</span> container = diagram.<span class="hljs-title function_">closest</span>(<span class="hljs-string">&#x27;.mermaid-diagram-container&#x27;</span>);
    <span class="hljs-keyword">const</span> zoomLevelElement = container ? container.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.zoom-level&#x27;</span>) : <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (zoomLevelElement) {
        <span class="hljs-title function_">updateZoomLevel</span>(zoomLevelElement, state.<span class="hljs-property">scale</span>);
    }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">resetZoom</span>(<span class="hljs-params">diagramId</span>) {
    <span class="hljs-keyword">const</span> diagram = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(diagramId);
    <span class="hljs-keyword">if</span> (!diagram) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">getDiagramState</span>(diagramId);
    state.<span class="hljs-property">scale</span> = <span class="hljs-number">1</span>;
    state.<span class="hljs-property">translateX</span> = <span class="hljs-number">0</span>;
    state.<span class="hljs-property">translateY</span> = <span class="hljs-number">0</span>;
    <span class="hljs-title function_">updateTransform</span>(diagram, state);

    <span class="hljs-keyword">const</span> container = diagram.<span class="hljs-title function_">closest</span>(<span class="hljs-string">&#x27;.mermaid-diagram-container&#x27;</span>);
    <span class="hljs-keyword">const</span> zoomLevelElement = container ? container.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.zoom-level&#x27;</span>) : <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (zoomLevelElement) {
        <span class="hljs-title function_">updateZoomLevel</span>(zoomLevelElement, state.<span class="hljs-property">scale</span>);
    }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">toggleFullscreenGlobal</span>(<span class="hljs-params">diagramId</span>) {
    <span class="hljs-keyword">const</span> diagram = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(diagramId);
    <span class="hljs-keyword">if</span> (!diagram) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> container = diagram.<span class="hljs-title function_">closest</span>(<span class="hljs-string">&#x27;.mermaid-diagram-container&#x27;</span>);
    <span class="hljs-keyword">if</span> (!container) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">getDiagramState</span>(diagramId);
    <span class="hljs-title function_">toggleFullscreen</span>(container, diagram, state);
}

<span class="hljs-comment">// Helper function to toggle fullscreen</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">toggleFullscreen</span>(<span class="hljs-params">container, diagram, state</span>) {
    <span class="hljs-keyword">const</span> overlay = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.fullscreen-overlay&#x27;</span>) || <span class="hljs-title function_">createFullscreenOverlay</span>();

    <span class="hljs-keyword">if</span> (state.<span class="hljs-property">isFullscreen</span>) {
        <span class="hljs-comment">// Exit fullscreen</span>
        container.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;mermaid-fullscreen&#x27;</span>);
        overlay.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;active&#x27;</span>);
        state.<span class="hljs-property">isFullscreen</span> = <span class="hljs-literal">false</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// Enter fullscreen</span>
        container.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;mermaid-fullscreen&#x27;</span>);
        overlay.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;active&#x27;</span>);
        state.<span class="hljs-property">isFullscreen</span> = <span class="hljs-literal">true</span>;
    }
}

<span class="hljs-comment">// Helper function to create fullscreen overlay</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createFullscreenOverlay</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">const</span> overlay = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.fullscreen-overlay&#x27;</span>);
    <span class="hljs-keyword">if</span> (overlay) <span class="hljs-keyword">return</span> overlay;

    <span class="hljs-keyword">const</span> newOverlay = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;div&#x27;</span>);
    newOverlay.<span class="hljs-property">className</span> = <span class="hljs-string">&#x27;fullscreen-overlay&#x27;</span>;
    newOverlay.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-comment">// Exit fullscreen when clicking overlay</span>
        <span class="hljs-keyword">const</span> fullscreenContainer = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.mermaid-fullscreen&#x27;</span>);
        <span class="hljs-keyword">if</span> (fullscreenContainer) {
            <span class="hljs-keyword">const</span> diagram = fullscreenContainer.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.mermaid&#x27;</span>);
            <span class="hljs-keyword">if</span> (diagram) {
                <span class="hljs-keyword">const</span> state = diagramStates.<span class="hljs-title function_">get</span>(diagram.<span class="hljs-property">id</span>);
                <span class="hljs-keyword">if</span> (state) {
                    <span class="hljs-title function_">toggleFullscreen</span>(fullscreenContainer, diagram, state);
                }
            }
        }
    });
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(newOverlay);
    <span class="hljs-keyword">return</span> newOverlay;
}

</div>
                 </div>

             <div class="p-4">
                 <div class="d-flex justify-content-between align-items-center mb-3">
                     <h3 class="h6 text-muted mb-0 d-flex align-items-center">
                         <i class="fas fa-brain me-2 text-primary"></i>
                         AI Explanation
                     </h3>
                     <button class="btn btn-outline-primary btn-sm copy-explanation" data-file-index="13" title="Copy explanation">
                         <i class="fas fa-copy me-1"></i> Copy
                     </button>
                 </div>
                 <div class="explanation-content">
                     <h1>Explanation of the <code>_flowchart.js</code> JavaScript Code</h1>
<p>This JavaScript file is responsible for enhancing Mermaid diagrams with additional features such as manual rendering, interactive zoom, and fullscreen support on a web page.</p>
<h2>Code Walkthrough</h2>
<h3>Initial Setup</h3>
<ul>
<li><strong>Global State:</strong> A <code>Map</code> object named <code>diagramStates</code> is used to store the state of each diagram. Each diagram&#39;s state includes zoom level, translation offsets for panning, and other UI states like fullscreen mode.</li>
</ul>
javascript
  const diagramStates = new Map();
  ```

<ul>
<li><p><strong>Event Listener:</strong> A <code>DOMContentLoaded</code> event listener is added to set up the diagrams once the DOM is fully loaded.</p>
<pre><code class="language-javascript">document.addEventListener(&#39;DOMContentLoaded&#39;, function () { ... });
</code></pre>
</li>
</ul>
<h3>Mermaid Initialization</h3>
<ul>
<li><p>The code checks if Mermaid is available (<code>typeof mermaid !== &#39;undefined&#39;</code>) and initializes it with specific settings:</p>
<ul>
<li>Autoplay rendering is disabled (<code>startOnLoad: false</code>).</li>
<li>Diagram themes and appearance settings are configured.</li>
<li>Security level is set to <code>antiscript</code>.</li>
</ul>
<pre><code class="language-javascript">if (typeof mermaid !== &#39;undefined&#39;) {
    mermaid.initialize({ ... });
}
</code></pre>
</li>
</ul>
<h3>Diagram Processing</h3>
<ul>
<li><p><strong>Selector:</strong> Selects all unprocessed Mermaid diagrams in the DOM.</p>
<pre><code class="language-javascript">const mermaidElements = document.querySelectorAll(&#39;.mermaid:not([data-processed])&#39;);
</code></pre>
</li>
<li><p>Each selected diagram is processed:</p>
<ul>
<li><strong>Content Check:</strong> Ensures that each diagram has valid content by checking for common Mermaid diagram keywords.</li>
<li><strong>Rendering:</strong> Uses <code>mermaid.render()</code> to create an SVG from the diagram content.</li>
<li><strong>Error Handling:</strong> Logs errors and provides fallback messages in case rendering fails.</li>
</ul>
<pre><code class="language-javascript">mermaidElements.forEach(async (element) =&gt; { ... });
</code></pre>
</li>
</ul>
<h3>Zoom and Fullscreen Control</h3>
<ul>
<li><p><strong>Zoom Controls:</strong> After rendering, zoom controls including buttons for zoom in/out, reset, and fullscreen are added.</p>
<pre><code class="language-javascript">function addZoomControls(diagramElement) { ... }
</code></pre>
</li>
<li><p><strong>Mouse &amp; Touch Support:</strong> Implements mouse wheel and touch events to support zoom and pan actions.</p>
<pre><code class="language-javascript">diagramElement.addEventListener(&#39;wheel&#39;, function (e) { ... });
diagramElement.addEventListener(&#39;touchstart&#39;, function (e) { ... });
</code></pre>
</li>
</ul>
<h3>Helper Functions</h3>
<ul>
<li><code>updateTransform(element, state)</code> updates an element&#39;s CSS transform property based on the current zoom and pan state.</li>
<li><code>updateZoomLevel(displayElement, scale)</code> updates the displayed zoom level.</li>
<li><code>getDiagramState(diagramId)</code> retrieves or initializes the zoom/pan state for a given diagram.</li>
</ul>
<h3>Fullscreen Functionality</h3>
<ul>
<li>Toggles fullscreen mode through <code>toggleFullscreen(container, diagram, state)</code> and uses an overlay to manage fullscreen exit.</li>
<li>A helper <code>createFullscreenOverlay()</code> ensures an overlay is available to capture fullscreen exit actions.</li>
</ul>
<h3>Constants</h3>
<ul>
<li>Defined constants for zoom factors and spacing help maintain consistent configuration across the implementation.<pre><code class="language-javascript">const ZOOM_FACTOR_IN = 1.2;
const ZOOM_FACTOR_OUT = 0.9;
const NODE_SPACING = 100;
const RANK_SPACING = 80;
const FONT_SIZE = &#39;14px&#39;;
</code></pre>
</li>
</ul>
<h3>Global Functions</h3>
<ul>
<li>Functions like <code>zoomDiagram</code>, <code>resetZoom</code>, and <code>toggleFullscreenGlobal</code> provide easy external access to zoom and fullscreen controls.</li>
</ul>
<h3>Conclusion</h3>
<p>This script is specifically crafted to enhance Mermaid diagram interactivity, providing both desktop and mobile users robust features such as zoom, pan, and fullscreen capabilities. Each diagram&#39;s state is individually managed, allowing for independent interaction and maintaining these settings across user interactions.</p>
<pre><code>
</code></pre>

                 </div>
             </div>
         </div>
     </div>
 </div>

 <div class="file-entry col-12 mb-4" id="file-14" data-file-path="D:\MyDev\CodeExplain\src\output\html\_js.js" data-file-index="14">
     <div class="card shadow-sm border-0 h-100" style="border-radius: 12px; overflow: hidden;">
         <div class="card-header bg-gradient-primary text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1rem 1.5rem;">
             <div class="d-flex justify-content-between align-items-center">
                  <h2 class="toggle-code h5 fw-semibold mb-0 cursor-pointer d-flex align-items-center text-white" data-file-index="14" style="font-size: 1.1rem;">
                      <i class="fas fa-chevron-right me-2 transition-transform duration-200"></i>
                      <i class="fas fa-file-code me-2"></i>
                      output/html/_js.js
                  </h2>
                 <span class="badge bg-white bg-opacity-25 text-white px-2 py-1" style="font-size: 0.75rem;">
                     javascript
                 </span>
             </div>
         </div>

               <div class="card-body p-0">
                 <div class="code-container bg-light border-bottom d-none" style="max-height: 400px; overflow: auto;" data-file-path="D:\MyDev\CodeExplain\src\output\html\_js.js" data-file-language="javascript">
                     <div class="p-3 text-center text-muted">
                         <div class="spinner-border spinner-border-sm me-2" role="status" style="display: none;"></div>
                         <span class="loading-text">Click to load code</span>
                     </div>
                     <div class="code-content" style="display: none;">(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
    <span class="hljs-comment">// Constants for configuration</span>
    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SIDEBAR_DEFAULT_WIDTH</span> = <span class="hljs-number">280</span>;
    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SIDEBAR_MIN_WIDTH</span> = <span class="hljs-number">250</span>;
    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SIDEBAR_MAX_WIDTH</span> = <span class="hljs-number">450</span>;
    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MOBILE_BREAKPOINT</span> = <span class="hljs-number">768</span>;
    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">COPY_FEEDBACK_DURATION</span> = <span class="hljs-number">2000</span>;

    <span class="hljs-comment">// Cache DOM elements and other state (assigned in DOMContentLoaded)</span>
    <span class="hljs-keyword">let</span> cachedFileEntries;
    <span class="hljs-keyword">let</span> cachedSidebarLinks;

    <span class="hljs-comment">// Initialize syntax highlighting</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;DOMContentLoaded&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
        <span class="hljs-comment">// Configure marked to use highlight.js for code blocks (after marked is loaded)</span>
        <span class="hljs-keyword">const</span> { <span class="hljs-title class_">Marked</span> } = <span class="hljs-variable language_">window</span>.<span class="hljs-property">marked</span>;
        <span class="hljs-keyword">const</span> { markedHighlight } = <span class="hljs-variable language_">window</span>.<span class="hljs-property">markedHighlight</span>;

        <span class="hljs-comment">// Create Marked instance with the highlight plugin</span>
        <span class="hljs-keyword">const</span> markedInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Marked</span>(
            { <span class="hljs-attr">gfm</span>: <span class="hljs-literal">true</span> },
            <span class="hljs-title function_">markedHighlight</span>({
                <span class="hljs-attr">langPrefix</span>: <span class="hljs-string">&#x27;hljs language-&#x27;</span>,
                <span class="hljs-attr">emptyLangClass</span>: <span class="hljs-string">&#x27;hljs&#x27;</span>,
                <span class="hljs-title function_">highlight</span>(<span class="hljs-params">code, lang</span>) {
                    <span class="hljs-keyword">const</span> language = hljs.<span class="hljs-title function_">getLanguage</span>(lang) ? lang : <span class="hljs-string">&#x27;plaintext&#x27;</span>;
                    <span class="hljs-keyword">return</span> hljs.<span class="hljs-title function_">highlight</span>(code, { language }).<span class="hljs-property">value</span>;
                }
            })
        );

        <span class="hljs-comment">// Apply syntax highlighting to code blocks in AI explanations</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> hljs !== <span class="hljs-string">&#x27;undefined&#x27;</span>) {
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">&#x27;.explanation-content pre code&#x27;</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">block</span>) =&gt;</span> {
                <span class="hljs-keyword">if</span> (!block.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">&#x27;hljs&#x27;</span>)) {
                    hljs.<span class="hljs-title function_">highlightElement</span>(block);
                }
            });
        }

        <span class="hljs-comment">// Cache DOM elements - convert NodeList to Array for better performance</span>
        cachedFileEntries = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">&#x27;.file-entry&#x27;</span>));
        cachedSidebarLinks = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">&#x27;#sidebar a[href^=\&quot;#file-\&quot;]&#x27;</span>);
        
        <span class="hljs-comment">// If no sidebar exists, set to empty NodeList to prevent errors</span>
        <span class="hljs-keyword">if</span> (cachedSidebarLinks.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
            cachedSidebarLinks = [];
        }

        <span class="hljs-comment">// Initialize layout</span>
        <span class="hljs-title function_">initializeLayout</span>();

        <span class="hljs-comment">// Initial active item update</span>
        <span class="hljs-title function_">updateActiveSidebarItem</span>();

        <span class="hljs-comment">// Update navigation arrows</span>
        <span class="hljs-title function_">updateNavigationArrows</span>();

        <span class="hljs-comment">// Function to toggle folder icons</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">toggleFolderIcon</span>(<span class="hljs-params">folderToggle, force</span>) {
            <span class="hljs-keyword">const</span> folderContents = folderToggle.<span class="hljs-property">nextElementSibling</span>;
            <span class="hljs-keyword">const</span> folderIcon = folderToggle.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.folder-icon&#x27;</span>);
            <span class="hljs-keyword">const</span> isExpanded = force !== <span class="hljs-literal">undefined</span> ? force : !folderContents.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">&#x27;d-none&#x27;</span>);

            <span class="hljs-keyword">if</span> (isExpanded) {
                folderIcon.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;fa-chevron-right&#x27;</span>);
                folderIcon.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;fa-chevron-down&#x27;</span>);
            } <span class="hljs-keyword">else</span> {
                folderIcon.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;fa-chevron-down&#x27;</span>);
                folderIcon.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;fa-chevron-right&#x27;</span>);
            }
        }

        <span class="hljs-comment">// Initialize folder icons for expanded folders</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">&#x27;.folder-toggle&#x27;</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">toggle</span> =&gt;</span> {
            <span class="hljs-keyword">const</span> folderContents = toggle.<span class="hljs-property">nextElementSibling</span>;
            <span class="hljs-keyword">if</span> (folderContents &amp;&amp; !folderContents.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">&#x27;d-none&#x27;</span>)) {
                <span class="hljs-title function_">toggleFolderIcon</span>(toggle, <span class="hljs-literal">true</span>);
            }
        });

        <span class="hljs-comment">// Code folding with dynamic loading</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
            <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>.<span class="hljs-title function_">closest</span>(<span class="hljs-string">&#x27;.toggle-code&#x27;</span>)) {
                <span class="hljs-keyword">const</span> toggleElement = e.<span class="hljs-property">target</span>.<span class="hljs-title function_">closest</span>(<span class="hljs-string">&#x27;.toggle-code&#x27;</span>);
                <span class="hljs-keyword">const</span> fileEntry = toggleElement.<span class="hljs-title function_">closest</span>(<span class="hljs-string">&#x27;.file-entry&#x27;</span>);
                <span class="hljs-keyword">const</span> codeContainer = fileEntry.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.code-container&#x27;</span>);
                <span class="hljs-keyword">const</span> icon = toggleElement.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;i&#x27;</span>);
                <span class="hljs-keyword">const</span> fileIndex = <span class="hljs-built_in">parseInt</span>(fileEntry.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;data-file-index&#x27;</span>));
                <span class="hljs-keyword">const</span> spinner = codeContainer.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.spinner-border&#x27;</span>);
                <span class="hljs-keyword">const</span> loadingText = codeContainer.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.loading-text&#x27;</span>);

                <span class="hljs-comment">// Check if code is already loaded</span>
                <span class="hljs-keyword">const</span> isLoaded = codeContainer.<span class="hljs-title function_">hasAttribute</span>(<span class="hljs-string">&#x27;data-loaded&#x27;</span>);

                <span class="hljs-keyword">if</span> (!isLoaded) {
                    <span class="hljs-comment">// Show loading state</span>
                    spinner.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">&#x27;inline-block&#x27;</span>;
                    loadingText.<span class="hljs-property">textContent</span> = <span class="hljs-string">&#x27;Loading code...&#x27;</span>;

                    <span class="hljs-comment">// Load code content from pre-embedded data</span>
                    <span class="hljs-keyword">const</span> codeContentDiv = codeContainer.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.code-content&#x27;</span>);
                    <span class="hljs-keyword">if</span> (codeContentDiv) {
                        <span class="hljs-keyword">const</span> highlightedCode = codeContentDiv.<span class="hljs-property">innerHTML</span>;

                        <span class="hljs-comment">// Replace placeholder with actual code</span>
                        codeContainer.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
                            &lt;pre class=&quot;hljs p-3 mb-0&quot; style=&quot;background: transparent;&quot;&gt;&lt;code class=&quot;hljs&quot;&gt;<span class="hljs-subst">${highlightedCode}</span>&lt;/code&gt;&lt;/pre&gt;
                        `</span>;

                        <span class="hljs-comment">// Mark as loaded</span>
                        codeContainer.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;data-loaded&#x27;</span>, <span class="hljs-string">&#x27;true&#x27;</span>);
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-comment">// Fallback if content not found</span>
                        codeContainer.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
                            &lt;div class=&quot;p-3 text-center text-muted&quot;&gt;
                                &lt;i class=&quot;fas fa-exclamation-triangle me-2&quot;&gt;&lt;/i&gt;
                                Code content not available
                            &lt;/div&gt;
                        `</span>;
                        codeContainer.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;data-loaded&#x27;</span>, <span class="hljs-string">&#x27;true&#x27;</span>);
                    }
                }

                <span class="hljs-comment">// Toggle visibility</span>
                <span class="hljs-keyword">if</span> (codeContainer.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">&#x27;d-none&#x27;</span>)) {
                    codeContainer.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;d-none&#x27;</span>);
                    icon.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;fa-chevron-right&#x27;</span>);
                    icon.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;fa-chevron-down&#x27;</span>);
                } <span class="hljs-keyword">else</span> {
                    codeContainer.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;d-none&#x27;</span>);
                    icon.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;fa-chevron-down&#x27;</span>);
                    icon.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;fa-chevron-right&#x27;</span>);
                }
            }
        });

        <span class="hljs-comment">// Copy explanation functionality</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
            <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>.<span class="hljs-title function_">closest</span>(<span class="hljs-string">&#x27;.copy-explanation&#x27;</span>)) {
                <span class="hljs-keyword">const</span> button = e.<span class="hljs-property">target</span>.<span class="hljs-title function_">closest</span>(<span class="hljs-string">&#x27;.copy-explanation&#x27;</span>);
                <span class="hljs-keyword">const</span> explanationContainer = button.<span class="hljs-title function_">closest</span>(<span class="hljs-string">&#x27;.file-entry&#x27;</span>).<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.explanation-content&#x27;</span>);
                <span class="hljs-keyword">const</span> explanationText = explanationContainer.<span class="hljs-property">textContent</span>.<span class="hljs-title function_">trim</span>();

                navigator.<span class="hljs-property">clipboard</span>.<span class="hljs-title function_">writeText</span>(explanationText).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
                    <span class="hljs-keyword">const</span> originalText = button.<span class="hljs-property">innerHTML</span>;
                    button.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">&#x27;&lt;i class=&quot;fas fa-check&quot;&gt;&lt;/i&gt; Copied!&#x27;</span>;
                    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                        button.<span class="hljs-property">innerHTML</span> = originalText;
                    }, <span class="hljs-variable constant_">COPY_FEEDBACK_DURATION</span>);
                });
            }
        });


        <span class="hljs-comment">// Sidebar navigation and folder toggle</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
            <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>.<span class="hljs-title function_">closest</span>(<span class="hljs-string">&#x27;a[href^=&quot;#file-&quot;]&#x27;</span>)) {
                e.<span class="hljs-title function_">preventDefault</span>();
                <span class="hljs-keyword">const</span> targetId = e.<span class="hljs-property">target</span>.<span class="hljs-title function_">closest</span>(<span class="hljs-string">&#x27;a&#x27;</span>).<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;href&#x27;</span>).<span class="hljs-title function_">substring</span>(<span class="hljs-number">1</span>);
                <span class="hljs-keyword">const</span> targetElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(targetId);
                <span class="hljs-keyword">if</span> (targetElement) {
                    targetElement.<span class="hljs-title function_">scrollIntoView</span>({ <span class="hljs-attr">behavior</span>: <span class="hljs-string">&#x27;smooth&#x27;</span> });
                }
            }

            <span class="hljs-comment">// Folder toggle functionality</span>
            <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>.<span class="hljs-title function_">closest</span>(<span class="hljs-string">&#x27;.folder-toggle&#x27;</span>)) {
                <span class="hljs-keyword">const</span> folderToggle = e.<span class="hljs-property">target</span>.<span class="hljs-title function_">closest</span>(<span class="hljs-string">&#x27;.folder-toggle&#x27;</span>);
                <span class="hljs-keyword">const</span> folderContents = folderToggle.<span class="hljs-property">nextElementSibling</span>;
                folderContents.<span class="hljs-property">classList</span>.<span class="hljs-title function_">toggle</span>(<span class="hljs-string">&#x27;d-none&#x27;</span>);
                <span class="hljs-title function_">toggleFolderIcon</span>(folderToggle);
            }
        });

        <span class="hljs-comment">// Sidebar toggle functionality</span>
        <span class="hljs-keyword">const</span> sidebarToggle = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;sidebar-toggle&#x27;</span>);
        <span class="hljs-keyword">const</span> sidebar = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;sidebar&#x27;</span>);
        <span class="hljs-keyword">const</span> mainContent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;main&#x27;</span>);

        <span class="hljs-keyword">if</span> (sidebarToggle &amp;&amp; sidebar &amp;&amp; mainContent) {
            sidebarToggle.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
                <span class="hljs-keyword">const</span> isCollapsed = sidebar.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> === <span class="hljs-string">&#x27;translateX(-100%)&#x27;</span>;
                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> &lt;= <span class="hljs-number">768</span>) {
                    <span class="hljs-comment">// Mobile: toggle between collapsed and expanded</span>
                    <span class="hljs-keyword">if</span> (isCollapsed) {
                        sidebar.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">&#x27;translateX(0)&#x27;</span>;
                        sidebar.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-string">&#x27;1&#x27;</span>;
                        sidebar.<span class="hljs-property">style</span>.<span class="hljs-property">pointerEvents</span> = <span class="hljs-string">&#x27;auto&#x27;</span>;
                        mainContent.<span class="hljs-property">style</span>.<span class="hljs-property">marginLeft</span> = <span class="hljs-string">&#x27;280px&#x27;</span>;
                    } <span class="hljs-keyword">else</span> {
                        sidebar.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">&#x27;translateX(-100%)&#x27;</span>;
                        sidebar.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-string">&#x27;0&#x27;</span>;
                        sidebar.<span class="hljs-property">style</span>.<span class="hljs-property">pointerEvents</span> = <span class="hljs-string">&#x27;none&#x27;</span>;
                        mainContent.<span class="hljs-property">style</span>.<span class="hljs-property">marginLeft</span> = <span class="hljs-string">&#x27;0&#x27;</span>;
                    }
                }
            });
        }

        <span class="hljs-comment">// Sidebar drag resizing</span>
        <span class="hljs-keyword">const</span> sidebarResizer = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;sidebar-resizer&#x27;</span>);
        <span class="hljs-keyword">let</span> isResizing = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">let</span> startX = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">let</span> startWidth = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">let</span> animationFrameId = <span class="hljs-literal">null</span>;

        <span class="hljs-keyword">if</span> (sidebarResizer &amp;&amp; sidebar &amp;&amp; mainContent) {
            sidebarResizer.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;mousedown&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
                isResizing = <span class="hljs-literal">true</span>;
                startX = e.<span class="hljs-property">clientX</span>;
                startWidth = sidebar.<span class="hljs-property">offsetWidth</span>;
                <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">cursor</span> = <span class="hljs-string">&#x27;ew-resize&#x27;</span>;
                <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">userSelect</span> = <span class="hljs-string">&#x27;none&#x27;</span>;
            });

            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;mousemove&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
                <span class="hljs-keyword">if</span> (!isResizing) <span class="hljs-keyword">return</span>;

                <span class="hljs-comment">// Cancel any pending animation frame</span>
                <span class="hljs-keyword">if</span> (animationFrameId !== <span class="hljs-literal">null</span>) {
                    <span class="hljs-title function_">cancelAnimationFrame</span>(animationFrameId);
                }

                <span class="hljs-comment">// Schedule update on next animation frame</span>
                animationFrameId = <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
                    <span class="hljs-keyword">const</span> newWidth = startWidth + (e.<span class="hljs-property">clientX</span> - startX);
                    <span class="hljs-keyword">const</span> clampedWidth = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-variable constant_">SIDEBAR_MIN_WIDTH</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable constant_">SIDEBAR_MAX_WIDTH</span>, newWidth));

                    sidebar.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">`<span class="hljs-subst">${clampedWidth}</span>px`</span>;
                    mainContent.<span class="hljs-property">style</span>.<span class="hljs-property">marginLeft</span> = <span class="hljs-string">`<span class="hljs-subst">${clampedWidth}</span>px`</span>;
                    mainContent.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">`calc(100% - <span class="hljs-subst">${clampedWidth}</span>px)`</span>;
                    animationFrameId = <span class="hljs-literal">null</span>;
                });
            });

            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;mouseup&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
                <span class="hljs-keyword">if</span> (isResizing) {
                    isResizing = <span class="hljs-literal">false</span>;
                    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">cursor</span> = <span class="hljs-string">&#x27;&#x27;</span>;
                    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">userSelect</span> = <span class="hljs-string">&#x27;&#x27;</span>;
                }
            });
        }

        <span class="hljs-comment">// Handle window resize using the shared layout function</span>
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-title function_">applyLayoutStyles</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> &lt;= <span class="hljs-variable constant_">MOBILE_BREAKPOINT</span>);
        });

        <span class="hljs-comment">// Navigation arrow event listeners</span>
        <span class="hljs-keyword">const</span> prevFileBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;prev-file&#x27;</span>);
        <span class="hljs-keyword">const</span> nextFileBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;next-file&#x27;</span>);
        
        <span class="hljs-keyword">if</span> (prevFileBtn &amp;&amp; nextFileBtn) {
            prevFileBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
                <span class="hljs-keyword">const</span> currentFile = <span class="hljs-title function_">getCurrentVisibleFile</span>();
                <span class="hljs-keyword">const</span> prevFile = <span class="hljs-title function_">getPreviousFile</span>(currentFile);
                <span class="hljs-keyword">if</span> (prevFile) {
                    prevFile.<span class="hljs-title function_">scrollIntoView</span>({ <span class="hljs-attr">behavior</span>: <span class="hljs-string">&#x27;smooth&#x27;</span> });
                }
            });

            nextFileBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
                <span class="hljs-keyword">const</span> currentFile = <span class="hljs-title function_">getCurrentVisibleFile</span>();
                <span class="hljs-keyword">const</span> nextFile = <span class="hljs-title function_">getNextFile</span>(currentFile);
                <span class="hljs-keyword">if</span> (nextFile) {
                    nextFile.<span class="hljs-title function_">scrollIntoView</span>({ <span class="hljs-attr">behavior</span>: <span class="hljs-string">&#x27;smooth&#x27;</span> });
                }
            });
        }

        <span class="hljs-comment">// Use requestAnimationFrame for smoother scroll performance</span>
        <span class="hljs-keyword">let</span> isScrolling = <span class="hljs-literal">false</span>;
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;scroll&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
            <span class="hljs-keyword">if</span> (!isScrolling) {
                <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
                    <span class="hljs-title function_">updateActiveSidebarItem</span>();
                    isScrolling = <span class="hljs-literal">false</span>;
                });
                isScrolling = <span class="hljs-literal">true</span>;
            }
        });

    });

    <span class="hljs-comment">// Shared function to apply layout styles based on screen size</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">applyLayoutStyles</span>(<span class="hljs-params">isMobile</span>) {
        <span class="hljs-keyword">const</span> sidebar = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;sidebar&#x27;</span>);
        <span class="hljs-keyword">const</span> sidebarToggle = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;sidebar-toggle&#x27;</span>);
        <span class="hljs-keyword">const</span> mainContent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;main&#x27;</span>);

        <span class="hljs-comment">// If sidebar doesn&#x27;t exist (e.g., in flowchart, architecture, or onboarding mode), just return</span>
        <span class="hljs-keyword">if</span> (!sidebar) {
            <span class="hljs-comment">// In special modes, ensure main content takes full width</span>
            <span class="hljs-keyword">if</span> (mainContent) {
                mainContent.<span class="hljs-property">style</span>.<span class="hljs-property">marginLeft</span> = <span class="hljs-string">&#x27;0&#x27;</span>;
                mainContent.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">&#x27;100%&#x27;</span>;
            }
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">if</span> (isMobile) {
            <span class="hljs-keyword">if</span> (sidebarToggle) {
                sidebarToggle.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;d-none&#x27;</span>);
            }
            <span class="hljs-keyword">if</span> (sidebar.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> !== <span class="hljs-string">&#x27;translateX(-100%)&#x27;</span>) {
                sidebar.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">&#x27;translateX(-100%)&#x27;</span>;
                sidebar.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-string">&#x27;0&#x27;</span>;
                sidebar.<span class="hljs-property">style</span>.<span class="hljs-property">pointerEvents</span> = <span class="hljs-string">&#x27;none&#x27;</span>;
                <span class="hljs-keyword">if</span> (mainContent) {
                    mainContent.<span class="hljs-property">style</span>.<span class="hljs-property">marginLeft</span> = <span class="hljs-string">&#x27;0&#x27;</span>;
                    mainContent.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">&#x27;100%&#x27;</span>;
                }
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (sidebarToggle) {
                sidebarToggle.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;d-none&#x27;</span>);
            }
            sidebar.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">&#x27;translateX(0)&#x27;</span>;
            sidebar.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-string">&#x27;1&#x27;</span>;
            sidebar.<span class="hljs-property">style</span>.<span class="hljs-property">pointerEvents</span> = <span class="hljs-string">&#x27;auto&#x27;</span>;
            <span class="hljs-keyword">const</span> currentWidth = sidebar.<span class="hljs-property">offsetWidth</span> || <span class="hljs-variable constant_">SIDEBAR_DEFAULT_WIDTH</span>;
            <span class="hljs-keyword">if</span> (mainContent) {
                mainContent.<span class="hljs-property">style</span>.<span class="hljs-property">marginLeft</span> = <span class="hljs-string">`<span class="hljs-subst">${currentWidth}</span>px`</span>;
                mainContent.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">`calc(100% - <span class="hljs-subst">${currentWidth}</span>px)`</span>;
            }
        }
    }

    <span class="hljs-comment">// Initialize layout on page load</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">initializeLayout</span>(<span class="hljs-params"></span>) {
        <span class="hljs-title function_">applyLayoutStyles</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> &lt;= <span class="hljs-variable constant_">MOBILE_BREAKPOINT</span>);
    }

    <span class="hljs-comment">// Helper function to find the most visible element from a list of elements</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">getMostVisibleElement</span>(<span class="hljs-params">elements</span>) {
        <span class="hljs-keyword">let</span> mostVisibleElement = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">let</span> maxVisibility = <span class="hljs-number">0</span>;

        elements.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">element</span> =&gt;</span> {
            <span class="hljs-keyword">const</span> rect = element.<span class="hljs-title function_">getBoundingClientRect</span>();
            <span class="hljs-keyword">const</span> windowHeight = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;

            <span class="hljs-comment">// Calculate how much of the element is visible</span>
            <span class="hljs-keyword">const</span> visibleTop = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, rect.<span class="hljs-property">top</span>);
            <span class="hljs-keyword">const</span> visibleBottom = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(windowHeight, rect.<span class="hljs-property">bottom</span>);
            <span class="hljs-keyword">const</span> visibleHeight = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, visibleBottom - visibleTop);
            <span class="hljs-keyword">const</span> visibility = visibleHeight / rect.<span class="hljs-property">height</span>;

            <span class="hljs-keyword">if</span> (visibility &gt; maxVisibility) {
                maxVisibility = visibility;
                mostVisibleElement = element;
            }
        });

        <span class="hljs-keyword">return</span> mostVisibleElement;
    }

    <span class="hljs-comment">// Auto-sync sidebar with scroll position</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateActiveSidebarItem</span>(<span class="hljs-params"></span>) {
        <span class="hljs-comment">// Remove active class from all sidebar links if they exist</span>
        <span class="hljs-keyword">if</span> (cachedSidebarLinks &amp;&amp; cachedSidebarLinks.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
            cachedSidebarLinks.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">link</span> =&gt;</span> link.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;active&#x27;</span>));

            <span class="hljs-comment">// Find which file entry is currently most visible</span>
            <span class="hljs-keyword">const</span> mostVisibleEntry = <span class="hljs-title function_">getMostVisibleElement</span>(cachedFileEntries);

            <span class="hljs-comment">// Highlight the corresponding sidebar item</span>
            <span class="hljs-keyword">if</span> (mostVisibleEntry) {
                <span class="hljs-keyword">const</span> fileIndex = mostVisibleEntry.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;data-file-index&#x27;</span>);
                <span class="hljs-keyword">const</span> correspondingLink = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;#sidebar a[href=&quot;#file-&#x27;</span> + fileIndex + <span class="hljs-string">&#x27;&quot;]&#x27;</span>);
                <span class="hljs-keyword">if</span> (correspondingLink) {
                    correspondingLink.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;active&#x27;</span>);
                }
            }
        }
    }

    <span class="hljs-comment">// Navigation arrow functionality</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">getCurrentVisibleFile</span>(<span class="hljs-params"></span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">getMostVisibleElement</span>(cachedFileEntries);
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">getPreviousFile</span>(<span class="hljs-params">currentFile</span>) {
        <span class="hljs-keyword">if</span> (!currentFile) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">const</span> currentIndex = cachedFileEntries.<span class="hljs-title function_">indexOf</span>(currentFile);
        <span class="hljs-keyword">return</span> currentIndex &gt; <span class="hljs-number">0</span> ? cachedFileEntries[currentIndex - <span class="hljs-number">1</span>] : <span class="hljs-literal">null</span>;
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">getNextFile</span>(<span class="hljs-params">currentFile</span>) {
        <span class="hljs-keyword">if</span> (!currentFile) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">const</span> currentIndex = cachedFileEntries.<span class="hljs-title function_">indexOf</span>(currentFile);
        <span class="hljs-keyword">return</span> currentIndex &lt; cachedFileEntries.<span class="hljs-property">length</span> - <span class="hljs-number">1</span> ? cachedFileEntries[currentIndex + <span class="hljs-number">1</span>] : <span class="hljs-literal">null</span>;
    }

    <span class="hljs-comment">// Show/hide navigation arrows based on file count</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateNavigationArrows</span>(<span class="hljs-params"></span>) {
        <span class="hljs-keyword">const</span> fileCount = cachedFileEntries.<span class="hljs-property">length</span>;
        <span class="hljs-keyword">const</span> navArrows = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;nav-arrows&#x27;</span>);
        
        <span class="hljs-comment">// If navArrows element doesn&#x27;t exist (e.g., in architecture, onboarding, or flowchart modes), return</span>
        <span class="hljs-keyword">if</span> (!navArrows) {
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-keyword">if</span> (fileCount &gt; <span class="hljs-number">1</span>) {
            navArrows.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;d-none&#x27;</span>);
        } <span class="hljs-keyword">else</span> {
            navArrows.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;d-none&#x27;</span>);
        }
    }

})();
</div>
                 </div>

             <div class="p-4">
                 <div class="d-flex justify-content-between align-items-center mb-3">
                     <h3 class="h6 text-muted mb-0 d-flex align-items-center">
                         <i class="fas fa-brain me-2 text-primary"></i>
                         AI Explanation
                     </h3>
                     <button class="btn btn-outline-primary btn-sm copy-explanation" data-file-index="14" title="Copy explanation">
                         <i class="fas fa-copy me-1"></i> Copy
                     </button>
                 </div>
                 <div class="explanation-content">
                     <p>Certainly! Let&#39;s explore this JavaScript code file and understand its structure and functionality step by step.</p>
<h1>JavaScript Code Explanation</h1>
<h2>Overview</h2>
<p>This JavaScript file is a self-executing function (an IIFE – Immediately Invoked Function Expression) designed to enhance a web interface. It provides functionality for syntax highlighting, interactive sidebar management, folder toggling, code content loading, item copying, and responsive design adjustments for different screen sizes.</p>
<h2>Key Sections and Functionalities</h2>
<h3>Configuration Constants</h3>
<ul>
<li><strong><code>SIDEBAR_DEFAULT_WIDTH</code>, <code>SIDEBAR_MIN_WIDTH</code>, <code>SIDEBAR_MAX_WIDTH</code></strong>: Define the default, minimum, and maximum widths of the sidebar.</li>
<li><strong><code>MOBILE_BREAKPOINT</code></strong>: Represents the screen width (in pixels) to switch to mobile layout; default is <code>768</code>.</li>
<li><strong><code>COPY_FEEDBACK_DURATION</code></strong>: Duration (in milliseconds) for copy confirmation message.</li>
</ul>
<h3>Cached DOM Elements</h3>
<ul>
<li><code>cachedFileEntries</code>: Stores the selected elements representing file entries.</li>
<li><code>cachedSidebarLinks</code>: Stores the sidebar links that point to file entries.</li>
</ul>
<h3>Syntax Highlighting</h3>
<ul>
<li>Utilizes the <code>marked</code> library along with <code>highlight.js</code> to apply syntax highlighting to code blocks, particularly within AI-generated explanation content.</li>
</ul>
<h3>DOMContentLoaded Event</h3>
<ul>
<li>Manages all DOM interactions post loading.</li>
<li>Initiates syntax highlights, caches DOM elements, and initializes layout.</li>
<li>Adds listeners for various user interactions like clicking on sidebar links, toggling folders, or resizing sidebar.</li>
</ul>
<h3>Sidebar Management</h3>
<ul>
<li><strong>Resize and Toggle</strong>: Allows resizing and toggling of the sidebar, adapting depending on screen size using event listeners.</li>
<li><strong>Sidebar Resizing</strong>: Achieved through mouse events that adjust the sidebar width using <code>mousemove</code> and <code>mouseup</code> listeners.</li>
</ul>
<h3>Folder Toggles</h3>
<ul>
<li><code>toggleFolderIcon(folderToggle, force)</code>: Handles changing folder icon states and visibility when folders are expanded or collapsed.</li>
</ul>
<h3>Code Folding and Loading</h3>
<ul>
<li>Enables code sections within file entries to be dynamically loaded and toggled.</li>
<li>Initially loads code blocks upon interaction if they aren&#39;t already loaded, showing a loading spinner until completion.</li>
</ul>
<h3>Copy to Clipboard</h3>
<ul>
<li>Intercept user clicks on elements with a <code>.copy-explanation</code> class to copy text content into the clipboard, providing feedback when completed.</li>
</ul>
<h3>Responsive Layout and Scroll Management</h3>
<ul>
<li><strong>Window Resize Handling</strong>: Adjusts the sidebar and layout using the <code>applyLayoutStyles(isMobile)</code> function based on the detected screen size (mobile vs desktop).</li>
<li><strong>Scroll Synchronization</strong>: Updates active sidebar items by evaluating which on-screen file is most visible.</li>
</ul>
<h3>Navigation Arrows</h3>
<ul>
<li>Uses navigation arrows to move between files using functions:<ul>
<li><code>getCurrentVisibleFile()</code></li>
<li><code>getPreviousFile(currentFile)</code></li>
<li><code>getNextFile(currentFile)</code></li>
</ul>
</li>
</ul>
<h2>Utility Functions</h2>
<h3><code>applyLayoutStyles(isMobile)</code></h3>
<ul>
<li>Adjusts layout styles for sidebar and main content based on whether the viewport is considered mobile.</li>
</ul>
<h3><code>initializeLayout()</code></h3>
<ul>
<li>Initializes layout configurations at page load for a responsive setup.</li>
</ul>
<h3><code>getMostVisibleElement(elements)</code></h3>
<ul>
<li>Determines which element from a list is the most visible on screen, used primarily for highlighting the active file entry in the sidebar.</li>
</ul>
<h3><code>updateActiveSidebarItem()</code></h3>
<ul>
<li>Syncs the active state of sidebar links with the visible file on screen, ensuring the correct navigation context.</li>
</ul>
<h3>Navigation Arrows Control</h3>
<ul>
<li><strong><code>updateNavigationArrows()</code></strong>: Determines the visibility of navigation arrows based on the number of files.</li>
</ul>
<h2>Final Thoughts</h2>
<p>This script significantly augments a web page&#39;s interactivity by providing a robust framework for handling UI components like sidebars, syntax-highlighted code blocks, and dynamic content loading. Its design is thoughtful, ensuring usability across devices with responsive adaptations for both mobile and desktop views.</p>


<p>This explanation provides insight into how each aspect of the code contributes to the overall functionality of this script. Let me know if there are any specific sections you&#39;d like to explore in further detail!</p>

                 </div>
             </div>
         </div>
     </div>
 </div>

 <div class="file-entry col-12 mb-4" id="file-15" data-file-path="D:\MyDev\CodeExplain\src\output\pdf\pdfOutput.js" data-file-index="15">
     <div class="card shadow-sm border-0 h-100" style="border-radius: 12px; overflow: hidden;">
         <div class="card-header bg-gradient-primary text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1rem 1.5rem;">
             <div class="d-flex justify-content-between align-items-center">
                  <h2 class="toggle-code h5 fw-semibold mb-0 cursor-pointer d-flex align-items-center text-white" data-file-index="15" style="font-size: 1.1rem;">
                      <i class="fas fa-chevron-right me-2 transition-transform duration-200"></i>
                      <i class="fas fa-file-code me-2"></i>
                      output/pdf/pdfOutput.js
                  </h2>
                 <span class="badge bg-white bg-opacity-25 text-white px-2 py-1" style="font-size: 0.75rem;">
                     javascript
                 </span>
             </div>
         </div>

               <div class="card-body p-0">
                 <div class="code-container bg-light border-bottom d-none" style="max-height: 400px; overflow: auto;" data-file-path="D:\MyDev\CodeExplain\src\output\pdf\pdfOutput.js" data-file-language="javascript">
                     <div class="p-3 text-center text-muted">
                         <div class="spinner-border spinner-border-sm me-2" role="status" style="display: none;"></div>
                         <span class="loading-text">Click to load code</span>
                     </div>
                     <div class="code-content" style="display: none;"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);
<span class="hljs-keyword">const</span> puppeteer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;puppeteer&#x27;</span>);
<span class="hljs-keyword">const</span> marked = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;marked&#x27;</span>);

<span class="hljs-comment">// Constants for PDF generation</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PDF_CONFIG</span> = {
  <span class="hljs-attr">format</span>: <span class="hljs-string">&#x27;A3&#x27;</span>,
  <span class="hljs-attr">margin</span>: {
    <span class="hljs-attr">top</span>: <span class="hljs-string">&#x27;0.75in&#x27;</span>,
    <span class="hljs-attr">right</span>: <span class="hljs-string">&#x27;0.75in&#x27;</span>,
    <span class="hljs-attr">bottom</span>: <span class="hljs-string">&#x27;0.75in&#x27;</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-string">&#x27;0.75in&#x27;</span>
  }
};

<span class="hljs-comment">// Helper function for HTML escaping</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">escapeHtml</span> = (<span class="hljs-params">text</span>) =&gt; {
  <span class="hljs-keyword">return</span> text
    .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&amp;/g</span>, <span class="hljs-string">&quot;&amp;amp;&quot;</span>)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&lt;/g</span>, <span class="hljs-string">&quot;&amp;lt;&quot;</span>)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&gt;/g</span>, <span class="hljs-string">&quot;&amp;gt;&quot;</span>)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&quot;/g</span>, <span class="hljs-string">&quot;&amp;quot;&quot;</span>)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&#x27;/g</span>, <span class="hljs-string">&quot;&amp;#039;&quot;</span>);
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PDFOutput</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">config</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span> = config;

    <span class="hljs-comment">// Configure marked to use highlight.js for code blocks once during initialization</span>
    marked.<span class="hljs-title function_">setOptions</span>({
      <span class="hljs-attr">highlight</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">code, lang</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> hljs !== <span class="hljs-string">&#x27;undefined&#x27;</span> &amp;&amp; lang &amp;&amp; hljs.<span class="hljs-title function_">getLanguage</span>(lang)) {
          <span class="hljs-keyword">return</span> hljs.<span class="hljs-title function_">highlight</span>(code, { <span class="hljs-attr">language</span>: lang }).<span class="hljs-property">value</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> hljs !== <span class="hljs-string">&#x27;undefined&#x27;</span>) {
          <span class="hljs-keyword">return</span> hljs.<span class="hljs-title function_">highlightAuto</span>(code).<span class="hljs-property">value</span>;
        }
        <span class="hljs-keyword">return</span> code;
      }
    });
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params">explanations, targetPath, title = <span class="hljs-string">&#x27;Code Explanation&#x27;</span></span>) {
    <span class="hljs-comment">// Use targetPath if provided, otherwise use default in current directory</span>
    <span class="hljs-keyword">const</span> outputPath = targetPath || path.<span class="hljs-title function_">join</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">&#x27;codeexplain-output.pdf&#x27;</span>);

    <span class="hljs-comment">// Handle both single file and multiple files</span>
    <span class="hljs-keyword">const</span> files = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(explanations) ? explanations : [explanations];

    <span class="hljs-comment">// Generate HTML content</span>
    <span class="hljs-keyword">const</span> htmlContent = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateHTML</span>(files, targetPath, title);

    <span class="hljs-comment">// Convert HTML to PDF using Puppeteer</span>
    <span class="hljs-keyword">let</span> browser;
    <span class="hljs-keyword">try</span> {
      browser = <span class="hljs-keyword">await</span> puppeteer.<span class="hljs-title function_">launch</span>({
        <span class="hljs-attr">headless</span>: <span class="hljs-string">&#x27;new&#x27;</span>,  <span class="hljs-comment">// Using new headless mode</span>
        <span class="hljs-attr">args</span>: [<span class="hljs-string">&#x27;--no-sandbox&#x27;</span>, <span class="hljs-string">&#x27;--disable-setuid-sandbox&#x27;</span>]
      });

      <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">newPage</span>();
      <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">setContent</span>(htmlContent, { <span class="hljs-attr">waitUntil</span>: <span class="hljs-string">&#x27;networkidle0&#x27;</span> });

      <span class="hljs-comment">// Wait for highlight.js to load and execute</span>
      <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">waitForFunction</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> hljs !== <span class="hljs-string">&#x27;undefined&#x27;</span> &amp;&amp; <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">&#x27;.hljs&#x27;</span>).<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>;
      }, { <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span> }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-comment">// If highlighting doesn&#x27;t complete, continue anyway</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Highlight.js may not have completed, proceeding with PDF generation&#x27;</span>);
      });

      <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">pdf</span>({
        <span class="hljs-attr">path</span>: outputPath,
        ...<span class="hljs-variable constant_">PDF_CONFIG</span>,
        <span class="hljs-attr">printBackground</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">preferCSSPageSize</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">displayHeaderFooter</span>: <span class="hljs-literal">false</span>
      });

      <span class="hljs-keyword">return</span> outputPath;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">throw</span> error;
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-keyword">if</span> (browser) {
        <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">close</span>();
      }
    }
  }

  <span class="hljs-title function_">generateTableOfContents</span>(<span class="hljs-params">files</span>) {
    <span class="hljs-keyword">const</span> tocItems = files.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">file, index</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> fileName = <span class="hljs-title function_">escapeHtml</span>(file.<span class="hljs-property">relativePath</span> || path.<span class="hljs-title function_">basename</span>(file.<span class="hljs-property">path</span>));
      <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;li&gt;&lt;a href=&quot;#file-<span class="hljs-subst">${index}</span>&quot;&gt;<span class="hljs-subst">${fileName}</span>&lt;/a&gt;&lt;/li&gt;`</span>;
    });
    <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;ul&gt;<span class="hljs-subst">${tocItems.join(<span class="hljs-string">&#x27;&#x27;</span>)}</span>&lt;/ul&gt;`</span>;
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">generateFileContent</span>(<span class="hljs-params">file, index</span>) {
    <span class="hljs-keyword">let</span> processedExplanation = file.<span class="hljs-property">explanation</span> || <span class="hljs-string">&#x27;No explanation available.&#x27;</span>;
    processedExplanation = <span class="hljs-keyword">typeof</span> processedExplanation === <span class="hljs-string">&#x27;string&#x27;</span> ? processedExplanation : <span class="hljs-title class_">String</span>(processedExplanation);

    <span class="hljs-comment">// Process explanation content</span>
    processedExplanation = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">extractMermaidBlocks</span>(processedExplanation);
    processedExplanation = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">extractMarkdownBlocks</span>(processedExplanation);

    <span class="hljs-keyword">let</span> renderedExplanation;
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// Replace the special markers back after marked processing</span>
      renderedExplanation = marked.<span class="hljs-title function_">parse</span>(processedExplanation)
        .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&lt;!--PARSED_MARKDOWN_START--&gt;([\s\S]*?)&lt;!--PARSED_MARKDOWN_END--&gt;/g</span>, <span class="hljs-string">&#x27;$1&#x27;</span>);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Error parsing markdown for PDF:&#x27;</span>, error);
      renderedExplanation = <span class="hljs-string">`&lt;pre&gt;<span class="hljs-subst">${escapeHtml(processedExplanation)}</span>&lt;/pre&gt;`</span>;
    }

    <span class="hljs-comment">// Read file content from disk if not available in memory</span>
    <span class="hljs-keyword">let</span> fileContent = file.<span class="hljs-property">content</span>;
    <span class="hljs-keyword">if</span> (!fileContent) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>).<span class="hljs-property">promises</span>;
        fileContent = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(file.<span class="hljs-property">path</span>, <span class="hljs-string">&#x27;utf8&#x27;</span>);
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error reading file content for PDF: <span class="hljs-subst">${file.path}</span>`</span>, error);
        fileContent = <span class="hljs-string">&#x27;// Error: Could not read file content&#x27;</span>;
      }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-string">`
      &lt;div class=&quot;file&quot; id=&quot;file-<span class="hljs-subst">${index}</span>&quot;&gt;
        &lt;div class=&quot;file-path&quot;&gt;<span class="hljs-subst">${escapeHtml(file.relativePath || path.basename(file.path))}</span>&lt;/div&gt;
        &lt;div class=&quot;code&quot;&gt;
          &lt;pre&gt;&lt;code class=&quot;language-<span class="hljs-subst">${file.language || <span class="hljs-string">&#x27;plaintext&#x27;</span>}</span>&quot;&gt;<span class="hljs-subst">${escapeHtml(fileContent)}</span>&lt;/code&gt;&lt;/pre&gt;
        &lt;/div&gt;
        &lt;div class=&quot;explanation&quot;&gt;
          &lt;h2&gt;AI Explanation&lt;/h2&gt;
          <span class="hljs-subst">${renderedExplanation}</span>
        &lt;/div&gt;
      &lt;/div&gt;
    `</span>;
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">generateHTML</span>(<span class="hljs-params">files, targetPath, title</span>) {
    <span class="hljs-comment">// Generate file content for all files</span>
    <span class="hljs-keyword">const</span> fileContents = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(
      files.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f !== <span class="hljs-literal">null</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">file, index</span>) =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateFileContent</span>(file, index))
    );

    <span class="hljs-keyword">const</span> htmlTemplate = <span class="hljs-string">`
      &lt;!DOCTYPE html&gt;
      &lt;html&gt;
      &lt;head&gt;
          &lt;meta charset=&quot;UTF-8&quot;&gt;
          &lt;title&gt;<span class="hljs-subst">${title}</span>&lt;/title&gt;
          &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/base16/cupertino.min.css&quot;&gt;
          &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js&quot;&gt;&lt;/script&gt;
          &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/autohotkey.min.js&quot;&gt;&lt;/script&gt;
          &lt;style&gt;
              body {
                  font-family: Arial, sans-serif;
                  margin: 20px;
                  line-height: 1.6;
                  font-size: 12px;
                  -webkit-font-smoothing: antialiased;
                  text-rendering: optimizeLegibility;
              }
              * { box-sizing: border-box; }
              .file {
                  margin-bottom: 40px;
                  page-break-inside: avoid;
                  page-break-after: always;
              }
              .file-path {
                  font-size: 18px;
                  font-weight: bold;
                  margin-bottom: 15px;
                  line-height: 1.4;
              }
              .code {
                  background: #f5f5f5;
                  padding: 15px;
                  margin: 15px 0;
                  border-radius: 4px;
                  border: none;
              }
              .code pre {
                  margin: 0;
                  font-family: &#x27;Courier New&#x27;, monospace;
                  font-size: 11px;
                  line-height: 1.4;
                  white-space: pre-wrap;
                  word-wrap: break-word;
              }
              .code code {
                  font-family: &#x27;Courier New&#x27;, monospace;
                  font-size: 11px;
                  line-height: 1.4;
              }
              .hljs {
                  background: #ffffff !important;
                  border: 1px solid #e0e0e0 !important;
              }
              .explanation {
                  margin-top: 25px;
              }
              .explanation h1,
              .explanation h2,
              .explanation h3 {
                  color: #333;
                  margin-top: 25px;
                  margin-bottom: 15px;
                  line-height: 1.3;
              }
              .explanation h1 { font-size: 20px; }
              .explanation h2 { font-size: 18px; }
              .explanation h3 { font-size: 16px; }
              .explanation p {
                  margin: 15px 0;
                  line-height: 1.7;
                  text-align: justify;
              }
              .explanation code {
                  background: #f0f0f0;
                  padding: 3px 6px;
                  font-family: &#x27;Courier New&#x27;, monospace;
                  font-size: 11px;
                  border-radius: 3px;
                  line-height: 1.2;
              }
              .explanation pre {
                  background: #f5f5f5;
                  padding: 15px;
                  overflow-x: auto;
                  margin: 15px 0;
                  line-height: 1.4;
                  font-size: 11px;
                  border-radius: 4px;
                  border: 1px solid #e0e0e0;
                  page-break-inside: avoid;
              }
              .explanation pre code {
                  background: transparent;
                  padding: 0;
                  font-size: 11px;
                  line-height: 1.4;
              }
              .explanation ul,
              .explanation ol {
                  margin: 15px 0;
                  padding-left: 25px;
                  line-height: 1.6;
              }
              .explanation li {
                  margin: 8px 0;
              }
              .explanation blockquote {
                  border-left: 4px solid #ccc;
                  padding-left: 15px;
                  margin: 15px 0;
                  font-style: italic;
                  line-height: 1.6;
              }
          &lt;/style&gt;
      &lt;/head&gt;
      &lt;body&gt;
          &lt;h1&gt;<span class="hljs-subst">${title}</span>&lt;/h1&gt;
          <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.generateTableOfContents(files)}</span>
          &lt;div style=&quot;page-break-before: always;&quot;&gt;&lt;/div&gt;
          <span class="hljs-subst">${fileContents.join(<span class="hljs-string">&#x27;&#x27;</span>)}</span>
          &lt;script&gt;
              if (typeof hljs !== &#x27;undefined&#x27;) {
                  hljs.highlightAll();
              }
          &lt;/script&gt;
      &lt;/body&gt;
      &lt;/html&gt;
    `</span>;

    <span class="hljs-keyword">return</span> htmlTemplate.<span class="hljs-title function_">trim</span>();
  }

  <span class="hljs-title function_">extractMermaidBlocks</span>(<span class="hljs-params">text</span>) {
    <span class="hljs-keyword">return</span> text.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/```mermaid\s*([\s\S]*?)```/g</span>, <span class="hljs-function">(<span class="hljs-params">match, mermaidCode</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> diagramId = <span class="hljs-string">`mermaid-diagram-<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.random().toString(<span class="hljs-number">36</span>).substr(<span class="hljs-number">2</span>, <span class="hljs-number">9</span>)}</span>`</span>;
      <span class="hljs-keyword">const</span> cleanCode = mermaidCode.<span class="hljs-title function_">trim</span>();

      <span class="hljs-keyword">if</span> (!cleanCode) <span class="hljs-keyword">return</span> match;

      <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;div class=&quot;mermaid-diagram-container mb-4&quot;&gt;
        &lt;div class=&quot;mermaid&quot; id=&quot;<span class="hljs-subst">${diagramId}</span>&quot;&gt;<span class="hljs-subst">${cleanCode}</span>&lt;/div&gt;
      &lt;/div&gt;`</span>;
    });
  }

  <span class="hljs-title function_">extractMarkdownBlocks</span>(<span class="hljs-params">text</span>) {
    <span class="hljs-keyword">return</span> text.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/```markdown\s*([\s\S]*?)```/g</span>, <span class="hljs-function">(<span class="hljs-params">match, markdownContent</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> cleanContent = markdownContent.<span class="hljs-title function_">trim</span>();

      <span class="hljs-keyword">if</span> (!cleanContent) <span class="hljs-keyword">return</span> match;

      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// Add a special marker to prevent double parsing in marked.parse later</span>
        <span class="hljs-keyword">const</span> parsed = marked.<span class="hljs-title function_">parse</span>(cleanContent);
        <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;!--PARSED_MARKDOWN_START--&gt;<span class="hljs-subst">${parsed}</span>&lt;!--PARSED_MARKDOWN_END--&gt;`</span>;
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Error parsing markdown block:&#x27;</span>, error);
        <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;pre&gt;<span class="hljs-subst">${escapeHtml(cleanContent)}</span>&lt;/pre&gt;`</span>;
      }
    });
  }
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { <span class="hljs-title class_">PDFOutput</span> };</div>
                 </div>

             <div class="p-4">
                 <div class="d-flex justify-content-between align-items-center mb-3">
                     <h3 class="h6 text-muted mb-0 d-flex align-items-center">
                         <i class="fas fa-brain me-2 text-primary"></i>
                         AI Explanation
                     </h3>
                     <button class="btn btn-outline-primary btn-sm copy-explanation" data-file-index="15" title="Copy explanation">
                         <i class="fas fa-copy me-1"></i> Copy
                     </button>
                 </div>
                 <div class="explanation-content">
                     <p>Certainly! Let&#39;s walk through the provided JavaScript code, which is part of a Node.js application used to convert code explanations, possibly in multiple files, into a styled PDF document. The code primarily utilizes the <code>puppeteer</code> library to handle HTML-to-PDF conversion and the <code>marked</code> library for processing Markdown.</p>
<h3>Overview</h3>
<p>The code resides in the file <code>pdfOutput.js</code> and contains a class, <code>PDFOutput</code>, responsible for generating PDFs from code and its explanations.</p>
<p>Here&#39;s a structured breakdown:</p>
<h3>1. Import Statements</h3>
<ul>
<li><strong><code>path</code></strong>: A Node.js module for handling and transforming file paths.</li>
<li><strong><code>puppeteer</code></strong>: A library providing a high-level API to control Chrome/Chromium over the DevTools Protocol. It is used here to convert HTML to PDF.</li>
<li><strong><code>marked</code></strong>: A fast markdown parser and compiler for translating Markdown into HTML.</li>
</ul>
<h3>2. Constants</h3>
<ul>
<li><strong><code>PDF_CONFIG</code></strong>: Configuration object with settings for the PDF format (<code>A3</code>) and uniform margins.</li>
</ul>
<h3>3. Helper Functions</h3>
<ul>
<li><strong><code>escapeHtml(text)</code></strong>: A function to escape HTML special characters to ensure that code or other text strings are rendered as plain text in HTML, preventing HTML injection issues.</li>
</ul>
<h3>4. The <code>PDFOutput</code> Class</h3>
<h4>Constructor</h4>
<ul>
<li><strong><code>constructor(config)</code></strong>: Initializes the PDFOutput instance with a configuration. It configures <code>marked</code> to use <code>highlight.js</code> for syntax highlighting of code blocks, if available.</li>
</ul>
<h4>Methods</h4>
<ol>
<li><p><strong><code>generate(explanations, targetPath, title = &#39;Code Explanation&#39;)</code></strong></p>
<ul>
<li><p><strong>Functionality</strong>: </p>
<ul>
<li>Converts the given code explanations into a PDF.</li>
<li>Uses a target path or defaults to the current directory output path.</li>
<li>Can handle single or multiple explanation files.</li>
<li>Converts Markdown explanations to HTML, then uses <code>puppeteer</code> to convert this HTML to a PDF.</li>
</ul>
</li>
<li><p><strong>Flow</strong>:</p>
<ul>
<li>Generate HTML content.</li>
<li>Launch a headless browser using <code>puppeteer</code> to convert the HTML to a PDF format, ensuring all resources are loaded.</li>
<li>Handles additional checks for code highlighting completion before generating the PDF.</li>
<li>Closes the browser once done.</li>
</ul>
</li>
</ul>
</li>
<li><p><strong><code>generateTableOfContents(files)</code></strong> </p>
<ul>
<li><strong>Functionality</strong>: Creates a &quot;Table of Contents&quot; list, linking to each file section within the document.</li>
</ul>
</li>
<li><p><strong><code>generateFileContent(file, index)</code></strong></p>
<ul>
<li><strong>Functionality</strong>: Processes each file’s content and explanation, rendering them into HTML structures.</li>
<li>It handles the reading of file content, applies Markdown parsing, and ensures the explanations are properly formatted and highlighted for readability.</li>
</ul>
</li>
<li><p><strong><code>generateHTML(files, targetPath, title)</code></strong></p>
<ul>
<li><strong>Functionality</strong>: Produces a complete HTML document from the files&#39; content and explanation.</li>
<li>Embeds styles and scripts that facilitate syntax highlighting and structures the document with headings, explanations, and other elements.</li>
</ul>
</li>
<li><p><strong><code>extractMermaidBlocks(text)</code></strong> and <strong><code>extractMarkdownBlocks(text)</code></strong></p>
<ul>
<li><strong>Functionality</strong>: Identify and separate <code>mermaid</code> and <code>markdown</code> blocks within the explanations.</li>
<li>Ensures that content is not processed more than once by using special markers.</li>
</ul>
</li>
</ol>
<h3>5. Export</h3>
<ul>
<li>The <code>PDFOutput</code> class is exported using <code>module.exports</code>, making it available for import in other parts of the application.</li>
</ul>
<h3>Key Points</h3>
<ul>
<li><strong>Puppeteer</strong>: Used extensively for rendering the HTML to PDF by controlling a headless instance of Chromium.</li>
<li><strong>Markdown Transformation</strong>: The use of the <code>marked</code> library for converting Markdown to HTML, with special handling for block elements.</li>
<li><strong>Code Highlighting</strong>: Ensured via <code>highlight.js</code>, promoting a more readable output with visually distinct code blocks.</li>
<li><strong>Robust Error Handling</strong>: The implementation catches possible errors and reports exceptions carefully, ensuring that the operations like reading a file or parsing Markdown do not abruptly fail without logging.</li>
</ul>
<p>This entire setup is ideal for generating structured and visually appealing PDF documents, capturing both code and commentary, styled to highlight and explain effectively.</p>

                 </div>
             </div>
         </div>
     </div>
 </div>
                </div>
            </div>
        </main>

        <!-- Navigation Arrows -->
        <div id="nav-arrows" class="position-fixed d-none d-flex flex-column" style="bottom: 20px; right: 20px; z-index: 1040; gap: 8px;">
            <button id="prev-file" class="btn btn-primary btn-sm" title="Previous file">
                <i class="fas fa-chevron-up"></i>
            </button>
            <button id="next-file" class="btn btn-primary btn-sm" title="Next file">
                <i class="fas fa-chevron-down"></i>
            </button>
        </div>
    </div>

    <!-- Non-critical scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js" defer></script>
    <!-- Load common programming languages for syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/python.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/javascript.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/typescript.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/java.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/cpp.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/csharp.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/ruby.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/go.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/rust.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/php.min.js" defer></script>
     <script src="https://cdn.jsdelivr.net/npm/marked@9.1.0/marked.min.js" defer></script>
     <script src="https://cdn.jsdelivr.net/npm/marked-highlight@2.1.0/lib/index.umd.js" defer></script>
     <script src="https://cdn.jsdelivr.net/npm/mermaid@11.0.0/dist/mermaid.min.js" defer></script>
</html>