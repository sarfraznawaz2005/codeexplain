<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Explanation: src</title>
    <!-- Critical CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/base16/cupertino.min.css">
    
    <!-- Critical JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>
    <style>
    /* Sidebar styles */
#sidebar a:hover {
    background-color: rgba(0, 123, 255, 0.1);
    color: #0056b3;
}

#sidebar a.active {
    background-color: #007bff;
    color: white;
}

#sidebar .folder-toggle:hover {
    background-color: rgba(0, 123, 255, 0.1);
    color: #0056b3;
}

/* Sidebar list styling */
#sidebar ul {
    list-style: none;
    line-height: 1.3;
}

#sidebar li {
    list-style: none;
}

/* Main content typography and styling */
.explanation-content {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    color: #495057;
}

.explanation-content h1,
.explanation-content h2,
.explanation-content h3,
.explanation-content h4,
.explanation-content h5,
.explanation-content h6 {
    color: #212529;
    font-weight: 600;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
    line-height: 1.3;
}

.explanation-content h1 {
    font-size: 1.75rem;
}

.explanation-content h2 {
    font-size: 1.5rem;
}

.explanation-content h3 {
    font-size: 1.25rem;
}

.explanation-content h4 {
    font-size: 1.1rem;
}

.explanation-content h5 {
    font-size: 1rem;
}

.explanation-content h6 {
    font-size: 0.9rem;
}

.explanation-content p {
    margin-bottom: 1rem;
    line-height: 1.7;
    text-align: justify;
}

.explanation-content ul,
.explanation-content ol {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
}

.explanation-content li {
    margin-bottom: 0.5rem;
    line-height: 1.6;
}

.explanation-content li p {
    margin-bottom: 0.5rem;
}

.explanation-content code {
    background-color: #f8f9fa;
    padding: 0.125rem 0.25rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
    color: #d73a49;
    font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
}

.explanation-content pre {
    background-color: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 0.375rem;
    padding: 1rem;
    margin: 1rem 0;
    overflow-x: auto;
    font-size: 0.875rem;
    line-height: 1.5;
}

.explanation-content pre code {
    background-color: transparent;
    padding: 0;
    color: inherit;
    border: none;
}

/* Ensure highlight.js styles don't conflict */
.explanation-content pre.hljs {
    background-color: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 0.375rem;
    padding: 1rem;
    margin: 1rem 0;
    overflow-x: auto;
    font-size: 0.875rem;
    line-height: 1.5;
}

/* Code block styling */
.code-container pre code {
    font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace !important;
}

/* Ensure highlight.js styles are applied to code container */
.code-container pre code.hljs {
    background: transparent;
    color: inherit;
}

.explanation-content blockquote {
    border-left: 4px solid #007bff;
    padding-left: 1rem;
    margin: 1.5rem 0;
    color: #6c757d;
    font-style: italic;
}

.explanation-content table {
    width: 100%;
    margin-bottom: 1rem;
    border-collapse: collapse;
}

.explanation-content th,
.explanation-content td {
    padding: 0.75rem;
    border: 1px solid #dee2e6;
    text-align: left;
}

.explanation-content th {
    background-color: #f8f9fa;
    font-weight: 600;
}

.explanation-content strong {
    font-weight: 600;
    color: #212529;
}

.explanation-content em {
    font-style: italic;
    color: #495057;
}

/* Card improvements */
.card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

/* File name hover cursor */
.toggle-code:hover {
    cursor: pointer;
}

/* Navigation arrows */
#nav-arrows {
    opacity: 0.8;
    transition: opacity 0.3s ease;
}

#nav-arrows:hover {
    opacity: 1;
}

/* Zoom controls */
.btn-group .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.btn-group .btn {
    transition: all 0.2s ease;
}

.btn-group .btn:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* Mermaid diagram controls */
.mermaid-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin: 10px 0;
    padding: 10px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #dee2e6;
    position: relative;
    z-index: 10;
    /* Ensure controls are above the diagram */
    contain: layout style;
    /* Isolate controls from diagram transforms */
}

.mermaid-controls .btn {
    padding: 6px 12px;
    font-size: 0.875rem;
    border-radius: 6px;
}

.zoom-level {
    font-weight: 600;
    color: #495057;
    min-width: 60px;
    text-align: center;
}

/* Responsive mermaid containers */
.mermaid-diagram-container {
    position: relative;
    overflow: hidden;
    /* Ensure diagram doesn't overflow container */
    border-radius: 8px;
    border: 1px solid #dee2e6;
    background: white;
    min-height: 200px;
    contain: layout;
    /* Isolate layout calculations */
}

.mermaid {
    display: block;
    width: 100%;
    min-height: 200px;
    cursor: grab;
    transition: transform 0.1s ease;
    position: relative;
    z-index: 1;
    /* Ensure diagram is below controls */
    contain: layout style paint;
    /* Isolate diagram from controls */
}

.mermaid svg {
    width: 100%;
    height: auto;
    min-height: 200px;
}

.mermaid.dragging {
    cursor: grabbing;
}

.mermaid-zoomable {
    transform-origin: center center;
}

/* Fullscreen mode */
.mermaid-fullscreen {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    background: white !important;
    z-index: 9999 !important;
    padding: 20px !important;
    box-sizing: border-box !important;
}

.mermaid-fullscreen svg {
    width: 100% !important;
    height: 100% !important;
}

.fullscreen-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.8);
    z-index: 9998;
    display: none;
}

.fullscreen-overlay.active {
    display: block;
}

/* Responsive breakpoints for diagrams */
@media (max-width: 768px) {
    .mermaid-diagram-container {
        min-height: 150px;
    }

    .mermaid svg {
        min-height: 150px;
    }

    .mermaid-controls {
        flex-wrap: wrap;
        gap: 5px;
    }

    .mermaid-controls .btn {
        padding: 4px 8px;
        font-size: 0.75rem;
    }
}
    </style>

    <script>
    (function () {
    // Constants for configuration
    const SIDEBAR_DEFAULT_WIDTH = 280;
    const SIDEBAR_MIN_WIDTH = 250;
    const SIDEBAR_MAX_WIDTH = 450;
    const MOBILE_BREAKPOINT = 768;
    const COPY_FEEDBACK_DURATION = 2000;

    // Cache DOM elements and other state (assigned in DOMContentLoaded)
    let cachedFileEntries;
    let cachedSidebarLinks;

    // Initialize syntax highlighting
    document.addEventListener('DOMContentLoaded', function () {
        // Configure marked to use highlight.js for code blocks (after marked is loaded)
        const { Marked } = window.marked;
        const { markedHighlight } = window.markedHighlight;

        // Create Marked instance with the highlight plugin
        const markedInstance = new Marked(
            { gfm: true },
            markedHighlight({
                langPrefix: 'hljs language-',
                emptyLangClass: 'hljs',
                highlight(code, lang) {
                    const language = hljs.getLanguage(lang) ? lang : 'plaintext';
                    return hljs.highlight(code, { language }).value;
                }
            })
        );

        // Apply syntax highlighting to code blocks in AI explanations
        if (typeof hljs !== 'undefined') {
            document.querySelectorAll('.explanation-content pre code').forEach((block) => {
                if (!block.classList.contains('hljs')) {
                    hljs.highlightElement(block);
                }
            });
        }

        // Cache DOM elements - convert NodeList to Array for better performance
        cachedFileEntries = Array.from(document.querySelectorAll('.file-entry'));
        cachedSidebarLinks = document.querySelectorAll('#sidebar a[href^=\"#file-\"]');
        
        // If no sidebar exists, set to empty NodeList to prevent errors
        if (cachedSidebarLinks.length === 0) {
            cachedSidebarLinks = [];
        }

        // Initialize layout
        initializeLayout();

        // Initial active item update
        updateActiveSidebarItem();

        // Update navigation arrows
        updateNavigationArrows();

        // Function to toggle folder icons
        function toggleFolderIcon(folderToggle, force) {
            const folderContents = folderToggle.nextElementSibling;
            const folderIcon = folderToggle.querySelector('.folder-icon');
            const isExpanded = force !== undefined ? force : !folderContents.classList.contains('d-none');

            if (isExpanded) {
                folderIcon.classList.remove('fa-chevron-right');
                folderIcon.classList.add('fa-chevron-down');
            } else {
                folderIcon.classList.remove('fa-chevron-down');
                folderIcon.classList.add('fa-chevron-right');
            }
        }

        // Initialize folder icons for expanded folders
        document.querySelectorAll('.folder-toggle').forEach(toggle => {
            const folderContents = toggle.nextElementSibling;
            if (folderContents && !folderContents.classList.contains('d-none')) {
                toggleFolderIcon(toggle, true);
            }
        });

        // Code folding
        document.addEventListener('click', function (e) {
            if (e.target.closest('.toggle-code')) {
                const toggleElement = e.target.closest('.toggle-code');
                const codeContainer = toggleElement.closest('.file-entry').querySelector('.code-container');
                const icon = toggleElement.querySelector('i');

                if (codeContainer.classList.contains('d-none')) {
                    codeContainer.classList.remove('d-none');
                    icon.classList.remove('fa-chevron-right');
                    icon.classList.add('fa-chevron-down');
                } else {
                    codeContainer.classList.add('d-none');
                    icon.classList.remove('fa-chevron-down');
                    icon.classList.add('fa-chevron-right');
                }
            }
        });

        // Copy explanation functionality
        document.addEventListener('click', function (e) {
            if (e.target.closest('.copy-explanation')) {
                const button = e.target.closest('.copy-explanation');
                const explanationContainer = button.closest('.file-entry').querySelector('.explanation-content');
                const explanationText = explanationContainer.textContent.trim();

                navigator.clipboard.writeText(explanationText).then(() => {
                    const originalText = button.innerHTML;
                    button.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    setTimeout(() => {
                        button.innerHTML = originalText;
                    }, COPY_FEEDBACK_DURATION);
                });
            }
        });


        // Sidebar navigation and folder toggle
        document.addEventListener('click', function (e) {
            if (e.target.closest('a[href^="#file-"]')) {
                e.preventDefault();
                const targetId = e.target.closest('a').getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                }
            }

            // Folder toggle functionality
            if (e.target.closest('.folder-toggle')) {
                const folderToggle = e.target.closest('.folder-toggle');
                const folderContents = folderToggle.nextElementSibling;
                folderContents.classList.toggle('d-none');
                toggleFolderIcon(folderToggle);
            }
        });

        // Sidebar toggle functionality
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.querySelector('main');

        if (sidebarToggle && sidebar && mainContent) {
            sidebarToggle.addEventListener('click', () => {
                const isCollapsed = sidebar.style.transform === 'translateX(-100%)';
                if (window.innerWidth <= 768) {
                    // Mobile: toggle between collapsed and expanded
                    if (isCollapsed) {
                        sidebar.style.transform = 'translateX(0)';
                        sidebar.style.opacity = '1';
                        sidebar.style.pointerEvents = 'auto';
                        mainContent.style.marginLeft = '280px';
                    } else {
                        sidebar.style.transform = 'translateX(-100%)';
                        sidebar.style.opacity = '0';
                        sidebar.style.pointerEvents = 'none';
                        mainContent.style.marginLeft = '0';
                    }
                }
            });
        }

        // Sidebar drag resizing
        const sidebarResizer = document.getElementById('sidebar-resizer');
        let isResizing = false;
        let startX = 0;
        let startWidth = 0;
        let animationFrameId = null;

        if (sidebarResizer && sidebar && mainContent) {
            sidebarResizer.addEventListener('mousedown', (e) => {
                isResizing = true;
                startX = e.clientX;
                startWidth = sidebar.offsetWidth;
                document.body.style.cursor = 'ew-resize';
                document.body.style.userSelect = 'none';
            });

            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;

                // Cancel any pending animation frame
                if (animationFrameId !== null) {
                    cancelAnimationFrame(animationFrameId);
                }

                // Schedule update on next animation frame
                animationFrameId = requestAnimationFrame(() => {
                    const newWidth = startWidth + (e.clientX - startX);
                    const clampedWidth = Math.max(SIDEBAR_MIN_WIDTH, Math.min(SIDEBAR_MAX_WIDTH, newWidth));

                    sidebar.style.width = `${clampedWidth}px`;
                    mainContent.style.marginLeft = `${clampedWidth}px`;
                    mainContent.style.width = `calc(100% - ${clampedWidth}px)`;
                    animationFrameId = null;
                });
            });

            document.addEventListener('mouseup', () => {
                if (isResizing) {
                    isResizing = false;
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                }
            });
        }

        // Handle window resize using the shared layout function
        window.addEventListener('resize', () => {
            applyLayoutStyles(window.innerWidth <= MOBILE_BREAKPOINT);
        });

        // Navigation arrow event listeners
        const prevFileBtn = document.getElementById('prev-file');
        const nextFileBtn = document.getElementById('next-file');
        
        if (prevFileBtn && nextFileBtn) {
            prevFileBtn.addEventListener('click', () => {
                const currentFile = getCurrentVisibleFile();
                const prevFile = getPreviousFile(currentFile);
                if (prevFile) {
                    prevFile.scrollIntoView({ behavior: 'smooth' });
                }
            });

            nextFileBtn.addEventListener('click', () => {
                const currentFile = getCurrentVisibleFile();
                const nextFile = getNextFile(currentFile);
                if (nextFile) {
                    nextFile.scrollIntoView({ behavior: 'smooth' });
                }
            });
        }

        // Use requestAnimationFrame for smoother scroll performance
        let isScrolling = false;
        window.addEventListener('scroll', function () {
            if (!isScrolling) {
                window.requestAnimationFrame(function () {
                    updateActiveSidebarItem();
                    isScrolling = false;
                });
                isScrolling = true;
            }
        });

    });

    // Shared function to apply layout styles based on screen size
    function applyLayoutStyles(isMobile) {
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const mainContent = document.querySelector('main');

        // If sidebar doesn't exist (e.g., in flowchart, architecture, or onboarding mode), just return
        if (!sidebar) {
            // In special modes, ensure main content takes full width
            if (mainContent) {
                mainContent.style.marginLeft = '0';
                mainContent.style.width = '100%';
            }
            return;
        }

        if (isMobile) {
            if (sidebarToggle) {
                sidebarToggle.classList.remove('d-none');
            }
            if (sidebar.style.transform !== 'translateX(-100%)') {
                sidebar.style.transform = 'translateX(-100%)';
                sidebar.style.opacity = '0';
                sidebar.style.pointerEvents = 'none';
                if (mainContent) {
                    mainContent.style.marginLeft = '0';
                    mainContent.style.width = '100%';
                }
            }
        } else {
            if (sidebarToggle) {
                sidebarToggle.classList.add('d-none');
            }
            sidebar.style.transform = 'translateX(0)';
            sidebar.style.opacity = '1';
            sidebar.style.pointerEvents = 'auto';
            const currentWidth = sidebar.offsetWidth || SIDEBAR_DEFAULT_WIDTH;
            if (mainContent) {
                mainContent.style.marginLeft = `${currentWidth}px`;
                mainContent.style.width = `calc(100% - ${currentWidth}px)`;
            }
        }
    }

    // Initialize layout on page load
    function initializeLayout() {
        applyLayoutStyles(window.innerWidth <= MOBILE_BREAKPOINT);
    }

    // Helper function to find the most visible element from a list of elements
    function getMostVisibleElement(elements) {
        let mostVisibleElement = null;
        let maxVisibility = 0;

        elements.forEach(element => {
            const rect = element.getBoundingClientRect();
            const windowHeight = window.innerHeight;

            // Calculate how much of the element is visible
            const visibleTop = Math.max(0, rect.top);
            const visibleBottom = Math.min(windowHeight, rect.bottom);
            const visibleHeight = Math.max(0, visibleBottom - visibleTop);
            const visibility = visibleHeight / rect.height;

            if (visibility > maxVisibility) {
                maxVisibility = visibility;
                mostVisibleElement = element;
            }
        });

        return mostVisibleElement;
    }

    // Auto-sync sidebar with scroll position
    function updateActiveSidebarItem() {
        // Remove active class from all sidebar links if they exist
        if (cachedSidebarLinks && cachedSidebarLinks.length > 0) {
            cachedSidebarLinks.forEach(link => link.classList.remove('active'));

            // Find which file entry is currently most visible
            const mostVisibleEntry = getMostVisibleElement(cachedFileEntries);

            // Highlight the corresponding sidebar item
            if (mostVisibleEntry) {
                const fileIndex = mostVisibleEntry.getAttribute('data-file-index');
                const correspondingLink = document.querySelector('#sidebar a[href="#file-' + fileIndex + '"]');
                if (correspondingLink) {
                    correspondingLink.classList.add('active');
                }
            }
        }
    }

    // Navigation arrow functionality
    function getCurrentVisibleFile() {
        return getMostVisibleElement(cachedFileEntries);
    }

    function getPreviousFile(currentFile) {
        if (!currentFile) return null;
        const currentIndex = cachedFileEntries.indexOf(currentFile);
        return currentIndex > 0 ? cachedFileEntries[currentIndex - 1] : null;
    }

    function getNextFile(currentFile) {
        if (!currentFile) return null;
        const currentIndex = cachedFileEntries.indexOf(currentFile);
        return currentIndex < cachedFileEntries.length - 1 ? cachedFileEntries[currentIndex + 1] : null;
    }

    // Show/hide navigation arrows based on file count
    function updateNavigationArrows() {
        const fileCount = cachedFileEntries.length;
        const navArrows = document.getElementById('nav-arrows');
        
        // If navArrows element doesn't exist (e.g., in architecture, onboarding, or flowchart modes), return
        if (!navArrows) {
            return;
        }
        
        if (fileCount > 1) {
            navArrows.classList.remove('d-none');
        } else {
            navArrows.classList.add('d-none');
        }
    }

})();

    
    </script>    
</head>
    <body class="bg-light text-dark" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;">
    <div id="app" class="vh-100">
        <!-- Header -->
        <header class="bg-white shadow-sm position-fixed top-0 start-0 w-100 border-bottom" style="z-index: 1030; backdrop-filter: blur(10px); background-color: rgba(255, 255, 255, 0.95);">
            <div class="container-fluid py-3 px-4">
                <div class="row align-items-center">
                    <div class="col-auto d-flex align-items-center">
                        <i class="fas fa-code text-primary me-3 fs-4"></i>
                         <h1 class="h5 fw-bold text-dark mb-0">Code Explanation: <span class="text-primary fw-semibold">src</span></h1>
                    </div>
                    <div class="col text-center d-none d-md-block">
                        <small class="text-muted">AI-Powered Code Explanation</small>
                    </div>

                </div>
            </div>
        </header>


        

        <!-- Main Content -->
        <main style="margin-left: 0px; width: 100%; margin-top: 96px; padding: 2rem; transition: margin-left 0.3s ease; min-height: calc(100vh - 96px);">
            <div class="container-fluid">
                <!-- File Entries -->
                <div id="file-entries" class="row g-4">
                    
<div class="file-entry col-12 mb-4" id="file-0" data-file-path="developer-onboarding" data-file-index="0">
    <div class="card shadow-sm border-0 h-100" style="border-radius: 12px; overflow: hidden;">
        <div class="card-header bg-gradient-primary text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1rem 1.5rem;">
            <div class="d-flex justify-content-between align-items-center">
                <h2 class="toggle-code h5 fw-semibold mb-0 cursor-pointer d-flex align-items-center text-white" data-file-index="0" style="font-size: 1.1rem;">
                    <i class="fas fa-chevron-right me-2 transition-transform duration-200"></i>
                    <i class="fas fa-file-code me-2"></i>
                    Developer Onboarding
                </h2>
                <span class="badge bg-white bg-opacity-25 text-white px-2 py-1" style="font-size: 0.75rem;">
                    arch
                </span>
            </div>
        </div>

        <div class="card-body p-0">
              <div class="code-container bg-light border-bottom d-none" style="max-height: 400px; overflow: auto;">
                  <div class="p-3">
                      <pre class="mb-0"><code class="language-arch" style="font-size: 0.9rem; line-height: 1.5;">
<span class="hljs-comment"># Codebase Summary</span>

<span class="hljs-comment">## Project Structure</span>

<span class="hljs-comment">### ai</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">**aiEngine.js** (javascript):</span> <span class="hljs-string">Contains</span> <span class="hljs-string">code</span> <span class="hljs-string">for</span> <span class="hljs-string">aiEngine</span> <span class="hljs-string">module</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">**promptManager.js** (javascript):</span> <span class="hljs-string">Contains</span> <span class="hljs-string">code</span> <span class="hljs-string">for</span> <span class="hljs-string">promptManager</span> <span class="hljs-string">module</span>

<span class="hljs-comment">### commands</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">**explain.js** (javascript):</span> <span class="hljs-string">Contains</span> <span class="hljs-string">code</span> <span class="hljs-string">for</span> <span class="hljs-string">explain</span> <span class="hljs-string">module</span>

<span class="hljs-comment">### core</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">**cacheManager.js** (javascript):</span> <span class="hljs-string">Contains</span> <span class="hljs-string">code</span> <span class="hljs-string">for</span> <span class="hljs-string">cacheManager</span> <span class="hljs-string">module</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">**codeAnalyzer.js** (javascript):</span> <span class="hljs-string">Contains</span> <span class="hljs-string">code</span> <span class="hljs-string">for</span> <span class="hljs-string">codeAnalyzer</span> <span class="hljs-string">module</span>

<span class="hljs-comment">### config</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">**configManager.js** (javascript):</span> <span class="hljs-string">Configuration</span> <span class="hljs-string">settings</span> <span class="hljs-string">and</span> <span class="hljs-string">environment</span> <span class="hljs-string">variables</span>

<span class="hljs-comment">### flowchart</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">**flowchartGenerator.js** (javascript):</span> <span class="hljs-string">Contains</span> <span class="hljs-string">code</span> <span class="hljs-string">for</span> <span class="hljs-string">flowchartGenerator</span> <span class="hljs-string">module</span>

<span class="hljs-comment">### utils</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">**constants.js** (javascript):</span> <span class="hljs-string">Contains</span> <span class="hljs-string">code</span> <span class="hljs-string">for</span> <span class="hljs-string">constants</span> <span class="hljs-string">module</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">**languageMap.js** (javascript):</span> <span class="hljs-string">Contains</span> <span class="hljs-string">code</span> <span class="hljs-string">for</span> <span class="hljs-string">languageMap</span> <span class="hljs-string">module</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">**utils.js** (javascript):</span> <span class="hljs-string">Provides</span> <span class="hljs-string">utility</span> <span class="hljs-string">functions</span> <span class="hljs-string">and</span> <span class="hljs-string">reusable</span> <span class="hljs-string">code</span>

<span class="hljs-comment">### output/html</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">**htmlOutput.js** (javascript):</span> <span class="hljs-string">Contains</span> <span class="hljs-string">code</span> <span class="hljs-string">for</span> <span class="hljs-string">htmlOutput</span> <span class="hljs-string">module</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">**htmlTemplate.js** (javascript):</span> <span class="hljs-string">Contains</span> <span class="hljs-string">code</span> <span class="hljs-string">for</span> <span class="hljs-string">htmlTemplate</span> <span class="hljs-string">module</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">**_css.css** (css):</span> <span class="hljs-string">Contains</span> <span class="hljs-string">code</span> <span class="hljs-string">for</span> <span class="hljs-string">_css</span> <span class="hljs-string">module</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">**_flowchart.js** (javascript):</span> <span class="hljs-string">Contains</span> <span class="hljs-string">code</span> <span class="hljs-string">for</span> <span class="hljs-string">_flowchart</span> <span class="hljs-string">module</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">**_js.js** (javascript):</span> <span class="hljs-string">Contains</span> <span class="hljs-string">code</span> <span class="hljs-string">for</span> <span class="hljs-string">_js</span> <span class="hljs-string">module</span>

<span class="hljs-comment">### output/pdf</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">**pdfOutput.js** (javascript):</span> <span class="hljs-string">Contains</span> <span class="hljs-string">code</span> <span class="hljs-string">for</span> <span class="hljs-string">pdfOutput</span> <span class="hljs-string">module</span>

<span class="hljs-comment">## Technology Stack</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">**Languages**:</span> <span class="hljs-string">javascript,</span> <span class="hljs-string">css</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">**File Types**:</span> <span class="hljs-string">.js,</span> <span class="hljs-string">.css</span>

<span class="hljs-comment">## Key Files Content</span>

<span class="hljs-comment">### config/configManager.js</span>

<span class="hljs-string">```javascript</span>
<span class="hljs-string">const</span> <span class="hljs-string">path</span> <span class="hljs-string">=</span> <span class="hljs-string">require(&#x27;path&#x27;);</span>
<span class="hljs-string">const</span> <span class="hljs-string">fs</span> <span class="hljs-string">=</span> <span class="hljs-string">require(&#x27;fs-extra&#x27;);</span>

<span class="hljs-string">//</span> <span class="hljs-string">Configuration</span> <span class="hljs-string">constants</span>
<span class="hljs-string">const</span> <span class="hljs-string">CONFIG_DEFAULTS</span> <span class="hljs-string">=</span> {
  <span class="hljs-attr">GEMINI_MODEL:</span> <span class="hljs-string">&#x27;gemini-2.5-flash&#x27;</span>,
  <span class="hljs-attr">OPENAI_MODEL:</span> <span class="hljs-string">&#x27;gpt-4o&#x27;</span>,
  <span class="hljs-attr">RETRY_ATTEMPTS:</span> <span class="hljs-number">3</span>,
  <span class="hljs-attr">RETRY_DELAY:</span> <span class="hljs-number">1000</span>,
  <span class="hljs-attr">JSON_INDENT_SPACES:</span> <span class="hljs-number">2</span>
}<span class="hljs-string">;</span>

<span class="hljs-string">const</span> <span class="hljs-string">CONFIG_DIR_NAME</span> <span class="hljs-string">=</span> <span class="hljs-string">&#x27;.codeexplain&#x27;</span><span class="hljs-string">;</span>
<span class="hljs-string">const</span> <span class="hljs-string">CONFIG_FILE_NAME</span> <span class="hljs-string">=</span> <span class="hljs-string">&#x27;config.json&#x27;</span><span class="hljs-string">;</span>

<span class="hljs-string">class</span> <span class="hljs-string">ConfigManager</span> {
  <span class="hljs-comment">#codeExplainDir;</span>

  <span class="hljs-string">constructor(configPath)</span> {
    <span class="hljs-string">this.configPath</span> <span class="hljs-string">=</span> <span class="hljs-string">configPath;</span>
    <span class="hljs-string">this.#codeExplainDir</span> <span class="hljs-string">=</span> <span class="hljs-string">path.join(process.cwd()</span>, <span class="hljs-string">CONFIG_DIR_NAME);</span>
    <span class="hljs-string">this.defaultConfig</span> <span class="hljs-string">=</span> {
      <span class="hljs-attr">provider:</span> <span class="hljs-string">&#x27;gemini&#x27;</span>,
      <span class="hljs-attr">model:</span> <span class="hljs-string">&#x27;gemini-2.5-flash&#x27;</span>,
      <span class="hljs-attr">output:</span> <span class="hljs-string">&#x27;html&#x27;</span>,
      <span class="hljs-attr">mode:</span> <span class="hljs-string">&#x27;explain&#x27;</span>,
      <span class="hljs-attr">level:</span> <span class="hljs-string">&#x27;beginner&#x27;</span>,
      <span class="hljs-attr">maxTokens:</span> <span class="hljs-number">15000</span>,
      <span class="hljs-attr">baseUrl:</span> <span class="hljs-literal">null</span>, <span class="hljs-string">//</span> <span class="hljs-string">For</span> <span class="hljs-string">Ollama</span> <span class="hljs-string">or</span> <span class="hljs-string">custom</span> <span class="hljs-string">OpenAI</span> <span class="hljs-string">endpoints</span>
      <span class="hljs-attr">retry:</span> {
        <span class="hljs-attr">attempts:</span> <span class="hljs-string">CONFIG_DEFAULTS.RETRY_ATTEMPTS</span>,
        <span class="hljs-attr">delay:</span> <span class="hljs-string">CONFIG_DEFAULTS.RETRY_DELAY</span>
      },
      <span class="hljs-attr">codeExtensions:</span> [
        <span class="hljs-string">//</span> <span class="hljs-string">Web</span> <span class="hljs-string">Development</span>
        <span class="hljs-string">&#x27;.js&#x27;</span>, <span class="hljs-string">&#x27;.jsx&#x27;</span>, <span class="hljs-string">&#x27;.ts&#x27;</span>, <span class="hljs-string">&#x27;.tsx&#x27;</span>, <span class="hljs-string">&#x27;.vue&#x27;</span>, <span class="hljs-string">&#x27;.svel
... (truncated)
```

</span>
                      </code></pre>
                  </div>
              </div>

            <div class="p-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="h6 text-muted mb-0 d-flex align-items-center">
                        <i class="fas fa-brain me-2 text-primary"></i>
                        AI Explanation
                    </h3>
                    <button class="btn btn-outline-primary btn-sm copy-explanation" data-file-index="0" title="Copy explanation">
                        <i class="fas fa-copy me-1"></i> Copy
                    </button>
                </div>
                <div class="explanation-content">
                    <h1>Codebase Architecture Overview</h1>
<p>This document provides a comprehensive architectural overview of the codebase, targeting beginner developers. It outlines the key components, their relationships, data flow, design patterns, and technology stack.</p>
<h2>1. Overall System Architecture and Design</h2>
<p>The codebase is designed to analyze and explain code, generate flowcharts, and output the results in various formats (HTML, PDF). It leverages AI models (Gemini, OpenAI) to provide explanations at different levels of detail. The system is structured into modules that handle specific tasks, such as AI interaction, code analysis, output generation, and configuration management.</p>
<h2>2. Key Components and Their Relationships</h2>
<p>The project comprises several key modules, each responsible for a specific aspect of the application&#39;s functionality.  Here&#39;s a breakdown of each and their inter-relationships:</p>
<ul>
<li><p><strong><code>ai</code></strong>: This directory contains modules related to interacting with AI models.</p>
<ul>
<li><strong><code>aiEngine.js</code></strong>:  This is likely the core module responsible for communicating with the AI models (Gemini or OpenAI). It handles sending prompts and receiving responses.  It&#39;s the interface between the core logic and the chosen AI provider.</li>
<li><strong><code>promptManager.js</code></strong>:  This module manages the prompts sent to the AI engine. It likely constructs prompts based on the input code and desired explanation level.  It may also handle prompt formatting and optimization for specific AI models.</li>
</ul>
</li>
<li><p><strong><code>commands</code></strong>: This directory contains command-line interface (CLI) command definitions.</p>
<ul>
<li><strong><code>explain.js</code></strong>:  This module likely defines the <code>explain</code> command. It handles parsing command-line arguments, orchestrating the code analysis and explanation process, and outputting the results. This serves as an entrypoint for the program.</li>
</ul>
</li>
<li><p><strong><code>core</code></strong>: This directory contains the core logic of the application.</p>
<ul>
<li><strong><code>cacheManager.js</code></strong>: This module handles caching of AI responses to improve performance and reduce API calls.</li>
<li><strong><code>codeAnalyzer.js</code></strong>: This module analyzes the input code to extract relevant information, such as syntax, structure, and dependencies.  It serves as an abstraction that allows the AI to focus on the important parts of the code instead of raw text.</li>
</ul>
</li>
<li><p><strong><code>config</code></strong>:</p>
<ul>
<li><strong><code>configManager.js</code></strong>: This module manages the application&#39;s configuration settings, including API keys, model choices, and output formats. It reads configuration from a file (<code>config.json</code>) and provides access to configuration values. This is crucial for customizing the application&#39;s behavior.</li>
</ul>
</li>
<li><p><strong><code>flowchart</code></strong>:</p>
<ul>
<li><strong><code>flowchartGenerator.js</code></strong>: This module generates flowcharts from the analyzed code.</li>
</ul>
</li>
<li><p><strong><code>utils</code></strong>: This directory contains utility functions and constants.</p>
<ul>
<li><strong><code>constants.js</code></strong>: Defines constants used throughout the application, such as default values and error messages.</li>
<li><strong><code>languageMap.js</code></strong>:  Maps file extensions to programming languages, enabling language-specific analysis and highlighting.</li>
<li><strong><code>utils.js</code></strong>: Provides reusable utility functions, such as file reading, string manipulation, and error handling.</li>
</ul>
</li>
<li><p><strong><code>output</code></strong>: This directory contains modules for generating output in different formats.</p>
<ul>
<li><strong><code>output/html</code></strong>:<ul>
<li><strong><code>htmlOutput.js</code></strong>: This module generates HTML output from the analyzed code and AI explanations.</li>
<li><strong><code>htmlTemplate.js</code></strong>: Provides the HTML template used to structure the output.</li>
<li><strong><code>_css.css</code></strong>: Contains CSS styles for the HTML output.</li>
<li><strong><code>_flowchart.js</code></strong>: Contains JavaScript code related to flowchart visualization in the HTML output.</li>
<li><strong><code>_js.js</code></strong>: Contains JavaScript code for interactive elements in the HTML output.</li>
</ul>
</li>
<li><strong><code>output/pdf</code></strong>:<ul>
<li><strong><code>pdfOutput.js</code></strong>: This module generates PDF output from the analyzed code and AI explanations.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Relationship Diagram (Conceptual):</strong></p>

<p>[CLI] (explain.js) --&gt; [Configuration] (configManager.js)
[CLI] --&gt; [Code Analysis] (codeAnalyzer.js)
[CLI] --&gt; [AI Engine] (aiEngine.js)
[CLI] --&gt; [Flowchart] (flowchartGenerator.js)
[Code Analysis] --&gt; [Language Map] (languageMap.js)
[AI Engine] --&gt; [Prompt Manager] (promptManager.js)
[AI Engine] --&gt; [Cache Manager] (cacheManager.js)
[CLI] --&gt; [Output] (htmlOutput.js, pdfOutput.js)</p>
<pre><code>
## 3. Data Flow and Interactions Between Modules

1.  **Input:** The `explain.js` command receives the input code file as an argument.
2.  **Configuration:** `explain.js` uses `configManager.js` to load configuration settings, such as the AI model to use and the output format.
3.  **Code Analysis:** `codeAnalyzer.js` analyzes the input code to extract relevant information (e.g., syntax, structure).
4.  **Prompt Generation:** `promptManager.js` constructs a prompt based on the analyzed code and the user&#39;s desired explanation level.
5.  **AI Interaction:** `aiEngine.js` sends the prompt to the configured AI model (Gemini or OpenAI) and retrieves the response.  `cacheManager.js` is used to check if the prompt has been processed before, and either retrieves the explanation or caches a newly generated one.
6.  **Flowchart Generation:** `flowchartGenerator.js` creates a flowchart representation of the code&#39;s logic.
7.  **Output Generation:** Based on the configured output format (`html` or `pdf`), either `htmlOutput.js` or `pdfOutput.js` generates the output document, incorporating the code, AI explanation, and flowchart.  `htmlOutput.js` uses `htmlTemplate.js` for the HTML structure and styling from `_css.css` and interactive components handled by `_js.js` and potentially `_flowchart.js`.
8.  **Output:** The generated document is saved to a file or displayed to the user.

## 4. Design Patterns and Architectural Decisions

*   **Modular Design:** The codebase is divided into modules with clear responsibilities, promoting code reusability and maintainability.
*   **Configuration Management:** The `configManager.js` module centralizes configuration settings, making it easy to customize the application&#39;s behavior.
*   **Abstraction:** The `aiEngine.js` module provides an abstraction layer for interacting with different AI models, allowing the application to switch between models without significant code changes.
*   **Caching:** The `cacheManager.js` module implements caching to improve performance and reduce API calls.
*   **Template Pattern:** `htmlOutput.js` and `htmlTemplate.js` use a template pattern to generate HTML output, separating the structure of the output from the data.

## 5. Technology Stack and Frameworks Used

*   **JavaScript:** The primary programming language.
*   **CSS:** Used for styling the HTML output.
*   **Node.js:**  Implied usage since `require` is used and Javascript files are present.

## 6. Project Structure and Organization

The project follows a clear directory structure that separates different concerns:

*   `ai`: AI interaction logic.
*   `commands`: CLI command definitions.
*   `core`: Core application logic.
*   `config`: Configuration management.
*   `flowchart`: Flowchart generation.
*   `utils`: Utility functions and constants.
*   `output`: Output generation in different formats.

## 7. Entry Points and Main Application Flow

The main entry point of the application is likely the `explain.js` file within the `commands` directory. This is where the command-line arguments are parsed, and the core logic of the application is invoked. The overall application flow can be summarized as follows:

1.  User executes the `explain` command with the input code file.
2.  `explain.js` parses the command-line arguments and loads the configuration using `configManager.js`.
3.  `explain.js` invokes `codeAnalyzer.js` to analyze the input code.
4.  `explain.js` uses the analyzed code to generate a prompt using `promptManager.js`.
5.  `explain.js` sends the prompt to the AI engine via `aiEngine.js` and caches results via `cacheManager.js`.
6.  `explain.js` invokes `flowchartGenerator.js` to create a flowchart.
7.  `explain.js` uses either `htmlOutput.js` or `pdfOutput.js` to generate the output document, based on the configuration.
8.  The generated document is saved to a file or displayed to the user.

## 8. Code Examples

Here are some code snippets to illustrate key aspects of the codebase:

**Example: Configuration Loading (config/configManager.js)**

```javascript
const path = require(&#39;path&#39;);
const fs = require(&#39;fs-extra&#39;);

const CONFIG_DEFAULTS = {
  GEMINI_MODEL: &#39;gemini-2.5-flash&#39;,
  OPENAI_MODEL: &#39;gpt-4o&#39;,
  RETRY_ATTEMPTS: 3,
  RETRY_DELAY: 1000,
  JSON_INDENT_SPACES: 2
};

const CONFIG_DIR_NAME = &#39;.codeexplain&#39;;
const CONFIG_FILE_NAME = &#39;config.json&#39;;

class ConfigManager {
  #codeExplainDir;

  constructor(configPath) {
    this.configPath = configPath;
    this.#codeExplainDir = path.join(process.cwd(), CONFIG_DIR_NAME);
    this.defaultConfig = {
      provider: &#39;gemini&#39;,
      model: &#39;gemini-2.5-flash&#39;,
      output: &#39;html&#39;,
      mode: &#39;explain&#39;,
      level: &#39;beginner&#39;,
      maxTokens: 15000,
      baseUrl: null, // For Ollama or custom OpenAI endpoints
      retry: {
        attempts: CONFIG_DEFAULTS.RETRY_ATTEMPTS,
        delay: CONFIG_DEFAULTS.RETRY_DELAY
      },
      codeExtensions: [
        // Web Development
        &#39;.js&#39;, &#39;.jsx&#39;, &#39;.ts&#39;, &#39;.tsx&#39;, &#39;.vue&#39;, &#39;.svelte&#39;, &#39;.html&#39;, &#39;.css&#39;, &#39;.scss&#39;, &#39;.php&#39;,
        // Backend Development
        &#39;.py&#39;, &#39;.java&#39;, &#39;.c&#39;, &#39;.cpp&#39;, &#39;.go&#39;, &#39;.rs&#39;, &#39;.sh&#39;, &#39;.kt&#39;, &#39;.rb&#39;, &#39;.m&#39;, &#39;.swift&#39;, &#39;.cs&#39;,
        // Data Science and ML
        &#39;.r&#39;, &#39;.ipynb&#39;,
        // DevOps and Infrastructure
        &#39;.yml&#39;, &#39;.yaml&#39;, &#39;.dockerfile&#39;, &#39;.tf&#39;, &#39;.toml&#39;,
        // Databases
        &#39;.sql&#39;,
      ]
    };
  }

  async initialize() {
    await fs.ensureDir(this.#codeExplainDir);
    const configFilePath = path.join(this.#codeExplainDir, CONFIG_FILE_NAME);

    if (!fs.existsSync(configFilePath)) {
      await fs.writeJson(configFilePath, this.defaultConfig, { spaces: CONFIG_DEFAULTS.JSON_INDENT_SPACES });
      console.log(`Default configuration created at ${configFilePath}`);
    }

    this.config = await fs.readJson(configFilePath);
  }

  getConfig() {
    return this.config;
  }
}

module.exports = ConfigManager;
</code></pre>
<p>This code snippet shows how the <code>ConfigManager</code> class loads configuration settings from a file and provides access to those settings.</p>
<p><strong>Example: AI Engine (ai/aiEngine.js)</strong></p>
<pre><code class="language-javascript">// Assumed structure - actual implementation would differ significantly
class AiEngine {
  constructor(config) {
    this.config = config;
  }

  async generateExplanation(prompt) {
    let response;
    if (this.config.provider === &#39;gemini&#39;) {
      // Code to interact with Gemini API
      response = await this.callGeminiAPI(prompt);
    } else if (this.config.provider === &#39;openai&#39;) {
      // Code to interact with OpenAI API
      response = await this.callOpenAIAPI(prompt);
    } else {
      throw new Error(`Unsupported AI provider: ${this.config.provider}`);
    }
    return response;
  }

  async callGeminiAPI(prompt) {
    // Replace with actual Gemini API call
    console.log(&quot;Calling Gemini API with prompt:&quot;, prompt);
    return &quot;Gemini Explanation&quot;; // Mock response
  }

  async callOpenAIAPI(prompt) {
    // Replace with actual OpenAI API call
    console.log(&quot;Calling OpenAI API with prompt:&quot;, prompt);
    return &quot;OpenAI Explanation&quot;; // Mock response
  }
}

module.exports = AiEngine;
</code></pre>
<p>This simplified example demonstrates the basic structure of the <code>aiEngine.js</code> module, which handles communication with AI models.</p>
<p>This architecture overview provides a solid foundation for understanding the codebase and its components. As a beginner developer, you can use this information to navigate the project, understand the relationships between modules, and contribute effectively.
```</p>

                </div>
            </div>
        </div>
    </div>
</div>
    
                </div>
            </div>
        </main>

        
    </div>

    <!-- Non-critical scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js" defer></script>
    <!-- Load common programming languages for syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/python.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/javascript.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/typescript.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/java.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/cpp.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/csharp.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/ruby.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/go.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/rust.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/php.min.js" defer></script>
     <script src="https://cdn.jsdelivr.net/npm/marked@9.1.0/marked.min.js" defer></script>
     <script src="https://cdn.jsdelivr.net/npm/marked-highlight@2.1.0/lib/index.umd.js" defer></script>
     <script src="https://cdn.jsdelivr.net/npm/mermaid@11.0.0/dist/mermaid.min.js" defer></script>
